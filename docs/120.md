# ä»‹ç»

> åŸæ–‡ï¼š<https://github.com/figment-networks/learn-tutorials/blob/master/polygon/Build-a-Social-Media-DApp-and-Deploy-it-on-Polygon.md>

![](img/fb2077ea3ffecb8d45f4ae1210e89132.png)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªåƒ YouTube ä¸€æ ·çš„ç¤¾äº¤åª’ä½“ DApp(åˆ†æ•£å¼åº”ç”¨ç¨‹åº)ï¼Œä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åœ¨ Polygon (Matic)å­Ÿä¹°æµ‹è¯•ç½‘ç»œä¸Šã€‚æ‰€ä»¥ï¼Œæ‹¿èµ·ä¸€æ¯å’–å•¡ <g-emoji class="g-emoji" alias="coffee" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/2615.png">â˜•ï¸</g-emoji> è®©æˆ‘ä»¬å¼€å§‹å§ï¼

DTube é¡¹ç›®æ˜¯ Akhilesh Thite åœ¨ 2021 å¹´ 7 æœˆè‡³ 8 æœˆçš„ ETHOdyssey è™šæ‹Ÿé»‘å®¢é©¬æ‹‰æ¾æœŸé—´åˆ›å»ºçš„ã€‚æ‰€æœ‰ç”¨äºåˆ›å»ºè¿™ä¸ª DApp çš„èµ„æºéƒ½å¯ä»¥åœ¨æœ¬æ•™ç¨‹æœ«å°¾çš„â€œå‚è€ƒèµ„æ–™â€ä¸€èŠ‚ä¸­æ‰¾åˆ°ã€‚

# å…ˆå†³æ¡ä»¶

æœ¬æ•™ç¨‹å‡è®¾ä½ æœ‰ä¸€äº›ç¼–ç¨‹çš„åˆçº§ç»éªŒå’ŒåŒºå—é“¾ç†è§£ã€‚

å­¦å®Œæœ¬æ•™ç¨‹åï¼Œæ‚¨å°†èƒ½å¤Ÿ:

*   åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¹‹ä¸Šæ„å»ºå…¨æ ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ã€‚
*   åœ¨ Polygon (Matic)å­Ÿä¹°æµ‹è¯•ç½‘ç»œä¸Šéƒ¨ç½²æ™ºèƒ½åˆçº¦ã€‚
*   ä½¿ç”¨æ¾éœ²å’Œ MetaMaskã€‚
*   ç†è§£ Web3 æ¦‚å¿µã€‚
*   ä½¿ç”¨ [Fleek](https://docs.fleek.co/) å¹³å°åœ¨ [IPFS](https://docs.ipfs.io/concepts/) ä¸¾åŠ DAppã€‚

# è¦æ±‚

æˆ‘ä»¬éœ€è¦æ‚¨çš„è®¡ç®—æœºä¸Šçš„ä»¥ä¸‹å†…å®¹æ¥æ„å»ºæˆ‘ä»¬çš„ DAppã€‚

### èŠ‚ç‚¹å’Œ npm

Node æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒåœ¨ web æµè§ˆå™¨ä¹‹å¤–æ‰§è¡Œ JavaScript ä»£ç ï¼Œnpm æ˜¯ä¸€ä¸ª JavaScript åŒ…å®‰è£…ç¨‹åºã€‚è¦åœ¨ä½ çš„ç”µè„‘ä¸Šå®‰è£… Node.js & npmï¼Œç‚¹å‡»è¿™ä¸ª[é“¾æ¥](https://nodejs.org/en/download/) - >æ ¹æ®ä½ çš„ç”µè„‘éœ€æ±‚ä¸‹è½½æ–‡ä»¶- >å®‰è£…æ–‡ä»¶ã€‚è¦æ£€æŸ¥æˆåŠŸçš„å®‰è£…ç±»å‹`npm -v`åœ¨ cmd æç¤ºç¬¦æˆ–ç»ˆç«¯ï¼Œå®ƒä¼šæ˜¾ç¤ºç‰ˆæœ¬ï¼Œè¿™æ„å‘³ç€ä½ å·²ç»æˆåŠŸåœ°å®‰è£…åœ¨ä½ çš„ç”µè„‘ä¸Šã€‚

### æ¾éœ²

Truffle æ˜¯å¼€å‘åŒºå—é“¾åº”ç”¨ç¨‹åºçš„æœ€ä½³å¼€å‘ç¯å¢ƒã€‚Truffle ç»™äº†æˆ‘ä»¬æ ·æ¿ä»£ç (æ¨¡æ¿ä»£ç )æ¥å¼€å§‹æ„å»ºæˆ‘ä»¬çš„ DAppã€‚

è¦å®‰è£… truffleï¼Œæ‰“å¼€ä¸€ä¸ªç»ˆç«¯(windows cmd æç¤ºç¬¦æˆ– mac ç»ˆç«¯)å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤:`npm install -g truffle`

### Ganache(æœ¬æ•™ç¨‹å¯é€‰)

åŠ çº³åˆ‡æ˜¯ DApp å‘å±•çš„ä¸ªäººåŒºå—é“¾ç¯å¢ƒã€‚å®ƒä¸ºä¸€ä¸ªæœ¬åœ°åŒºå—é“¾æä¾›äº† 10 ä¸ªé»˜è®¤è´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰ 100 ä¸ª ETHã€‚è¿™å¯¹äºæµ‹è¯•å’Œå¼€å‘éå¸¸æœ‰ç”¨ï¼Œ[å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œè¯·æŸ¥çœ‹](https://www.trufflesuite.com/ganache)ã€‚

### MetaMask Setup

å…ƒæ©ç ç”¨äºä¸ä»¥å¤ªåŠåŒºå—é“¾äº¤äº’ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡æµè§ˆå™¨æ‰©å±•æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºè®¿é—®ä»–ä»¬çš„ä»¥å¤ªåŠé’±åŒ…ï¼Œç„¶åå¯ä»¥ç”¨æ¥ä¸åˆ†æ•£çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚

è¦å®‰è£… MetaMask æ‰©å±•ï¼Œç‚¹å‡»è¿™ä¸ª[é“¾æ¥](https://metamask.io/)ã€‚ç°åœ¨ï¼Œ`Create a MetaMask account -> save the mnemonics (12 secret words) because we need those mnemonics at the time of deployment`

è¦é€šè¿‡å…ƒæ©ç ä¸å¤šè¾¹å½¢äº¤äº’ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»æ·»åŠ ä¸€ä¸ªæ–°çš„ RPC ç«¯ç‚¹ã€‚ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„ Fox å›¾æ ‡ï¼Œæ‰“å¼€ Metamask æ‰©å±•ï¼Œç„¶åé€‰æ‹©`Settings -> Networks -> Add network -> Save`ã€‚å¡«å†™ä¸‹å›¾ä¸­ç»™å‡ºçš„ä¿¡æ¯ã€‚

![](img/2cc97254baf13a8a47cfccd294cb7035.png)

ç°åœ¨ä½ ä¼šæ³¨æ„åˆ°é’±åŒ…é‡Œçš„ä½™é¢ä¸ºé›¶(0 Matic)ï¼Œä»¥è·å–æµ‹è¯• MATIC è¿›è¡Œéƒ¨ç½²å’Œæµ‹è¯•ï¼Œ`go to Matic Faucet -> Select Mumbai -> Paste wallet address -> Submit`ï¼ŒMATIC æ°´é¾™å¤´[é“¾æ¥](https://faucet.matic.network)ã€‚æå®šäº†ã€‚æ£€æŸ¥ä½ çš„é’±åŒ…ï¼Œä½ ä¼šåœ¨é‚£é‡Œçœ‹è§ä¸€äº› Maticã€‚*(æˆ‘ä»¬åªéœ€è¦å°‘é‡çš„ Matic (5-10 Matic)æ¥éƒ¨ç½²å’Œæµ‹è¯•æˆ‘ä»¬çš„ DAppã€‚)*

![](img/06cac7e75a23db7c96943beaaa42cbc6.png)

### æŠ€æœ¯å †æ ˆ

*   **è¯­è¨€:** `Solidity, JavaScript, HTML5, CSS3`
*   **åº“:** `React.js, Web3.js`
*   **å·¥å…·:** `IPFS`
*   **ç½‘ç»œ:** `Polygon (Matic)`
*   **å¹³å°:** `Ethereum, Fleek`

### è·¯æ ‡

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åœ¨ **Truffle** çš„å¸®åŠ©ä¸‹è®¾ç½®æˆ‘ä»¬çš„ç¼–ç ç¯å¢ƒï¼Œä¹‹åæˆ‘ä»¬å°†åœ¨ **solidity** ä¸­ç¼–å†™**æ™ºèƒ½åˆçº¦**ã€‚åœ¨ç¼–å†™æ™ºèƒ½å¥‘çº¦ä¹‹åï¼Œä¸ºäº†æ„å»ºæˆ‘ä»¬çš„ DApp çš„å‰ç«¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [React.js](https://reactjs.org/docs/getting-started.html) Javascript åº“åŠ ä¸Šä¸€äº› **HTML5ã€CSS3 & JavaScript** ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ **IPFS** (æ˜Ÿé™…æ–‡ä»¶ç³»ç»Ÿ)å°†æˆ‘ä»¬çš„è§†é¢‘æ•£åˆ—å­˜å‚¨åˆ°åŒºå—é“¾ï¼Œç¨åæˆ‘ä»¬å°†èƒ½å¤Ÿé€šè¿‡è°ƒç”¨è¿™äº›è§†é¢‘æ•£åˆ—æ¥æ’­æ”¾è¿™äº›è§†é¢‘ã€‚

ä¸ºäº†å°†æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸å‰ç«¯è¿æ¥èµ·æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Web3.js](https://web3js.readthedocs.io/en/v1.4.0/) ï¼Œç„¶åæˆ‘ä»¬å°†åœ¨**å­Ÿä¹°æµ‹è¯•ç½‘**ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ã€‚æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **Fleek** å¹³å°åœ¨ IPFS ä¸¾åŠè¿™ä¸ª DAppã€‚

ä»€ä¹ˆæ˜¯**æ™ºèƒ½åˆçº¦ï¼Ÿ**

æ™ºèƒ½åˆçº¦æ˜¯åŒºå—é“¾ä¸Šçš„ç‚¹å¯¹ç‚¹æ•°å­—ç”¨æˆ·åè®®ã€‚ä¸ºäº†åœ¨ä»¥å¤ªåŠä¸­ç¼–å†™æ™ºèƒ½åˆåŒï¼Œæˆ‘ä»¬ä½¿ç”¨ solidity ç¼–ç¨‹è¯­è¨€ã€‚

ä»€ä¹ˆæ˜¯ [Web3.js](https://web3js.readthedocs.io/en/v3.0.0-rc.5/) ï¼Ÿ

Web3.js æ˜¯ä¸€ç»„ JavaScript åº“ï¼Œå……å½“é€šå¾€åŒºå—é“¾ä¸–ç•Œçš„ç«¯å£ã€‚Web3 æ˜¯å°†æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦è¿æ¥åˆ° DApp å‰ç«¯çš„åª’ä»‹ã€‚

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å°†è¦ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå¹¶æä¾›äº†æ„å»º DApp çš„è·¯çº¿å›¾ã€‚ç°åœ¨åˆ°äº†æœ‰è¶£çš„éƒ¨åˆ†â€”â€”è®©æˆ‘ä»¬åš DApp å§ï¼

# é¡¹ç›®è®¾ç½®

ä¸ºäº†é¿å…å¤„ç†ä»»ä½•æ¼äººçš„ç‰ˆæœ¬é”™è¯¯&æˆ‘ä»¬ä¸æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å®‰è£…æ”¯æŒä»£ç åº“(ä¾èµ–é¡¹)ï¼Œè€Œæ˜¯é€šè¿‡å…‹éš†ä¸€ä¸ªåŒ…å«é¡¹ç›®æ–‡ä»¶çš„ GitHub åº“å¹¶å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–é¡¹æ¥å¼€å§‹æ„å»ºæˆ‘ä»¬çš„ DAppã€‚

*   `Fork`[å‚¨å­˜åº“](https://github.com/AkhileshThite/DTube)ï¼Œè¿™å°†åœ¨ä½ çš„è´¦æˆ·ä¸­å¤åˆ¶è¿™ä¸ªé¡¹ç›®ã€‚

*   ç”¨å‘½ä»¤`git clone https://github.com/<YourGitHubUsername>/DTube.git`å…‹éš† GitHub åº“ã€‚è¿™å°†æŠŠé¡¹ç›®æ–‡ä»¶ä» GitHub å¤åˆ¶åˆ°ä½ çš„ç”µè„‘ä¸Šã€‚

*   å‘½ä»¤`cd DTube`å°†å¸¦æ‚¨è¿›å…¥ä¸‹è½½åˆ°æ‚¨è®¡ç®—æœºä¸Šçš„å­˜å‚¨åº“çš„æœ¬åœ°å‰¯æœ¬ã€‚

ç°åœ¨ï¼Œç”¨ä½ æœ€å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨æˆ–è€… IDE æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ [VS Code](https://code.visualstudio.com) ã€‚

![](img/db291a63742aa85e5055bce294a61ee2.png)

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹:

*   `npm install`

æ³¨æ„:-éšç€æ•™ç¨‹çš„æ·±å…¥ï¼Œå¯¹äºæ¯ä¸ªéƒ¨åˆ†ï¼Œæ‚¨éƒ½å¯ä»¥ä»æ–‡ä»¶ä¸­æ¸…é™¤ä»£ç å¹¶è‡ªå·±ç¼–å†™ä»£ç ã€‚æ‚¨å¯ä»¥éšæ—¶ä»æœ¬æ•™ç¨‹æˆ–é¡¹ç›®çš„åŸå§‹ GitHub åº“ä¸­äº¤å‰æ£€æŸ¥æ‚¨çš„ä»£ç ã€‚

æ•™ç¨‹çš„æ¯ä¸€éƒ¨åˆ†éƒ½æœ‰ path å’Œ GitHub repo é“¾æ¥ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ»šåŠ¨æ¥å¯»æ‰¾å®ƒä»¬ã€‚

# å¯é çš„æ™ºèƒ½åˆåŒ

è·¯å¾„:`/src/contracts/DTube.sol`

æˆ‘ä»¬å°†è®¾è®¡æ™ºèƒ½åˆåŒä¸Šä¼ è§†é¢‘(ä¸ IPFS è§†é¢‘å“ˆå¸Œ)ï¼Œå­˜å‚¨è§†é¢‘(ä¸æ ‡é¢˜å’Œ IPFS è§†é¢‘å“ˆå¸Œ)ï¼Œåˆ—è¡¨è§†é¢‘(æŒ‰è§†é¢‘ id)åˆ°åŒºå—é“¾ã€‚

è®©æˆ‘ä»¬å®šä¹‰è¦ä½¿ç”¨çš„ Solidity ç¼–è¯‘å™¨çš„ç‰ˆæœ¬ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåä¸º DTube çš„ Solidity å¥‘çº¦ã€‚æœ€åˆï¼Œæˆ‘ä»¬æŒ‡å®šè§†é¢‘è®¡æ•°ä¸ºé›¶ã€‚`uint`è¡¨ç¤ºæ— ç¬¦å·æ•´æ•°æ•°æ®ç±»å‹(åªèƒ½æ˜¯ 0 ä»¥ä¸Šçš„æ•°å­—ï¼Œä¸èƒ½æ˜¯è´Ÿå€¼)ã€‚`string`è¡¨ç¤ºå­—ç¬¦ä¸²æ•°æ®ç±»å‹ã€‚åœ¨ ABI ( [åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£](https://docs.soliditylang.org/en/latest/abi-spec.html))çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬ç¨åå¯ä»¥é€šè¿‡åç§°â€œDTubeâ€æ¥å¼•ç”¨è¿™ä¸ªå¥‘çº¦ã€‚`public`çš„çŠ¶æ€å˜é‡ visibility ä¸å®‰å…¨æ€§æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå®ƒä»…ä»…æ„å‘³ç€å˜é‡ä¸æ˜¯éšè—çš„ï¼Œä¹Ÿä¸æ˜¯å¥‘çº¦æ‰€ç‹¬æœ‰çš„ã€‚`mapping(uint => Video) public videos`æ˜¯ä¸€ä¸ª`uint`å·å’Œä¸€ä¸ªè§†é¢‘ä¹‹é—´çš„æ˜ å°„ã€‚å› ä¸ºä¼šæœ‰å¤šä¸ªè§†é¢‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨æ¯ä¸ªå…ƒç´ `Video`çš„æ•°æ®ç±»å‹æ¥åˆ›å»ºä¸€ä¸ªå˜é‡`Videos`ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªä»£ç ç‰‡æ®µä¸­åˆ›å»ºè¿™ä¸ªå˜é‡ã€‚

```
pragma solidity ^0.5.0;

contract DTube {
  uint public videoCount = 0;
  string public name = "DTube";
  mapping(uint => Video) public videos;
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»º`Video`æ•°æ®ç±»å‹å’Œ`VideoUploaded`äº‹ä»¶ã€‚

```
// Create data types
  struct Video {
    uint id;    // video count
    string hash; // IPFS video hash
    string title; // Title of the video
    address author; // User's wallet address
  }
// Create an event
  event VideoUploaded(
    uint id,
    string hash,
    string title,
    address author
  );
```

è®©æˆ‘ä»¬åœ¨å‡½æ•°ç­¾åä¸­åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•°`_videoHash`å’Œ`_title`çš„`uploadVideo`å‡½æ•°ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ä¸€äº›æ¡ä»¶(è¦æ±‚ä¼ é€’çš„å‚æ•°é•¿åº¦å¤§äºé›¶)æ¥ç¡®ä¿`video hash`ã€`video title`ã€`uploader address`å­˜åœ¨ã€‚ä¹‹åï¼Œä¸ºäº†åŒºåˆ†è§†é¢‘ï¼Œæˆ‘ä»¬å°†å¢åŠ  videoCount(æ¯ä¸ªè§†é¢‘å°†æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·æ¥è¯†åˆ«å®ƒ)ã€‚

```
  constructor() public {
  } 

  function uploadVideo(string memory _videoHash, string memory _title) public {
    // Make sure the video hash exists
    require(bytes(_videoHash).length > 0);
    // Make sure video title exists
    require(bytes(_title).length > 0);
    // Make sure uploader address exists
    require(msg.sender!=address(0));

    // Increment video id
    videoCount ++;
```

æœ€åï¼Œæˆ‘ä»¬å°†é€šè¿‡åŒ…å«å˜é‡`videoCount`ã€`_videoHash`ã€`_title`ã€&æœ€å`msg.sender`å°†è§†é¢‘æ·»åŠ åˆ°åˆåŒä¸­ï¼Œè¿™æ˜¯ Solidity ä¸­çš„ä¸€ä¸ª[å…¨å±€å˜é‡](https://docs.soliditylang.org/en/latest/units-and-global-variables.html?highlight=msg.sender#special-variables-and-functions)ï¼Œå®ƒç®€å•åœ°è¡¨ç¤ºå½“å‰ç”¨æˆ·ã€‚ç„¶åæˆ‘ä»¬å°†å‘å‡º`VideoUploaded`äº‹ä»¶ï¼Œè¯¥äº‹ä»¶ä¼šå°†è¯¥ä¿¡æ¯å­˜å‚¨åœ¨å‘å‡ºè¯¥äº‹ä»¶çš„äº‹åŠ¡çš„æ—¥å¿—ä¸­ã€‚

```
    // Add video to the contract
    videos[videoCount] = Video(videoCount, _videoHash, _title, msg.sender);
    // Trigger an event
    emit VideoUploaded(videoCount, _videoHash, _title, msg.sender);
  }
}
```

# å—èŒè¿å¾™

*   è·¯å¾„:`/src/contracts/`
*   è·¯å¾„:`/migrations/`

æ¯å½“æˆ‘ä»¬é€šè¿‡å‘½ä»¤`truffle init`æˆ–`truffle unbox react`ä½¿ç”¨ truffle åˆ›å»º DApp æ—¶ï¼Œtruffle éƒ½ä¼šç»™æˆ‘ä»¬æ ·æ¿ä»£ç æ¥å¼€å§‹æ„å»ºæˆ‘ä»¬çš„ DAppã€‚å®ƒåŒ…å«ä»¥ä¸‹ä¸»è¦æ–‡ä»¶:

*   `migrations/1_initial_migration.js`
*   `contracts/Migrations.sol (& DTube.sol)`
*   `test`
*   `truffle-config.js`

(åœ¨éƒ¨ç½²æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒä¹‹å‰ï¼Œæˆ‘ä»¬ç¨åå°†è®¨è®º`truffle-config.js`ã€‚)

Truffle è¿ç§»æ˜¯ JavaScript æ–‡ä»¶ï¼Œå¸®åŠ©æ‚¨å°†åˆåŒéƒ¨ç½²åˆ°ä»¥å¤ªåŠ(æˆ–å…¶ä»– EVM å…¼å®¹çš„)ç½‘ç»œã€‚è¿™äº›æ–‡ä»¶è´Ÿè´£å‡†å¤‡æ‚¨çš„éƒ¨ç½²ä»»åŠ¡ï¼Œå®ƒä»¬æ˜¯åœ¨å‡è®¾æ‚¨çš„éƒ¨ç½²éœ€æ±‚ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜çš„æƒ…å†µä¸‹ç¼–å†™çš„ã€‚

å› æ­¤ï¼Œä¸ºäº†å°†æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ï¼Œåœ¨è¿ç§»æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`2_initial_migration.js`çš„æ–°æ–‡ä»¶éå¸¸é‡è¦ï¼Œè¯¥æ–‡ä»¶å°†ä¸æˆ‘ä»¬çš„`DTube.sol`åˆçº¦å¯¹è¯ã€‚

![](img/401996f9bb3472dcad52d097dc5c842d.png)

ä»£ç ç±»ä¼¼äº`1_initial_migration.js`ï¼Œåªæ˜¯ç”¨ DTube ä»£æ›¿äº†è¿ç§»ã€‚

`2_initial_migration.js`ä¼šæ˜¯è¿™æ ·çš„:

```
const DTube = artifacts.require("DTube");

module.exports = function(deployer) {
  deployer.deploy(DTube);
};
```

# ä½¿ç”¨ React.js çš„å‰ç«¯

è·¯å¾„:`/src/components/`

React åº”ç”¨ç¨‹åºç”±å„ç§ç»„ä»¶ç»„æˆï¼Œä¾‹å¦‚å¯¼èˆªæ ã€ä¸»é¡µã€ç½‘é¡µé¡µè„šç­‰ã€‚React åŠ è½½ä¸€ä¸ªå•ç‹¬çš„ HTML é¡µé¢(`/public/index.html`)ï¼Œç„¶åç”¨é¡¹ç›®ä¸­å®šä¹‰çš„æ‰€æœ‰ç»„ä»¶å¡«å……è¿™ä¸ªé¡µé¢ã€‚

![](img/003558a71b947141781cbc077b1606ae.png)

### app.js

ç°åœ¨è®©æˆ‘ä»¬æ¥å¤„ç†æˆ‘ä»¬çš„ä¸»`app.js`æ–‡ä»¶ï¼Œå®ƒå°†åŒ…å«æ‰€æœ‰çš„ç»„ä»¶(å¯¼èˆªæ ã€ä¸»é¡µé¢ã€é¡µè„š)ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å¯¼å…¥æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ç»„ä»¶å’Œåº“(åŒ…æ‹¬ web3.js ),å¹¶å®ä¾‹åŒ–æˆ‘ä»¬çš„ IPFS å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä» IPFS ç½‘ç»œå­˜å‚¨å’Œæ£€ç´¢æ–‡ä»¶ã€‚

```
import React, { Component } from "react";
import DTube from "../abis/DTube.json";
import Navbar from "./Navbar";
import Main from "./Main";
import Footer from "./Footer";
import Web3 from "web3";
import "./App.css";

//Declare IPFS
const ipfsClient = require("ipfs-http-client");
const ipfs = ipfsClient({
  host: "ipfs.infura.io",
  port: 5001,
  protocol: "https",
});
```

å…³äº JavaScript ä¸­çš„å¼‚æ­¥/ç­‰å¾…å‡½æ•°:

**å¼‚æ­¥**

å®ƒåªæ˜¯å…è®¸æˆ‘ä»¬ç¼–å†™åŸºäºæ‰¿è¯ºçš„ä»£ç ï¼Œå°±åƒå®ƒæ˜¯åŒæ­¥çš„ä¸€æ ·ï¼Œå¹¶ä¸”å®ƒæ£€æŸ¥æˆ‘ä»¬æ²¡æœ‰ä¸­æ–­æ‰§è¡Œçº¿ç¨‹ã€‚å®ƒé€šè¿‡äº‹ä»¶å¾ªç¯å¼‚æ­¥è¿è¡Œã€‚å¼‚æ­¥å‡½æ•°æ€»æ˜¯ä¼šè¿”å›å€¼ã€‚å®ƒç¡®ä¿ä¸€ä¸ªæ‰¿è¯ºè¢«è¿”å›ï¼Œå¦‚æœæ²¡æœ‰è¢«è¿”å›ï¼Œé‚£ä¹ˆ javascript è‡ªåŠ¨å°†å®ƒåŒ…è£…åœ¨ä¸€ä¸ªæ‰¿è¯ºä¸­ï¼Œè¿™ä¸ªæ‰¿è¯ºç”¨å®ƒçš„å€¼æ¥è§£æã€‚

**ç­‰å¾…**

Await å‡½æ•°ç”¨äºç­‰å¾…æ‰¿è¯ºã€‚å®ƒåªèƒ½åœ¨å¼‚æ­¥å—ä¸­ä½¿ç”¨ã€‚å®ƒè®©ä»£ç ä¸€ç›´ç­‰åˆ°æ‰¿è¯ºè¿”å›ç»“æœã€‚å®ƒåªä¼šè®©å¼‚æ­¥å—ç­‰å¾…ã€‚

*ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¼‚æ­¥/ç­‰å¾…å‡½æ•°[çš„ç®€å•è§£é‡Šã€‚](https://www.geeksforgeeks.org/async-await-function-in-javascript/)*

ä¹‹åï¼Œæˆ‘ä»¬å°†ç²˜è´´ MetaMask æŒ‡ç¤ºæˆ‘ä»¬åŠ è½½ web3 çš„ç¡®åˆ‡é»˜è®¤ä»£ç ã€‚å®ƒä»å…ƒæ©ç ä¸­è·å–ä»¥å¤ªåŠæä¾›ç¨‹åºï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°æ‚¨çš„ DApp ä¸­ï¼Œå¦‚æœæ‚¨çš„æµè§ˆå™¨æ²¡æœ‰å®‰è£…å…ƒæ©ç ï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºçª—å£â€œæ£€æµ‹åˆ°éä»¥å¤ªåŠæµè§ˆå™¨â€ã€‚ä½ åº”è¯¥è€ƒè™‘è¯•è¯• MetaMaskï¼â€æ¶ˆæ¯ã€‚

```
class App extends Component {

  async componentWillMount() {
    await this.loadWeb3()
    await this.loadBlockchainData()
  }

  async loadWeb3() {
    if (window.ethereum) {
      window.web3 = new Web3(window.ethereum)
      await window.ethereum.request({ method: 'eth_requestAccounts' })
    }
    else if (window.web3) {
      window.web3 = new Web3(window.web3.currentProvider)
    }
    else {
      window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!')
    }
  }
```

åœ¨`loadBlockchainData()`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†åŠ è½½ ETH è´¦æˆ·ï¼Œè¿æ¥ç½‘ç»œ IDï¼ŒæŒ‰æœ€æ–°çš„è§†é¢‘åˆ—è¡¨ã€‚å¦‚æœæ™ºèƒ½åˆçº¦æœªéƒ¨ç½²åˆ°ç›¸åº”çš„ç½‘ç»œï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºçª—å£â€œDTube åˆçº¦æœªéƒ¨ç½²åˆ°æ£€æµ‹åˆ°çš„ç½‘ç»œâ€æ¶ˆæ¯ã€‚

React ç»„ä»¶æœ‰ä¸€ä¸ªå†…ç½®çš„çŠ¶æ€å¯¹è±¡ã€‚çŠ¶æ€å¯¹è±¡æ˜¯å­˜å‚¨å±äºç»„ä»¶çš„å±æ€§å€¼çš„åœ°æ–¹ã€‚å½“çŠ¶æ€å¯¹è±¡æ”¹å˜æ—¶ï¼Œç»„ä»¶é‡æ–°å‘ˆç°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`this.state`è·å–åŒºå—é“¾æ•°æ®ï¼Œå¹¶åœ¨ç¨åä½¿ç”¨`this.props`åœ¨æˆ‘ä»¬çš„å‰ç«¯ react ç»„ä»¶ä¸­æ˜¾ç¤ºå®ƒã€‚

```
  async loadBlockchainData() {
    const web3 = window.web3;
    // Load account
    const accounts = await web3.eth.getAccounts();
    this.setState({ account: accounts[0] });
    // Network ID
    const networkId = await web3.eth.net.getId();
    const networkData = DTube.networks[networkId];
    if (networkData) {
      const dtube = new web3.eth.Contract(DTube.abi, networkData.address);
      this.setState({ dtube });
      const videosCount = await dtube.methods.videoCount().call();
      this.setState({ videosCount });
      // Load videos, sort by newest
      for (var i = videosCount; i >= 1; i--) {
        const video = await dtube.methods.videos(i).call();
        this.setState({
          videos: [...this.state.videos, video],
        });
      }
      //Set latest video with title to view as default
      const latest = await dtube.methods.videos(videosCount).call();
      this.setState({
        currentHash: latest.hash,
        currentTitle: latest.title,
      });
      this.setState({ loading: false });
    } else {
      window.alert("DTube contract not deployed to detected network.");
    }
  }
```

ç°åœ¨æˆ‘ä»¬å‡†å¤‡é€šè¿‡`captureFile`å‡½æ•°å°†æ–‡ä»¶ä¸Šä¼ åˆ° IPFSã€‚

```
  captureFile = (event) => {
    event.preventDefault();
    const file = event.target.files[0];
    const reader = new window.FileReader();
    reader.readAsArrayBuffer(file);

    reader.onloadend = () => {
      this.setState({ buffer: Buffer(reader.result) });
      console.log("buffer", this.state.buffer);
    };
  };
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦`uploadVideo`å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ è§†é¢‘æ–‡ä»¶åˆ° IPFSã€‚ä¸Šä¼ è§†é¢‘æ–‡ä»¶åˆ° IPFS æ—¶ï¼Œå®ƒä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸€æ¡ä¿¡æ¯â€œæäº¤æ–‡ä»¶åˆ° IPFSâ€¦â€¦â€ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†å¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„æ–‡ä»¶`ipfs.add()`:ä¸Šä¼ çš„æ–‡ä»¶&ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†æŠŠè§†é¢‘æ–‡ä»¶çš„ [CID](https://docs.ipfs.io/concepts/content-addressing/) å“ˆå¸Œå­˜å‚¨åˆ°åŒºå—é“¾ã€‚

```
  uploadVideo = (title) => {
    console.log("Submitting file to IPFS...");
    //adding file to the IPFS
    ipfs.add(this.state.buffer, (error, result) => {
      console.log("IPFS result", result);
      if (error) {
        console.error(error);
        return;
      }

      this.setState({ loading: true });
      this.state.dtube.methods
        .uploadVideo(result[0].hash, title)
        .send({ from: this.state.account })
        .on("transactionHash", (hash) => {
          this.setState({ loading: false });
        });
    });
  };
```

ä¸ºäº†å°†è§†é¢‘å“ˆå¸Œå’Œè§†é¢‘æ ‡é¢˜æ›´æ–°ä¸ºâ€œå½“å‰â€ï¼Œæˆ‘ä»¬å°†åˆ›å»º`changeVideo`å‡½æ•°ã€‚ä¹‹åï¼Œè®©æˆ‘ä»¬åˆ›å»ºç»‘å®šå‡½æ•°ï¼Œåœ¨æˆ‘ä»¬çš„å‰ç«¯ react ç»„ä»¶ä¸­æ˜¾ç¤ºåŒºå—é“¾æ•°æ®ã€‚

æ˜¯ React ä¸­çš„ä¸€ä¸ªå†…ç½®æ–¹æ³•ï¼Œç”¨äºå°†æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™åŸºäºç±»çš„ç»„ä»¶çš„å‡½æ•°ã€‚

```
  changeVideo = (hash, title) => {
    this.setState({ currentHash: hash });
    this.setState({ currentTitle: title });
  };

  constructor(props) {
    super(props);
    this.state = {
      buffer: null,
      account: "",
      dtube: null,
      videos: [],
      loading: true,
      currentHash: null,
      currentTitle: null,
    };

    this.uploadVideo = this.uploadVideo.bind(this);
    this.captureFile = this.captureFile.bind(this);
    this.changeVideo = this.changeVideo.bind(this);
  }
```

æœ€åï¼Œè®©æˆ‘ä»¬åœ¨é¡¶éƒ¨æ·»åŠ æˆ‘ä»¬å¯¼å…¥çš„æ‰€æœ‰ç»„ä»¶`<Navbar>`ã€`<Main>`ã€&ã€`<Footer>`ã€‚è®°ä½`this.state`æ­£åœ¨è·å–æ‰€æœ‰åŒºå—é“¾æ•°æ®ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›æ•°æ®åœ¨ react å‰ç«¯ç»„ä»¶ä¸­æ˜¾ç¤ºã€‚

åœ¨`<Navbar>`ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºç”¨æˆ·çš„è´¦æˆ·åœ°å€ï¼Œå› æ­¤`<Navbar account={this.state.account} />`å°†è·å–ç”¨æˆ·çš„å½“å‰è´¦æˆ·åœ°å€ï¼Œæˆ‘ä»¬å°†åœ¨`this.props.account`ä¹‹å‰åœ¨`Navbar.js`ç»„ä»¶ä¸­æ˜¾ç¤ºè¯¥åœ°å€ã€‚åŒæ ·ï¼Œå¯¹äºæˆ‘ä»¬çš„ DApp çš„ä¸»è¦å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦è§†é¢‘ï¼Œä¸Šä¼ è§†é¢‘ï¼Œæ•è·æ–‡ä»¶ï¼Œæ”¹å˜è§†é¢‘ï¼Œå½“å‰å“ˆå¸Œï¼Œå½“å‰æ ‡é¢˜æ•°æ®æ˜¾ç¤ºåœ¨`Main.js`ç»„ä»¶ã€‚

```
  render() {
    return (
      <div>
        <Navbar account={this.state.account} />
        {this.state.loading ? (
          <div id="loader" className="text-center mt-5">
            <p>Loading...</p>
          </div>
        ) : (
          <Main
            videos={this.state.videos}
            uploadVideo={this.uploadVideo}
            captureFile={this.captureFile}
            changeVideo={this.changeVideo}
            currentHash={this.state.currentHash}
            currentTitle={this.state.currentTitle}
          />
        )}
        <Footer />
      </div>
    );
  }
}

export default App;
```

### Navbar.js

![](img/5383daf2a468c14155c7b61d5f45be43.png)

åœ¨ Navbar ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºå“ç‰Œå¾½æ ‡ã€å“ç‰Œåç§°ã€ç”¨æˆ·å¸æˆ·åœ°å€å’Œç”¨æˆ·ä¸ªäººèµ„æ–™(åŒ…æ‹¬ä¸€ä¸ªä½¿ç”¨ JavaScript åº“çš„å”¯ä¸€æ ‡è¯†)ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å¯¼å…¥ä»£ç å’Œå“ç‰Œ logoã€‚æˆ‘ä»¬å°†ä½¿ç”¨ [Bootstrap](https://getbootstrap.com/) æ¥åˆ¶ä½œæˆ‘ä»¬çš„å¯¼èˆªæ ã€‚

```
import React, { Component } from "react";
import Identicon from "identicon.js"; //user profile
import dtube from "../dtube.png"; //logo

class Navbar extends Component {
  render() {
    return (
      <nav className="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow text-monospace">
        <a
          className="navbar-brand ml-1 col-sm-3 col-md-2 mr-0"
          href="/"
          rel="noopener noreferrer"
        >
          <img
            src={dtube}
            width="30"
            height="30"
            className="d-inline-block align-top"
            alt="DTube logo"
          />
          &nbsp;DTube
        </a>
        <ul className="navbar-nav px-3">
          <li className="nav-item text-nowrap h5 d-none d-sm-none d-sm-block">
            <small className="text-secondary">
              <small id="account">{this.props.account}</small>
            </small>
            {this.props.account ? (
              <img
                className="ml-2"
                width="30"
                height="30"
                src={`data:image/png;base64,${new Identicon(
 this.props.account,
 30
 ).toString()}`}
                alt="DTube account address"
              />
            ) : (
              <span></span>
            )}
          </li>
        </ul>
      </nav>
    );
  }
}

export default Navbar;
```

æˆ‘ä»¬ç”¨`this.props.account`å±æ€§åœ¨è¿™ä¸ªç»„ä»¶ä¸­æ˜¾ç¤ºç”¨æˆ·åœ°å€ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µä½¿ç”¨äº† [React æ¡ä»¶æ¸²æŸ“](https://reactjs.org/docs/conditional-rendering.html)å’Œ JavaScript [ä¸‰å…ƒè¿ç®—ç¬¦](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator):å¦‚æœç”¨æˆ·è´¦å·åœ°å€å­˜åœ¨ï¼Œé‚£ä¹ˆæ˜¾ç¤º identicon ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚å¦åˆ™ï¼Œæ˜¾ç¤ºç©ºç™½`<span>`ã€‚

```
            {this.props.account ? (
              <img
                className="ml-2"
                width="30"
                height="30"
                src={`data:image/png;base64,${new Identicon(
 this.props.account,
 30
 ).toString()}`}
                alt="DTube account address"
              />
            ) : (
              <span></span>
```

### ä¸»é¡µ. js

![](img/4bb49c82756d23af2b73340d5ba18ef5.png)

ä¸ºäº†æ˜¾ç¤ºå½“å‰ä¸Šä¼ çš„è§†é¢‘å’Œè§†é¢‘æ ‡é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`this.props.currentHash` & `this.props.currentTitle`å±æ€§ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œä½¿ç”¨`https://ipfs.infura.io/ipfs/`ï¼Ÿå› ä¸º [Infura](https://infura.io/) å°†[é”å®šæˆ‘ä»¬çš„ IPFS æ–‡ä»¶](https://docs.ipfs.io/concepts/persistence/)ä»¥ä¿æŒæ–‡ä»¶å¯¹ç½‘ç»œå¯ç”¨ã€‚å¦åˆ™ï¼Œå¦‚æœæˆ‘ä»¬è¿æ¥çš„ IPFS èŠ‚ç‚¹å…³é—­ï¼Œè§†é¢‘æ–‡ä»¶å¯èƒ½ä¸å¯ç”¨ã€‚æœ‰å‡ ç§å¯ç”¨çš„ IPFS é”å®šæœåŠ¡ï¼ŒInfura ç”±äºå…¶å¼¹æ€§æ˜¯æœ€å¸¸ç”¨çš„æœåŠ¡ä¹‹ä¸€ã€‚

```
import React, { Component } from "react";
import "./App.css";

class Main extends Component {
  render() {
    return (
      <div className="container-fluid text-monospace main">
        <br></br>
        &nbsp;
        <br></br>
        <div className="row">
          <div className="col-md-10">
            <div
              className="embed-responsive embed-responsive-16by9"
              style={{ maxHeight: "720px" }}
            >
              <video
                src={`https://ipfs.infura.io/ipfs/${this.props.currentHash}`}
                controls
              ></video>
            </div>
            <h3 className="mt-3">
              <b>
                <i className="video-title">{this.props.currentTitle}</i>
              </b>
            </h3>
          </div>
```

![](img/9e7ce6349befc1f09e55267338e4d556.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨è§†é¢‘æè¦ä¸­åˆ›å»ºä¸€ä¸ªè¡¨å•æ¥é€‰æ‹©è§†é¢‘æ–‡ä»¶ã€è¾“å…¥è§†é¢‘æ ‡é¢˜å¹¶ä¸Šä¼ è§†é¢‘ã€‚æˆ‘ä»¬å°†é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†é€šè¿‡`this.props.captureFile`æ–¹æ³•ä¸Šä¼ åˆ° IPFSã€‚ç„¶åæˆ‘ä»¬è¦è¾“å…¥`video ref={(input) => { this.videoTitle = input }}`çš„æ ‡é¢˜ã€‚åœ¨`onSubmit`äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡`this.props.uploadVideo(title)`ä¸Šä¼ å¸¦æœ‰è§†é¢‘æ ‡é¢˜çš„è§†é¢‘æ–‡ä»¶ã€‚

```
          <div
            className="vide-feed col-md-2 border border-secondary overflow-auto text-center"
            style={{ maxHeight: "4000px", minWidth: "175px" }}
          >
            <h5 className="feed-title">
              <b>Video Feed ğŸ“º</b>
            </h5>
            <form
              onSubmit={(event) => {
                event.preventDefault();
                const title = this.videoTitle.value;
                this.props.uploadVideo(title);
              }}
            >
              &nbsp;
              <input
                type="file"
                accept=".mp4, .mov, .mkv .ogg .wmv"
                onChange={this.props.captureFile}
                style={{ width: "250px" }}
              />
              <div className="form-group mr-sm-2">
                <input
                  id="videoTitle"
                  type="text"
                  ref={(input) => {
                    this.videoTitle = input;
                  }}
                  className="form-control-sm mt-3 mr-3"
                  placeholder="Title.."
                  required
                />
              </div>
              <button
                type="submit"
                className="btn border border-dark btn-primary btn-block btn-sm"
              >
                Upload
              </button>
              &nbsp;
            </form>
```

![](img/ac5a2053023ddaeb96784c9218a193b1.png)

æœ€åï¼Œä¸ºäº†åœ¨è§†é¢‘æè¦ä¸­åˆ—å‡ºæ‰€æœ‰ä¹‹å‰ä¸Šä¼ çš„è§†é¢‘åŠå…¶æ ‡é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`video.hash`å’Œ`video.title`å±æ€§ã€‚æ¯å½“æˆ‘ä»¬ç‚¹å‡»ä»»ä½•åˆ—å‡ºçš„/å…ˆå‰çš„è§†é¢‘æ—¶ï¼Œ`changeVideo`åŠŸèƒ½ä¼šå°†`video.hash`å’Œ`video.title`è½¬æ¢ä¸º`currentHash` & `currentTitle`ï¼Œè¿™æ ·æ‰€é€‰çš„è§†é¢‘å°±ä¼šå‡ºç°åœ¨å±å¹•ä¸Šã€‚

```
            {this.props.videos.map((video, key) => {
              return (
                <div
                  className="card mb-4 text-center hover-overlay bg-secondary mx-auto"
                  style={{ width: "195px" }}
                  key={key}
                >
                  <div className="card-title bg-dark">
                    <small className="text-white">
                      <b>{video.title}</b>
                    </small>
                  </div>
                  <div>
                    <p
                      onClick={() =>
                        this.props.changeVideo(video.hash, video.title)
                      }
                    >
                      <video
                        src={`https://ipfs.infura.io/ipfs/${video.hash}`}
                        style={{ width: "170px" }}
                      />
                    </p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    );
  }
}

export default Main;
```

å“‡ï¼Œä»£ç çœŸå¤šï¼æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤`npm start`åœ¨æœ¬åœ°è¿è¡Œ React åº”ç”¨ç¨‹åºã€‚å½“ç„¶ï¼ŒåŠŸèƒ½ç¼ºå¤±ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨å¤šè¾¹å½¢(Matic)ç½‘ç»œä¸Šéƒ¨ç½²æˆ‘ä»¬çš„å¯é æ€§å¥‘çº¦ã€‚

*`<Footer>`ç»„ä»¶æ˜¯å‡ºäºé»‘å®¢é©¬æ‹‰æ¾çš„ç›®çš„åœ¨ bootstrap ä¸­åˆ›å»ºçš„ã€‚è¿™å’Œæˆ‘ä»¬çš„ DApp æ²¡æœ‰å…³ç³»ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ç®€å•åœ°ä¿®æ”¹è¯¥éƒ¨åˆ†ã€‚*

# åœ¨å¤šè¾¹å½¢ä¸Šéƒ¨ç½²æ™ºèƒ½åˆåŒ(Matic)

### å—èŒé…ç½®

*   `truffle-config.js`å¯¹äº Mac ç”¨æˆ·
*   `truffle.js`å¯¹äº Windows ç”¨æˆ·

truffle-config æ–‡ä»¶æ˜¯ä¸€ä¸ªéœ€è¦ç†è§£çš„é‡è¦æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é…ç½® DTube Solidity æ–‡ä»¶(æ™ºèƒ½åˆçº¦)ã€åˆçº¦ ABI çš„è·¯å¾„ï¼Œå¹¶å®šä¹‰å¯ç”¨çš„**ç½‘ç»œ**ã€‚

```
const HDWalletProvider = require("@truffle/hdwallet-provider")
require('dotenv').config(); // Load .env file

module.exports = {
  networks: {
   // For Ganache, your personal blockchain
   development: {
      host: "127.0.0.1",     // Localhost (default: none)
      port: 8545,            // Standard Ethereum port 
      network_id: "*",       // Any network (default: none)
    },
  },
  contracts_directory: './src/contracts/', // path to Smart Contracts
  contracts_build_directory: './src/abis/', // Path to ABIs
  compilers: {
    solc: {
      optimizer: {
        enabled: true,
        runs: 200
      }
    }
  }
}
```

ç¡®ä¿æ‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•(`~/DTube/.env`)ä¸­åˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶ï¼Œå¹¶å°†æ‚¨æœ€å¥½æ–°ç”Ÿæˆçš„ã€ä»…ç”¨äº testnet çš„å…ƒæ©ç  wallet çš„ç§˜å¯†æ¢å¤çŸ­è¯­(12 ä¸ªå•è¯)ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨å˜é‡ååŠ©è®°ç¬¦ã€‚è¿™å°†ç”± truffle åœ¨è¿è¡Œæ—¶åŠ è½½ï¼Œç„¶åå¯ä»¥ç”¨`process.env.MNEMONIC`è®¿é—®ç¯å¢ƒå˜é‡ã€‚

```
MNEMONIC= 12 secret words here.. 
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ truffle-config æ–‡ä»¶ä¸­æ·»åŠ `matic` networkï¼Œå®ƒå°†åŒ…å«æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡åŠ©è®°ç¬¦å’Œ RPC URLã€‚

```
    matic: {
      provider: () => new HDWalletProvider(process.env.MNEMONIC, 
      `https://rpc-mumbai.matic.today`),
      network_id: 80001,
      confirmations: 2,
      timeoutBlocks: 200,
      skipDryRun: true,
      gas: 6000000,
      gasPrice: 10000000000,
    },
```

å¦‚ä¸Šé¢çš„ä»£ç å—æ‰€ç¤ºï¼Œæ‚¨å¯ä»¥ä¸ºæ›´å¿«çš„äº¤æ˜“è®¾ç½®å¤©ç„¶æ°”ä»·æ ¼å’Œå¤©ç„¶æ°”é™åˆ¶ã€‚

### éƒ¨ç½²æ™ºèƒ½åˆåŒ

*   å‘½ä»¤:`truffle migrate --network matic`

å¦‚æœæ‚¨æ˜¯ç¬¬äºŒæ¬¡éƒ¨ç½²å®ƒï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿›è¡Œéƒ¨ç½²ï¼Œåªæ˜¯ä¸ºäº†**é‡ç½®**å¹¶é¿å… JSON é”™è¯¯ã€‚

*   å‘½ä»¤:`truffle migrate --network matic --reset`

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä¸‹å†…å®¹:

```
2_deploy_contracts.js
=====================

   Replacing 'MyContract'
   ------------------
   > transaction hash:    0x1c94d095a2f629521344885910e6a01076188fa815a310765679b05abc09a250
   > Blocks: 5            Seconds: 5
   > contract address:    0xbFa33D565Fcb81a9CE8e7a35B61b12B04220A8EB
   > block number:        2371252
   > block timestamp:     1578238698
   > account:             0x9fB29AAc15b9A4B7F17c3385939b007540f4d791
   > balance:             79.409358061899298312
   > gas used:            1896986
   > gas price:           0 gwei
   > value sent:          0 ETH
   > total cost:          0 ETH

   Pausing for 2 confirmations...
   ------------------------------
   > confirmation number: 5 (block: 2371262)
initialised!

   > Saving migration to chain.
   > Saving artifacts
   -------------------------------------
   > Total cost:                   0 ETH

Summary
=======
> Total deployments:   2
> Final cost:          0 ETH
```

æ¥è‡ª matic truffle æ–‡æ¡£çš„ä»£ç ç‰‡æ®µã€‚

**é‡è¦æç¤º:å¦‚æœæ‚¨åœ¨å°† Solidity å¥‘çº¦éƒ¨ç½²åˆ° Polygon (Matic)æ—¶é‡åˆ°ä»»ä½•é”™è¯¯ï¼Œè¯·æŸ¥çœ‹ Figment learn ä¸Šçš„[åœ¨ Polygon ä¸Šéƒ¨ç½²å’Œè°ƒè¯•æ™ºèƒ½å¥‘çº¦](https://learn.figment.io/tutorials/deploying-and-debugging-smart-contracts-on-polygon)æ•™ç¨‹çš„â€œå¤„ç†ä¸åŒé”™è¯¯â€éƒ¨åˆ†ã€‚**

ç°åœ¨è®©æˆ‘ä»¬ç”¨å‘½ä»¤`npm start`åœ¨ [http://localhost:3000/](http://localhost:3000/) ä¸Šè¿è¡Œ React åº”ç”¨ç¨‹åºã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ° MetaMask å¼¹å‡ºçª—å£ï¼Œè¯¢é—®æ‚¨æ˜¯å¦æ„¿æ„å°† MetaMask wallet è¿æ¥åˆ°è¯¥ç«™ç‚¹ã€‚ä¸€æ—¦è¿æ¥ï¼Œæ‚¨å¯ä»¥ä¸Šä¼ å’Œåˆ†äº«è§†é¢‘åœ¨æ‚¨çš„ DAppï¼Œè¿™æ˜¯éƒ¨ç½²åœ¨å¤šè¾¹å½¢(Matic)ç½‘ç»œï¼

![](img/8de5de2294e38bdeca9d549d96f16c4c.png)

# ä½¿ç”¨ Fleek åœ¨ IPFS ä¸»æŒ DApp

å¦‚æœæ‚¨å°†è¿™ä¸ªé¡¹ç›®æ‰˜ç®¡åœ¨ä»»ä½•ä¸€ä¸ªé›†ä¸­å¼æœåŠ¡å™¨ä¸Šï¼Œæ‚¨å°±ä¸èƒ½ç§°ä¹‹ä¸ºâ€œåˆ†æ•£å¼åº”ç”¨ç¨‹åºâ€ã€‚ä¸ºäº†ä½¿å…¶åˆ†æ•£åŒ–ï¼Œæˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨ IPFSã€‚ä½†æ˜¯è¿™é‡Œçš„é—®é¢˜æ˜¯ä½ ä¸èƒ½ç”¨ç›¸åŒçš„ IPFS æ•£åˆ—æ¥æ›´æ–°/ä¿®æ”¹é¡¹ç›®ã€‚IPFS ä½¿ç”¨åŸºäºå†…å®¹çš„å¯»å€ï¼Œå› æ­¤æ¯ä¸ªèµ„äº§éƒ½æœ‰è‡ªå·±å”¯ä¸€çš„åœ°å€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨â€œFleekâ€IPFS æ‰˜ç®¡å’Œ Filecoin å­˜å‚¨å¹³å°çš„åœ°æ–¹ï¼Œæ‚¨å¯ä»¥**éƒ¨ç½²é¡¹ç›®ã€è·å–é“¾æ¥ã€è·å– SSL è¯ä¹¦ã€åˆ†é…åŸŸï¼Œå¹¶é€šè¿‡ç®€å•åœ°è¿æ¥æ‚¨çš„ GitHub å­˜å‚¨åº“**æ¥æ›´æ–°é¡¹ç›®ã€‚å½“ä½ åœ¨å›è´­ä¸Šæ¨ä»»ä½•å˜åŒ–ï¼Œfleek å°†è‡ªåŠ¨æ›´æ–°ä¸æ–°çš„ IPFS æ•£åˆ—åœ¨åŒä¸€ä¸ª Fleek ç½‘å€çš„å˜åŒ–ã€‚å¤šé…·å•Šã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆåšçš„ã€‚

åœ¨ Fleek ä¸Šæ‰˜ç®¡ DApp ä¹‹å‰ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`.gitignore`æ–‡ä»¶ï¼Œå°†`node_modules`å’Œ`.env`æ”¾åœ¨`.gitignore`æ–‡ä»¶ä¸­çš„ä¸åŒè¡Œä¸Šï¼Œå¹¶è®°ä½å°†æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ã€‚

{% hint style="warning" %}åˆ‡å‹¿å…±äº«æˆ–æäº¤æ‚¨çš„`.env`æ–‡ä»¶ã€‚å®ƒåŒ…å«æ‚¨çš„å‡­è¯ï¼Œå¦‚`mnemonics`å’Œ`API`å¯†é’¥ã€‚å› æ­¤ï¼Œå»ºè®®å°†`.env`æ·»åŠ åˆ°æ‚¨çš„`.gitignore`æ–‡ä»¶ä¸­ã€‚{% endhint %}

```
/node_modules
.env
```

åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨åº“ï¼Œå¹¶æ¨é€æ‰€æœ‰çš„æ›´æ”¹ã€‚

*`Sign up on` [å¼—åˆ©å…‹](https://fleek.co/) `-> Add new site -> Connect GitHub repo -> select framework (React in our case) -> Deploy Site`*

å°±æ˜¯è¿™æ ·ï¼éƒ¨ç½²ç½‘ç«™åï¼Œæ‚¨å°†è·å¾— DApp çš„ fleek é“¾æ¥ï¼Œæ‚¨å¯ä»¥åˆ†é…ä¸€ä¸ªåŸŸï¼Œå¹¶ä¸ä¸–ç•Œä¸Šçš„ä»»ä½•äººå…±äº«æ‚¨çš„ DApp é“¾æ¥ã€‚æ­å–œä½ ï¼æ‚¨å·²ç»æ„å»ºäº†ä¸€ä¸ªçœŸæ­£å»ä¸­å¿ƒåŒ–çš„ç¤¾äº¤åª’ä½“åº”ç”¨ç¨‹åºã€‚

# ç»“è®º

æ­å–œä½ ï¼å®Œæˆæœ¬æ•™ç¨‹åï¼Œæ‚¨åº”è¯¥å¯¹å¦‚ä½•ä¸ºè§†é¢‘å†…å®¹åˆ›å»º dApp ä»¥åŠå¦‚ä½•åœ¨ Polygon ä¸Šéƒ¨ç½²å®ƒæœ‰äº†å¾ˆå¥½çš„ç†è§£ã€‚

# å…³äºä½œè€…

æˆ‘æ˜¯ Akhilesh Thiteï¼Œä¸€åå°åº¦çš„æŠ€æœ¯çˆ±å¥½è€…ï¼Œå¯¹è½¯ä»¶å¼€å‘ã€å¼€æºå’Œå»ä¸­å¿ƒåŒ–å……æ»¡çƒ­æƒ…ã€‚è¯·éšæ—¶åœ¨[GitHub](https://github.com/AkhileshThite)&[Twitter](https://twitter.com/AkhileshThite_)ä¸Šä¸æˆ‘è”ç³»ã€‚

# å‚è€ƒ

*   *æ¾éœ²æ–‡ä»¶:[https://www.trufflesuite.com/docs/truffle/overview](https://www.trufflesuite.com/docs/truffle/overview)*
*   *å¤šè¾¹å½¢(Matic)æ–‡æ¡£:[https://docs . Matic . network/docs/develop/getting-started](https://docs.matic.network/docs/develop/getting-started)*
*   *meta mask docs:[https://docs.metamask.io/guide/#why-metamask](https://docs.metamask.io/guide/#why-metamask)*
*   *web 3 docs:[https://web3js.readthedocs.io/en/v1.4.0/](https://web3js.readthedocs.io/en/v1.4.0/)*
*   *ååº”æ–‡ä»¶:[https://reactjs.org/docs/getting-started.html](https://reactjs.org/docs/getting-started.html)*
*   *å¼—åˆ©å…‹æ–‡ä»¶:[https://docs.fleek.co](https://docs.fleek.co)*
*   *IPFS æ–‡æ¡£:[https://docs . ipfs . io/concepts/what-is-ipfs/#å»ä¸­å¿ƒåŒ–](https://docs.ipfs.io/concepts/what-is-ipfs/#decentralization)*
*   *Async/Await:[https://www . geeks forgeeks . org/Async-Await-function-in-JavaScript/](https://www.geeksforgeeks.org/async-await-function-in-javascript/)*
*   *Dapp å¤§å­¦ YouTube:[https://www.youtube.com/watch?v=OLsteD3xkPQ](https://www.youtube.com/watch?v=OLsteD3xkPQ)*
*   *åœ¨ Polygon ä¸Šéƒ¨ç½²&è°ƒè¯•æ™ºèƒ½åˆçº¦:[https://learn . fig ment . io/tutorials/Deploying-and-debug-smart-contracts-on-Polygon](https://learn.figment.io/tutorials/deploying-and-debugging-smart-contracts-on-polygon)*