# mirror/06-mint-nft

> åŸæ–‡ï¼š<https://github.com/figment-networks/learn-tutorials/blob/master/mirror/06-mint-nft.md>

ä¸å¯æ›¿ä»£ä»¤ç‰Œ(NFT)æ˜¯ä¸€é¡¹è¿·äººçš„æŠ€æœ¯ï¼Œç”±åŒºå—é“¾åè®®çš„åˆ†ç±»å¸åŠŸèƒ½æä¾›æ”¯æŒã€‚å®ƒä»¬å…è®¸æˆ‘ä»¬é€šè¿‡æä¾›åˆ†æ•£ä¸”æ˜“äºéªŒè¯çš„æ‰€æœ‰æƒè®°å½•æ¥è¯æ˜æ•°å­—èµ„äº§çš„æ‰€æœ‰æƒã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¢«ç§°ä¸º [ERC-721](https://ethereum.org/en/developers/docs/standards/tokens/erc-721/) çš„æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº† NFT çš„åŸºæœ¬åŠŸèƒ½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„æ™ºèƒ½åˆçº¦å®ç°æ¥æœ€å°åŒ–æˆ‘ä»¬çš„å·¥ä½œï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬åˆ›å»ºçš„ä»¤ç‰Œçš„å®‰å…¨æ€§ã€‚

{% sidenote title="Box 6.1:å…³äºæ™ºèƒ½åˆçº¦çš„è¯´æ˜" %}æ™ºèƒ½åˆçº¦æ˜¯è¿è¡Œåœ¨ç‰¹å®šåŒºå—é“¾åè®®ä¸Šçš„è®¡ç®—æœºç¨‹åºï¼Œå¯ä»¥è¢«æ‰§è¡Œä»¥åœ¨åŒºå—é“¾ä¸Šæ‰§è¡Œæ“ä½œã€‚å®ƒä»¬æ˜¯ç¡®å®šæ€§çš„ï¼Œå…·æœ‰ç‰¹å®šçš„ã€æœ‰é™çš„åŠŸèƒ½ï¼Œæ—¨åœ¨å¯¹å…·æœ‰æŸäº›å¯é¢„æµ‹çŠ¶æ€å˜åŒ–çš„è¾“å…¥åšå‡ºååº”ã€‚ä¸€ä¸ªå¸¸è§çš„ç‰©ç†ç±»æ¯”æ˜¯è‡ªåŠ¨å”®è´§æœºã€‚ä½ æŠ•å…¥é¢„å…ˆè®¾å®šå¥½çš„é’±ï¼Œæœºå™¨å°±ä¼šæŠŠä¸€ä»½ç‚¹å¿ƒæ”¾è¿›æŠ•å¸å£ï¼Œè®©ä½ å»å–ã€‚è¯·æ³¨æ„ï¼Œä¸ crypto ä¸­çš„è®¸å¤šæ ‡ç­¾ä¸€æ ·ï¼Œæœ¯è¯­â€œæ™ºèƒ½åˆåŒâ€å¯èƒ½ä¼šæœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿™ä¸ªè¯çš„æ™ºèƒ½æ„ä¹‰ä¸Šå¹¶ä¸æ™ºèƒ½ï¼Œè€Œä¸”å®ƒä»¬è‚¯å®šä¸æ˜¯åˆæ³•çš„åˆåŒã€‚

æˆ‘ä»¬å°†åˆ©ç”¨ [OpenZeppelin](https://openzeppelin.com/) ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†æ™ºèƒ½åˆåŒåº“ï¼Œå·²ç»è¿‡å®‰å…¨å®¡è®¡ï¼Œå®Œå…¨å¯ç»„åˆã€‚ä¸æ‚¨ä»¥å‰å¯èƒ½ä½¿ç”¨è¿‡çš„ä»»ä½•åº“æˆ–åŒ…ä¸€æ ·ï¼Œè¿™å…è®¸æˆ‘ä»¬ä»ç°æˆçš„åŠŸèƒ½ä¸­å—ç›Šï¼Œå¹¶åœ¨æˆ‘ä»¬éœ€è¦ä»»ä½•å®šåˆ¶æ—¶æ‰©å±•å®ƒã€‚

Hardhat æ˜¯å¦ä¸€ä¸ªé‡è¦çš„å·¥å…·ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å®ƒä½œä¸ºå¼€å‘ç¯å¢ƒã€‚å®ƒå°†å…è®¸æˆ‘ä»¬ç¼–è¯‘ [Solidity](https://docs.soliditylang.org/) ï¼Œè¿™æ˜¯æˆ‘ä»¬å°†ç”¨æ¥ç¼–å†™æ™ºèƒ½åˆåŒçš„ç¼–ç¨‹è¯­è¨€ã€‚æ­¤å¤–ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªå•å…ƒæµ‹è¯•çš„æµ‹è¯•æ¡†æ¶ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œå°†æœ‰åŠ©äºéƒ¨ç½²åˆ°[å¤šè¾¹å½¢](https://polygon.technology/)ã€‚

# å®æ–½ <g-emoji class="g-emoji" alias="jigsaw" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f9e9.png">ğŸ§©</g-emoji>

å¦‚æœæ‚¨å¯¼èˆªåˆ°`web3/contracts/MirrorClone.sol`ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬å·²ç»ä¸ºæ‚¨æ­å»ºäº†ä¸€ä»½æ™ºèƒ½åˆåŒã€‚åœ¨æ·±å…¥æˆ‘ä»¬éœ€è¦ç¼–å†™çš„`createToken`å‡½æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸€ä¸‹ä»£ç çš„ä¸€èˆ¬ç»“æ„ã€‚

# æ™ºèƒ½åˆåŒå®¡æŸ¥ <g-emoji class="g-emoji" alias="monocle_face" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f9d0.png">ğŸ§</g-emoji>

ä½¿ç”¨`pragma`å…³é”®å­—ï¼Œåšå›ºæ€§ç¨‹åºå¿…é¡»æ€»æ˜¯ä»é¡¶éƒ¨çš„åšå›ºæ€§ç‰ˆæœ¬å¼€å§‹ã€‚è¿™å‘Šè¯‰ Solidity ç¼–è¯‘å™¨ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ã€‚è¾ƒæ–°ç‰ˆæœ¬çš„`solc`ç¼–è¯‘å™¨é€šå¸¸åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯å‘åå…¼å®¹çš„ï¼Œä½†æ˜¯ä¿æŒæœ€æ–°ç‰ˆæœ¬å¹¶ä¸”ä¸ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„ç¼–è¯‘å™¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µï¼Œé™¤éæœ‰å¾ˆå¥½çš„ç†ç”±è¿™æ ·åšã€‚

æˆ‘ä»¬è¿˜ä»`MirrorClone.sol`ä¸­çš„ OpenZeppelin åº“å¯¼å…¥äº†ä¸€äº›é¢„æ„å»ºçš„å¥‘çº¦ã€‚æˆ‘ä»¬çš„åˆåŒå°†ç»§æ‰¿ ERC-721 ä»¤ç‰Œ T2 çš„åŸºæœ¬åŠŸèƒ½ã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºæˆ‘ä»¬æƒ³è¦æ·»åŠ çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹ç¼–å†™ã€‚

æ‚¨å¯ä»¥å°†æ™ºèƒ½åå®šè§†ä¸ºä¸€ä¸ªå…·æœ‰æ„é€ å‡½æ•°ã€å±æ€§å’Œæ–¹æ³•çš„ç±»ã€‚è¿™ä¸åç»­çš„ä»£ç è¡Œéå¸¸æ¥è¿‘ï¼ŒåŒ…æ‹¬å®šä¹‰æ™ºèƒ½å¥‘çº¦çš„å±æ€§(ä¾‹å¦‚ï¼Œåä¸º`tokenURIToTokenId`çš„æ˜ å°„)ï¼Œè®¾ç½®ä¸€ä¸ªæ¥å—åç§°å’Œç¬¦å·çš„æ„é€ å‡½æ•°ï¼Œå¹¶æ·»åŠ å‡½æ•°æ¥æ‰©å±•ç»§æ‰¿çš„åŠŸèƒ½ã€‚

# åˆ›å»ºä»¤ç‰Œ<g-emoji class="g-emoji" alias="factory" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f3ed.png">ğŸ­</g-emoji>

å…³æ³¨`createToken`å‡½æ•°ï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤å‘Šè¯‰æˆ‘ä»¬éœ€è¦ç¡®ä¿åœ¨åˆ›å»ºä»¤ç‰Œä¹‹å‰ä¼ é€’ä¸€ä¸ª`tokenURI`ã€‚åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œä»¤ç‰Œ URI å°†æ˜¯æ¥è‡ª Arweave çš„äº‹åŠ¡ idï¼Œä¹Ÿç§°ä¸ºäº‹åŠ¡æ•£åˆ—ã€‚

æˆ‘ä»¬éœ€è¦åˆ©ç”¨ Solidity çš„`require`å‡½æ•°æ¥æ£€æŸ¥æ‰€æä¾›çš„`tokenURI`çš„é•¿åº¦æ˜¯å¦å¤§äºé›¶ã€‚å¦‚æœéœ€æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å›ä¸€ä¸ªç®€å•çš„ã€æè¿°æ€§çš„é”™è¯¯æ¶ˆæ¯ã€‚

```js
require(bytes(_tokenURI).length > 0, "Empty tokenURI");
```

æ¥ä¸‹æ¥æˆ‘ä»¬åº”è¯¥å¢åŠ `tokenIds`çš„è®¡æ•°å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸ºæ¯ä¸ªæ¡ç›®åˆ†é…ä¸€ä¸ªæƒŸä¸€çš„ä»¤ç‰Œ IDã€‚

```js
_tokenIds.increment();
uint256 newItemId = _tokenIds.current();
```

ç„¶åæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä» **ERC721.sol å¥‘çº¦**ç»§æ‰¿çš„`_safeMint`å‡½æ•°ä¸ºæ¡ç›®çš„ä½œè€…åˆ›å»ºä¸€ä¸ªä»¤ç‰Œã€‚å…¶ç›®çš„æ˜¯å½“ä½œè€…ç‚¹å‡»å‘å¸ƒæ—¶ï¼ŒdApp ç«‹å³é“¸é€ ä¸€ä¸ªæ¡ç›®çš„ NFTã€‚

ä¸€æ—¦ç”Ÿæˆï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®ä»¤ç‰Œçš„ URIï¼Œä½¿ç”¨ Arweave äº‹åŠ¡æ•£åˆ—å°†å®ƒé“¾æ¥åˆ°æ¡ç›®ã€‚æˆ‘ä»¬è¿˜åº”è¯¥å°†è¿™ä¸ªå…³ç³»æ·»åŠ åˆ°æˆ‘ä»¬çš„æ˜ å°„è·Ÿè¸ªå™¨`tokenURIToTokenId`ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬ä»¥åå°±å¯ä»¥é€šè¿‡å®ƒä»¬çš„ä»¤ç‰Œ URI æ¥æŸ¥è¯¢ NFTã€‚

æœ€åï¼Œåœ¨å‡½æ•°å®Œæˆå¹¶è¿”å›ä»¤ç‰Œ ID ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å‘å‡ºä¸€ä¸ªåŒ…å«ä½œè€…åœ°å€ã€ä»¤ç‰Œ ID å’Œä»¤ç‰Œ URI çš„`TokenMinted`äº‹ä»¶ã€‚

```js
_safeMint(msg.sender, newItemId);
_setTokenURI(newItemId, _tokenURI);
tokenURIToTokenId[_tokenURI] = newItemId;

emit TokenMinted(msg.sender, newItemId, _tokenURI);

return newItemId;
```

# æµ‹è¯•æ™ºèƒ½åˆçº¦ <g-emoji class="g-emoji" alias="test_tube" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f9ea.png">ğŸ§ª</g-emoji>

æ™ºèƒ½åˆçº¦ä¸æˆ‘ä»¬ç¼–å†™çš„ä»»ä½•å…¶ä»–ç¨‹åºæ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ç¼–å†™å…¨é¢çš„æµ‹è¯•ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬æ­£åœ¨æ„å»ºå¥å£®çš„ä»£ç ï¼Œå¹¶ä¸ºæ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¸­çš„å˜åŒ–æä¾›å®‰å…¨ç½‘ã€‚æˆ‘ä»¬å·²ç»ä¸ºæ‚¨ç¼–å†™äº† 3 ä¸ªæµ‹è¯•ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œæ¥ç¡®è®¤å®ƒä»¬æ˜¯å¦é€šè¿‡:

```js
$ yarn web3:compile
$ yarn web3:test 
```

åªè¦æˆ‘ä»¬å®ç°äº†ä¸Šé¢çš„ä»£ç ï¼Œè¿™ä¸‰ä¸ªæµ‹è¯•éƒ½åº”è¯¥é€šè¿‡äº†ã€‚åªæ˜¯ä¸ºäº†æ£€æŸ¥ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨é‡Šæ‰åˆšåˆšç¼–å†™çš„`createToken`å‡½æ•°çš„ä»£ç ã€‚å¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œè¯·æ³¨æ„å®ƒä»¬å°†ä¼šå¤±è´¥:

```js
$ yarn web3:test
yarn run v1.22.11
$ npx hardhat test
.
.
.
MirrorClone
    methods
      createToken
        1) reverts when empty tokenURI passed
        2) mints new token
        3) emits TokenMinted event
0 passing
3 failing 
```

å¦‚æœä½ å†æ¬¡å–æ¶ˆä»£ç çš„æ³¨é‡Šï¼Œä¸€åˆ‡éƒ½ä¼šå˜å¾—å¾ˆå¥½ã€‚

[![Nice and green, just the way we like it.](img/d5c5ace9e02a6850750cf1eb7c2fc951.png)](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/mirror/assets/green.jpeg)

{% label %}æ¼‚äº®åˆç¯ä¿ï¼Œæ­£æ˜¯æˆ‘ä»¬å–œæ¬¢çš„æ–¹å¼ã€‚

è®©æˆ‘ä»¬ä¸ºæ™ºèƒ½åˆçº¦å†ç¼–å†™ä¸€ä¸ªæµ‹è¯•ã€‚åœ¨ Solidity ä¸­ï¼Œå½“ä¸€ä¸ªé”®æ²¡æœ‰è¢«èµ‹å€¼æ—¶ï¼Œæ˜ å°„è¿”å› 0ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰é”®çš„é»˜è®¤å€¼éƒ½æ˜¯ 0ã€‚æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¥ç¡®ä¿ä»»ä½•ä¸å­˜åœ¨çš„`tokenURI`è¿”å› 0ã€‚

å°†ä»¥ä¸‹æµ‹è¯•æ·»åŠ åˆ°`web3/test/index.test.ts`:

```js
describe('tokenURIToTokenId', () => {
  it('returns 0 if tokenURI does not exist', async () => {
    expect(await contract.tokenURIToTokenId('ar://does-not-exist')).to.eq(
      0,
    );
  });
});
```

å†æ¬¡è¿è¡Œæµ‹è¯•åº”è¯¥å¯ä»¥ç¡®è®¤æ‰€æœ‰å››ä¸ªæµ‹è¯•éƒ½é€šè¿‡äº†ã€‚

# éƒ¨ç½²æ™ºèƒ½åˆåŒ<g-emoji class="g-emoji" alias="rocket" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f680.png">ğŸš€</g-emoji>

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªåŠŸèƒ½æ€§çš„æ™ºèƒ½åˆçº¦ï¼Œå¯ä»¥æŒ‰é¢„æœŸå·¥ä½œäº†ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½éƒ¨ç½²å®ƒäº†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å¤šè¾¹å½¢ç½‘ç»œæ¥é¿å…ä»¥å¤ªåŠé«˜æ˜‚çš„ç…¤æ°”è´¹ã€‚å‡ºäºæˆ‘ä»¬çš„ç›®çš„ï¼ŒPolygon çš„å·¥ä½œæ–¹å¼å®Œå…¨ç›¸åŒï¼Œå¹¶ä¸”ä¸ä»¥å¤ªåŠè™šæ‹Ÿæœºå®Œå…¨å…¼å®¹ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å°†éƒ¨ç½²åˆ° Polygon çš„ Mumbai testnetï¼Œå› æ­¤æ‚¨ä¸å¿…ä½¿ç”¨æœ‰ä»·å€¼çš„ä»¤ç‰Œæ¥å®Œæˆæ­¤ dAppã€‚äº‹å®ä¸Šï¼Œå¦‚æœæ‚¨æ­£åœ¨ä¸ºç”Ÿäº§å¼€å‘å®ƒï¼Œæ‚¨åº”è¯¥é¦–å…ˆå°†å®ƒéƒ¨ç½²åˆ° testnetï¼Œä»¥ä¾¿åœ¨å°†å®ƒéƒ¨ç½²åˆ° mainnet ä¹‹å‰æµ‹è¯•å®ƒçš„åŠŸèƒ½ã€‚å¤§å¤šæ•°ç”Ÿäº§é¡¹ç›®éƒ½è¿™æ ·åšï¼Œä»¥ç¡®ä¿ mainnet éƒ¨ç½²å·²ç»è¿‡å®æˆ˜æµ‹è¯•ï¼Œå¹¶ä¸”ä¸å¤ªå¯èƒ½è¢«é”™è¯¯ä»£ç æ‰€å‰Šå¼±ã€‚

{% sidenote title="Box 6.1:ä»€ä¹ˆæ˜¯æµ‹è¯•ç½‘ï¼Ÿ"%}å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰å„ç§ç½‘ç»œçš„æ¦‚å¿µï¼Œæ‚¨å¯ä»¥å°†å…¶è§†ä¸º Web 2 ä¸­åº”ç”¨ç¨‹åºçš„ä¸åŒç¯å¢ƒ(ä¾‹å¦‚ï¼Œå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰)ã€‚å¤§å¤šæ•°åè®®éƒ½æœ‰ä¸€ä¸ªç”¨äºå…·æœ‰å®é™…ç»æµä»·å€¼çš„ç”Ÿäº§éƒ¨ç½²çš„ä¸»ç½‘åŒºå—é“¾ï¼Œä»¥åŠä¸€ä¸ªç”¨äºå®éªŒçš„æµ‹è¯•ç½‘ã€‚æµ‹è¯•ç½‘åœ¨åŠŸèƒ½ä¸Šä¸ä¸»ç½‘ç›¸å½“ï¼Œä½†ä¸ç®¡ç†ç»æµä»·å€¼ã€‚

ä¸ºäº†éƒ¨ç½²åˆåŒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`web3/scripts/deploy.ts`æ–‡ä»¶ï¼Œå…¶ä¸­æ¨¡æ¿ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåˆ©ç”¨**ä¹™é†š**å’Œ**å®‰å…¨å¸½**çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥å¼•ç”¨`getContractFactory`æ¥åŠ è½½æˆ‘ä»¬åˆšåˆšç¼–å†™çš„ **MirrorClone** æ™ºèƒ½å¥‘çº¦ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`deploy`æ–¹æ³•ï¼ŒæŒ‰ç…§`constructor`çš„è¦æ±‚ä¼ å…¥åç§°å’Œç¬¦å·ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥åŒ…å«ä¸€ä¸ª console.log è¯­å¥æ¥æ‰“å°æ™ºèƒ½å¥‘çº¦å…¬å…±åœ°å€ï¼Œç¨åæˆ‘ä»¬éœ€è¦å°†å®ƒæ·»åŠ ä¸ºç¯å¢ƒå˜é‡ã€‚

```js
const MirrorClone = await ethers.getContractFactory('MirrorClone');
const mirrorClone = await MirrorClone.deploy('Mirror Clone', 'MRM');

await mirrorClone.deployed();

console.log('MirrorClone deployed to:', mirrorClone.address);
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åˆ°å‘½ä»¤è¡Œå¹¶éƒ¨ç½²å¥‘çº¦ã€‚è¯·æ³¨æ„ï¼Œè¿™æœ‰æ—¶ä¼šå› ä¸ºè¿æ¥é—®é¢˜è€Œå¤±è´¥ã€‚å¦‚æœæœ‰ï¼Œå°±å†è¯•ä¸€æ¬¡ã€‚è¿˜è¦ç¡®ä¿æ‚¨çš„ç§é’¥ä¿å­˜åœ¨`.env.local`ä¸­ï¼Œè¿™æ ·éƒ¨ç½²äº‹åŠ¡å¯ä»¥ä»æ‚¨çš„ testnet MATIC ä½™é¢ä¸­æ”¯ä»˜ã€‚

```js
$ yarn web3:deploy:testnet 
```

æˆ‘ä»¬çš„éƒ¨ç½²è„šæœ¬å°†å¥‘çº¦å…¬å…±åœ°å€è®°å½•åˆ°æ§åˆ¶å°ä¸­ã€‚è®©æˆ‘ä»¬å¤åˆ¶å¹¶æ›¿æ¢`.env.development`ä¸­é»˜è®¤çš„é›¶ä½œä¸º`NEXT_PUBLIC_CONTRACT_ADDRESS`ç¯å¢ƒå˜é‡çš„å€¼ã€‚dApp å°†åœ¨å‘å¸ƒæ¡ç›®æ—¶åˆ©ç”¨è¿™ä¸€ç‚¹æ¥ä¸ºå®ƒä»¬åˆ†é… NFTã€‚

æˆ‘ä»¬éœ€è¦é‡æ–°å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œä»¥ä½¿æ›´æ”¹åçš„å˜é‡ç”Ÿæ•ˆã€‚åœ¨æ­£åœ¨è¿è¡Œçš„ç»ˆç«¯çª—å£ä¸­æŒ‰ CTRL+C åœæ­¢æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å†æ¬¡å¯åŠ¨æœåŠ¡å™¨:

```js
$ ARWEAVE_WALLET=$(cat arweave-wallet.json) yarn dev 
```

æˆ‘ä»¬è¿˜æƒ³éªŒè¯åˆåŒï¼Œè¿™å…è®¸é“¾æ¢ç´¢è€…åƒ [Polygonscan](https://polygonscan.com/) å’Œ [Etherscan](https://etherscan.io/) ç¡®è®¤éƒ¨ç½²çš„åˆåŒä¸æºä»£ç åŒ¹é…ï¼Œå¹¶æ˜¾ç¤ºæºä»£ç ä¾›å¼€å‘äººå‘˜å’Œç”¨æˆ·æŸ¥çœ‹ã€‚

è¯·æ³¨æ„ï¼Œæ‚¨åº”è¯¥å°†ä¸‹é¢å‘½ä»¤ä¸­çš„`INSERT_CONTRACT_ADDRESS_HERE`æ›¿æ¢ä¸ºæ‚¨çš„æ™ºèƒ½åˆçº¦å…¬å…±åœ°å€ã€‚ä¼ é€’åœ¨åˆçº¦éƒ¨ç½²æœŸé—´ä½¿ç”¨çš„ç›¸åŒæ„é€ å‡½æ•°å‚æ•°ä¹Ÿéå¸¸é‡è¦â€”â€”ç¡®ä¿â€œé•œåƒå…‹éš†â€å’Œâ€œMRMâ€å‚æ•°ä½¿ç”¨ä¸ä¼ é€’ç»™`MirrorClone.deploy()`çš„å‚æ•°ç›¸åŒçš„å¤§å°å†™å’Œé—´è·ã€‚

```js
$ yarn web3:verify:testnet INSERT_CONTRACT_ADDRESS_HERE 'Mirror Clone' 'MRM' 
```

å¦‚æœéªŒè¯å¤±è´¥ï¼Œé”™è¯¯æ¶ˆæ¯é€šå¸¸ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œä½†æ˜¯è¯·å†æ¬¡æ£€æŸ¥æ‚¨çš„`PRIVATE_KEY`å’Œ`POLYGONSCAN_API_KEY`ã€‚

*å¦‚æœæ‚¨é€å­—éƒ¨ç½²æ™ºèƒ½åˆçº¦*ï¼Œæ‚¨å°†åœ¨éªŒè¯æœŸé—´åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ä»¥ä¸‹é”™è¯¯:

```js
Error in plugin @nomiclabs/hardhat-etherscan: 
The Etherscan API responded with a failure status.
The verification may still succeed but should be checked manually.
Reason: Already Verified 
```

æ²¡ä»€ä¹ˆå¥½æ‹…å¿ƒçš„ï¼è¿™ä»…ä»…æ„å‘³ç€æ‚¨éƒ¨ç½²çš„æ™ºèƒ½å¥‘çº¦çš„ç¡®åˆ‡å­—èŠ‚ç å·²ç»åœ¨ä¸åŒçš„åœ°å€è¿›è¡Œäº†éªŒè¯ã€‚å¯¹æ™ºèƒ½å¥‘çº¦æºä»£ç çš„ä»»ä½•æ›´æ”¹ï¼ŒåŒ…æ‹¬é¢å¤–çš„æ¢è¡Œç¬¦ã€æ·»åŠ æˆ–åˆ é™¤çš„æ³¨é‡Šï¼Œç”šè‡³ä¸åŒçš„ç¼©è¿›ï¼Œéƒ½ä¼šæ”¹å˜ç¼–è¯‘åçš„å­—èŠ‚ç ï¼Œå› æ­¤ä¸ä¼šä»å¥‘çº¦éªŒè¯æ’ä»¶è§¦å‘æ­¤é”™è¯¯ã€‚

å¦‚æœæ‚¨è®¿é—® [Polygonscan çš„ testnet explorer](https://mumbai.polygonscan.com/) ï¼Œæ‚¨å¯ä»¥ä»å‘½ä»¤è¡Œå°†åˆåŒåœ°å€å¤åˆ¶ç²˜è´´åˆ°æœç´¢æ¡†ä¸­ï¼Œå¹¶ç¡®è®¤åˆåŒåœ¨åŒºå—é“¾ä¸Šã€‚

[![If a contract deployment isn't reason for fireworks, I don't know what is. ](img/ebb5539d6ca18e567720db5f997e1ae8.png)](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/mirror/assets/fireworks.jpeg)

{% label %}å¦‚æœåˆåŒéƒ¨ç½²ä¸æ˜¯ fireworks çš„ç†ç”±ï¼Œæˆ‘ä¸çŸ¥é“è¿˜æœ‰ä»€ä¹ˆç†ç”±ã€‚

# ä¸ºæ¡ç›®ç”Ÿæˆ NFTsã€‘ğŸ¬

å›æƒ³ä¸€ä¸‹ç¬¬ 3 æ­¥ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªåœ¨ Arweave ä¸­åˆ›å»ºæ¡ç›®çš„å‡½æ•°ã€‚æˆ‘ä»¬ç°åœ¨éœ€è¦å°† NFT é“¸é€ åŠŸèƒ½æ•´åˆåˆ°å·¥ä½œæµç¨‹ä¸­ã€‚å¦‚æœæˆ‘ä»¬è¿”å›åˆ°`CreateEntryForm.tsx`ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ°åœ¨`handleSubmit`ä¸­ try å—çš„åº•éƒ¨æœ‰ç”Ÿæˆ NFT çš„æŒ‡ä»¤ã€‚

æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªç­¾åè€…ï¼Œå¹¶å°†å¥‘çº¦è¿æ¥åˆ°ç­¾åè€…ã€‚ç„¶åæˆ‘ä»¬éœ€è¦åˆ©ç”¨æˆ‘ä»¬åˆšåˆšç¼–å†™çš„`createToken`å‡½æ•°æ¥é“¸é€  NFTã€‚

```js
const signer = provider.getSigner();
const contractWithSigner = contract.connect(signer);

const resp = await contractWithSigner.createToken(transactionId);
const rec = await resp.wait();
```

å¦‚æœæ‚¨ç°åœ¨å°è¯•åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œæ‚¨çš„ MetaMask é’±åŒ…å°†è¦æ±‚æ‚¨ç­¾ç½²ä¸€é¡¹äº¤æ˜“ï¼Œä»¥é“¸é€  NFTã€‚åœ¨ Arweave ç¡®è®¤è¿›å…¥åï¼Œä½ å°†èƒ½å¤Ÿå¯¼èˆªåˆ°å…¥å£å¹¶çœ‹åˆ° NFTï¼

ä½†æ˜¯å¦‚æœèƒ½æŠŠé‚£ä¸ª NFT è½¬è®©ç»™åˆ«äººä¸æ˜¯å¾ˆå¥½å—ï¼Ÿä¹Ÿè®¸æœ‰äººæƒ³ä»æ‚¨è¿™é‡Œè´­ä¹°è¯¥æ¡ç›®ï¼Œæˆ–è€…æ‚¨æƒ³å°†è¯¥æ¡ç›®çš„æ‰€æœ‰æƒèµ é€ç»™æœ‹å‹ã€‚æˆ‘ä»¬å°†åœ¨æ­¥éª¤ 7 ä¸­å¤„ç†ä¸‹ä¸€ä¸ªé—®é¢˜ã€‚

##### *æ¸…å• 6.1:æ™ºèƒ½åˆçº¦çš„ä»£ç *

```js
function createToken(string memory _tokenURI) public returns (uint) {
    // require statement to check if _tokenURI is not empty
    require(bytes(_tokenURI).length > 0, "Empty tokenURI");

    // Increment counter so it starts with 0
    _tokenIds.increment();
    uint256 newItemId = _tokenIds.current();

    // Mint token
    _safeMint(msg.sender, newItemId);

    // Set token URI
    _setTokenURI(newItemId, _tokenURI);

    // Set tokenURIToTokenId
    tokenURIToTokenId[_tokenURI] = newItemId;

    // Emit TokemMinted event
    emit TokenMinted(msg.sender, newItemId, _tokenURI);

    // Return new tokenId
    return newItemId;
}
```

##### *æ¸…å• 6.2:tokenURIToTokenId æµ‹è¯•ä»£ç *

```js
describe('tokenURIToTokenId', () => {
  it('returns 0 if tokenURI does not exist', async () => {
    expect(await contract.tokenURIToTokenId('ar://does-not-exist')).to.eq(
      0,
    );
  });
});
```

##### *æ¸…å• 6.3:éƒ¨ç½²ä»£ç *

```js
async function main() {
  const MirrorClone = await ethers.getContractFactory('MirrorClone');
  const mirrorClone = await MirrorClone.deploy('Mirror Clone', 'MRM');

  await mirrorClone.deployed();

  console.log('MirrorClone deployed to:', mirrorClone.address);
}
```

##### *æ¸…å• 6.4:å‘å¸ƒå¸–å­*æ—¶ç”Ÿæˆ NFT çš„ä»£ç 

```js
const handleSubmit = useCallback(
.
.
.
    try {
      .
      .
      .
      if (provider && contract) {
        .
        .
        .
        // Mint NFT
        const signer = provider.getSigner();
        const contractWithSigner = contract.connect(signer);

        const resp = await contractWithSigner.createToken(transactionId);
        const rec = await resp.wait();

        alert('Entry created successfully');
      }
    .
    .
    .
```

# æŒ‘æˆ˜<g-emoji class="g-emoji" alias="weight_lifting" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f3cb.png">ğŸ‹ï¸</g-emoji>

åœ¨æ‚¨çš„ç¼–è¾‘å™¨ä¸­æ‰“å¼€`web3/contracts/MirrorClone.sol`ã€`web3/test/index.test.ts`ã€`web3/scripts/deploy.ts`å’Œ`components/CreateEntryForm/CreateEntryForm.tsx`ï¼Œå¹¶æŒ‰ç…§æ³¨é‡Šä¸­åŒ…å«çš„æ­¥éª¤å®Œæˆæ™ºèƒ½åˆåŒã€å…¶æµ‹è¯•ã€éƒ¨ç½²è„šæœ¬å’Œ NFT é€ å¸åŠŸèƒ½çš„ç¼–å†™ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæè¿°ï¼Œä»¥åŠä¸€ä¸ªé“¾æ¥ï¼Œé“¾æ¥åˆ°æ‚¨ä¸ºäº†å®ç°æ¯ä¸€è¡Œè€Œéœ€è¦æŸ¥çœ‹çš„æ–‡æ¡£ã€‚ç›¸å…³çš„ä»£ç å—ä¹ŸåŒ…å«åœ¨ä¸‹é¢çš„æ¸…å•ä¸­ã€‚

##### *æ¸…å• 6.5:æ™ºèƒ½åˆçº¦è¯´æ˜*

```js
function createToken(string memory _tokenURI) public returns (uint) {
    // require statement to check if _tokenURI is not empty

    // Increment counter so it starts with 0

    // Mint token

    // Set token URI

    // Set tokenURIToTokenId

    // Emit TokenMinted event

    // Return new tokenId
}
```

##### *æ¸…å• 6.2:tokenURIToTokenId æµ‹è¯•ä»£ç *

```js
// Write a describe block that tests for a 0 return when a token URI doesn't exist in the tokenURIToTokenId mapping
```

##### *æ¸…å• 6.3:éƒ¨ç½²ä»£ç *

```js
async function main() {
  // Deploy MirrorClone smart contract
  // More information can be found here: https://hardhat.org/guides/deploying.html

  console.log('MirrorClone deployed to:', '<CONTRACT ADDRESS>');
}
```

##### *æ¸…å• 6.4:å‘å¸ƒå¸–å­*æ—¶ç”Ÿæˆ NFT çš„ä»£ç 

```js
const handleSubmit = useCallback(
.
.
.
    try {
      .
      .
      .
      if (provider && contract) {
        .
        .
        .
        // Mint NFT
        // Get signer and connect it to smart contract
        // More information can be found here: https://docs.ethers.io/v5/getting-started/#getting-started--writing

        // Call `createToken` method passing in transactionId
      }
    .
    .
    .
```

å®Œæˆä»£ç åï¼Œåˆ›å»ºä¸€ä¸ªæ¡ç›®ä¼šè‡ªåŠ¨å°†å…¶ä½œä¸º NFT(åœ¨ MetaMask ä¸­ç¡®è®¤äº‹åŠ¡å):

[![Screenshot of NFT](img/4f4a35b61e9b17d7dc619f48bb5ba738.png)](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/mirror/assets/nft.jpg)