# ä»‹ç»

> åŸæ–‡ï¼š<https://github.com/figment-networks/learn-tutorials/blob/master/tezos/how-to-create-a-dex-in-tezos.md>

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ DEX(åˆ†æ•£äº¤æ¢),é€šè¿‡å®ƒæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ç¼–å†™ä¸€ä¸ª DEXï¼Œä»¥åŠ DEX é€šå¸¸æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

è¯¥ DEX å°†ä½¿ç”¨æ’å®šäº§å“åšå¸‚ç®—æ³•ï¼Œå¹¶å°†åŸºäº Uniswap çš„ v1ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº Uniswap çš„æ’å®šäº§å“åšå¸‚ç®—æ³•å’Œ v1 çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥é˜…è¯»æ­¤[ç™½çš®ä¹¦](https://hackmd.io/@HaydenAdams/HJ9jLsfTz)ã€‚ä½ ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ª[è§†é¢‘](https://www.youtube.com/watch?v=-6HefvM5vBg)æ¥äº†è§£ CPMM ç®—æ³•ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ç¼–å†™å¤§é‡ä»£ç ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä»è¿™ä¸ªèµ„æºåº“ä¸­æ‰¾åˆ°å®Œæ•´çš„æºä»£ç :ã€https://github.com/vivekascoder/tez-dex

# å…ˆå†³æ¡ä»¶

SmartPyã€Reactã€Taquito å’Œæ™ºèƒ½åˆçº¦çš„åŸºæœ¬çŸ¥è¯†ã€‚

# è¦æ±‚

*   [NodeJs](https://nodejs.org/en/) (v14.18.1 æˆ–æ›´é«˜ç‰ˆæœ¬)
*   [çº±çº¿](https://yarnpkg.com/)
*   [å¯ºåº™é’±åŒ…](https://templewallet.com/)

# é¡¹ç›®è®¾ç½®

ä½¿ç”¨`create-react-app`åˆ›å»ºä¸€ä¸ªç©ºçš„ React é¡¹ç›®ï¼Œåˆ›å»ºåå®‰è£…ä¸‹é¢çš„åŒ…ã€‚

> æ³¨æ„:å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘å°†ä½¿ç”¨`tailwindcss`æ¥è®¾è®¡ç»„ä»¶çš„æ ·å¼ï¼Œä½†æ˜¯è¿™ä¸€æ­¥æ˜¯å®Œå…¨å¯é€‰çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³è¦çš„ UI åº“/Css æ¡†æ¶ã€‚

1.  Taquito å’Œ BeconWallet

```
yarn add @taquito/taquito @taquito/beacon-wallet 
```

2.  Tailwindcss(å¯é€‰)

```
yarn add --dev tailwindcss@npm:@tailwindcss/postcss7-compat postcss@^7 autoprefixer@^9 
```

å…³äºç”¨`create-react-app`è®¾ç½® tailwindcss çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»[ã€‚](https://tailwindcss.com/docs/guides/create-react-app)

å®‰è£…å®Œä¾èµ–é¡¹åï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º`./contracts`çš„æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­ä¿å­˜æ‰€æœ‰çš„ smartpy ä»£ç ã€‚

éƒ¨ç½²ä¸¤ä¸ª FA1.2 ä»¤ç‰Œï¼Œå³ **<g-emoji class="g-emoji" alias="cat" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f431.png">ğŸ±</g-emoji>çŒ«ä»¤ç‰Œ**å’Œ **LP ä»¤ç‰Œ**ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ç¨åä½¿ç”¨ã€‚

# å¤„ç†æ™ºèƒ½åˆåŒ

## æ·»åŠ  dex.py

æˆ‘ä»¬å°†é€šè¿‡åœ¨`contracts`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`dex.py`çš„æ–‡ä»¶æ¥å¼€å§‹æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œä¿å­˜ä¸æˆ‘ä»¬çš„ DEX åŠŸèƒ½ç›¸å…³çš„æ‰€æœ‰ä»£ç ã€‚

åˆ›å»ºä¸€ä¸ªåä¸º`Token`çš„æ¼”ç¤º FA1.2 å¥‘çº¦ï¼Œæˆ‘ä»¬ä»…ç”¨äºæµ‹è¯•ã€‚

```
import smartpy as sp
fa12 = sp.io.import_script_from_url("https://smartpy.io/templates/FA1.2.py")

class Token(fa12.FA12):
    """ Test FA1.2 Token """
    pass
```

åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­åˆ›å»ºå¦ä¸€ä¸ªå¥‘çº¦ï¼Œå¹¶å°†å…¶å‘½åä¸º`Dex`ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬çš„ä¸» DEX å¥‘çº¦ç±»ã€‚

```
class Dex(sp.Contract):
    def __init__(self, _token_address, _lp_address):
        self.init(
            invariant=sp.nat(0),
            tez_pool=sp.mutez(0),
            token_pool=sp.nat(0),
            token_address=_token_address,
            lp_address=_lp_address,
        )
```

è¿™é‡Œï¼Œ`Dex`å¥‘çº¦ä¸­çš„å­˜å‚¨ç”± 5 ä¸ªäº‹ç‰©ç»„æˆï¼Œå…¶ä¸­ä¸å˜é‡è¡¨ç¤ºæ± çš„ä¸å˜é‡ï¼Œå®ƒç­‰äº`tez_pool`å’Œ`token_pool`çš„ä¹˜ç§¯ã€‚`tez_pool`å’Œ`token_pool`è·Ÿè¸ªæˆ‘ä»¬æ± ä¸­ xtz å’Œ Cat ä»¤ç‰Œçš„æ•°é‡ï¼Œè¿™å°†ç”¨äºç¡®å®šäº¤æ¢ä»¤ç‰Œæ—¶çš„æ¯”ç‡ã€‚è¿™é‡Œ`lp_address`å’Œ`token_address`è·Ÿè¸ªæˆ‘ä»¬çš„ LP ä»¤ç‰Œå’Œ Cat ä»¤ç‰Œçš„åœ°å€ï¼Œå®ƒä»¬åœ¨è¿›è¡ŒåˆåŒé—´è°ƒç”¨æ—¶ä½¿ç”¨ã€‚

æˆ‘ä»¬ç°åœ¨å°†åˆ›å»ºä¸€äº›å®ç”¨å‡½æ•°ï¼Œç”¨äºè¿›è¡Œä¼ è¾“ï¼Œå³`transfer_tokens`ç”¨äºåœ¨åˆåŒé—´è°ƒç”¨çš„å¸®åŠ©ä¸‹å°†ä¸€å®šæ•°é‡çš„ä»¤ç‰Œä»ä¸€ä¸ªåœ°å€ä¼ è¾“åˆ°å¦ä¸€ä¸ªåœ°å€ï¼Œè€Œ`transfer_tez`ä»…ç”¨äºå°†ä¸€å®šæ•°é‡çš„ xtz ä»åœ°å€æ± ä¼ è¾“åˆ°ç‰¹å®šåœ°å€ã€‚

```
def transfer_tokens(self, from_, to, amount):
    """ Utility Function to transfer FA1.2 Tokens."""
    sp.verify(amount > sp.nat(0), 'INSUFFICIENT_TOKENS[transfer_token]')
    transfer_type = sp.TRecord(
        from_=sp.TAddress,
        to_=sp.TAddress,
        value=sp.TNat
    ).layout(("from_ as from", ("to_ as to", "value")))
    transfer_data = sp.record(from_=from_, to_=to, value=amount)
    token_contract = sp.contract(
        transfer_type,
        self.data.token_address,
        "transfer"
    ).open_some()
    sp.transfer(transfer_data, sp.mutez(0), token_contract)

def transfer_tez(self, to_, amount: sp.TMutez):
    """ Utility function to transfer tezos. """
    sp.send(to_, amount, message="SENDING_TEZ")
```

åœ¨å…è®¸å…¶ä»–äººå‘æˆ‘ä»¬çš„æ± æä¾›æµåŠ¨æ€§çš„åŒæ—¶ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸æ ¹æ®ä»–ä»¬çš„æµåŠ¨æ€§ç»™äºˆä»–ä»¬ä¸€å®šæ•°é‡çš„ **LP ä»¤ç‰Œ**ï¼Œä¸ºæ­¤æˆ‘ä»¬å°†ä¸å¾—ä¸é“¸é€  LP ä»¤ç‰Œï¼Œå¹¶åœ¨ç”¨æˆ·æƒ³è¦å›ä»–ä»¬çš„æµåŠ¨æ€§æ—¶çƒ§æ‰å®ƒä»¬ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æœ‰å¦å¤–ä¸¤ä¸ªå®ç”¨å‡½æ•°ï¼Œå³`mint_lp`å’Œ`burn_lp`ï¼Œå®ƒä»¬ä¸»è¦ç”¨äºé“¸é€ å’Œåˆ»å½• LP ä»¤ç‰Œã€‚

```
def mint_lp(self, amount):
    """Mint `amount` LP tokens to `sp.sender` account."""
    transfet_type = sp.TRecord(
        address=sp.TAddress,
        value=sp.TNat,
    )
    transfer_value = sp.record(
        address=sp.sender,
        value=amount,
    )
    contract = sp.contract(
        transfet_type,
        self.data.lp_address,
        'mint'
    ).open_some()
    sp.transfer(transfer_value, sp.mutez(0), contract)

def burn_lp(self, amount):
    """ Burn `amount` LP Tokens. """
    transfet_type = sp.TRecord(
        address=sp.TAddress,
        value=sp.TNat,
    )
    transfer_value = sp.record(
        address=sp.sender,
        value=amount,
    )
    contract = sp.contract(
        transfet_type,
        self.data.lp_address,
        'burn'
    ).open_some()
    sp.transfer(transfer_value, sp.mutez(0), contract)
```

`mint_lp`æ–¹æ³•è·å–è¦é“¸é€ çš„ä»£å¸æ•°é‡ï¼Œç„¶åå®ƒæ‰§è¡Œä¸€ä¸ªåˆåŒé—´è°ƒç”¨ï¼Œä»¥ä¸è¢«ç§°ä¸º`mint`çš„`entry_point`ç­¾è®¢ LP ä»£å¸åˆåŒï¼Œä»è€Œé“¸é€  LP ä»£å¸ã€‚åŒæ ·çš„ï¼Œ`burn_lp`æ–¹æ³•éœ€è¦æ¶ˆè€— LP ä»¤ç‰Œçš„æ•°é‡ã€‚

> æ³¨æ„:è¯·æ³¨æ„ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„ DEX åˆåŒæ˜¯ LP ä»¤ç‰ŒåˆåŒçš„ç®¡ç†ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå¯ä»¥é“¸é€ å’Œç‡ƒçƒ§ä»¤ç‰Œã€‚

## åˆå§‹åŒ– Exchange

ç°åœ¨ï¼Œæˆ‘ä»¬å°†è‡´åŠ›äºä¸€ä¸ªåä¸º`initialize_exchange`çš„å…¥å£ç‚¹ï¼Œå®ƒå°†è´Ÿè´£æä¾›æ± ä¸­çš„åˆå§‹æµåŠ¨æ€§ï¼Œå¹¶ç®¡ç†ä»¤ç‰Œå’Œ xtz ä¹‹é—´çš„åˆå§‹æ¯”ç‡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥æ¯”ç‡æ¥ç®¡ç†ä»·æ ¼ã€‚

```
@sp.entry_point
def initialize_enchange(self, token_amount):
    # We just take the sp.amount and then transfer the tokens based on that.
    sp.if ((self.data.token_pool == sp.nat(0)) & (self.data.tez_pool == sp.mutez(0))):
        tez_amount = sp.amount
        sp.verify(token_amount > sp.nat(10), message="NOT_ENOUGH_TOKEN")
        sp.verify((tez_amount > sp.mutez(1)), message="NOT_EMOUGH_TEZ")

        self.data.tez_pool = tez_amount
        self.data.token_pool = token_amount
        self.data.invariant = token_amount * \
            sp.utils.mutez_to_nat(tez_amount)

        self.transfer_tokens(
            from_=sp.sender, 
            to=sp.self_address,
            amount=token_amount
        )
    sp.else:
        sp.failwith('ALREADY_INITIALIZED')
```

è¿™ä¸ªå…¥å£ç‚¹é¦–å…ˆæ£€æŸ¥ tez å’Œ token çš„æ€»é‡æ˜¯å¦ä¸ºé›¶ï¼Œè¿™å°†é™åˆ¶ç”¨æˆ·åªèƒ½åœ¨æä¾›åˆå§‹æµåŠ¨æ€§åæ‰èƒ½è°ƒç”¨å®ƒã€‚

ç„¶åæˆ‘ä»¬æ£€æŸ¥ token amount å’Œ xtz amount æ˜¯å¦å¤§äº 0ï¼Œç„¶åæˆ‘ä»¬æ›´æ–°`tez_pool`å’Œ`token_pool`ä»¥åŠä¸å˜é‡ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„å®ç”¨å‡½æ•°`transfer_tokens`å°†ä»¤ç‰Œä»ç”¨æˆ·è½¬ç§»åˆ°æˆ‘ä»¬çš„åˆåŒã€‚

## Tez åˆ°ä»¤ç‰Œäº¤æ¢

ç°åœ¨æˆ‘ä»¬å°†ç¼–å†™ dex ä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†ï¼Œå°† tez è½¬æ¢æˆä»¤ç‰Œï¼Œåä¹‹äº¦ç„¶ã€‚æˆ‘ä»¬å°†ä» tez åˆ°ä»¤ç‰Œäº¤æ¢å¼€å§‹ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º`tez_to_token`çš„å…¥å£ç‚¹ï¼Œå®ƒå°†äº¤æ¢å‘é€çš„ xtz æ•°é‡ï¼Œå³`sp.sender`ï¼Œå¹¶æ ¹æ®å½“å‰çš„äº¤æ¢æ¯”ç‡å°†å…¶äº¤æ¢ä¸º Cat ä»¤ç‰Œã€‚

åœ¨ CPMM ç®—æ³•ä¸­ï¼Œä¸å˜é‡éœ€è¦æ˜¯å¸¸æ•°ï¼Œè¿™æ„å‘³ç€`x.y=k`å…¶ä¸­ x å’Œ y åˆ†åˆ«ä»£è¡¨ xtz å’Œä»¤ç‰Œçš„æ•°é‡ã€‚ç°åœ¨å¦‚æœä½ æƒ³æŠŠ xtz æ¢æˆ tokenï¼Œé‚£ä¹ˆæ–° xtz çš„é‡ä¼šå¢åŠ è®©æˆ‘ä»¬ç§°ä¹‹ä¸º`x1`ã€‚

ä¸”è®©æˆ‘ä»¬æŠŠæ–°çš„ä»£å¸é‡‘é¢ç§°ä¸º`y1`ï¼Œé‚£ä¹ˆæ ¹æ®ç­‰å¼`x1.y1=k`ã€‚

è¿™æ„å‘³ç€æ± ä¸­çš„æ–°ä»£å¸æ•°é‡å°†ä¸º`y1 = k / x1`ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è®¡ç®—`new_token_pool`çš„æ–¹æ³•ã€‚

ç°åœ¨ï¼Œç”¨æˆ·å°†æ”¶åˆ°çš„ç”¨äºäº¤æ¢ä»–çš„`x` tez (x æ˜¯ mutez)çš„ä»£å¸æ•°é‡å°†æ˜¯`token_out = y - y1`ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•è®¡ç®—`token_out`ã€‚

> æ³¨æ„:è¯·æ³¨æ„ï¼Œåœ¨å°†æŸäº› xtz å…‘æ¢æˆä»£å¸åï¼Œæ± ä¸­çš„ xtz æ•°é‡å°†å¢åŠ ï¼Œä»£å¸æ•°é‡å°†å‡å°‘ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è®¡ç®—ç”¨æˆ·å°†æ”¶åˆ°çš„ä»£å¸æ•°é‡æ—¶ï¼Œæˆ‘ä»¬åšçš„æ˜¯`y - y1`è€Œä¸æ˜¯`y1 - y`ã€‚

è®¡ç®—å®Œ`tokens_out`ä¹‹åï¼Œæˆ‘ä»¬æ­£åœ¨æ›´æ–°æ–°çš„`tez_pool`å’Œ`token_pool`ä»¥åŠæ–°çš„ä¸å˜é‡ã€‚ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„å®ç”¨å‡½æ•°`transfer_tokens`å‘ç”¨æˆ·å‘é€`token_out`æ•°é‡çš„ä»¤ç‰Œã€‚

```
@sp.entry_point
def tez_to_token(self):
    sp.verify(sp.amount > sp.mutez(0), message="NOT_ENOUGH_TEZ")
    tez_in_nat = sp.utils.mutez_to_nat(sp.amount) 
    new_tez_pool = self.data.tez_pool + sp.amount
    new_token_pool = sp.local('new_token_pool', sp.nat(0))
    new_token_pool.value = self.data.invariant / sp.utils.mutez_to_nat(new_tez_pool) 
    token_out = sp.local('token_out', sp.as_nat(self.data.token_pool - new_token_pool.value))
    self.data.tez_pool = new_tez_pool
    self.data.token_pool = new_token_pool.value
    self.data.invariant = self.data.token_pool * sp.utils.mutez_to_nat(self.data.tez_pool)

    sp.if token_out.value > sp.nat(0):
        self.transfer_tokens(
            from_=sp.self_address,
            to=sp.sender, 
            amount=token_out.value
        )
```

## ä»¤ç‰Œåˆ° Tez äº¤æ¢

å°†ä»¤ç‰Œäº¤æ¢åˆ° tez çš„è¿‡ç¨‹ä¹Ÿä¸æˆ‘ä»¬åœ¨ tez åˆ°ä»¤ç‰Œäº¤æ¢ä¸­æ‰€åšçš„éå¸¸ç›¸ä¼¼ã€‚

```
@sp.entry_point
def token_to_tez(self, params):
    sp.set_type(params, sp.TRecord(token_amount=sp.TNat))
    sp.verify(params.token_amount > sp.nat(0), message="NOT_ENOUGH_TOKEN")
    new_token_pool = self.data.token_pool + params.token_amount
    new_tez_pool = self.data.invariant / new_token_pool
    self.data.tez_pool = sp.utils.nat_to_mutez(new_tez_pool)
    self.data.token_pool = new_token_pool
    self.data.invariant = new_token_pool * new_tez_pool

    # Transfer `token_amount` to this contract's address
    self.transfer_tokens(
        from_=sp.sender, 
        to=sp.self_address, 
        amount=params.token_amount
    )

    tez_out = self.data.tez_pool - sp.utils.nat_to_mutez(new_tez_pool)
    # Transfer the swapped tezos.
    self.transfer_tez(to_=sp.sender, amount=tez_out)
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç”¨æˆ·å‘é€ç»™åˆåŒçš„ä»¤ç‰Œé‡ä¸æ± ä¸­å…ˆå‰çš„ä»¤ç‰Œé‡ç›¸åŠ æ¥è®¡ç®—`new_token_pool`ã€‚æˆ‘ä»¬é€šè¿‡ç”¨ä¸å˜é‡é™¤ä»¥`new_token_amount`æ¥è®¡ç®— xtz çš„æ–°é‡ã€‚

ç„¶åæˆ‘ä»¬æ›´æ–°æ± ä¸­çš„å€¼ã€‚

```
new_token_pool = self.data.token_pool + params.token_amount
new_tez_pool = self.data.invariant / new_token_pool
self.data.tez_pool = sp.utils.nat_to_mutez(new_tez_pool)
self.data.token_pool = new_token_pool
self.data.invariant = new_token_pool * new_tez_pool
```

ä¹‹åï¼Œæˆ‘ä»¬å°†ä»£å¸çš„æ•°é‡ï¼Œå³`params.token_amount`ä»å‘é€æ–¹è½¬ç§»åˆ°æˆ‘ä»¬çš„åˆåŒåœ°å€ã€‚ä¹‹åï¼Œæˆ‘ä»¬è®¡ç®—ä»£è¡¨ç”¨æˆ·å°†æ”¶åˆ°çš„ xtz(å•ä½ä¸º mutez)æ•°é‡çš„`tez_out`ã€‚

æœ€åï¼Œæˆ‘ä»¬å®é™…ä¸Šå°†`tez_out` xtz ä»æˆ‘ä»¬çš„åˆåŒè½¬ç§»åˆ°å‘é€æ–¹ã€‚

```
# Transfer `token_amount` to this contract's address
self.transfer_tokens(
    from_=sp.sender, 
    to=sp.self_address, 
    amount=params.token_amount
)

tez_out = self.data.tez_pool - sp.utils.nat_to_mutez(new_tez_pool)
# Transfer the swapped tezos.
self.transfer_tez(to_=sp.sender, amount=tez_out)
```

## æŠ•èµ„æµåŠ¨æ€§

æˆ‘ä»¬å·²ç»å®Œæˆäº† tez ä¸ä»£å¸çš„äº¤æ¢ï¼Œåä¹‹äº¦ç„¶ï¼Œä½†æˆ‘ä»¬éœ€è¦åœ¨åˆåŒä¸­æ·»åŠ ä¸€ç§æ–¹å¼ï¼Œå…è®¸å…¶ä»–äººå‘æ± ä¸­æ·»åŠ æ–°çš„æµåŠ¨æ€§ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸¤ä¸ªå…¥å£ç‚¹ï¼Œå³`invest_liquidty`å’Œ`divest_liquidity`ï¼Œè¿™å°†å…è®¸ç”¨æˆ·åˆ†åˆ«å‘æ± ä¸­æ·»åŠ æ–°çš„æµåŠ¨æ€§å’Œä»æ± ä¸­ç§»é™¤ä»–ä»¬çš„æµåŠ¨æ€§ã€‚

åœ¨æ·±å…¥ç ”ç©¶`invest_liquidity`çš„ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒéœ€è¦åšå“ªäº›äº‹æƒ…ã€‚

1.  æ£€æŸ¥è°ƒç”¨å…¥å£ç‚¹æ—¶åœ¨äº‹åŠ¡ä¸­å‘é€çš„ xtz æ˜¯å¦å¤§äº 0ã€‚
2.  è®¡ç®—èµ„é‡‘æ± çš„æ€»æµåŠ¨æ€§ã€‚
3.  è®¡ç®—æˆ‘ä»¬å°†æ¥å—çš„ä»£å¸é‡‘é¢ï¼Œè¿™æ˜¯æ ¹æ®å½“å‰æ±‡ç‡å’Œå‘é€çš„ xtz é‡‘é¢ç¡®å®šçš„ã€‚
4.  æ ¹æ®æµåŠ¨æ€§è®¡ç®—æˆ‘ä»¬å¿…é¡»ä¸ºç”¨æˆ·é“¸é€ çš„ LP ä»¤ç‰Œçš„æ•°é‡ã€‚
5.  é“¸é€ æ‰€éœ€çš„ LP ä»¤ç‰Œã€‚
6.  æ›´æ–°åˆåŒçš„å­˜å‚¨ã€‚

```
@sp.entry_point
def invest_liquidity(self):
    sp.verify(sp.amount > sp.mutez(0), message="NOT_ENOUGH_TOKEN")

    total_liquidity = sp.utils.mutez_to_nat(self.data.tez_pool) + self.data.token_pool
    token_amount = sp.utils.mutez_to_nat(sp.amount) * self.data.token_pool / sp.utils.mutez_to_nat(self.data.tez_pool)
    liquidity_minted = sp.utils.mutez_to_nat(sp.amount) * total_liquidity / sp.utils.mutez_to_nat(self.data.tez_pool)

    # Mint `liquidity_minted` LP tokens to the `sp.sender`
    self.mint_lp(liquidity_minted)

    self.data.tez_pool += sp.amount
    self.data.token_pool += token_amount
    self.data.invariant = sp.utils.mutez_to_nat(self.data.tez_pool) * self.data.token_pool

    self.transfer_tokens(
        from_=sp.sender, 
        to=sp.self_address, 
        amount=token_amount
    )
```

é¦–å…ˆï¼Œæˆ‘ä»¬æ­£åœ¨è®¡ç®—`total_liquidity`ï¼Œå®ƒæ˜¯`tez_pool`å’Œ`token_pool`çš„å½“å‰å€¼ä¹‹å’Œã€‚ç„¶åï¼Œæˆ‘ä»¬æ ¹æ® token å’Œ xtz ä¹‹é—´çš„å½“å‰æ¯”ç‡ï¼Œè®¡ç®—æˆ‘ä»¬éœ€è¦çš„ä»¤ç‰Œæ•°é‡ä»¥åŠå‘é€çš„ xtzã€‚

```
sp.verify(sp.amount > sp.mutez(0), message="NOT_ENOUGH_TOKEN")

total_liquidity = sp.utils.mutez_to_nat(self.data.tez_pool) + self.data.token_pool
token_amount = sp.utils.mutez_to_nat(sp.amount) * self.data.token_pool / sp.utils.mutez_to_nat(self.data.tez_pool)
```

ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—æˆ‘ä»¬å¿…é¡»ä¸ºæµåŠ¨æ€§æä¾›è€…åˆ›é€ çš„æµåŠ¨æ€§æ•°é‡ï¼Œè¿™å–å†³äºå‘é€åˆ°èµ„é‡‘æ± çš„æµåŠ¨æ€§æ•°é‡ã€‚

ä¹‹åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„æ•ˆç”¨å‡½æ•°`mint_lp`é“¸é€  LP ä»¤ç‰Œï¼Œç„¶åæˆ‘ä»¬å°†æ›´æ–°åˆåŒçš„å­˜å‚¨ã€‚

æœ€åï¼Œæˆ‘ä»¬å°†æ‰€éœ€çš„ä»¤ç‰Œæ•°é‡ä»å‘ä»¶äººåœ°å€è½¬ç§»åˆ°æˆ‘ä»¬çš„åˆåŒåœ°å€ã€‚

```
liquidity_minted = sp.utils.mutez_to_nat(sp.amount) * total_liquidity / sp.utils.mutez_to_nat(self.data.tez_pool)

# Mint `liquidity_minted` LP tokens to the `sp.sender`
self.mint_lp(liquidity_minted)

self.data.tez_pool += sp.amount
self.data.token_pool += token_amount
self.data.invariant = sp.utils.mutez_to_nat(self.data.tez_pool) * self.data.token_pool

self.transfer_tokens(
    from_=sp.sender, 
    to=sp.self_address, 
    amount=token_amount
)
```

## å‰¥ç¦»æµåŠ¨æ€§

ç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥å‘æˆ‘ä»¬çš„æ± ä¸­æŠ•èµ„æµåŠ¨æ€§ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è‡´åŠ›äº`divest_liquidity`ï¼Œè¿™å°†å…è®¸æµåŠ¨æ€§æä¾›è€…æ”¶å›ä»–ä»¬çš„æµåŠ¨æ€§ã€‚

æˆ‘ä»¬çš„`divest_liquidity`å…¥å£ç‚¹åªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³æµåŠ¨æ€§æä¾›è€…æƒ³è¦çƒ§æ‰çš„ LP ä»¤ç‰Œçš„æ•°é‡ï¼Œæ ¹æ®è¿™ä¸ªæ•°é‡ï¼Œæˆ‘ä»¬å°†æŠŠæµåŠ¨æ€§è¿˜ç»™ä»–ä»¬ã€‚

```
@sp.entry_point
def divest_liquidity(self, lp_amount: sp.TNat):
    """ Burn LP and give back the liquidity """
    sp.verify(lp_amount > sp.nat(0), 'INVALID_AMOUNT')
    total_liquidity = sp.utils.mutez_to_nat(self.data.tez_pool) + self.data.token_pool

    tez_out = sp.utils.mutez_to_nat(self.data.tez_pool) * lp_amount / total_liquidity
    token_out = self.data.token_pool * lp_amount / total_liquidity

    self.data.tez_pool = self.data.tez_pool - sp.utils.nat_to_mutez(token_out)
    self.data.token_pool = sp.as_nat(self.data.token_pool - token_out)
    self.data.invariant = self.data.token_pool * sp.utils.mutez_to_nat(self.data.tez_pool)
    self.burn_lp(lp_amount)

    sp.if tez_out > sp.nat(0):
        self.transfer_tez(to_=sp.sender, amount=sp.utils.nat_to_mutez(tez_out))

    sp.if token_out > sp.nat(0):
        self.transfer_tokens(
            from_=sp.self_address,
            to=sp.sender, 
            amount=token_out
        )
    sp.else:
        sp.failwith('NOT_ENOUGH_TOKENS')
```

æˆ‘ä»¬å°†ä»éªŒè¯ LP ä»¤ç‰Œçš„æ•°é‡å¼€å§‹(éœ€è¦å¤§äº 0)ã€‚ç„¶åæˆ‘ä»¬è®¡ç®—è¿™ä¸ªæ± çš„æ€»æµåŠ¨æ€§ã€‚

ç°åœ¨ï¼Œæ ¹æ®æ‚¨æ­£åœ¨æ¶ˆè€—çš„ LP ä»¤ç‰Œæ•°é‡ï¼Œæˆ‘ä»¬æ­£åœ¨è®¡ç®—ä»£è¡¨æµåŠ¨æ€§æä¾›å•†å°†æ”¶å›çš„ xtz å’Œä»¤ç‰Œæ•°é‡çš„`tez_out`å’Œ`token_out`ã€‚

```
sp.verify(lp_amount > sp.nat(0), 'INVALID_AMOUNT')
total_liquidity = sp.utils.mutez_to_nat(self.data.tez_pool) + self.data.token_pool

tez_out = sp.utils.mutez_to_nat(self.data.tez_pool) * lp_amount / total_liquidity
token_out = self.data.token_pool * lp_amount / total_liquidity
```

ç°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨æ›´æ–°åˆåŒçš„å­˜å‚¨ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„æ•ˆç”¨å‡½æ•°å‘é€å›æµåŠ¨æ€§ã€‚

```
self.data.tez_pool = self.data.tez_pool - sp.utils.nat_to_mutez(token_out)
self.data.token_pool = sp.as_nat(self.data.token_pool - token_out)
self.data.invariant = self.data.token_pool * sp.utils.mutez_to_nat(self.data.tez_pool)
self.burn_lp(lp_amount)

sp.if tez_out > sp.nat(0):
    self.transfer_tez(to_=sp.sender, amount=sp.utils.nat_to_mutez(tez_out))

sp.if token_out > sp.nat(0):
    self.transfer_tokens(
        from_=sp.self_address,
        to=sp.sender, 
        amount=token_out
    )
sp.else:
    sp.failwith('NOT_ENOUGH_TOKENS')
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç¼–ç äº†æ‰€æœ‰éœ€è¦çš„å…¥å£ç‚¹ã€‚ç°åœ¨è®©æˆ‘ä»¬ç§»åˆ°å‰ç«¯ã€‚è¦è·å¾—å®Œæ•´çš„æºä»£ç ï¼Œè¯·æŸ¥çœ‹è¿™ä¸ªåº“:[https://github.com/vivekascoder/tez-dex](https://github.com/vivekascoder/tez-dex)

# åœ¨å‰ç«¯å·¥ä½œ

æˆ‘ä»¬å°†ä»åœ¨`App.jsx`æ–‡ä»¶ä¸­å¯¼å…¥å¿…è¦çš„ä¸œè¥¿å¼€å§‹ã€‚

> æ³¨æ„:ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘åœ¨`App.jsx`ä¸­å†™äº†æ‰€æœ‰çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä½ å¯ä»¥æŒ‰ç…§ä½ å–œæ¬¢çš„æ–¹å¼æ„å»ºä½ çš„ä»£ç ã€‚

è®©æˆ‘ä»¬å¯¼å…¥é¡¹ç›®ä¸­å¯èƒ½éœ€è¦çš„æ‰€æœ‰å¿…è¦çš„ä¸œè¥¿ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`axios`æ¥åˆ©ç”¨ **tzkt API** æ¥è·å–ç”¨æˆ·çš„ä½™é¢ã€‚

```
import React, { useState, useEffect } from "react";
import "./index.css";

import { TezosToolkit } from "@taquito/taquito";
import { BeaconWallet } from "@taquito/beacon-wallet";

import CONFIG from "./config.js";
import axios from "axios";
```

æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªåä¸º`config.js`çš„æ–‡ä»¶ï¼ŒåŒ…å«åœ°å€å’Œå…¶ä»–æœ‰å…³æˆ‘ä»¬åˆåŒçš„ä¿¡æ¯ã€‚

```
const config = {
  rpcUrl: "https://granadanet.smartpy.io",
  tokenAddress: "KT1HrjGaoTmdZ8Znbup6bgV2gEpFF8tt9jo5",
  tokenDecimals: 10 ** 6,
  tokenBalanceBigMapId: 87342,
  dexAddress: "KT1FFoWsyFH7rJGxogvPRRuu8MwskY6Asags",
  lpTokenAddress: "KT1AEd7ZCSdpZhNNnEwZU9sNFSkib2s7e61f",
  lpDecimals: 10 ** 9,
  lpBalanceBigMapId: 87352,
  preferredNetwork: "granadanet",
};

export default config;
```

æˆ‘ä»¬å°†åœ¨åŒä¸€ä¸ª`App.jsx`æ–‡ä»¶ä¸­åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„ JSX ç»„ä»¶ï¼Œå³è´Ÿè´£æ˜¾ç¤ºä»»ä½•æ¶ˆæ¯çš„`Notification`å’Œæ˜¾ç¤ºç”¨æˆ·å½“å‰æ‹¥æœ‰çš„**çŒ«ä»¤ç‰Œ**å’Œ **LP ä»¤ç‰Œ**çš„`Balance`ã€‚

```
function Notification({ error, setError }) {
  return (
    <div
      className={`fixed bottom-2 left-2 right-2 p-4 text-sm bg-purple-500 text-white shadow-md z-50 
 ${error ? "block" : "hidden"}`}
    >
      <div className="flex items-center space-x-4">
        <button
          onClick={() => {
            setError("");
          }}
        >
          â
        </button>
        <p className="flex-1">{error}</p>
      </div>
    </div>
  );
}

function Balances({catToken, lpToken}) {
  return (
    <div className="bg-gray-100 shadow-sm flex items-center justify-center p-4 mb-20 space-x-10">
      <span className="font-semibold text-sm">ğŸ± Cat Token: {catToken}</span>
      <span className="font-semibold text-sm">ğŸ’¦ LP Token: {lpToken}</span>
    </div>
  );
}
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯åŠ¨ä¸»è¦çš„`App`ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨ useState åˆ›å»ºä¸€äº›çŠ¶æ€å˜é‡ï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­åˆ›å»ºç‰¹å®šçš„çŠ¶æ€ã€‚

1.  `tezos`:è·Ÿè¸ª`TezosToolkit`å¯¹è±¡ã€‚
2.  `wallet`:è·Ÿè¸ªç”¨æˆ·çš„åœ°å€ã€‚
3.  `error`:è·Ÿè¸ªå°†åœ¨`Notification`ç»„ä»¶ä¸­æ˜¾ç¤ºçš„é”™è¯¯æ¶ˆæ¯ã€‚
4.  `swapXtzAmount`:è·Ÿè¸ªä»£è¡¨äº¤æ¢æ—¶è¦å‘é€çš„ xtz æ•°é‡çš„è¾“å…¥æ¡†ã€‚
5.  `swapTokenAmount`:è·Ÿè¸ªä»£è¡¨äº¤æ¢æ—¶è¦å‘é€çš„ä»¤ç‰Œæ•°é‡çš„è¾“å…¥æ¡†ã€‚
6.  `liquidityXtz`:åœ¨å‘æ± ä¸­æ·»åŠ æµåŠ¨æ€§æ—¶ï¼Œè·Ÿè¸ªéœ€è¦å‘é€çš„ xtz çš„æ•°é‡ã€‚
7.  `lpToBurn`:åœ¨è°ƒç”¨`divest_liquidity`æ—¶ï¼Œè·Ÿè¸ªéœ€è¦çƒ§å½•çš„ LP ä»¤ç‰Œçš„æ•°é‡ã€‚
8.  `lpBalance`:è·Ÿè¸ªå½“å‰ç”¨æˆ·çš„ LP ä»¤ç‰Œä½™é¢ã€‚
9.  `catBalance`:è®°å½•ç”¨æˆ·æ‹¥æœ‰çš„çŒ«å¸æ•°é‡ã€‚

```
function App() {
  const [tezos, setTezos] = useState(null);
  const [wallet, setWallet] = useState(null);
  const [error, setError] = useState("");

  // For the input boxes.
  const [swapXtzAmount, setSwapXtzAmount] = useState(0);
  const [swapTokenAmount, setSwapTokenAmount] = useState(0);
  const [liquidityXtz, setLiquidityXtz] = useState(0);
  const [lpToBurn, setLpToBurn] = useState(0);

  // For showing the balnces.
  const [lpBalance, setLpBalance] = useState(0);
  const [catBalance, setCatBalance] = useState(0);

  return (<div></div>);
}
```

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®ç”¨å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨`tzkt` API çš„å¸®åŠ©ä¸‹è·å–ç”¨æˆ·çš„ä»¤ç‰Œä½™é¢ã€‚

```
async function getBalance(userAddress, bigmapId) {
  const {data} = await axios.get(
    `https://api.granadanet.tzkt.io/v1/bigmaps/${bigmapId}/keys`
  );
  const requiredEl = data.find((el) => {
    return el.key === userAddress;
  })
  if (requiredEl) {
    return parseInt(requiredEl.value.balance);
  } else {
    return 0;
  }
}
```

æˆ‘ä»¬å°†æœ‰ä¸€ä¸ªå‡½æ•°æ¥æ›´æ–°ä½™é¢ï¼Œè¿™æ ·æ— è®ºä½•æ—¶æˆ‘ä»¬æƒ³è¦æ›´æ–°ä½™é¢ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥é€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥å®Œæˆã€‚

```
async function updateBalances() {
if (tezos) {
    const cat = await getBalance(
    wallet,
    CONFIG.tokenBalanceBigMapId
    );
    setCatBalance(cat);

    const lp = await getBalance(
    wallet,
    CONFIG.lpBalanceBigMapId
    );
    setLpBalance(lp);
    console.log({cat, lp})
}
}
```

æ¯å½“`wallet`æ”¹å˜æ—¶ï¼Œè®©æˆ‘ä»¬åˆ©ç”¨`useEffect`é’©å­æ¥æ›´æ–°å¹³è¡¡ã€‚

```
useEffect( () => {
  async function runUseEffect () {
    await updateBalances()
    console.log('updates')
  }
  runUseEffect();
}, [wallet])
```

æˆ‘ä»¬æ¥åšä¸€ä¸ªè¿æ¥**ç¥åº™é’±åŒ…**çš„å‡½æ•°ã€‚

```
async function connectToWallet() {
  if (!tezos) {
    const t = new TezosToolkit(CONFIG.rpcUrl);
    const wallet = new BeaconWallet({
      name: "Tez Dex",
      preferredNetwork: CONFIG.preferredNetwork,
    });
    await wallet.requestPermissions({
      network: { type: CONFIG.preferredNetwork },
    });
    t.setWalletProvider(wallet);
    const pkh = await t.wallet.pkh();
    setTezos(t);
    setWallet(pkh);
  } else {
    setError("The wallet is already connected.");
  }
}
```

å½“ç”¨æˆ·ç‚¹å‡»**äº¤æ¢**æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å°†è§¦å‘è¿™ä¸ªè°ƒç”¨`tez_to_token`å…¥å£ç‚¹çš„æ–¹æ³•ã€‚

```
async function exchange() {
  try {
    const dexContract = await tezos.wallet.at(CONFIG.dexAddress);
    if (swapXtzAmount > 0) {
      // Swap Xtz -> Token
      console.log('Tez -> Token')
      const xtz = parseInt(swapXtzAmount * 10 ** 6);

      // Interacting with the entry_point
      const op = await dexContract.methods.tez_to_token().send({amount: xtz, mutez: true});
      setError(`Operation Hash: ${op.opHash}`)
      const result = await op.confirmation();
      console.log(result);
    } 
    else if(swapTokenAmount > 0) {
      console.log('Token-> Tez')
      // Swap Token -> Xtz
      const catAmount = parseInt(swapTokenAmount * CONFIG.tokenDecimals);
      const tokenContract = await tezos.wallet.at(CONFIG.tokenAddress);
      const batch = await tezos.wallet.batch()
      .withContractCall(
        tokenContract.methods.approve(
          CONFIG.dexAddress,
          catAmount,
        )
      )
      .withContractCall(
        dexContract.methods.token_to_tez(catAmount)
      )
      const batchOp = await batch.send();
      console.log("Operation hash:", batchOp.hash);
      setError(`Operation Hash: ${batchOp.hash}`)

      await updateBalances();
    } 
    else {
      setError(`Not a valid Value.`)
    }
  } catch(err) {
    setError(err.message)
  }
}
```

åŒæ ·ï¼Œå½“ç”¨æˆ·ç‚¹å‡» addLiquidity è¡¨å•çš„ **Add** æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å°†è§¦å‘è¿™ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨`invest_liquidity`å…¥å£ç‚¹ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„å¦ä¸€ä»¶å¾ˆé…·çš„äº‹æƒ…æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ ¹æ®å‘é€çš„ XTZ æ•°é‡å’Œå½“å‰æ±‡ç‡è®¡ç®—éœ€è¦æ‰¹å‡†çš„ Cat ä»¤ç‰Œæ•°é‡ã€‚

```
async function addLiquidity() {
  // Add the liquidity into the dex.
  const dexContract = await tezos.wallet.at(CONFIG.dexAddress);
  const tokenContract = await tezos.wallet.at(CONFIG.tokenAddress);

  const xtz = parseInt(liquidityXtz * 10 ** 6);
  const storage = await dexContract.storage();
  const tezpool = storage['tez_pool'].toNumber();
  const tokenPool = storage['token_pool'].toNumber();
  const tokenNeeded = parseInt(xtz * tokenPool / tezpool);

  const op = await tokenContract.methods.approve(
    CONFIG.dexAddress,
    tokenNeeded
  ).send();
  setError(`Operation Hash: ${op.opHash}`)
  const result = await op.confirmation();
  console.log(result);

  // Interacting with the entry_point
  const anotherOp = await dexContract.methods.invest_liquidity().send({amount: xtz, mutez: true});
  setError(`Operation Hash: ${anotherOp.opHash}`)
  const anotherResult = await anotherOp.confirmation();
  console.log(anotherResult);

  await updateBalances();
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œå½“ç”¨æˆ·ç‚¹å‡» **Remove** æŒ‰é’®å¹¶è°ƒç”¨å¸¦æœ‰éœ€è¦çƒ§å½•çš„ LP ä»¤ç‰Œæ•°é‡çš„`divest_liquidity`å…¥å£ç‚¹æ—¶ï¼Œè¯¥æ–¹æ³•å°†è¢«è§¦å‘ã€‚

```
async function removeLiquidity() {
  const lp = parseInt(lpToBurn * 10 ** 6);
  const dexContract = await tezos.wallet.at(CONFIG.dexAddress);

  // Remove the liquidity from the dex based on the amount of the LP Token burn.
  const op = await dexContract.methods.divest_liquidity(lp).send();
  setError(`Operation Hash: ${op.opHash}`)
  const result = await op.confirmation();
  console.log(result);

  await updateBalances();
}
```

è®©æˆ‘ä»¬åœ¨ä¸€äº› HTML å’Œ tailwindcss å®ç”¨ç¨‹åºç±»çš„å¸®åŠ©ä¸‹ï¼Œå¼€å§‹ç¼–å†™å®é™…çš„ UIã€‚è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨æœ‰æ¡ä»¶åœ°æ¸²æŸ“`Notification`ç»„ä»¶ï¼Œå¦‚æœ`error`æœ‰å€¼ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªå°å¼¹å‡ºçª—å£ã€‚

ä¹‹åï¼Œæˆ‘ä»¬è¿˜è¦æ¸²æŸ“`Balance`ç»„ä»¶ã€‚

```
<div className="max-w-2xl mx-auto relative min-h-screen">
  {error ? <Notification error={error} setError={setError} /> : ""}
  <nav className="bg-gray-100 shadow-sm flex items-center justify-between p-4 mb-20">
    <h1 className="text-lg font-semibold">âš”ï¸ Tez Dex</h1>
    <div className="flex space-x-3 items-center">
      <button className={btnClass} onClick={connectToWallet}>
        {wallet
          ? `${wallet.slice(0, 5)}...${wallet.slice(32, 36)}`
          : "ğŸ’³ï¸ Connect"}
      </button>
    </div>
  </nav>

  <Balances 
    catToken={catBalance / CONFIG.tokenDecimals}
    lpToken={lpBalance / CONFIG.lpDecimals}
  />
</div>
```

ä¹‹åï¼Œè®©æˆ‘ä»¬å¼€å§‹ä¸ºæˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„ä¸åŒåŠ¨ä½œç¼–å†™ä¸€äº›è¡¨å•ï¼Œæ‰€æœ‰çš„è¡¨å•éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚

```
return (
    <div className="max-w-2xl mx-auto relative min-h-screen">
      {error ? <Notification error={error} setError={setError} /> : ""}
      <nav className="bg-gray-100 shadow-sm flex items-center justify-between p-4 mb-20">
        <h1 className="text-lg font-semibold">âš”ï¸ Tez Dex</h1>
        <div className="flex space-x-3 items-center">
          <button className={btnClass} onClick={connectToWallet}>
            {wallet
              ? `${wallet.slice(0, 5)}...${wallet.slice(32, 36)}`
              : "ğŸ’³ï¸ Connect"}
          </button>
        </div>
      </nav>

      <Balances 
        catToken={catBalance / CONFIG.tokenDecimals}
        lpToken={lpBalance / CONFIG.lpDecimals}
      />
      <div className="m-2 p-4 bg-gray-200">
        <p className="text-xs text-gray-500">âš”ï¸ Tez Dex / Exchange</p>
        <form
          className="space-y-4 mt-4"
          onSubmit={(e) => {
            e.preventDefault();
            exchange();
          }}
        >
          <input
            type="number"
            placeholder="Amount of XTZ"
            name="tez"
            className="block text-sm w-full"
            value={swapXtzAmount}
            onChange={(e) => {setSwapXtzAmount(e.target.value);}}
          />
          <input
            type="number"
            placeholder="Amount of Token"
            name="token"
            className="block text-sm w-full"
            value={swapTokenAmount}
            onChange={(e) => {setSwapTokenAmount(e.target.value);}}
          />
          <button
            className={btnClass}
          >
            ğŸ”ƒ Swap
          </button>
        </form>
      </div>

      <div className="m-2 p-4 bg-gray-200">
        <p className="text-xs text-gray-500">âš”ï¸ Tez Dex / Add Liquidity</p>
        <form className="space-y-4 mt-4" onSubmit={(e) => {e.preventDefault(); addLiquidity();}}>
          <div className="flex space-x-2">
            <input
              type="number"
              placeholder="Amount of XTZ"
              name="tez"
              className="text-sm w-full flex-1"
              value={liquidityXtz} 
              onChange={(e) => {setLiquidityXtz(e.target.value)}}
            />
            <button className={btnClass}>ğŸ’¦ Add</button>
          </div>
        </form>
      </div>

      <div className="m-2 p-4 bg-gray-200">
        <p className="text-xs text-gray-500">âš”ï¸ Tez Dex / Remove Liquidity</p>
        <form className="space-y-4 mt-4" onSubmit={(e) => {e.preventDefault(); removeLiquidity();}}>
          <div className="flex space-x-2">
            <input
              type="number"
              placeholder="Amount of LP Tokens to burn"
              name="tez"
              className="text-sm w-full flex-1"
              value={lpToBurn} 
              onChange={(e) => {setLpToBurn(e.target.value)}}
            />
            <button className={btnClass}>ğŸ”¥ Remove</button>
          </div>
        </form>
      </div>

      <p className="absolute bottom-2 right-2 text-xs font-semibold">
        Coded by{" "}
        <a href="https://github.com/vivekascoder" className="text-blue-500">
          @vivekascoder
        </a>
      </p>
    </div>
  );
```

æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤`yarn start`å¯åŠ¨ React é¡¹ç›®ã€‚ç„¶åæ‰“å¼€ä½ çš„ç½‘ç»œæµè§ˆå™¨åˆ°`http://localhost:3000`ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹å›¾çš„ä¸œè¥¿:

[![Tez Dex](img/da79db634be7622761c639185388bd87.png)](https://camo.githubusercontent.com/21c213a5a7723fb8f8b8df63e29ed8599a353b097c0c3c7a2b8e28665e547112/68747470733a2f2f692e696d6775722e636f6d2f5149456c4e375a5f642e776562703f6d617877696474683d37363026666964656c6974793d6772616e64)

## æŠŠ Tez æ¢æˆ tokenã€‚

åœ¨ xtz ä¸­è¾“å…¥ä¸€äº›é‡‘é¢(æ¯”å¦‚è¯´ 1)åï¼Œå•å‡»äº¤æ¢æŒ‰é’®ã€‚

[![Tez To Token](img/ab4fcbbfda0723f8e77a202514973e16.png)](https://camo.githubusercontent.com/b780126ffd4781884a021c761f3d901e1e2086a846b147c58b83cbaa45aa64fa/68747470733a2f2f692e696d6775722e636f6d2f47554773706a4d2e706e67)

æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®å½“å‰æ¯”ç‡ï¼Œå…‘æ¢ 1 æš tez åï¼Œæˆ‘ä»¬å°†è·å¾—å¤§çº¦ 97 æš cat tokenã€‚[![Transaction](img/8556296c7dba27435314a2d76b176cba.png)](https://camo.githubusercontent.com/8fe17594e3d69caaf9c6df3a54cb3dd54fd2d0424f868306d2c6d4c8ed063e4a/68747470733a2f2f692e696d6775722e636f6d2f346c48636b55532e706e67)

# å…³äºä½œè€…

æˆ‘æ˜¯ Vivekï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šå…³äºæˆ‘çš„ä¿¡æ¯

# å‚è€ƒ

1.  [Uniswap v1 ç™½çš®ä¹¦](https://hackmd.io/@HaydenAdams/HJ9jLsfTz)
2.  [è®²è§£ DEX çš„è§†é¢‘](https://hackmd.io/@HaydenAdams/HJ9jLsfTz)