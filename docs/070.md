# ä»‹ç»

> åŸæ–‡:[https://github . com/fig ment-networks/learn-tutorials/blob/master/cosmos/create-a-blog-app . MD](https://github.com/figment-networks/learn-tutorials/blob/master/cosmos/create-a-blog-app.md)

[**åŸæ–‡æ•™ç¨‹å¯ä»¥åœ¨ Cosmos SDK æ–‡æ¡£è¿™é‡Œæ‰¾åˆ°**](https://tutorials.cosmos.network/starport-blog/tutorial/01-index.html) ã€‚

é€šè¿‡é˜…è¯»æœ¬æ•™ç¨‹ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªç”± Cosmos SDK æ”¯æŒçš„ç®€å•åšå®¢åº”ç”¨ç¨‹åºã€‚

# å…¥é—¨æŒ‡å—

æˆ‘ä»¬å¼€å§‹å§ï¼ç¬¬ä¸€æ­¥æ˜¯å®‰è£… [starport](https://github.com/tendermint/starport) CLI å·¥å…·ã€‚

åœ¨å®‰è£…äº†`starport`ä¹‹åï¼Œä½¿ç”¨å®ƒåœ¨åä¸º`blog`çš„ç›®å½•ä¸­åˆ›å»ºåˆå§‹åº”ç”¨ç¨‹åºç»“æ„:

```
starport app github.com/example/blog 
```

Starport çš„ä¸»è¦ç‰¹æ€§ä¹‹ä¸€æ˜¯ä»£ç ç”Ÿæˆã€‚ä¸Šé¢çš„å‘½ä»¤å·²ç»ç”Ÿæˆäº†ä¸€ä¸ªç›®å½•ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå·¥ä½œçš„åŒºå—é“¾åº”ç”¨ç¨‹åºã€‚Starport è¿˜å¯ä»¥ç”¨`starport type`å‘½ä»¤ç»™ä½ çš„åº”ç”¨æ·»åŠ æ•°æ®ç±»å‹ã€‚è¦æŸ¥çœ‹å®ƒçš„è¿è¡Œæƒ…å†µï¼Œè¯·éµå¾ª[æŠ•ç¥¨åº”ç”¨æ•™ç¨‹](https://learn.figment.io/tutorials/build-a-polling-app)ã€‚ç„¶è€Œï¼Œåœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ‰‹åŠ¨åˆ›å»ºè¿™äº›æ–‡ä»¶ï¼Œä»¥äº†è§£å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

# æ¦‚è§‚

è®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸‹ Starport ä¸ºæˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆã€‚ [`app/app.go`](https://docs.cosmos.network/master/basics/app-anatomy.html#core-application-file) æ–‡ä»¶å¯¼å…¥å¹¶é…ç½® SDK æ¨¡å—ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªæ„é€ å™¨ï¼Œè¯¥æ„é€ å™¨æ‰©å±•äº†ä¸€ä¸ª[åŸºæœ¬ SDK åº”ç”¨ç¨‹åº](https://docs.cosmos.network/master/core/baseapp.html)ç­‰ç­‰ã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºå°†åªä½¿ç”¨ä¸ Cosmos SDK æ†ç»‘åœ¨ä¸€èµ·çš„å‡ ä¸ªæ ‡å‡†æ¨¡å—(åŒ…æ‹¬ç”¨äºå¤„ç†è´¦æˆ·çš„`auth`å’Œç”¨äºå¤„ç†ç¡¬å¸è½¬ç§»çš„`bank`)å’Œä¸€ä¸ªåŒ…å«è‡ªå®šä¹‰åŠŸèƒ½çš„æ¨¡å—(`x/blog`)ã€‚

åœ¨`cmd`ç›®å½•ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç¨‹åºçš„æºæ–‡ä»¶ï¼Œç”¨äºä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºäº¤äº’:`blogd`ä¸ºæ‚¨çš„å—é“¾å¯åŠ¨ä¸€ä¸ªå®Œæ•´èŠ‚ç‚¹ï¼Œè€Œ`blogcli`ä½¿æ‚¨èƒ½å¤ŸæŸ¥è¯¢å®Œæ•´èŠ‚ç‚¹ï¼Œæˆ–è€…é€šè¿‡å‘é€äº‹åŠ¡æ¥æ›´æ–°çŠ¶æ€ï¼Œæˆ–è€…é€šè¿‡æŸ¥è¯¢æ¥è¯»å–çŠ¶æ€ã€‚

è¿™ä¸ªåšå®¢åº”ç”¨ç¨‹åºå°†æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæŒä¹…çš„[é”®å€¼å­˜å‚¨](https://docs.cosmos.network/master/core/store.html)ä¸­ã€‚ä¸å¤§å¤šæ•°é”®å€¼å­˜å‚¨ç±»ä¼¼ï¼Œæ‚¨å¯ä»¥æ£€ç´¢ã€åˆ é™¤ã€æ›´æ–°å’Œéå†é”®æ¥è·å¾—æ‚¨æ„Ÿå…´è¶£çš„å€¼ã€‚

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ç±»ä¼¼åšå®¢çš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®šä¹‰ç¬¬ä¸€ç§ç±»å‹ï¼Œ`Post`ã€‚

**T2`x/blog/types/TypesPost.go`**

```
package types

import (
	sdk "github.com/cosmos/cosmos-sdk/types"
)

type Post struct {
	Creator sdk.AccAddress `json:"creator" yaml:"creator"`
	ID      string         `json:"id" yaml:"id"`
	Title   string         `json:"title" yaml:"title"`
	Body    string         `json:"body" yaml:"body"`
}
```

ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ç¯‡æ–‡ç« çš„ä¸‰ä¸ªå±æ€§:åˆ›å»ºè€…ã€æ ‡é¢˜å’Œ IDã€‚SDK æä¾›äº†æœ‰ç”¨çš„ç±»å‹æ¥è¡¨ç¤ºåœ°å€ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨`sdk.AccAddress`æ¥è¡¨ç¤º Creatorã€‚æ ‡é¢˜å­˜å‚¨ä¸ºå­—ç¬¦ä¸²ã€‚æœ€åï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªå¸–å­ç”Ÿæˆå”¯ä¸€çš„å…¨å±€ idï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨ä¸ºå­—ç¬¦ä¸²ã€‚

æˆ‘ä»¬çš„é”®å€¼å­˜å‚¨ä¸­çš„å¸–å­å°†å¦‚ä¸‹æ‰€ç¤º:

```
"post-0bae9f7d-20f8-4b51-9d5c-af9103177d66": {
  "Creator": "cosmos18cd5t4msvp2lpuvh99rwglrmjrrw9qx5h3f3gz",
  "Title": "This is a post!",
  "Body": "Welcome to my blog app.",
  "ID": "0bae9f7d-20f8-4b51-9d5c-af9103177d66"
},
"post-8c6d8cd4-b4c9-4ba3-a683-e894db3f2605": {
  ...
} 
```

ç°åœ¨å•†åº—æ˜¯ç©ºçš„ã€‚æˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹æ€ä¹ˆåŠ å¸–å­ã€‚

å€ŸåŠ© Cosmos SDKï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ CLI ( `blogcli`)æˆ–å‘é€ HTTP è¯·æ±‚ä¸æ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰ CLI å‘½ä»¤ã€‚ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿè¾“å…¥`blogcli tx blog create-post 'This is a post!' 'Welcome to my blog app.' --from=user1`æ¥æ·»åŠ ä¸€ç¯‡æ–‡ç« åˆ°ä½ çš„å•†åº—ã€‚`create-post`å­å‘½ä»¤è¿˜æ²¡æœ‰è¢«å®šä¹‰â€”â€”ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

**T2`x/blog/client/cli/tx.go`**

åœ¨`import`å—ä¸­ï¼Œç¡®ä¿å¯¼å…¥è¿™äº”ä¸ªé¢å¤–çš„åŒ…:

```
import (
  // Existing imports...
  "bufio"
  "github.com/cosmos/cosmos-sdk/client/context"
  "github.com/cosmos/cosmos-sdk/x/auth"
  "github.com/cosmos/cosmos-sdk/x/auth/client/utils"
  sdk "github.com/cosmos/cosmos-sdk/types"
)
```

è¯¥æ–‡ä»¶å·²ç»åŒ…å«å®šä¹‰è‡ªå®šä¹‰`blogcli` [å‘½ä»¤](https://docs.cosmos.network/master/building-modules/module-interfaces.html#cli)çš„`func GetTxCmd`ã€‚æˆ‘ä»¬å°†é€šè¿‡é¦–å…ˆå°†`GetCmdCreatePost`æ·»åŠ åˆ°`blogTxCmd`æ¥å°†è‡ªå®šä¹‰çš„`create-post`å‘½ä»¤æ·»åŠ åˆ°æˆ‘ä»¬çš„`blogcli`ä¸­ã€‚

```
blogTxCmd.AddCommand(flags.PostCommands(
    GetCmdCreatePost(cdc),
  )...)
```

åœ¨æ–‡ä»¶çš„æœ€åï¼Œæˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸‹`GetCmdCreatePost`æœ¬èº«ã€‚

```
package cli

import (
	"bufio"

	"github.com/spf13/cobra"

	"github.com/cosmos/cosmos-sdk/client/context"
	"github.com/cosmos/cosmos-sdk/codec"
	sdk "github.com/cosmos/cosmos-sdk/types"
	"github.com/cosmos/cosmos-sdk/x/auth"
	"github.com/cosmos/cosmos-sdk/x/auth/client/utils"
	"github.com/sdk-tutorials/starport-blog/blog/x/blog/types"
)

func GetCmdCreatePost(cdc *codec.Codec) *cobra.Command {
	return &cobra.Command{
		Use:   "create-post [title] [body]",
		Short: "Creates a new post",
		Args:  cobra.MinimumNArgs(2),
		RunE: func(cmd *cobra.Command, args []string) error {
			argsTitle := string(args[0])
			argsBody := string(args[1])

			cliCtx := context.NewCLIContext().WithCodec(cdc)
			inBuf := bufio.NewReader(cmd.InOrStdin())
			txBldr := auth.NewTxBuilderFromCLI(inBuf).WithTxEncoder(utils.GetTxEncoder(cdc))
			msg := types.NewMsgCreatePost(cliCtx.GetFromAddress(), argsTitle, argsBody)
			err := msg.ValidateBasic()
			if err != nil {
				return err
			}
			return utils.GenerateOrBroadcastMsgs(cliCtx, txBldr, []sdk.Msg{msg})
		},
	}
}
```

ä¸Šé¢çš„å‡½æ•°å®šä¹‰äº†è¿è¡Œ`create-post`å­å‘½ä»¤æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚`create-post`æ¥å—ä¸¤ä¸ªå‚æ•°`[title] [body]`ï¼Œåˆ›å»ºä¸€ä¸ªæ¶ˆæ¯`NewMsgCreatePost`(æ ‡é¢˜ä¸º`args[0]`å’Œ`args[1]`)å¹¶å¹¿æ’­è¯¥æ¶ˆæ¯ï¼Œä»¥ä¾¿åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå¤„ç†ã€‚

è¿™æ˜¯ SDK ä¸­çš„ä¸€ç§å¸¸è§æ¨¡å¼:ç”¨æˆ·é€šè¿‡å¹¿æ’­[æ¶ˆæ¯](https://docs.cosmos.network/master/building-modules/messages-and-queries.html#messages)å¯¹å­˜å‚¨è¿›è¡Œæ›´æ”¹ã€‚CLI å‘½ä»¤å’Œ HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºå¯ä»¥å¹¿æ’­çš„æ¶ˆæ¯ï¼Œä»¥ä¾¿è¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚

**T2`x/blog/types/MsgCreatePost.go`**

è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­å°†`NewMsgCreatePost`å®šä¹‰ä¸º`x/blog/types/MsgCreatePost.go`ã€‚

```
package types

import (
	sdk "github.com/cosmos/cosmos-sdk/types"
	sdkerrors "github.com/cosmos/cosmos-sdk/types/errors"
	"github.com/google/uuid"
)

var _ sdk.Msg = &MsgCreatePost{}

type MsgCreatePost struct {
	ID      string
	Creator sdk.AccAddress `json:"creator" yaml:"creator"`
	Title   string         `json:"title" yaml:"title"`
	Body    string         `json:"body" yaml:"body"`
}

func NewMsgCreatePost(creator sdk.AccAddress, title string, body string) MsgCreatePost {
	return MsgCreatePost{
		ID:      uuid.New().String(),
		Creator: creator,
		Title:   title,
		Body:    body,
	}
}

func (msg MsgCreatePost) Route() string {
	return RouterKey
}

func (msg MsgCreatePost) Type() string {
	return "CreatePost"
}

func (msg MsgCreatePost) GetSigners() []sdk.AccAddress {
	return []sdk.AccAddress{sdk.AccAddress(msg.Creator)}
}

func (msg MsgCreatePost) GetSignBytes() []byte {
	bz := ModuleCdc.MustMarshalJSON(msg)
	return sdk.MustSortJSON(bz)
}

func (msg MsgCreatePost) ValidateBasic() error {
	if msg.Creator.Empty() {
		return sdkerrors.Wrap(sdkerrors.ErrInvalidAddress, "creator can't be empty")
	}
	return nil
}
```

ç±»ä¼¼äº post ç»“æ„ï¼Œ`MsgCreatePost`åŒ…å«åˆ›å»ºè€…å’Œæ ‡é¢˜å±æ€§ã€‚æˆ‘ä»¬æ²¡æœ‰åŒ…å« ID å±æ€§ï¼Œå› ä¸º`MsgCreatePost`åªå®šä¹‰äº†æˆ‘ä»¬ä»ç”¨æˆ·é‚£é‡Œæ¥å—çš„æ•°æ®â€”â€”æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥è‡ªåŠ¨ç”Ÿæˆ IDã€‚

```
package types

import (
	sdk "github.com/cosmos/cosmos-sdk/types"
	sdkerrors "github.com/cosmos/cosmos-sdk/types/errors"
	"github.com/google/uuid"
)

var _ sdk.Msg = &MsgCreatePost{}

type MsgCreatePost struct {
	ID      string
	Creator sdk.AccAddress `json:"creator" yaml:"creator"`
	Title   string         `json:"title" yaml:"title"`
	Body    string         `json:"body" yaml:"body"`
}

func NewMsgCreatePost(creator sdk.AccAddress, title string, body string) MsgCreatePost {
	return MsgCreatePost{
		ID:      uuid.New().String(),
		Creator: creator,
		Title:   title,
		Body:    body,
	}
}

func (msg MsgCreatePost) Route() string {
	return RouterKey
}

func (msg MsgCreatePost) Type() string {
	return "CreatePost"
}

func (msg MsgCreatePost) GetSigners() []sdk.AccAddress {
	return []sdk.AccAddress{sdk.AccAddress(msg.Creator)}
}

func (msg MsgCreatePost) GetSignBytes() []byte {
	bz := ModuleCdc.MustMarshalJSON(msg)
	return sdk.MustSortJSON(bz)
}

func (msg MsgCreatePost) ValidateBasic() error {
	if msg.Creator.Empty() {
		return sdkerrors.Wrap(sdkerrors.ErrInvalidAddress, "creator can't be empty")
	}
	return nil
}
```

`NewMsgCreatePost`æ˜¯ä¸€ä¸ªåˆ›å»º`MsgCreatePost`æ¶ˆæ¯çš„æ„é€ å‡½æ•°ã€‚å¿…é¡»å®šä¹‰ä»¥ä¸‹äº”ä¸ªå‡½æ•°æ¥å®ç°`Msg`æ¥å£ã€‚å®ƒä»¬å…è®¸æ‚¨æ‰§è¡Œä¸éœ€è¦è®¿é—®å­˜å‚¨çš„éªŒè¯(æ¯”å¦‚æ£€æŸ¥ç©ºå€¼)ç­‰ã€‚

```
package types

import (
	sdk "github.com/cosmos/cosmos-sdk/types"
	sdkerrors "github.com/cosmos/cosmos-sdk/types/errors"
	"github.com/google/uuid"
)

var _ sdk.Msg = &MsgCreatePost{}

type MsgCreatePost struct {
	ID      string
	Creator sdk.AccAddress `json:"creator" yaml:"creator"`
	Title   string         `json:"title" yaml:"title"`
	Body    string         `json:"body" yaml:"body"`
}

func NewMsgCreatePost(creator sdk.AccAddress, title string, body string) MsgCreatePost {
	return MsgCreatePost{
		ID:      uuid.New().String(),
		Creator: creator,
		Title:   title,
		Body:    body,
	}
}

func (msg MsgCreatePost) Route() string {
	return RouterKey
}

func (msg MsgCreatePost) Type() string {
	return "CreatePost"
}

func (msg MsgCreatePost) GetSigners() []sdk.AccAddress {
	return []sdk.AccAddress{sdk.AccAddress(msg.Creator)}
}

func (msg MsgCreatePost) GetSignBytes() []byte {
	bz := ModuleCdc.MustMarshalJSON(msg)
	return sdk.MustSortJSON(bz)
}

func (msg MsgCreatePost) ValidateBasic() error {
	if msg.Creator.Empty() {
		return sdkerrors.Wrap(sdkerrors.ErrInvalidAddress, "creator can't be empty")
	}
	return nil
}
```

å›åˆ°`x/blog/client/cli/tx.go`ä¸­çš„`GetCmdCreatePost`ï¼Œä½ ä¼šçœ‹åˆ°`MsgCreatePost`å’Œ`GenerateOrBroadcastMsgs`ä¸€èµ·è¢«åˆ›ä½œå’Œæ’­å‡ºã€‚

å¹¿æ’­ä¹‹åï¼Œæ¶ˆæ¯ç”±åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†å¤„ç†ï¼Œç§°ä¸º [**å¤„ç†ç¨‹åº**](https://docs.cosmos.network/master/building-modules/handler.html) ã€‚

**T2`x/blog/handler.go`**

é¦–å…ˆå¯¼å…¥æˆ‘ä»¬åˆ›å»ºçš„æ–°åšå®¢ç±»å‹:

```
import (
  // Existing imports...
  "github.com/example/blog/x/blog/types"
)
```

æ‚¨åº”è¯¥å·²ç»å®šä¹‰äº†åˆ—å‡ºæ‰€æœ‰å¯ç”¨å¤„ç†ç¨‹åºçš„`func NewHandler`ã€‚ä¿®æ”¹å®ƒä»¥åŒ…å«ä¸€ä¸ªåä¸º`handleMsgCreatePost`çš„æ–°å‡½æ•°ã€‚

```
package blog

import (
	"fmt"

	sdk "github.com/cosmos/cosmos-sdk/types"
	"github.com/sdk-tutorials/starport-blog/blog/x/blog/keeper"
	"github.com/sdk-tutorials/starport-blog/blog/x/blog/types"
	sdkerrors "github.com/cosmos/cosmos-sdk/types/errors"
)

// NewHandler ...
func NewHandler(k keeper.Keeper) sdk.Handler {
	return func(ctx sdk.Context, msg sdk.Msg) (*sdk.Result, error) {
		ctx = ctx.WithEventManager(sdk.NewEventManager())
		switch msg := msg.(type) {
    // this line is used by starport scaffolding
		case types.MsgCreateComment:
			return handleMsgCreateComment(ctx, k, msg)
		case types.MsgCreatePost:
			return handleMsgCreatePost(ctx, k, msg)
		default:
			errMsg := fmt.Sprintf("unrecognized %s message type: %T", types.ModuleName, msg)
			return nil, sdkerrors.Wrap(sdkerrors.ErrUnknownRequest, errMsg)
		}
	}
}
```

ç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸‹`handleMsgCreatePost`:

```
package blog

import (
	sdk "github.com/cosmos/cosmos-sdk/types"
	"github.com/sdk-tutorials/starport-blog/blog/x/blog/keeper"
	"github.com/sdk-tutorials/starport-blog/blog/x/blog/types"
)

func handleMsgCreatePost(ctx sdk.Context, k keeper.Keeper, msg types.MsgCreatePost) (*sdk.Result, error) {
	var post = types.Post{
		Creator: msg.Creator,
		ID:      msg.ID,
		Title:   msg.Title,
		Body:    msg.Body,
	}
	k.CreatePost(ctx, post)

	return &sdk.Result{Events: ctx.EventManager().Events()}, nil
}
```

åœ¨è¿™ä¸ªå¤„ç†ç¨‹åºä¸­ï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ª`Post`å¯¹è±¡(post ç±»å‹åœ¨ç¬¬ä¸€æ­¥ä¸­å®šä¹‰)ã€‚æ‚¨ç”¨æ¶ˆæ¯çš„åˆ›å»ºè€…ã€æ ‡é¢˜å’Œæ­£æ–‡(`msg.Creator`ã€`msg.Title`å’Œ`msg.Body`)å¡«å…… post å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨åœ¨`tx.go`ä¸­ç”¨`NewMsgCreatePost()`å’Œ`uuid.New().String()`ç”Ÿæˆçš„æƒŸä¸€ IDã€‚

åˆ›å»ºå¸¦æœ‰åˆ›å»ºè€…ã€ID å’Œæ ‡é¢˜çš„ post å¯¹è±¡åï¼Œæ¶ˆæ¯å¤„ç†ç¨‹åºè°ƒç”¨`k.CreatePost(ctx, post)`ã€‚â€œkâ€ä»£è¡¨[ç®¡ç†å‘˜](https://docs.cosmos.network/master/building-modules/keeper.html)ï¼Œä¸€ä¸ªç”± SDK ä½¿ç”¨çš„æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå°†æ•°æ®å†™å…¥å­˜å‚¨ã€‚è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸‹`CreatePost` keeper å‡½æ•°ã€‚

**T2`x/blog/keeper/keeper.go`**

æ·»åŠ ä¸€ä¸ªæ¥å—ä¸¤ä¸ªå‚æ•°çš„`CreatePost`å‡½æ•°:ä¸€ä¸ª[ä¸Šä¸‹æ–‡](https://docs.cosmos.network/master/core/context.html#context-definition)å’Œä¸€ä¸ª postã€‚

```
package keeper

import (
	"github.com/cosmos/cosmos-sdk/codec"
	sdk "github.com/cosmos/cosmos-sdk/types"
	"github.com/sdk-tutorials/starport-blog/blog/x/blog/types"
)

func (k Keeper) CreatePost(ctx sdk.Context, post types.Post) {
	store := ctx.KVStore(k.storeKey)
	key := []byte(types.PostPrefix + post.ID)
	value := k.cdc.MustMarshalBinaryLengthPrefixed(post)
	store.Set(key, value)
}

func listPost(ctx sdk.Context, k Keeper) ([]byte, error) {
	var postList []types.Post
	store := ctx.KVStore(k.storeKey)
	iterator := sdk.KVStorePrefixIterator(store, []byte(types.PostPrefix))
	for ; iterator.Valid(); iterator.Next() {
		var post types.Post
		k.cdc.MustUnmarshalBinaryLengthPrefixed(store.Get(iterator.Key()), &post)
		postList = append(postList, post)
	}
	res := codec.MustMarshalJSONIndent(k.cdc, postList)
	return res, nil
}
```

`CreatePost`é€šè¿‡è¿æ¥ä¸€ä¸ª post å‰ç¼€å’Œä¸€ä¸ª ID æ¥åˆ›å»ºä¸€ä¸ªé”®ã€‚å¦‚æœä½ å›å¤´çœ‹çœ‹æˆ‘ä»¬å•†åº—çš„æ ·å­ï¼Œä½ ä¼šæ³¨æ„åˆ°é’¥åŒ™æœ‰å‰ç¼€ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ`post-0bae9f7d-20f8-4b51-9d5c-af9103177d66`åŒ…å«å‰ç¼€`post-`ã€‚è¿™æ˜¯å› ä¸ºæ‚¨æœ‰ä¸€ä¸ªå­˜å‚¨ï¼Œä½†æ˜¯æ‚¨å¯èƒ½å¸Œæœ›åœ¨å…¶ä¸­ä¿å­˜ä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚å¸–å­å’Œç”¨æˆ·ã€‚åœ¨é”®å‰åŠ ä¸Š`post-`å’Œ`user-`å¯ä»¥è®©ä½ åœ¨ä¸åŒç±»å‹çš„å¯¹è±¡ä¹‹é—´å…±äº«ä¸€ä¸ªå­˜å‚¨ç©ºé—´ã€‚

**T2`x/blog/types/key.go`**

è¦å®šä¹‰ post å‰ç¼€ï¼Œè¯·æ·»åŠ ä»¥ä¸‹ä»£ç :

```
package types

const (
	// ModuleName is the name of the module
	ModuleName = "blog"

	// StoreKey to be used when creating the KVStore
	StoreKey = ModuleName

	// RouterKey to be used for routing msgs
	RouterKey = ModuleName

	// QuerierRoute to be used for querier msgs
	QuerierRoute = ModuleName
)

const (
	PostPrefix = "post-"
)

const (
	CommentPrefix = "comment-"
)
```

**T2`x/blog/types/codec.go`**

æœ€åï¼Œ`store.Set(key, value)`å°†æˆ‘ä»¬çš„å¸–å­å†™åˆ°å•†åº—ã€‚æœ€åè¦åšçš„ä¸¤ä»¶äº‹æ˜¯å‘Šè¯‰æˆ‘ä»¬çš„[ç¼–ç å™¨](https://docs.cosmos.network/master/core/encoding.html#amino)æˆ‘ä»¬çš„`MsgCreatePost`å¦‚ä½•è¢«è½¬æ¢æˆå­—èŠ‚ã€‚

```
package types

import (
	"github.com/cosmos/cosmos-sdk/codec"
)

// RegisterCodec registers concrete types on codec
func RegisterCodec(cdc *codec.Codec) {
	// this line is used by starport scaffolding
	cdc.RegisterConcrete(MsgCreateComment{}, "blog/CreateComment", nil)
	cdc.RegisterConcrete(MsgCreatePost{}, "blog/CreatePost", nil)
}

// ModuleCdc defines the module codec
var ModuleCdc *codec.Codec

func init() {
	ModuleCdc = codec.New()
	RegisterCodec(ModuleCdc)
	codec.RegisterCrypto(ModuleCdc)
	ModuleCdc.Seal()
}
```

# å‘åŠ¨

ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡å»ºç«‹å’Œå¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¹¶åˆ›å»ºä¸€äº›èŒä½ã€‚

è¦å¯åŠ¨åº”ç”¨ç¨‹åºè¿è¡Œ:

```
starport serve 
```

æ­¤å‘½ä»¤å®‰è£…ä¾èµ–é¡¹ï¼Œæ„å»ºå’Œåˆå§‹åŒ–åº”ç”¨ç¨‹åºï¼Œå¹¶è¿è¡ŒæœåŠ¡å™¨ã€‚æ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®Œæˆ:

1.  `go mod tidy`æ¸…é™¤ä¾èµ–å…³ç³»ã€‚
2.  `make`æ„å»ºä½ çš„åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ä½ çš„è¿è¡Œè·¯å¾„ä¸­åˆ›å»ºä¸¤ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶:`blogd`å’Œ`blogcli`ã€‚
3.  `Makefile`ä¸­çš„åˆå§‹åŒ–è„šæœ¬åˆ é™¤æ•°æ®ç›®å½•ï¼Œé…ç½®æ‚¨çš„åº”ç”¨ç¨‹åºå¹¶ç”Ÿæˆä¸¤ä¸ªå¸æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†æ•°æ®å­˜å‚¨åœ¨ä½ çš„ä¸»ç›®å½•ä¸­çš„`~/.blogd`å’Œ`~/.blogcli`ã€‚è„šæœ¬åˆ é™¤äº†å®ƒä»¬ï¼Œæ‰€ä»¥æ¯æ¬¡ä½ æœ‰ä¸€ä¸ªå¹²å‡€çš„çŠ¶æ€ã€‚
4.  `blogd start`å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºã€‚å‡ ç§’é’Ÿåï¼Œæ‚¨å°†çœ‹åˆ°æ­£åœ¨ç”Ÿæˆçš„å—æ•£åˆ—ã€‚è®©è¿™ä¸ªç»ˆç«¯çª—å£ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç„¶åæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ã€‚

æ³¨æ„:æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿå’Œé˜²ç«å¢™è®¾ç½®ï¼Œæ‚¨å¯èƒ½å¿…é¡»æ¥å—ä¸€ä¸ªæç¤ºï¼Œè¯¢é—®æ‚¨çš„åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶(åœ¨æœ¬ä¾‹ä¸­ä¸º`blogd`)æ˜¯å¦å¯ä»¥æ¥å—å¤–éƒ¨è¿æ¥ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¸–å­:

```
blogcli tx blog create-post "My first post" "This is a post\!" --from=user1 
```

â€œè¿™æ˜¯å¸–å­ï¼â€æ˜¯æˆ‘ä»¬å¸–å­çš„æ ‡é¢˜ï¼Œ`--from=user1`å‘Šè¯‰ç¨‹åºæ˜¯è°åˆ›å»ºäº†è¿™ä¸ªå¸–å­ã€‚`user1`æ˜¯æ‚¨ç”¨æ¥ç­¾ç½²äº¤æ˜“çš„å¯†é’¥å¯¹çš„æ ‡ç­¾ï¼Œç”±å…ˆå‰ä½äº`/Makefile`ä¸­çš„åˆå§‹åŒ–è„šæœ¬åˆ›å»ºã€‚å¯†é’¥å­˜å‚¨åœ¨`~/.blogcli`ä¸­ã€‚

è¿è¡Œå‘½ä»¤å¹¶ç¡®è®¤åï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰â€œtxhashâ€å±æ€§çš„å¯¹è±¡ï¼Œå…¶å€¼ç±»ä¼¼äº`CA1491B39384A4F29E568F62B156E0F2D0601507EF499CE1B8F3930BAFE7F03C`ã€‚

è¦éªŒè¯äº¤æ˜“å·²è¢«å¤„ç†ï¼Œè¯·æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—®ä»¥ä¸‹ URL(ç¡®ä¿ç”¨ txhash çš„å€¼æ›¿æ¢`CA14...`ï¼Œä½†ç¡®ä¿ä¿ç•™å‰ç¼€`0x`):

```
http://localhost:26657/tx?hash=0xCA1491B39384A4F29E568F62B156E0F2D0601507EF499CE1B8F3930BAFE7F03C 
```

æ­å–œä½ ï¼æ‚¨åˆšåˆšåˆ›å»ºå¹¶å¯åŠ¨äº†æ‚¨çš„è‡ªå®šä¹‰åŒºå—é“¾ï¼Œå¹¶å‘é€äº†ç¬¬ä¸€ç¬”äº¤æ˜“<g-emoji class="g-emoji" alias="tada" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f389.png">ğŸ‰</g-emoji>

# æ½œåœ¨é”™è¯¯åŠå…¶è§£å†³æ–¹æ¡ˆ

## æ‰¾ä¸åˆ°æä¾›åŒ…çš„æ¨¡å—

```
x/blog/client/cli/tx.go:12:2: cannot find module providing package github.com/cosmos/cosmos-sdk/client/utils: import lookup disabled by -mod=readonly
x/blog/client/cli/tx.go:75:59: undefined: sdk 
```

ç¡®ä¿åœ¨`x/blog/client/cli/tx.go`ä¸­å¯¼å…¥æ‰€æœ‰å¿…éœ€çš„åŒ…:

```
import (
  // ...
  sdk "github.com/cosmos/cosmos-sdk/types"
  "github.com/cosmos/cosmos-sdk/x/auth/client/utils"
)
```

## â€œåšå®¢â€çš„æœªçŸ¥å‘½ä»¤â€œåˆ›å»º-å‘å¸ƒâ€

```
blogcli tx blog create-post 'Hello!' 'My first post' --from=user1
ERROR: unknown command "create-post" for "blog" 
```

ç¡®ä¿æ‚¨å·²ç»åœ¨`x/blog/client/cli/tx.go`çš„`func GetTxCmd`ä¸­æ·»åŠ äº†`GetCmdCreatePost(cdc)`ã€‚

## æ— æ³•å¯¹æœªæ³¨å†Œçš„å…·ä½“ç±»å‹è¿›è¡Œç¼–ç 

```
blogcli tx blog create-post Hello! --from=user1
panic: Cannot encode unregistered concrete type types.MsgCreatePost. 
```

ç¡®ä¿æ‚¨å·²ç»å°†`cdc.RegisterConcrete(MsgCreatePost{}, "blog/CreatePost", nil)`æ·»åŠ åˆ°äº†`x/blog/types/codec.go`ä¸­çš„`func RegisterCodec`ã€‚

# ç»“è®º

æ­å–œä½ ï¼Œä½ ç°åœ¨æœ‰äº†ä¸€ä¸ªå¯ä»¥åœ¨ Cosmos ä¸Šå­˜å‚¨æ•°æ®çš„åŠŸèƒ½æ€§åšå®¢åº”ç”¨ç¨‹åºï¼