# åœ¨ Celo ä¸­æ„å»ºä¼—ç­¹æ™ºèƒ½åˆçº¦

> åŸæ–‡:[https://github . com/fig ment-networks/learn-tutorials/blob/master/celo/celo-crowd-funding-project . MD](https://github.com/figment-networks/learn-tutorials/blob/master/celo/celo-crowd-funding-project.md)

æœ¬æ•™ç¨‹æœ‰ä¸‰ä¸ªéƒ¨åˆ†:

1.  åœ¨ Celo ä¸­æ„å»ºä¼—ç­¹æ™ºèƒ½åˆçº¦
2.  åœ¨ Celo ä¸­éƒ¨ç½²ä¼—ç­¹æ™ºèƒ½åˆçº¦
3.  ä¸ä¼—ç­¹æ™ºèƒ½åˆçº¦äº’åŠ¨

æˆ‘ä»¬å°†åœ¨ Solidity ä¸­ç”¨ 172 è¡Œä»£ç ç¼–å†™ä¸€ä¸ªæ™ºèƒ½åˆåŒï¼Œå®ƒå¯ä»¥ä¿ƒè¿› Celo ä¸Šçš„ä¼—ç­¹(å¦‚ GoFundMeã€Kickstarter å’Œ Indiegogo)ã€‚

æˆ‘ä»¬çš„åˆåŒå°†èƒ½å¤Ÿåˆ›å»ºç­¹èµ„è€…ï¼Œè®©äººä»¬å‘ä»–ä»¬ææ¬¾ï¼Œå¹¶å‘é¡¹ç›®åˆ›å»ºè€…æ”¯ä»˜ç­¹é›†çš„èµ„é‡‘ã€‚è¿™ä¸€åˆ‡éƒ½å°†åœ¨ cUSD(Celo stable coin)ä¸­å®Œæˆã€‚

é€šå¸¸çš„åšæ³•å¯èƒ½åŒ…æ‹¬ Plaid(é“¶è¡Œ)ã€Stripe(æ”¯ä»˜)ã€æ•°æ®åº“(ç”¨äºå­˜å‚¨æ•°æ®)å’Œ AWS(ç”¨äºæ‰˜ç®¡):

[![infrastructure](img/ac7b61037f0fb21b5d11273be7bac51a.png)](https://camo.githubusercontent.com/7f940f5b0fb1f352df703a54d1bde998fc7972cd0037117af2b1ad6742841bb6/68747470733a2f2f692e696d6775722e636f6d2f335071456a61462e706e67)

Solidity å’Œ Celo ä½¿æ„å»ºåç«¯å˜å¾—å®¹æ˜“ï¼æ›´ä¸ç”¨è¯´ï¼Œ<g-emoji class="g-emoji" alias="earth_americas" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f30e.png">ğŸŒ</g-emoji>ä»ç¬¬ä¸€å¤©å¼€å§‹ã€‚

è¿™ä¸ªç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„æ•™ç¨‹ç³»åˆ—å°†å¸¦æˆ‘ä»¬å®Œæˆæ™ºèƒ½å¥‘çº¦çš„ç¼–å†™ã€éƒ¨ç½²ä»¥åŠä½¿ç”¨ Javascript ä¸ä¹‹äº¤äº’ã€‚

## å…ˆå†³æ¡ä»¶

ç‚¹å‡»ä¸‹å›¾ï¼Œè§‚çœ‹ Youtube è§†é¢‘â€œåœ¨ Celo ä¸­å»ºç«‹ä¼—ç­¹æ™ºèƒ½åˆçº¦â€ã€‚

{ % embed URL = "[https://youtu.be/uOso0av9gj4](https://youtu.be/uOso0av9gj4)" caption = "åœ¨ Celo ä¸­æ„å»ºä¼—ç­¹æ™ºèƒ½åˆçº¦" %}

æœ¬æ•™ç¨‹é¢å‘ä¸­çº§ Web 3 å¼€å‘äººå‘˜ã€‚å®ƒå‡è®¾æ‚¨æœ‰ä¸€äº› Javascript å’Œ Solidity ç¼–ç¨‹ç»éªŒï¼Œå¹¶ä¸”ç†è§£åŸºæœ¬çš„ä»¥å¤ªåŠå’Œé¢å‘å¯¹è±¡ç¼–ç¨‹æ¦‚å¿µã€‚

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº†æ¾éœ²ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹ä»£ç è¡Œ:

`npm install -g truffle@5.3.12`

**æ³¨:**æœ¬æ•™ç¨‹ä½¿ç”¨èŠ‚ç‚¹ v14.16.1

## é¡¹ç›®è®¾ç½®

é¦–å…ˆï¼Œæ‰“å¼€ç»ˆç«¯å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®æ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º celo-ä¼—ç­¹:

```
mkdir celo-crowdfunding && cd celo-crowdfunding 
```

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç”¨èŠ‚ç‚¹åŒ…ç®¡ç†å™¨`npm`åˆå§‹åŒ–é¡¹ç›®ç›®å½•:

```
npm init -y 
```

åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›é¢å¤–çš„åŒ…ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€ä¸ªæ•™ç¨‹ä¸­ä¸æ™ºèƒ½åˆçº¦äº¤äº’:

*   ContractKit æ˜¯ç”± Celo å›¢é˜Ÿåˆ›å»ºçš„ä¸€ä¸ªåŒ…ï¼Œç”¨äºå¸®åŠ©å¼€å‘
*   [dotenv](https://www.npmjs.com/package/dotenv) ç”¨äºè¯»å–æˆ‘ä»¬ä»£ç ä¸­çš„ç¯å¢ƒå˜é‡
*   web3.js æ˜¯ä¸€ä¸ªæ–¹ä¾¿æˆ‘ä»¬ä¸åŒºå—é“¾äº’åŠ¨çš„åº“
*   OpenZeppelin contracts æ˜¯ä¸€ä¸ªç»è¿‡è‰¯å¥½æµ‹è¯•çš„ Solidity ä»£ç åº“ï¼Œæˆ‘ä»¬å°†é‡ç”¨å®ƒ

ä½¿ç”¨`npm`å®‰è£…ä¸Šè¿°æ‰€æœ‰ç»„ä»¶:

```
npm install -â€”save @celo/contractkit dotenv web3@1.3.6 @openzeppelin/contracts 
```

å®‰è£…å®Œæ‰€æœ‰çš„`npm`åŒ…åï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œ`truffle init`æ¥åˆå§‹åŒ– Truffleã€‚

ä¸‹é¢æ˜¯æˆåŠŸè¿è¡Œçš„`truffle init`çš„æ ·å­:

[![truffle init](img/85fb707fbfc302a0b188e7ad963a27ea.png)](https://camo.githubusercontent.com/96639b87ce3a287a678cff74b466d840f84b83a42403fae9b23287163e275cee/68747470733a2f2f692e696d6775722e636f6d2f4a46367a646f542e706e67)

## å†™åˆåŒ

é¦–å…ˆï¼Œåœ¨æ‚¨æœ€å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–°åˆ›å»ºçš„é¡¹ç›®ï¼Œå¹¶åœ¨æ‚¨çš„`contracts/`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º **CeloCrowdfund.sol** çš„æ–‡ä»¶ã€‚

åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œæ·»åŠ  Solidity ç‰ˆæœ¬ï¼Œå¹¶ä» OpenZeppelin å¯¼å…¥ SafeMath å¥‘çº¦å’Œ [ERC-20](https://ethereum.org/en/developers/docs/standards/tokens/erc-20/) æ¥å£:

```
pragma solidity >=0.4.22 <0.9.0;

// Importing OpenZeppelin's SafeMath Implementation
import "@openzeppelin/contracts/utils/math/SafeMath.sol";

// IERC-20 contract 
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
```

SafeMath æ˜¯ Solidity ä¸­`uint256`çš„åŒ…è£…å™¨ã€‚æˆ‘ä»¬ä½¿ç”¨ SafeMath æ˜¯å› ä¸º Solidity ä¸­çš„æ•´æ•°å®¹æ˜“å‡ºç°æº¢å‡ºé”™è¯¯ï¼Œè¿™ä¼šç»™æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å¸¦æ¥é‡å¤§é—®é¢˜ã€‚

æˆ‘ä»¬è¿˜å¯¼å…¥äº†`ERC-20`å¥‘çº¦æ¥å£ï¼Œå› ä¸ºå®ƒå®ç°äº†åŸºæœ¬çš„`ERC-20`åŠŸèƒ½ï¼Œè€Œ cUSD ä½¿ç”¨ ERC-20 æ ‡å‡†ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆå§‹åŒ–æˆ‘ä»¬çš„å¥‘çº¦:

```
contract CeloCrowdfund {
  // SafeMath for safe integer operations
  using SafeMath for uint256;

  // List of all the projects
  Project[] private projects;
}
```

è¿™æ˜¯ CeloCrowdfund åˆåŒçš„å¼€å§‹ã€‚å®ƒåŒ…æ‹¬ä¸€è¡Œä½¿ç”¨ SafeMath çš„ä»£ç å’Œä¸€ä¸ª`Project`ç±»å‹çš„æ•°ç»„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º`Project`çš„å¥‘çº¦ï¼Œå®ƒå°†å¤„ç†ç”¨æˆ·åˆ›å»ºçš„æ¯ä¸ªé¡¹ç›®ã€‚

åœ¨ä¸`CeloCrowdfund`å¥‘çº¦ç›¸åŒçš„æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª`Project`å¥‘çº¦å’Œä¸€ä¸ªåä¸º`ProjectState`çš„`enum`:

```
contract CeloCrowdfund {
  // SafeMath for safe integer operations
  using SafeMath for uint256;

  // List of all the projects
  Project[] private projects;
}

contract Project {
  using SafeMath for uint256;

  enum ProjectState {
    Fundraising,
    Expired,
    Successful
  }
  IERC20 private cUSDToken;
}
```

æˆ‘ä»¬ä½¿ç”¨åä¸º`ProjectState`çš„`enum`æ¥è·Ÿè¸ªé¡¹ç›®çš„å½“å‰çŠ¶æ€ã€‚é¡¹ç›®å¯ä»¥å¤„äºç­¹èµ„ã€åˆ°æœŸæˆ–æˆåŠŸçŠ¶æ€ã€‚æˆ‘ä»¬ä½¿ç”¨`enum`ï¼Œå› ä¸ºå®ƒä¸º`ProjectState`åˆ›å»ºäº†ä¸€ä¸ªå®šåˆ¶ç±»å‹ã€‚

æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªåä¸º`cUSDToken`çš„ç§æœ‰å˜é‡ï¼Œå®ƒçš„ç±»å‹æ˜¯`IERC20`ã€‚è¿™æ˜¯æˆ‘ä»¬å°†ç”¨æ¥ä¸ cUSD æ ‡è®°äº¤äº’çš„å˜é‡ã€‚

## æ‰©å¤§é¡¹ç›®åˆåŒ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€äº›æè¿°`Project`çš„å…¬å…±å˜é‡ã€‚Solidity ä¸­çš„å…¬å…±å˜é‡å¯ä»¥è¢«ä»»ä½•å…¶ä»–å¥‘çº¦æˆ– dApp è®¿é—®ã€‚æˆ‘ä»¬åœ¨åˆåŒä¸­å…¬å¼€è¿™äº›å˜é‡ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¸åˆåŒäº¤äº’æ—¶éœ€è¦å®ƒä»¬æ¥è·å¾—å…³äº`Project`çš„ç»†èŠ‚ã€‚æ›´å¤šå…³äºå®åº¦å˜é‡ç±»å‹çš„ä¿¡æ¯ï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹[æœ¬æŒ‡å—](https://www.bitdegree.org/learn/solidity-variables#control-variable-visibility)ã€‚

å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

```
contract Project {
  using SafeMath for uint256;

  enum ProjectState {
    Fundraising,
    Expired,
    Successful
  }

  IERC20 private cUSDToken;

  // Initialize public variables
  address payable public creator;
  uint public goalAmount;
  uint public completeAt;
  uint256 public currentBalance;
  uint public raisingDeadline;
  string public title;
  string public description;
  string public imageLink;

  // Initialize state at fundraising
  ProjectState public state = ProjectState.Fundraising;  

  mapping (address => uint) public contributions;
}
```

åˆå§‹åŒ–å˜é‡åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`state`å˜é‡ï¼Œåœ¨åˆå§‹åŒ–`Project`å¥‘çº¦æ—¶ä½œä¸ºç­¹æ¬¾çŠ¶æ€å¼€å§‹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»ç”¨æˆ·åœ°å€åˆ°ä»–ä»¬æèµ é‡‘é¢çš„[æ˜ å°„](https://docs.soliditylang.org/en/latest/types.html#mapping-types),ä½œä¸ºä¸€ä¸ª`uint`,æ¥è·Ÿè¸ªå¯¹`Project`çš„æèµ ã€‚åœ¨ Solidity ä¸­ï¼Œæ˜ å°„å°±åƒå“ˆå¸Œè¡¨æˆ–å­—å…¸ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€äº›[äº‹ä»¶](https://docs.soliditylang.org/en/latest/contracts.html#events)å’Œä¸€ä¸ª`mapping`åçš„`modifier`:

```
  // Event when funding is received
  event ReceivedFunding(address contributor, uint amount, uint currentTotal);

  // Event for when the project creator has received their funds
  event CreatorPaid(address recipient);

  modifier theState(ProjectState _state) {
    require(state == _state);
   _;
  }
```

æˆ‘ä»¬å°†åœ¨ç¨åçš„åˆåŒä¸­ä½¿ç”¨`ReceivedFunding`å’Œ`CreatorPaid`äº‹ä»¶åœ¨åŒºå—é“¾ä¸Šå­˜å‚¨äº‹åŠ¡æ—¥å¿—ã€‚è¿™æœ‰åŠ©äºè®°å½•æ—¶é—´æˆ³å’Œæˆ‘ä»¬çš„åˆåŒæ‰€åšçš„äº¤æ˜“ã€‚

æˆ‘ä»¬è¿˜åœ¨å¥‘çº¦ä¸­ä½¿ç”¨ä¸€ä¸ª[å‡½æ•°ä¿®é¥°ç¬¦](https://docs.soliditylang.org/en/latest/contracts.html#function-modifiers)æ¥æ£€æŸ¥é¡¹ç›®çš„çŠ¶æ€æ˜¯å¦æ€»æ˜¯ç±»å‹`state`ã€‚ä¿®æ”¹å™¨æ˜¯åœ¨ Solidity ä¸­æ‰§è¡ŒåŠŸèƒ½ä¹‹å‰æ£€æŸ¥æ¡ä»¶çš„ä¸€ç§å¯é‡å¤ä½¿ç”¨çš„æ–¹æ³•ã€‚ç¨åï¼Œæˆ‘ä»¬å°†åœ¨æ™ºèƒ½å¥‘çº¦çš„å‡ ä¸ªå‡½æ•°ä¸­ä½¿ç”¨ä¿®é¥°ç¬¦ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ä¿®é¥°ç¬¦åä¸º`Project`å¥‘çº¦æ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°:

```
constructor
(
  IERC20 token,
  address payable projectCreator,
  string memory projectTitle, 
  string memory projectDescription,
  string memory projectImageLink,
  uint fundRaisingDeadline,
  uint projectGoalAmount
) {
  cUSDToken = token;
  creator = projectCreator;
  title = projectTitle; 
  description = projectDescription; 
  imageLink = projectImageLink; 
  goalAmount = projectGoalAmount;
  raisingDeadline = fundRaisingDeadline;
  currentBalance = 0;
}
```

å¦‚æœä½ è¿‡å»åšè¿‡ä¸€äº›é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼Œä½ åº”è¯¥å¯¹æ„é€ å‡½æ•°å¾ˆç†Ÿæ‚‰ã€‚å®ƒä»¬æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`Project`å¯¹è±¡æ‰€éœ€çš„å‚æ•°ã€‚

**contribute()å‡½æ•°**

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åœ¨`Project`å¥‘çº¦ä¸­åˆ›å»ºä¸€ä¸ªå‘é¡¹ç›®ææ¬¾çš„å‡½æ•°:

```
// Fund a project
function contribute(uint256 amount) external theState(ProjectState.Fundraising) payable {
  cUSDToken.transferFrom(msg.sender, address(this), amount);

  contributions[msg.sender] = contributions[msg.sender].add(amount);
  currentBalance = currentBalance.add(amount);
  emit ReceivedFunding(msg.sender, amount, currentBalance);

  checkIfFundingExpired();
}
```

`contribute()`å‡½æ•°æ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ã€‚è¿™æ„å‘³ç€å®ƒåªèƒ½ä»å…¶ä»–æ™ºèƒ½åˆçº¦æˆ–äº¤æ˜“ä¸­è°ƒç”¨ã€‚

`contribute()`å‡½æ•°åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä½¿ç”¨ IERC20 `transferFrom()`å‡½æ•°å°†å‚æ•°ä¸­ä¼ é€’çš„é‡‘é¢ä»`msg.sender`(è°ƒç”¨è€…)å‘é€åˆ°`address(this)`(åˆåŒ):

`cUSDToken.transferFrom(msg.sender, address(this), amount);`

æ¥ä¸‹æ¥ï¼Œå®ƒå°†ç”¨æˆ·çš„åœ°å€æ·»åŠ åˆ°æ˜ å°„`contributions`ä¸­ï¼Œå°†ç”¨æˆ·çš„åœ°å€ä½œä¸ºé”®ï¼Œèµ„é‡‘é‡‘é¢ä½œä¸ºå€¼:

`contributions[msg.sender] = contributions[msg.sender].add(amount);`

ç„¶åï¼Œè¯¥å‡½æ•°æ›´æ–°é¡¹ç›®çš„å½“å‰ä½™é¢å¹¶å‘å‡ºä¸€ä¸ª`ReceivedFunding()`äº‹ä»¶:

```
currentBalance = currentBalance.add(amount);

emit ReceivedFunding(msg.sender, amount, currentBalance);
```

**å‡½æ•°**

åœ¨`contribute()`çš„åº•éƒ¨ï¼Œå‡½æ•°è°ƒç”¨è¿˜ä¸å­˜åœ¨çš„`checkIfFundingCompleteOrExpired();`ã€‚è®©æˆ‘ä»¬ç°åœ¨å°±å¼€å§‹åˆ›é€ å§ï¼

åœ¨`Project`å¥‘çº¦ä¸­ç¼–å†™ä»¥ä¸‹å‡½æ•°:

```
// check project state
function checkIfFundingExpired() public {
  if (block.timestamp > raisingDeadline) {
    state = ProjectState.Expired;
  }
}
```

è¯¥å‡½æ•°æ£€æŸ¥æˆªæ­¢æ—¶é—´æ˜¯å¦è¶…è¿‡äº†`block.timestamp`(æœ€è¿‘å—çš„å½“å‰æ—¶é—´)ã€‚å¦‚æœé¡¹ç›®å·²åˆ°æœŸï¼Œåˆ™çŠ¶æ€ä¼šæ›´æ–°ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åˆ¶ä½œ`payOut()`å‡½æ•°ã€‚

**æ”¯ä»˜()åŠŸèƒ½**

åœ¨`checkIfFundingCompleteOrExpired()`åŠŸèƒ½ä¸‹ï¼Œä¸º`payOut()`æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
function payOut() external returns (bool result) {
  require(msg.sender == creator);

  uint256 totalRaised = currentBalance;
  currentBalance =  0;

  if (cUSDToken.transfer(msg.sender, totalRaised)) {
    emit CreatorPaid(creator);
    state = ProjectState.Successful;
    return  true;
  } 
  else {
    currentBalance = totalRaised;
    state = ProjectState.Successful;
  }

  return  false;
}
```

`payOut()`å‡½æ•°åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é€šè¿‡ä½¿ç”¨`require()`æ£€æŸ¥è°ƒç”¨è¯¥å‡½æ•°çš„åœ°å€æ˜¯å¦ä¸é¡¹ç›®åˆ›å»ºè€…ç›¸åŒã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿åªæœ‰é¡¹ç›®åˆ›å»ºè€…å¯ä»¥æ’¤å›ä»–ä»¬çš„èµ„é‡‘ã€‚

æ¥ä¸‹æ¥ï¼Œ`payOut()`å‡½æ•°ä¼šå°†é¡¹ç›®ç­¹é›†çš„å…¨éƒ¨é‡‘é¢å‘é€å›é¡¹ç›®åˆ›å»ºè€…ã€‚å®ƒé€šè¿‡ä»`IERC20`æ¥å£è°ƒç”¨`tranfer()`å‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

`transfer()`è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœæœ‰æ•ˆï¼Œé‚£ä¹ˆå°±å‘å‡º`CreatorPaid()`äº‹ä»¶ï¼Œå¹¶æ›´æ–°çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬é‡ç½®`currentBalance`å˜é‡å¹¶æ›´æ–°çŠ¶æ€ã€‚

**get details()å‡½æ•°**

æœ€åï¼Œæˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„`Project`å¥‘çº¦ä¸­æ·»åŠ æœ€åä¸€ä¸ªå‡½æ•°ï¼Œå³`getDetails()`å‡½æ•°ã€‚

```
function  getDetails() public  view  returns
(
  address payable projectCreator,
  string memory projectTitle,
  string memory projectDescription,
  string memory projectImageLink,
  uint fundRaisingDeadline,
  ProjectState currentState, 
  uint256 projectGoalAmount, 
  uint256 currentAmount
) {
  projectCreator = creator;
  projectTitle = title;
  projectDescription = description;
  projectImageLink = imageLink;
  fundRaisingDeadline = raisingDeadline;
  currentState = state;
  projectGoalAmount = goalAmount;
  currentAmount = currentBalance;
}
```

è¿™ä¸ªå‡½æ•°é€šè¿‡è¿”å›æˆ‘ä»¬åœ¨`Project`å¥‘çº¦å¼€å§‹æ—¶è®¾ç½®çš„å…¬å…±å˜é‡æ¥è¿”å›å…³äºé¡¹ç›®çš„ä¿¡æ¯ã€‚

`Project`åˆåŒåˆ°æ­¤ä¸ºæ­¢ï¼

## å›åˆ°ä¼—ç­¹åˆåŒ

[![Celo crowdfund contract back to the future image](img/760ea4075f9bc4295edf77939fac3674.png)](https://camo.githubusercontent.com/75e90561f65531d7d94bd44c6fa0f38acba6768c772482675082a6676cccaf0c/68747470733a2f2f692e696d6775722e636f6d2f5546714a42307a2e706e67)

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®Œæˆäº†`Project`åˆåŒï¼Œæ˜¯æ—¶å€™å›åˆ°`CeloCrowdfund`åˆåŒäº†ã€‚å‘ä¸Šæ»šåŠ¨åˆ°ä½ çš„`CeloCrowdfund`åˆåŒæ‰€åœ¨çš„æ–‡ä»¶é¡¶éƒ¨ã€‚

æˆ‘ä»¬å°†ä»æ·»åŠ ä¸€ä¸ª`event`å¼€å§‹ï¼Œè¡¨ç¤ºé¡¹ç›®å¼€å§‹çš„æ—¶é—´:

```
contract CeloCrowdfund {
  // SafeMath for safe integer operations
  using SafeMath for uint256;

  // List of all the projects
  Project[] private projects;

  // event for when new project starts
  event ProjectStarted(
    address contractAddress,
    address projectCreator,
    string title,
    string description,
    string imageLink,
    uint256 fundRaisingDeadline,
    uint256 goalAmount
  );
}
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åœ¨åˆåŒçš„å‡ ä¸ªåœ°æ–¹ä½¿ç”¨äº†`events`ã€‚å½“ä¸€ä¸ªé¡¹ç›®è¢«åˆ›å»ºåˆ°åŒºå—é“¾æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ª`event`æ¥è®°å½•ã€‚å®ƒå°†è·å–åŒ…å«æˆ‘ä»¬ç”¨æ¥åˆ›å»ºæ–°çš„`Project`çš„æ‰€æœ‰`Project`æ•°æ®çš„å‚æ•°ã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç”¨`startProject()`å‡½æ•°å¯åŠ¨ä¸€ä¸ªé¡¹ç›®:

```
function startProject(
  IERC20 cUSDToken,
  string calldata title, 
  string calldata description,
  string calldata imageLink,
  uint durationInDays,
  uint amountToRaise
) external {
  uint raiseUntil = block.timestamp.add(durationInDays.mul(1 days));

  Project newProject = new Project(cUSDToken, payable(msg.sender), title, description, imageLink, raiseUntil, amountToRaise);
  projects.push(newProject);

  emit ProjectStarted(
    address(newProject),
    msg.sender,
    title,
    description,
    imageLink,
    raiseUntil,
    amountToRaise
  );
}
```

`startProject()`å‡½æ•°æ¥æ”¶åˆ›å»ºé¡¹ç›®çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚`title`ã€`description`ã€`imageLink`ã€`duration`ã€`amount`ç­‰ã€‚

ç„¶åï¼Œå®ƒé€šè¿‡å°†`durationInDays`ä¹˜ä»¥`1 days`æ¥è®¡ç®—`raiseUntil`å˜é‡çš„ä½¿ç”¨å¤©æ•°ã€‚è¿™å°†`durationInDays`å˜é‡ä»`uint`å˜ä¸º`block.timestamp`å¯ä»¥æ¥å—çš„ä¸œè¥¿ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çš„`startProject()`å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ª`Project`ç±»å‹çš„`newProject`(æ¥è‡ªæˆ‘ä»¬çš„`Project`å¥‘çº¦)ï¼Œå¸¦æœ‰`Project`å¥‘çº¦æ„é€ å‡½æ•°çš„å‚æ•°ã€‚

æœ€åï¼Œè¯¥å‡½æ•°å‘å‡ºä¸€ä¸ª`ProjectStarted()`æ—¥å¿—ã€‚

å…³äºæˆ‘ä»¬çš„`CeloCrowdfund`å¥‘çº¦çš„æœ€åä¸€ä»¶äº‹:æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥è¿”å›æ‰€åˆ›å»ºçš„`Projects`çš„åˆ—è¡¨:

```
function returnProjects() external view returns(Project[] memory) {
  return projects;
} 
```

è¿™å°±æ˜¯æˆ‘ä»¬çš„ä¸¤ä»½åˆåŒï¼

## ç»“è®º

å°±è¿™æ ·ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ™ºèƒ½åˆåŒï¼Œå…è®¸åœ¨ Celo ä¸­è¿›è¡Œä¼—ç­¹ã€‚

å¸Œæœ›åˆ›å»ºè¿™ä¸ªæ™ºèƒ½åˆåŒå·²ç»è®©ä½ æ„è¯†åˆ°ä»€ä¹ˆæ˜¯å¯èƒ½çš„ã€‚æ²¡æœ‰å¤ªå¤šçš„éº»çƒ¦å’ŒåŸºç¡€è®¾æ–½è®¾ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªåˆåŒæ¥æ¥å—ä»˜æ¬¾ï¼Œå¹¶å¸®åŠ©ç”¨æˆ·åè°ƒä¸ºä»–ä»¬æƒ³è¦æ”¯æŒçš„é¡¹ç›®ç­¹é›†èµ„é‡‘ã€‚ä»å„æ–¹é¢è€ƒè™‘ï¼Œå¯¹äºæ•´ä¸ªé¡¹ç›®åç«¯æ¥è¯´ï¼Œè¿™å¹¶ä¸å¤ªé•¿ä¹Ÿä¸å¤æ‚ã€‚

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå‘ Celo ç½‘ç»œéƒ¨ç½²æˆ‘ä»¬ç¼–å†™çš„åˆåŒï¼

**æ³¨**:æœ¬æ•™ç¨‹å’Œæ™ºèƒ½åˆçº¦æ˜¯åŸºäºæœ¬æ•™ç¨‹ä½œè€…å¼€å‘çš„ app co eracha çš„[åˆçº¦ã€‚å¦‚æœä½ æƒ³åœ¨ç§»åŠ¨åº”ç”¨ä¸­çœ‹åˆ°è¿™äº›åˆåŒï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œ](https://github.com/Alex-Neo-Projects/Coperacha-contracts)çœ‹åˆ°ä¸€ä¸ª[çš„ä¾‹å­ã€‚](https://github.com/Alex-Neo-Projects/Coperacha-app)

# åœ¨ Celo ä¸­éƒ¨ç½²ä¼—ç­¹æ™ºèƒ½åˆçº¦

å¦‚æœä½ å·²ç»å®Œæˆäº†æœ¬æ•™ç¨‹ç³»åˆ—çš„ç¬¬ 1 éƒ¨åˆ†ï¼Œä½ å°±æœ‰äº†ä¸€ä»½ç”¨ Solidity ç¼–å†™çš„ä¼—ç­¹åˆåŒã€‚ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªä¼—ç­¹åˆåŒï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒéƒ¨ç½²åˆ° Celo æµ‹è¯•ç½‘ç»œï¼Œä»¥ä¾¿ä¸ä¹‹è¿›è¡Œäº¤äº’ã€‚è®©æˆ‘ä»¬ç°åœ¨å°±åšå§ï¼

## å…ˆå†³æ¡ä»¶

æœ¬æ•™ç¨‹å‡è®¾æ‚¨å·²ç»éµå¾ªå¹¶å®Œæˆäº†ç¬¬ 1 éƒ¨åˆ†(åœ¨ Celo ä¸­æ„å»ºä¼—ç­¹æ™ºèƒ½å¥‘çº¦)ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œè¯·å…ˆè¿”å›å¹¶éµå¾ªè¯¥æ•™ç¨‹ã€‚

ç‚¹å‡»ä¸‹å›¾ï¼Œè§‚çœ‹ YouTube è§†é¢‘â€œåœ¨ Celo ä¸­éƒ¨ç½²ä¼—ç­¹æ™ºèƒ½åˆçº¦â€ã€‚

{ % embed URL = "[https://youtu.be/HShFGDvBgNk](https://youtu.be/HShFGDvBgNk)" }

## éƒ¨ç½²è®¾ç½®

é¦–å…ˆæ‰“å¼€ç»ˆç«¯ï¼Œ`cd`è¿›å…¥ Celo ä¼—ç­¹é¡¹ç›®æ–‡ä»¶å¤¹ã€‚

`cd celo-crowdfunding`

## è¿ç§»æ–‡ä»¶å¤¹

å¦‚æœæ–‡ä»¶å¤¹ä¸­å·²ç»æœ‰`1_initial_migration.js`æ–‡ä»¶ï¼Œåˆ é™¤å®ƒã€‚

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`1_celo_crowdfund.js`çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹å†…å®¹:

```
const CeloCrowdfund = artifacts.require("CeloCrowdfund");

module.exports = function (deployer) {
  deployer.deploy(CeloCrowdfund);
};
```

Truffle ä¸­çš„è¿ç§»æœ¬è´¨ä¸Šæ˜¯éƒ¨ç½²è„šæœ¬ã€‚æˆ‘ä»¬æ‰€å†™çš„æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„éƒ¨ç½²è„šæœ¬ï¼Œå®ƒæ¥å—æˆ‘ä»¬çš„å¥‘çº¦(`CeloCrowdfund`)å¹¶éƒ¨ç½²å®ƒã€‚

## è¿æ¥åˆ°æµ‹è¯•ç½‘ç»œèŠ‚ç‚¹

æˆ‘ä»¬å°†ä½¿ç”¨ DataHub è¿æ¥åˆ° Celo æµ‹è¯•ç½‘ç»œã€‚å¦‚æœæ‚¨æ²¡æœ‰å¸æˆ·ï¼Œè¯·åœ¨ [DataHub](https://datahub.figment.io) ç½‘ç«™ä¸Šæ³¨å†Œï¼Œä¸€æ—¦æ‚¨æœ‰äº† Celo API å¯†é’¥ï¼Œå°±å¯ä»¥ç»§ç»­å­¦ä¹ æœ¬æ•™ç¨‹ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç”¨äºæ•°æ®ä¸­å¿ƒèŠ‚ç‚¹çš„ API å¯†é’¥ï¼Œæˆ‘ä»¬æƒ³è¦ä¿æŠ¤å®ƒã€‚è·å¾—æ‚¨çš„ API å¯†é’¥çš„ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨æ‚¨çš„ DataHub å¸æˆ·çš„èŠ‚ç‚¹ã€‚ä¸ºäº†ä¿æŠ¤å®ƒï¼Œè®©æˆ‘ä»¬åœ¨`celoSmartContract`æ–‡ä»¶å¤¹çš„**æ ¹ç›®å½•**ä¸­åˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶ã€‚`.env`æ–‡ä»¶ç”¨äºç¯å¢ƒæœºå¯†ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯å­˜å‚¨ DataHub API å¯†åŒ™çš„æœ€ä½³ä½ç½®ã€‚

è¦åˆ›å»ºè¿™ä¸ª`.env`æ–‡ä»¶ï¼Œå¯¼èˆªåˆ°é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¹¶åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤:

`touch .env`

æ¥ä¸‹æ¥ï¼Œåœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€`.env`æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å˜é‡ï¼Œç¡®ä¿åœ¨`/`ä¹‹é—´è¾“å…¥ API é”®:

`REST_URL=https://celo-alfajores--rpc.datahub.figment.io/apikey/<YOUR API KEY>/`

**æ³¨æ„:**åœ¨ URL çš„æœ«å°¾éœ€è¦æœ‰ä¸€ä¸ªå°¾éšçš„`/`å®ƒæ‰èƒ½å·¥ä½œï¼

**æ³¨æ„:**å¦‚æœè®¡åˆ’å°†è¿™ä¸ªå›è´­åè®®æäº¤åˆ° Github ä¸­ï¼Œæ‚¨ä¸éœ€è¦ä¸Šä¼ `.env`æ–‡ä»¶çš„å†…å®¹ã€‚è¦è®© Git å¿½ç•¥`.env`æ–‡ä»¶ï¼Œä»ç»ˆç«¯åˆ›å»ºä¸€ä¸ª`.gitignore`æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

`touch .gitignore`

åœ¨`.gitignore`ä¸­ï¼Œå°†ä»¥ä¸‹å†…å®¹æ”¾å…¥æ–°çš„ä¸€è¡Œ:

```
.env 
```

å°±æ˜¯è¿™æ ·ï¼Git ç°åœ¨ä¼šå¿½ç•¥`.env`æ–‡ä»¶ã€‚

## è·å¾— Celo å¸æˆ·

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Celo å¸æˆ·è¿›è¡Œéƒ¨ç½²ã€‚éƒ¨ç½²æ—¶æˆ‘ä»¬éœ€è¦ä¸‰æ ·ä¸œè¥¿:

*   Celo å¸æˆ·åœ°å€
*   Celo å¸æˆ·ç§é’¥
*   è£…æœ‰æµ‹è¯•ç½‘èµ„é‡‘çš„ Celo è´¦æˆ·

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è·å¾—ä¸€ä¸ªå¸æˆ·å’Œä¸€ä¸ªç§é’¥ã€‚åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º **getAccount.js** çš„æ–‡ä»¶ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œç¼–å†™ä»¥ä¸‹å†…å®¹:

```
const ContractKit = require('@celo/contractkit');

const Web3 = require('web3');

require('dotenv').config();

const main = async() =>  {
  const web3 = new Web3(process.env.REST_URL);
  const client = ContractKit.newKitFromWeb3(web3);

  const account = web3.eth.accounts.create();

  console.log('address: ', account.address);
  console.log('privateKey: ', account.privateKey);
};

main().catch((err)  =>  {
  console.error(err);
});
```

æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚

é¦–å…ˆï¼Œè„šæœ¬å¯¼å…¥`ContractKit`ã€`Web3`å’Œ`dotenv`ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒä½¿ç”¨ä¸‹é¢çš„ä»£ç è¡Œé€šè¿‡`.env`æ–‡ä»¶ä¸­çš„ REST_URL è¿æ¥åˆ° Celo ç½‘ç»œ:

```
const web3 = new Web3(process.env.REST_URL);
```

ç„¶åï¼Œå®ƒåœ¨åŒä¸€ä¸ª testnet è¿æ¥ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä»£ç å¦‚ä¸‹:

```
const account = web3.eth.accounts.create();
```

ä¹‹åï¼Œæˆ‘ä»¬åªéœ€æ‰“å°å‡ºåœ°å€å’Œç§é’¥ä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚

**æ³¨:**ä»¥ä¸Šä»£ç æ¥è‡ª [#2ã€‚åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ª Celo è´¦æˆ·](https://learn.figment.io/network-documentation/celo/tutorial/intro-pathway-celo-basics/2.account)ï¼Œå› æ­¤å¦‚æœæ‚¨éœ€è¦è¯„è®ºï¼Œè¯·éšæ„å›æ”¾ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨ç»ˆç«¯ä¸­ç”¨å‘½ä»¤`node getAccount.js`è¿è¡Œè„šæœ¬ã€‚

è¾“å‡ºåº”è¯¥æ‰“å°å‡ºæ‚¨çš„æ–° Celo å¸æˆ·çš„åœ°å€å’Œç§é’¥ã€‚å®ƒçœ‹èµ·æ¥ä¼šåƒè¿™æ ·:

[![output](img/e758190431147ddd0f9709af9462659e.png)](https://camo.githubusercontent.com/85e62204e4c406103e375245afef4c7ee1fb83998bf2b08e168044c4863fd42b/68747470733a2f2f692e696d6775722e636f6d2f7571314c5854662e706e67)

**æ³¨æ„:**ç¡®ä¿æ‚¨çš„ç§é’¥å®‰å…¨éå¸¸é‡è¦ï¼ä¸ç®¡æ˜¯è°æ‹¿åˆ°äº†å®ƒï¼Œä»–éƒ½å¯ä»¥è®¿é—®ä½ åœ¨ Celo ä¸Šçš„æ‰€æœ‰èµ„é‡‘ã€‚

é€šè¿‡æ·»åŠ å¸¦æœ‰`PRIVATE_KEY=YOUR-PRIVATE-KEY`çš„ä¸€è¡Œå°†ç§é’¥å¤åˆ¶åˆ°`.env`æ–‡ä»¶ä¸­ï¼Œå…¶ä¸­ **YOUR-PRIVATE-KEY** æ˜¯æ‚¨ä»è„šæœ¬è¾“å‡ºä¸­è·å¾—çš„ç§é’¥ã€‚

ç°åœ¨æ‚¨å·²ç»æœ‰äº†ä¸€ä¸ª Celo å¸æˆ·ï¼Œè·å–åœ°å€å¹¶å°†å…¶ç²˜è´´åˆ° [Celo developer æ°´é¾™å¤´](https://celo.org/developers/faucet)ä¸­ã€‚è¿™å°†ä¸ºæ‚¨æä¾› testnet èµ„é‡‘ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›èµ„é‡‘æ¥éƒ¨ç½²æ™ºèƒ½åˆåŒã€‚å¡«å¥½è¡¨æ ¼ï¼Œç­‰å‡ ç§’é’Ÿï¼Œä½ çš„è´¦æˆ·å°±åº”è¯¥åŠ è½½å®Œæ¯•äº†ã€‚

[![funding](img/984ae5a1b05f820b8c824cf1376ca484.png)](https://camo.githubusercontent.com/0c74bcb5251da3397bae2c6901c25218a6ff73befb825a53c546181e95e0db06/68747470733a2f2f692e696d6775722e636f6d2f7a5074575748572e706e67)

## å—èŒé…ç½®

ä½¿ç”¨ **truffle-config.js** æ˜¯ä¸ºäº†å‘Šè¯‰ truffle æ‚¨å¸Œæœ›å¦‚ä½•éƒ¨ç½²åˆåŒã€‚

å‡ºäºæˆ‘ä»¬çš„ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° truffle-config é¡¹ç›®æ–‡ä»¶ä¸­:

```
const ContractKit = require('@celo/contractkit');
const Web3 = require('web3');

require('dotenv').config({path: '.env'});

// Create connection to DataHub Celo Network node
const web3 = new Web3(process.env.REST_URL);

const client = ContractKit.newKitFromWeb3(web3);

// Initialize account from our private key
const account = web3.eth.accounts.privateKeyToAccount(process.env.PRIVATE_KEY);

// We need to add private key to ContractKit in order to sign transactions
client.addAccount(account.privateKey);

module.exports = {
  compilers: {
    solc: {
      version: "0.8.0",    // Fetch exact version from solc-bin (default: truffle's version)
    }
  },
  networks: {
    test: {
      host: "127.0.0.1",
      port: 7545,
      network_id: "*"
    },
    alfajores: {
      provider: client.connection.web3.currentProvider, // CeloProvider
      network_id: 44787  // latest Alfajores network id
    }
  }
};
```

é¦–å…ˆï¼Œé…ç½®æ–‡ä»¶åƒ`getAccounts.js`æ–‡ä»¶ä¸€æ ·å¯¼å…¥`ContractKit`ã€`Web3`å’Œ`dotenv`ã€‚

å®ƒé€šè¿‡ä»`.env`è·å–`REST_URL`æ¥è¿æ¥åˆ°æˆ‘ä»¬çš„ Celo èŠ‚ç‚¹:

```
const web3 = new Web3(process.env.REST_URL);
```

ç„¶åï¼Œå®ƒä»`.env`æ–‡ä»¶ä¸­çš„ç§é’¥è·å–å¸æˆ·ï¼Œä»¥ä¾¿ä»æ‚¨çš„å¸æˆ·è¿›è¡Œéƒ¨ç½²:

```
const account = web3.eth.accounts.privateKeyToAccount(process.env.PRIVATE_KEY);
```

æˆ‘ä»¬è¿˜å°†ç§é’¥æ·»åŠ åˆ°`ContractKit`ä¸­ï¼Œä»¥ä¾¿ä¸ä»¥ä¸‹ç”¨æˆ·ç­¾ç½²äº¤æ˜“:

```
client.addAccount(account.privateKey);
```

æœ€åï¼Œåœ¨`module.exports`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åœ¨`compilers: {`ä¸‹è®¾ç½®æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ Solidity ç‰ˆæœ¬ï¼Œåœ¨`networks: {`ä¸‹è®¾ç½®æˆ‘ä»¬æƒ³è¦éƒ¨ç½²çš„ç½‘ç»œã€‚

ä¸‹é¢çš„ä»£ç å—å‘Šè¯‰ truffle éƒ¨ç½²åˆ° Alfajores (Celo çš„ testnet):

```
alfajores: {
    provider: client.connection.web3.currentProvider, // CeloProvider
    network_id: 44787  // latest Alfajores network id
}
```

## éƒ¨ç½²

æˆ‘ä»¬å¿«åˆ°äº†ï¼è¿è¡Œ`truffle compile`æ¥æ£€æŸ¥ä½ åšçš„ä¸€åˆ‡éƒ½æ˜¯æ­£ç¡®çš„ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡º:

![](img/b725a99b56d9f561e9a3ddf565b14698.png)

æ—¢ç„¶æˆ‘ä»¬å·²ç»ç¼–è¯‘äº†æ™ºèƒ½åˆçº¦ï¼Œæœ€åä¸€æ­¥å°±æ˜¯éƒ¨ç½²å®ƒã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥éƒ¨ç½²åˆ° Alfajores testnet:

```
truffle migrate --network alfajores 
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹éƒ¨ç½²è¾“å‡º:

![](img/5329980ac5da5c428858df04341d89fc.png)

å¦‚æœæ‚¨çœ‹åˆ°ç±»ä¼¼ä¸Šé¢çš„å†…å®¹ï¼Œä»£ç å°±å·¥ä½œäº†ï¼è¦æŸ¥çœ‹ Celo ç½‘ç»œä¸Šçš„æ™ºèƒ½åˆåŒï¼Œè¯·æ‰“å¼€ [Alfajores å—æµè§ˆå™¨](https://alfajores-blockscout.celo-testnet.org/) &ä»å—èŒè¾“å‡ºä¸­ç²˜è´´åˆåŒåœ°å€è¡Œä¸Šçš„åœ°å€:

`> contract address: YOUR-CELO-ADDRESS`

æ‚¨åº”è¯¥åœ¨å—èµ„æºç®¡ç†å™¨ä¸­çš„è¯¥åœ°å€çœ‹åˆ°ä¸€ä¸ªæˆåŠŸçš„åˆåŒéƒ¨ç½²:

![](img/d7fb4afb8a7dd4d10848bfadb68f54cd.png)

## åç»­æ­¥éª¤

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åœ¨ Celo ä¸Šéƒ¨ç½²äº† Celo ä¼—ç­¹æ™ºèƒ½åˆåŒï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä¸å®ƒè¿›è¡Œäº¤äº’ã€‚åœ¨ä¸‹ä¸€ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºæ–°çš„ä¼—ç­¹é¡¹ç›®å¹¶å‘å®ƒä»¬ææ¬¾æ¥ä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒè¿›è¡Œäº¤äº’ã€‚

## æ½œåœ¨é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è¯¢é—®[figument Learn Discord](https://discord.gg/f5YuEsQTAx)ã€‚ä¹Ÿå¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æºä»£ç [ã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™é‡Œæœ‰ä¸€äº›ä½ å¯èƒ½ä¼šé‡åˆ°çš„å¸¸è§é”™è¯¯ã€‚](https://github.com/alexreyes/Celo-Crowdfunding-Tutorial-2)

å¦‚æœå‡ºç°ä»¥ä¸‹é”™è¯¯:

`Error: Invalid JSON RPC response: {"message":"no Route matched with those values"}`

[![json rpc error](img/b349ebb275500d67a8482efa7f79c7b1.png)](https://camo.githubusercontent.com/b10c13fb11358a60891ccd1e3191e40ffe54d19ffef9b3f0b127e3e567eed1b6/68747470733a2f2f692e696d6775722e636f6d2f42384c657272552e706e67)

ç„¶åæ˜¯**ä¸­çš„ **REST_URL** æœ‰é—®é¢˜ã€‚env** æ–‡ä»¶ã€‚

ç¡®ä¿ URL æœ«å°¾æœ‰ä¸€ä¸ªç»“å°¾ **/** ï¼å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

`REST_URL = https://celo-alfajores--rpc.datahub.figment.io/apikey/YOUR-API-KEY/`

å¦‚æœåˆåŒæ²¡æœ‰éƒ¨ç½²åˆ°æµ‹è¯•ç½‘ç»œï¼Œè¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤º:

[![didn't deploy](img/c9baac31f82940118f2568a90c0363cf.png)](https://camo.githubusercontent.com/a59c20e99081c85f182da44f68a167aec86a58da7c690367b4dbe35f57673943/68747470733a2f2f692e696d6775722e636f6d2f703637645a444d2e706e67)

åˆåŒæ˜¯åœ¨å“ªé‡Œç¼–è¯‘çš„ï¼Œä½†å®ƒæ²¡æœ‰ç»™å‡ºéƒ¨ç½²çš„åœ°å€ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·ç¡®ä¿ä½ çš„è´¦æˆ·å·²ç»ä»æ°´é¾™å¤´ä¸­æ³¨å…¥äº† [testnet èµ„é‡‘ã€‚](https://celo.org/developers/faucet)

å¦‚æœæ‚¨æƒ³å†æ¬¡æ£€æŸ¥æ‚¨çš„è´¦æˆ·æ˜¯å¦æ”¶åˆ°äº†èµ„é‡‘ï¼Œè¯·è¿›å…¥ [Alfajores block explorer](https://alfajores-blockscout.celo-testnet.org/) å¹¶æœç´¢æ‚¨çš„è´¦æˆ·åœ°å€ã€‚

ç¡®ä¿ä½ çš„è´¦æˆ·ä¸æ˜¯åƒè¿™ä¸ªä¸€æ ·ç©ºçš„ï¼

[![empty account](img/05eb6ff72ad9f2ef527d14b69a52d2ba.png)](https://camo.githubusercontent.com/60a2da1b381d2d9f9c21ade38e54f3793ead7bf2162d4eb7ccb8297733494cbc/68747470733a2f2f692e696d6775722e636f6d2f795055594353442e706e67)

# ä¸ä¼—ç­¹æ™ºèƒ½åˆçº¦äº’åŠ¨

æ¬¢è¿æ¥åˆ°è¿™ä¸ªä¸‰éƒ¨åˆ†ç³»åˆ—çš„æœ€åä¸€ä¸ªæ•™ç¨‹ï¼Œåœ¨ Celo ä¸Šåˆ›å»ºä¼—ç­¹æ™ºèƒ½åˆåŒã€‚åœ¨æœ€åä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ Javascript ä»£ç ï¼Œä»¥ä¾¿ä¸æˆ‘ä»¬åœ¨å‰ä¸¤éƒ¨åˆ†ä¸­ç¼–å†™å’Œéƒ¨ç½²çš„æ™ºèƒ½å¥‘çº¦è¿›è¡Œäº¤äº’ã€‚

ç°åœ¨æˆ‘ä»¬åœ¨ Celo æµ‹è¯•ç½‘ç»œä¸Šæœ‰äº†æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ï¼Œæ˜¯æ—¶å€™ä½¿ç”¨å®ƒäº†ï¼

## å…ˆå†³æ¡ä»¶

æ‚¨å°†éœ€è¦æˆ‘ä»¬åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­ç¼–å†™çš„æ™ºèƒ½å¥‘çº¦ï¼Œä»¥åŠæ‚¨åœ¨ç¬¬ 2 éƒ¨åˆ†ä¸­è¿›è¡Œçš„éƒ¨ç½²ã€‚å› æ­¤ï¼Œè¦ä½¿æœ¬æ•™ç¨‹ä¸­çš„ä»£ç æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦å®Œæˆå‰é¢çš„ä¸¤ä¸ªæ•™ç¨‹ã€‚

ç‚¹å‡»ä¸‹å›¾ï¼Œè§‚çœ‹ YouTube è§†é¢‘â€œä¸ä¼—ç­¹æ™ºèƒ½åˆçº¦äº’åŠ¨â€ã€‚

{ % embed URL = "[https://youtu.be/C24prS3bk_I](https://youtu.be/C24prS3bk_I)" caption = "ä¸ä¼—ç­¹æ™ºèƒ½åˆçº¦äº’åŠ¨" %}

## è®¾ç½®

ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ª Javascript æ–‡ä»¶æ¥ç¼–å†™æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦äº¤äº’ã€‚åœ¨`celo-crowdfunding`æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`interact.js`çš„æ–‡ä»¶ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨åœ¨ç¬¬ä¸€èŠ‚æ•™ç¨‹ä¸­é€šè¿‡ NPM å®‰è£…çš„åŒ…ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªé¢å¤–çš„æ¨¡å— BigNumberï¼Œä»¥ä¾¿å¤„ç†å¡æ´›åŒºå—é“¾ä½¿ç”¨çš„å¤§æ•°ã€‚

åœ¨ç»ˆç«¯ä¸­ï¼Œè¿è¡Œ`npm install bignumber.js`ã€‚è¿™ä¸€æ­¥çš„è®¾ç½®å°±åˆ°æ­¤ä¸ºæ­¢ï¼

[![first step](img/bdf47048baaaada19207774b84d7bdb7.png)](https://camo.githubusercontent.com/3213a0c04a5f729999eba97fe70f94418bb36fc9c8dae52595428d29afd52480/68747470733a2f2f692e696d6775722e636f6d2f546e377a396f7a2e706e67)

## å¯¼å…¥æˆ‘ä»¬çš„æ¨¡å—

ä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’çš„ç¬¬ä¸€æ­¥æ˜¯å¯¼å…¥è„šæœ¬æ‰€éœ€çš„æ¨¡å—ã€‚

åœ¨`interact.js`æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œå†™ä¸‹ä»¥ä¸‹å†…å®¹:

```
const Web3 = require('web3');
const ContractKit = require('@celo/contractkit');
const web3 = new Web3('https://alfajores-forno.celo-testnet.org');
const kit = ContractKit.newKitFromWeb3(web3);
const CeloCrowdfund = require('./build/contracts/CeloCrowdfund.json');
const Project = require('./build/contracts/Project.json');
const BigNumber = require('bignumber.js');

require('dotenv').config({path:  '.env'});
```

æˆ‘ä»¬ç¨åå°†ä½¿ç”¨æ‰€æœ‰è¿™äº›æ¨¡å—ï¼Œä»¥ä¾¿ä¸æˆ‘ä»¬ä¹‹å‰åˆ¶å®šçš„ä¼—ç­¹åˆåŒè¿›è¡Œäº¤äº’ã€‚

## æ‹¿åˆ°æˆ‘ä»¬çš„åˆåŒ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ™ºèƒ½åˆçº¦ä½œä¸ºä¸€ä¸ªå˜é‡æ¥ä½¿ç”¨ã€‚æˆ‘ä»¬è¿˜éœ€è¦è·å¾—æˆ‘ä»¬çš„ Celo å¸æˆ·ï¼Œå› ä¸ºæˆ‘ä»¬å°†å‘ç½‘ç»œå‘é€äº¤æ˜“ã€‚

å¯¼å…¥åï¼Œç¼–å†™ä»¥ä¸‹å†…å®¹:

```
// Get Celo account info

let account = web3.eth.accounts.privateKeyToAccount(process.env.PRIVATE_KEY);
kit.connection.addAccount(account.privateKey)
```

ä¸Šé¢çš„ä»£ç ä»`.env`æ–‡ä»¶ä¸­å¯¼å…¥æˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªæ•™ç¨‹ä¸­è®¾ç½®çš„ç§é’¥ï¼Œå¹¶å°†å…¶æ”¾å…¥ account å˜é‡ä¸­ã€‚å®ƒè¿˜å°† Celo å¸æˆ·æ·»åŠ åˆ° contractKitã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­ç¼–å†™ä¸æ™ºèƒ½åˆçº¦çš„äº¤äº’:

```
async function interact()  {
  // Check the Celo network ID
  const networkId = await web3.eth.net.getId();

  // Get the contract associated with the current network
  const deployedNetwork = CeloCrowdfund.networks[networkId];

  // Create a new contract instance from the celo crowdfund contract
  let celoCrowdfundContract = new kit.web3.eth.Contract(CeloCrowdfund.abi, deployedNetwork && deployedNetwork.address);

  console.log("Account address: ", account.address);
  console.log(celoCrowdfundContract);
}

interact();
```

è®©æˆ‘ä»¬è¿è¡Œè¿™ä¸ªã€‚åœ¨ç»ˆç«¯ä¸­ï¼Œé”®å…¥:`node interact.js`ã€‚ç»“æœåº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

[![code](img/266f1ab2772964d68d996a2e303ec7c5.png)](https://camo.githubusercontent.com/816271634c24ea7082e5ac86c65d0ec40218d6c5ba07a21046dfea1fab36c0ac/68747470733a2f2f692e696d6775722e636f6d2f6d7470304463332e706e67)

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè¾“å‡ºåº”è¯¥æ˜¾ç¤ºå¸æˆ·åœ°å€å’Œæˆ‘ä»¬åˆ›å»ºçš„åˆåŒã€‚åˆåŒè¾“å‡ºçœ‹èµ·æ¥ä¸åŒäºå¸¸è§„çš„å¯é æ€§ä»£ç ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª[åˆåŒ ABI](https://docs.soliditylang.org/en/v0.5.3/abi-spec.html) ã€‚

å¤ªå¥½äº†ï¼å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»éªŒè¯äº†åˆåŒè¢«æ­£ç¡®å¯¼å…¥ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å¸æˆ·æ­£å¸¸å·¥ä½œã€‚

æ¥ä¸‹æ¥ï¼Œæ³¨é‡Šæ‰`celoCrowdfundContract`å˜é‡çš„`console.log`ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†ä½¿ç”¨å®ƒã€‚

ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„`Project`ã€‚åœ¨`interact()`ä¹‹å¤–åˆ›å»ºä¸€ä¸ªåä¸º`createProject()`çš„æ–°å‡½æ•°:

```
async function createProject(celoCrowdfundContract, stableToken, gasPrice)  {
  var projectGoal = BigNumber(1E18);
  await celoCrowdfundContract.methods.startProject(stableToken.address, 'Test project', 'We are testing the create project function', 'https://i.imgur.com/Flfo4hJ.png',  5, projectGoal).send({from: account.address, feeCurrency: stableToken.address, gasPrice: gasPrice});
  console.log("Created new project");
}
```

è¯¥å‡½æ•°å°†`celoCrowdfunding`ã€`stableToken`å’Œ`gasPrice`ä½œä¸ºå‚æ•°ã€‚ç„¶åå®ƒä½¿ç”¨`BigNumber`åˆ›å»ºä¸€ä¸ª`projectGoal`ã€‚

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 1ï¼Œ000ï¼Œ000ï¼Œ000ï¼Œ000ï¼Œ000 æˆ– 1^18 çš„æ•°å­—ï¼Œå› ä¸º cUSD æœ‰ 18 ä½å°æ•°ã€‚Solidity ä¸æ”¯æŒæµ®ç‚¹æ•°ï¼Œæ‰€ä»¥è§£å†³æ–¹æ³•æ˜¯ç”Ÿæˆéå¸¸å¤§çš„æ•°ã€‚1^18 cUSD ç­‰äº 1 ç¾å…ƒ cUSDã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨ä¼—ç­¹åˆåŒä¸­çš„`startProject()`æ–¹æ³•ï¼Œå¹¶ä¼ å…¥å®ƒéœ€è¦çš„å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬å›åˆ°`CeloCrowdfund.sol`å¥‘çº¦ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°`createProject()`æ–¹æ³•æ¥å—å¦‚ä¸‹å†…å®¹:

```
function startProject(
  IERC20 cUSDToken,
  string calldata title,
  string calldata description,
  string calldata imageLink,
  uint durationInDays,
  uint amountToRaise
)
```

è¿™äº›æ˜¯æˆ‘ä»¬è°ƒç”¨å‡½æ•°æ—¶æä¾›çš„å‚æ•°ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª stableToken å˜é‡ï¼Œå®ƒä½¿ç”¨`ContractKit` stabletoken åŒ…è£…å™¨æ¥è·å–å¯¹ cUSD ç¡¬å¸çš„å¼•ç”¨ã€‚

æˆ‘ä»¬è¿˜ä¼šå°†æ±½æ²¹ä»·æ ¼ä¼ é€’åˆ°æˆ‘ä»¬çš„å‡½æ•°ä¸­ã€‚ä¸ºäº†æ›´å¿«åœ°ç¡®è®¤æˆ‘ä»¬çš„äº¤æ˜“ï¼Œæˆ‘ä»¬å°†æŠŠæ±½æ²¹ä»·æ ¼è®¾ç½®å¾—é«˜äºæ¨èçš„æœ€ä½ä»·æ ¼ã€‚æƒ³è¦äº†è§£ Celo çš„æ±½æ²¹è´¹ï¼Œè¯·éšæ„æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚

å¾—åˆ°è¿™ä¸¤ä¸ªå˜é‡åï¼Œæˆ‘ä»¬å°†è°ƒç”¨`interact()`ä¸­çš„`createProject()`è¾…åŠ©å‡½æ•°ã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨æˆ‘ä»¬çš„`CeloCrowdfund`åˆåŒä¸­çš„`returnProjects()`å‡½æ•°è¿”å›æˆ‘ä»¬åˆåŒä¸­çš„æ‰€æœ‰é¡¹ç›®ï¼Œä»¥éªŒè¯å®ƒæ˜¯å¦å·¥ä½œ:

```
  // Print wallet address so we can check it on the block explorer
  console.log("Account address: ", account.address);

  // Get the cUSD ContractKit wrapper
  var stableToken = await kit.contracts.getStableToken();

  // Get the gas price minimum and set the new gas price to be double
  const gasPriceMinimumContract = await kit.contracts.getGasPriceMinimum()
  const gasPriceMinimum = await gasPriceMinimumContract.getGasPriceMinimum(stableToken.address)
  const gasPrice = Math.ceil(gasPriceMinimum * 2) // This should be much higher than the current average, so the transaction will confirm faster

  await createProject(celoCrowdfundContract, stableToken, gasPrice);

  // Return projects inside the celo crowdfund contract
  var result = await celoCrowdfundContract.methods.returnProjects().call();

  console.log("List of addressses for each of the projects created:", result);
```

è¿è¡Œä»£ç åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°åˆ›å»ºçš„æ–°é¡¹ç›®ã€‚

## å‘é¡¹ç›®æ±‡æ¬¾

ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒå¯„ä¸€äº›é’±ã€‚

å°±åƒæˆ‘ä»¬å¦‚ä½•åˆ›å»ºä¸€ä¸ªåä¸º`celoCrowdfundContract`çš„å˜é‡æ¥è®¿é—®æˆ‘ä»¬çš„`CeloCrowdfund`å¥‘çº¦ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå˜é‡æ¥è®¿é—®`Project`å¥‘çº¦ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç :

```
var projectInstanceContract = new web3.eth.Contract(
  Project.abi,
  deployedNetwork && result[result.length - 1] // Get the most recently deployed Project
);
```

è¿™å°†åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œä»ç”±`returnProjects()`å‡½æ•°è¿”å›çš„æ•°ç»„ä¸­è®¿é—®æœ€è¿‘åˆ›å»ºçš„é¡¹ç›®åˆåŒå®ä¾‹ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®æˆ‘ä»¬çš„é¡¹ç›®äº†ï¼Œä¸ºäº†å°† cUSD å‘é€åˆ°åˆåŒï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹ã€‚ç”±äº cUSD éµå¾ª [ERC-20](https://ethereum.org/en/developers/docs/standards/tokens/erc-20/) æ ‡å‡†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ±‡æ¬¾å‰æ‰¹å‡†å°† cUSD å‘é€ç»™åˆåŒã€‚æ‰¹å‡†åï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ cUSD åˆ°æˆ‘ä»¬çš„åˆåŒã€‚

ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†åœ¨åˆåŒä¸­æ‰¹å‡†ä¸€å¤§ç¬”è´§æ¬¾ã€‚è¦æ‰¹å‡†å‘é€ 500 cUSDï¼Œè¯·å¡«å†™ä»¥ä¸‹å†…å®¹:

```
  // Approve the project to spend up to 500 cUSD from wallet
  var approveAmount = BigNumber(500E18);
  await stableToken.approve(projectInstanceContract._address, approveAmount).sendAndWaitForReceipt({from: account.address});
```

å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬å·²ç»æ‰¹å‡†äº†æ¥å— 500 ç¾å…ƒçš„åˆåŒã€‚ä¸‹ä¸€æ­¥æ˜¯å®é™…å‘é€ä¸€äº›é’±ã€‚

åœ¨`interact()`å‡½æ•°ä¹‹å¤–ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`contribute()`çš„æ–°å‡½æ•°:

```
async function contribute(stableToken, projectInstanceContract, gasPrice)  {
  var sendAmount = BigNumber(2E18);

  // Call contribute() function with 2 cUSD
  await projectInstanceContract.methods.contribute(sendAmount).send({from: account.address, feeCurrency: stableToken.address, gasPrice: gasPrice});

  console.log("Contributed to the project\n");
}
```

åœ¨`contribute()`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`sendAmount`çš„å˜é‡ï¼Œå®ƒè¢«è®¾ç½®ä¸º 2E18ã€‚è¿™ç›¸å½“äº 2 cUSDã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„`projectInstanceContract`å˜é‡æ¥è°ƒç”¨æˆ‘ä»¬çš„`Project()`å¥‘çº¦ä¸­çš„`contribute()`å‡½æ•°ã€‚

å›åˆ°æˆ‘ä»¬çš„`interact()`å‡½æ•°ï¼Œè®©æˆ‘ä»¬è°ƒç”¨æˆ‘ä»¬åˆ›å»ºçš„`contribute()`åŠ©æ‰‹å‡½æ•°:

```
  await contribute(stableToken, projectInstanceContract, gasPrice);
```

## æ˜¾ç¤ºæˆ‘ä»¬çš„ä½™é¢

ç°åœ¨æˆ‘ä»¬å…³å¿ƒä¸¤ä¸ª cUSD ä½™é¢:æˆ‘ä»¬çš„ Celo é’±åŒ…çš„ä½™é¢ï¼Œä»¥åŠæˆ‘ä»¬çš„é¡¹ç›®çš„ä½™é¢,`contribute()`å‡½æ•°å°† 2 ä¸ª cUSD å‘é€åˆ°è¿™ä¸ªé¡¹ç›®ã€‚

åœ¨`interact()`å‡½æ•°ä¹‹å¤–ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`createBalances()`çš„åŠ©æ‰‹å‡½æ•°æ¥æ‰“å°æ‰€æœ‰å†…å®¹:

```
async function printBalances(stableToken, projectInstanceContract)  {

  var balanceOfUser = (await stableToken.balanceOf(account.address)).toString();

  console.log("User's address: ", account.address);
  console.log("User's cUSD balance: ", balanceOfUser/1E18, " cUSD\n");

  var balanceOfContract = (await stableToken.balanceOf(projectInstanceContract._address)).toString();

  console.log("Contract address: ", projectInstanceContract._address);
  console.log("Contract cUSD balance: ", balanceOfContract/1E18,  " cUSD\n");
}
```

`printBalances()`å‡½æ•°ä½¿ç”¨`stableToken`å˜é‡çš„`balanceOf()`å‡½æ•°æ¥è·å–æˆ‘ä»¬çš„ Celo é’±åŒ…çš„ cUSD ä½™é¢ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨åŒæ ·çš„`balanceOf()`å‡½æ•°æ¥è·å¾—åˆåŒçš„ä½™é¢ï¼Œç„¶åæˆ‘ä»¬æŠŠå®ƒå…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨`interact()`å‡½æ•°ä¸­ï¼Œåœ¨`contribute()`ä¹‹åè°ƒç”¨`printBalances()`å‡½æ•°:

```
await printBalances(stableToken, projectInstanceContract);
```

## ä»æˆ‘ä»¬çš„é¡¹ç›®åˆåŒä¸­æ”¯ä»˜

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸ºå…¶æä¾›èµ„é‡‘ã€‚æœ€åä¸€æ­¥æ˜¯æ”¯ä»˜æˆ‘ä»¬çš„åˆåŒï¼

åœ¨`interact()`å‡½æ•°ä¹‹å¤–ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º`payOut()`çš„åŠ©æ‰‹å‡½æ•°:

```
async function payOut(stableToken, projectInstanceContract, gasPrice)  {
  var payOut = await projectInstanceContract.methods.payOut().send({from: account.address, feeCurrency: stableToken.address, gasPrice: gasPrice});
  console.log("Paying out from project");
}
```

`payOut()`å‡½æ•°è°ƒç”¨æˆ‘ä»¬çš„`Project`æ™ºèƒ½å¥‘çº¦ä¸­çš„`payOut()`å‡½æ•°ã€‚è¿™å°†æŠŠæ‰€æœ‰èµ„é‡‘é€€å›ç»™é¡¹ç›®åˆ›å»ºè€…ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬åœ¨`interact()`å‡½æ•°ä¸­è°ƒç”¨`payOut()`åŠ©æ‰‹å‡½æ•°:

```
  await contribute(stableToken, projectInstanceContract, gasPrice);
  await printBalances(stableToken, projectInstanceContract);

  await payOut(stableToken, projectInstanceContract, gasPrice);

  console.log("After pay out: ");
  await printBalances(stableToken, projectInstanceContract);
```

æˆ‘ä»¬å¸Œæœ›åœ¨æ‰“å°å‰ç­‰å¾… 5 ç§’é’Ÿï¼Œä»¥ç¡®ä¿`payOut()`äº¤æ˜“å·²ç»åœ¨åŒºå—é“¾ä¸Šç¡®è®¤ã€‚

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œä»£ç ï¼åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œé”®å…¥:`node interact.js`

è¾“å‡ºåº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

[![output](img/9c14d460e278ea5d4e41fae225a8e4f6.png)](https://camo.githubusercontent.com/fce61eef5911a837e1f921d3d318485719430aefe250acc73aa84d6fa0f90762/68747470733a2f2f692e696d6775722e636f6d2f5032757965764e2e706e67)

å‰å®³ï¼æ­£å¦‚æˆ‘ä»¬ä»ç»ˆç«¯è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬çš„è„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå‘å®ƒè´¡çŒ®äº† 2 cUSDï¼Œç­‰å¾… 5 ç§’ï¼Œç„¶åä»é¡¹ç›®ä¸­æ”¯ä»˜ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° 2 cUSD ä» Celo é’±åŒ…->åˆåŒ->å›åˆ°é’±åŒ…çš„æµç¨‹ã€‚

æœ‰ç”¨ï¼

## ç»“è®º

è¿™ä¸ªç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„ç³»åˆ—å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•ä¸º Celo ç¼–å†™ä¸€ä¸ªæ™ºèƒ½å¥‘çº¦ï¼Œéƒ¨ç½²å®ƒï¼Œç„¶åä¸æˆ‘ä»¬åˆ›å»ºçš„æ™ºèƒ½å¥‘çº¦è¿›è¡Œäº¤äº’ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰ä¸ªæ•™ç¨‹ä½œä¸ºèµ·ç‚¹ï¼Œä¸ä½¿ç”¨ Javascript åˆ›å»ºçš„ä»»ä½•æ™ºèƒ½å¥‘çº¦è¿›è¡Œäº¤äº’ã€‚æ— è®ºæ‚¨æ˜¯åˆ›å»º web dApp è¿˜æ˜¯ç§»åŠ¨ dAppï¼Œæ‚¨éƒ½å¯ä»¥ä½¿ç”¨æ­¤ä»£ç æ¥ä¸æ‚¨çš„åˆåŒè¿›è¡Œäº¤äº’ã€‚

å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶è¯¢é—®[figument Learn Discord](https://discord.gg/f5YuEsQTAx)ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æºä»£ç 

# å…³äºä½œè€…

ä¹¦é¢æ•™ç¨‹æ˜¯ç”±äºšå†å…‹æ–¯Â·é›·è€¶æ–¯åˆ›ä½œçš„ã€‚Alex æ˜¯ä¸€åå­¦ç”Ÿ(è®¡ç®—æœºç§‘å­¦å­¦å£«),åŒæ—¶ä¹Ÿæ˜¯ä¸€ååŠ å¯†çˆ±å¥½è€…ï¼Œä»–æ¯å¤©éƒ½åœ¨å­¦ä¹ æœ‰å…³ web3 ä¸–ç•Œçš„çŸ¥è¯†ï¼Œå¹¶ç§¯æä¸º Web3 ç¤¾åŒºåšå‡ºè´¡çŒ®ã€‚ä»–ä¹‹å‰åœ¨è„¸ä¹¦å’Œå¾®è½¯å®Œæˆäº†å®ä¹ ã€‚

è¿™äº›è§†é¢‘ç”± [Neo Cho](https://www.linkedin.com/in/neocho/) åˆ¶ä½œã€‚Neo æ˜¯ä¸­ä½›ç½—é‡Œè¾¾å¤§å­¦çš„å­¦ç”Ÿ(è®¡ç®—æœºç§‘å­¦å­¦å£«)ã€‚ä»–å–œæ¬¢å­¦ä¹ åŠ å¯†ï¼Œå¹¶å¯¹ web3 çš„æœªæ¥æ„Ÿåˆ°å…´å¥‹ã€‚