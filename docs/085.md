# ä»‹ç»

> åŸæ–‡:[https://github . com/fig ment-networks/learn-tutorials/blob/master/near/Build _ a _ crowd funding _ dApp _ on _ near . MD](https://github.com/figment-networks/learn-tutorials/blob/master/near/Build_a_Crowdfunding_dApp_on_NEAR.md)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨åŒºå—é“¾é™„è¿‘å»ºç«‹ä¸€ä¸ªä¼—ç­¹ dAppã€‚æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒå°†ä½¿ç”¨ Rust ç¼–å†™ï¼Œæˆ‘ä»¬çš„å‰ç«¯å°†ä½¿ç”¨ React ç¼–å†™ã€‚

dApp å°†å…·æœ‰ä»¥ä¸‹åŠŸèƒ½:

*   ç™»å½•çš„ç”¨æˆ·å¯ä»¥å‘å¸ƒ/åˆ›å»ºè‡ªå·±çš„ä¼—ç­¹é¡¹ç›®
*   æŸ¥çœ‹ä¼—ç­¹é¡¹ç›®åˆ—è¡¨
*   ç”¨æˆ·å¯ä»¥å‘ä¼—ç­¹é¡¹ç›®ææ¬¾
*   ä¸ºä¸€ä¸ªä¼—ç­¹é¡¹ç›®æŠ•ç¥¨

åœ¨æˆ‘ä»¬å®ç°äº†æ™ºèƒ½åˆçº¦ä¸­çš„æ‰€æœ‰ç‰¹æ€§ä¹‹åï¼Œæˆ‘ä»¬å°†æ™ºèƒ½åˆçº¦è¿æ¥åˆ°æˆ‘ä»¬çš„ react å‰ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤º

[![project image](../Images/37b77a934a292ba7aa93ed92f455afea.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/projectimg.png?raw=true)

# å…ˆå†³æ¡ä»¶<g-emoji class="g-emoji" alias="clipboard" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cb.png">ğŸ“‹</g-emoji>

ä¸ºäº†è·Ÿéšå¹¶å®Œæˆæœ¬æ•™ç¨‹ï¼Œä½ å°†éœ€è¦[ååº”](https://reactjs.org/)å’Œ[ç”Ÿé”ˆ](https://www.youtube.com/watch?v=KDn_j48yoAo&t=581s)çš„åŸºæœ¬çŸ¥è¯†ã€‚

# è¦æ±‚

*   å®‰è£…[é˜²é”ˆå·¥å…·é“¾](https://www.rust-lang.org/tools/install)ã€‚
*   [npx äºŒå…ƒ](https://www.npmjs.com/package/npx)ã€‚
*   å®‰è£…äº† [Git](https://git-scm.com/downloads) å’Œ Node.js(v14+)
*   [è¿‘ cli](https://docs.near.org/docs/tools/near-cli#installation)
*   [ä¸€ä¸ªè¿‘å¸](https://docs.near.org/docs/develop/basics/create-account#creating-a-testnet-account)

> æ­£å¦‚æˆ‘åœ¨å‰é¢çš„ä»‹ç»ä¸­æåˆ°çš„ï¼Œè¿™ä¸ª dApp çš„æ™ºèƒ½å¥‘çº¦æ˜¯ç”¨ Rust ç¼–å†™çš„ã€‚å¦‚æœä¸ç†Ÿæ‚‰ Rustï¼Œå¯ä»¥ä¸Šè¿™ä¸ª [30 åˆ†é’Ÿé€Ÿæˆç­](https://www.youtube.com/watch?v=KDn_j48yoAo&t=581s)ã€‚

> ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†åŒ…æ‹¬ near-cli åœ¨å†…çš„æ‰€æœ‰è¦æ±‚ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸€ä¸ª near å¸æˆ·

# æ¦‚è§‚

æˆ‘ä»¬å·²ç»äº†è§£äº†åœ¨æœ¬æ•™ç¨‹ä¸­éœ€è¦å®‰è£…çš„ä¸œè¥¿ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹éšç€æ•™ç¨‹çš„è¿›å±•æˆ‘ä»¬å°†è¦åšçš„äº‹æƒ…ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ [npx](https://www.npmjs.com/package/npx) äºŒè¿›åˆ¶æ¥æ­å»ºæˆ‘ä»¬çš„é¡¹ç›®ï¼Œå…¶ä¸­ [create-near-app](https://github.com/near/create-near-app) ä¸ºæˆ‘ä»¬æä¾›äº†å‰ç«¯å’Œåç«¯ä½¿ç”¨çš„é€‰é¡¹ã€‚æ­å»ºé¡¹ç›®åï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹æ–‡ä»¶ç»“æ„ï¼Œç¼–å†™æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒï¼Œéƒ¨ç½²å¹¶æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¹¶è¿æ¥åˆ°æˆ‘ä»¬çš„ React å‰ç«¯ã€‚

# è®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®

æˆ‘ä»¬é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”¨ [create-near-app](https://github.com/near/create-near-app) è®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®:

```
 npx create-near-app --frontend=react --contract=rust crowdfundDapp
 cd crowdfundDapp
```

ä½¿ç”¨`--frontend=react`å’Œ`--contract=rust`é€‰é¡¹ï¼Œæˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„é¡¹ç›®æ¥æ‹¥æœ‰ä¸€ä¸ªååº”å‰ç«¯å’Œä¸€ä¸ª rust å¥‘çº¦ã€‚åœ¨ç­‰å¾…å®‰è£…æ‰€æœ‰ä¸œè¥¿çš„å‘½ä»¤ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ç»ˆç«¯ä¸­çœ‹åˆ°:

[![create crowdfund](../Images/7e509e41d2d76911b6163cb7128ecad1.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/createcrowdfund.png?raw=true)

ç°åœ¨ä¸€åˆ‡éƒ½å·²æˆåŠŸå®‰è£…ï¼Œä¸‡äº‹ä¿±å¤‡ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„æ–‡ä»¶ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­ã€‚

## æ–‡ä»¶ç»“æ„

[![file structure](../Images/20ab20b94b3fd7e2a13f8293a54d1856.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/filestructure.png?raw=true)

åœ¨æˆ‘ä»¬çš„æ–‡ä»¶ç»“æ„ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª`contract`æ–‡ä»¶å¤¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä¸“é—¨åœ¨`src`ç›®å½•ä¸­ç¼–å†™æˆ‘ä»¬çš„åˆåŒã€‚ç„¶åæ˜¯æˆ‘ä»¬çš„`near-dev`æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«åœ¨å¼€å‘æ¨¡å¼ä¸‹éƒ¨ç½²æˆ‘ä»¬çš„åˆåŒçš„é…ç½®ï¼Œè¿˜æœ‰æˆ‘ä»¬çš„`src`æ–‡ä»¶å¤¹ï¼Œç”¨äºæˆ‘ä»¬çš„å‰ç«¯ã€‚ä»”ç»†æŸ¥çœ‹æˆ‘ä»¬çš„åˆåŒæ–‡ä»¶å¤¹:

[![project image](../Images/1efa923b8a783d2093a280c2bf154f47.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/contract.png?raw=true)

åœ¨åˆåŒæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª`src`æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª`model.rs`ã€`lib.rs`å’Œ`utils.rs`æ–‡ä»¶ã€‚æˆ‘ä»¬å·²ç»æœ‰äº†`lib.rs`æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å†åˆ›å»ºä¸€ä¸ªã€‚`cargo.toml`æ–‡ä»¶åŒ…å«å…³äºæˆ‘ä»¬åˆåŒçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚

# æ„å»ºæˆ‘ä»¬çš„åˆåŒ

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•è®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®ä»¥åŠæˆ‘ä»¬çš„é¡¹ç›®æ˜¯å¦‚ä½•æ„é€ çš„ã€‚ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹æ„å»ºæˆ‘ä»¬çš„åˆåŒã€‚

## æˆ‘ä»¬çš„åˆåŒå¦‚ä½•è¿ä½œ

åœ¨æ„å»ºæˆ‘ä»¬çš„å¥‘çº¦ä¹‹å‰ï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹æˆ‘ä»¬çš„å¥‘çº¦æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠæˆ‘ä»¬å°†è°ƒç”¨çš„å‡½æ•°/ç«¯ç‚¹ã€‚åœ¨æˆ‘ä»¬çš„åˆåŒä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿ:

1.  åˆ›å»ºä¸€ä¸ªä¼—ç­¹é¡¹ç›®â€”â€”ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª`add_crowdfund`å‡½æ•°ï¼Œå½“è¢«è°ƒç”¨æ—¶ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ä¼—ç­¹é¡¹ç›®ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ä¼—ç­¹é¡¹ç›®ä¸­ã€‚
2.  åˆ—å‡ºæˆ‘ä»¬æ‰€æœ‰çš„ä¼—ç­¹é¡¹ç›®â€”â€”ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°`list_crowdfunds`æ¥åˆ—å‡ºæˆ‘ä»¬æ‰€æœ‰çš„ä¼—ç­¹é¡¹ç›®
3.  ä¸ºä¸€ä¸ªä¼—ç­¹é¡¹ç›®æŠ•ç¥¨â€”â€”ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª`add_vote`å‡½æ•°æ¥ä¸ºæˆ‘ä»¬çš„ä¼—ç­¹é¡¹ç›®æ·»åŠ æŠ•ç¥¨ã€‚
4.  å‘ä¼—ç­¹é¡¹ç›®æèµ â€”â€”ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª`add_donation`å‡½æ•°ï¼Œå‘ä¼—ç­¹é¡¹ç›®æèµ ä¸€å®šæ•°é‡çš„ NEAR token

åœ¨`src`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª`model.rs`ã€`lib.rs`å’Œ`utils.rs`æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„`utils`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¤åˆ¶å¹¶ç²˜è´´ä»¥ä¸‹ä»£ç ã€‚

> `utils.rs`æ–‡ä»¶åŒ…å«äº†ä¸€äº›æœ‰ç”¨çš„å‡½æ•°å’Œç±»å‹ï¼Œæˆ‘ä»¬å°†åœ¨æ„å»ºå¥‘çº¦æ—¶ä½¿ç”¨å®ƒä»¬ï¼Œè¿˜æœ‰ä¸€äº›æ³¨é‡Šè§£é‡Šå®ƒä»¬çš„ä½œç”¨ã€‚ä¸è¦å®³æ€•ï¼Œå› ä¸ºä½ åªéœ€è¦å¤åˆ¶å¹¶ç²˜è´´åˆ°ä½ çš„`utils.rs`æ–‡ä»¶ä¸­

```
 // utils.rs
    use near_sdk::{
        env,
        PromiseResult,
    };
    /// == TYPES ====================================================================
    /// Account Ids in Near are just strings.
    pub type AccountId = String;
    /// Gas is u64
    pub type Gas = u64;
    /// Amounts, Balances, and Money in NEAR are u128.
    pub type Amount = u128;
    pub type Balance = Amount;
    pub type Money = Amount;
    /// Timestamp in NEAR is a number.
    pub type Timestamp = u64;
    ///
    /// == CONSTANTS ================================================================
    ///
    /// TODO: revist MIN_ACCOUNT_BALANCE after some real data is included b/c this
    /// could end up being much higher
    /// ONE_NEAR = unit of NEAR token in yocto â“ƒ (1e24)
    pub const ONE_NEAR: u128 = 1_000_000_000_000_000_000_000_000 as u128;
    /// XCC_GAS = gas for cross-contract calls, ~5 Tgas (teragas = 1e12) per "hop"
    pub const XCC_GAS: Gas = 20_000_000_000_000;
    /// MIN_ACCOUNT_BALANCE = 3 NEAR min to keep account alive via storage staking
    pub const MIN_ACCOUNT_BALANCE: u128 = ONE_NEAR * 3;
    /// == FUNCTIONS ================================================================
    /// Converts Yocto â“ƒ token quantity into NEAR, as a String
    pub fn asNEAR(amount: u128) -> String {
        format!("{}", amount / ONE_NEAR)
    }
    /// Converts a quantity in NEAR into Yocto â“ƒ tokens
    pub fn toYocto<D: Into<u128>>(amount: D) -> u128 {
        ONE_NEAR * amount.into()
    }
    /// Asserts that the contract has called itself
    pub fn assert_self() {
        let caller = env::predecessor_account_id();
        let current = env::current_account_id();
        assert_eq!(caller, current, "Only this contract may call itself");
    }
    /// Asserts that only a single promise was received, and successful
    pub fn assert_single_promise_success(){
        assert_eq!(
            env::promise_results_count(),
            1,
            "Expected exactly one promise result",
        );
        match env::promise_result(0) {
            PromiseResult::Successful(_) => return,
            _ => panic!("Expected PromiseStatus to be successful"),
        };
    }
```

## åˆ›å»ºæˆ‘ä»¬çš„æ¨¡å‹

æˆ‘ä»¬å¯ä»¥åœ¨åˆåŒä¸­å°†æ¨¡å‹æè¿°ä¸ºç”¨äºå®šä¹‰æ–°ç±»å‹çš„è‡ªå®šä¹‰æ•°æ®å®¹å™¨ã€‚å°±åƒæˆ‘ä»¬æ‹¥æœ‰åŸå§‹ç±»å‹ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å‹ä¸­åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„å®šåˆ¶ç±»å‹ï¼Œæ¥æè¿°æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ä¸œè¥¿ï¼Œæˆ–è€…æŒ‰ç…§æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ä¸œè¥¿çš„æ¨¡å¼æ¥æ„å»ºã€‚æˆ‘ä»¬çš„`model.rs`æ–‡ä»¶çš„ä»£ç å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥è§£é‡Šå®ƒçš„ä½œç”¨

```
// model.rs 
    use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
    #[allow(unused_imports)]
    use near_sdk::{env, near_bindgen};
    use near_sdk::serde::{Deserialize, Serialize};

    use crate::utils::{
        AccountId,
        Money,
        Timestamp
    };
    #[derive(Clone, Serialize, Deserialize, BorshDeserialize, BorshSerialize)]
    #[serde(crate = "near_sdk::serde")]
    pub struct Crowdfund{
        id: i32,
      pub creator: AccountId,
        created_at: Timestamp,
        title: String,
        donation_target: u128,
        pub total_donations: u128,
       pub total_votes: i64,
        description: String,
       pub votes: Vec<String>
    }

    impl Crowdfund{
        pub fn new(id:i32, title: String, donation_target:u128, description: String) -> Self {

            Crowdfund{
                id,
                creator: env::signer_account_id(),
                created_at: env::block_timestamp(),
                title,
                donation_target,
                total_donations: 0,
                total_votes : 0,
                description,
                votes: vec![],
            }
        }
    }
    #[derive(Clone, Serialize, Deserialize, BorshDeserialize, BorshSerialize)]
    #[serde(crate = "near_sdk::serde")]
    pub struct Donation {
        amount: Money,
        donor: AccountId,
    }
    impl Donation {
        pub fn new() -> Self {        
          Donation{
            amount: env::attached_deposit(),
            donor: env::predecessor_account_id(),
            }
        }  
    }
```

è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä»£ç åœ¨åšä»€ä¹ˆ:

```
    use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
    #[allow(unused_imports)]
    use near_sdk::{env, near_bindgen};
    use near_sdk::serde::{Deserialize, Serialize};
```

ä¸Šé¢æˆ‘ä»¬æœ‰ rust contract æ ‡å‡†å¯¼å…¥ï¼Œå¯ä»¥çœ‹åˆ°åœ¨`Cargo.toml`æ–‡ä»¶ä¸­ä½¿ç”¨çš„ä¾èµ–å…³ç³»ã€‚ä¸åºåˆ—åŒ–ç›¸å…³çš„ä¾èµ–é¡¹`BorshDeserialize`å’Œ`BorshSerialize`ç”¨äºæ†ç»‘æˆ‘ä»¬çš„åˆåŒä»£ç å’Œå­˜å‚¨ï¼Œä»¥ä¾¿ä¸ºåŒºå—é“¾é™„è¿‘åšå¥½å‡†å¤‡ã€‚ä¾èµ–é¡¹å‰çš„`use`è¯­å¥ä»…ä»…æ˜¾ç¤ºäº†æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨äº†å“ªäº›ä¾èµ–é¡¹ã€‚

> `env`ç”¨äºç™»å½•æ‚¨çš„æ§åˆ¶å°æˆ–è¿”å›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¦‚ç­¾åè€…çš„å¸æˆ·

```
   // model.rs
    use crate::utils::{
        AccountId,
        Money,
        Timestamp
    };
```

è¿™é‡Œï¼Œæˆ‘ä»¬åªæ˜¯ä»æˆ‘ä»¬çš„`utils.rs`æ–‡ä»¶ä¸­å¯¼å…¥ä¸€äº›æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„è‡ªå®šä¹‰ç±»å‹ã€‚åœ¨è¿™æ®µä»£ç ä¹‹åï¼Œæˆ‘ä»¬æœ‰äº†å¯¹æˆ‘ä»¬çš„åˆåŒè‡³å…³é‡è¦çš„ä¼—ç­¹èµ„é‡‘`struct`ã€‚

## ä¼—ç­¹ç»“æ„

rust ä¸­çš„ A `struct`ç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„ç±»ã€‚ç»“æ„åœ¨æŸç§ç¨‹åº¦ä¸Šä¿å­˜äº†å¥‘çº¦çš„çŠ¶æ€ã€‚åœ¨æ„å»ºæˆ‘ä»¬çš„å¥‘çº¦æ—¶ï¼Œæˆ‘ä»¬çš„`struct`åé¢ä¼šè·Ÿç€ä¸€ä¸ª`impl`ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç¼–å†™å¥‘çº¦çš„æ ¸å¿ƒé€»è¾‘å‡½æ•°ã€‚

```
//model.rs
    #[derive(Clone, Serialize, Deserialize, BorshDeserialize, BorshSerialize)]
    #[serde(crate = "near_sdk::serde")]
    pub struct Crowdfund{
        id: i32,
      pub creator: AccountId,
        created_at: Timestamp,
        title: String,
        donation_target: u128,
        pub total_donations: u128,
       pub total_votes: i64,
        description: String,
       pub votes: Vec<String>
    }
```

æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæ·»åŠ ä¸€ä¸ªæ–°çš„ä¼—ç­¹é¡¹ç›®ï¼Œå› æ­¤ä¸Šé¢çš„ crowdfund `struct`åŒ…å«ç‰¹å®šä¼—ç­¹é¡¹ç›®å°†æ‹¥æœ‰çš„ä¿¡æ¯å­—æ®µã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªç±»å‹ã€‚æœ€åä¸€ä¸ªå­—æ®µæ˜¯ä¸€ç§å‘é‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªæ•°ç»„ã€‚

> å…³é”®å­—`pub`æ„å‘³ç€æˆ‘ä»¬åœ¨å®ƒå‰é¢åŠ ä¸Šçš„ä»»ä½•ä¸œè¥¿éƒ½æ˜¯å…¬å…±çš„ï¼Œå¯ä»¥åœ¨å¤–éƒ¨ä½¿ç”¨

```
  //model.rs
    impl Crowdfund{
        pub fn new(id:i32, title: String, donation_target:u128, description: String) -> Self {

            Crowdfund{
                id,
                creator: env::signer_account_id(),
                created_at: env::block_timestamp(),
                title,
                donation_target,
                total_donations: 0,
                total_votes : 0,
                description,
                votes: vec![],
            }
        }
    }
```

ä¸Šé¢çš„ä»£ç å—æ˜¯æˆ‘ä»¬åˆå§‹åŒ–`Crowdund`æ¨¡å‹çš„åœ°æ–¹ã€‚å¥‘çº¦æ˜¯ç”¨ä¸€äº›å‚æ•°åˆå§‹åŒ–çš„ï¼Œè¿˜åŒ…å«ä¸€äº›é»˜è®¤æ•°æ®ï¼Œæ¯”å¦‚`creator`å­—æ®µï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ç­¾åè€…å¸æˆ·çš„ idã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`total_donations`å’Œ`total_votes`ä¹Ÿè¢«è®¾ç½®ä¸ºé›¶ã€‚å¥‘çº¦ä¹Ÿç”¨ä¸€äº›å‚æ•°åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å°†åœ¨è°ƒç”¨å‡½æ•°æ·»åŠ ä¼—ç­¹èµ„é‡‘æ—¶æä¾›è¿™äº›å‚æ•°ã€‚è¿™äº›è®ºç‚¹æ˜¯:

*   `id`:æ¯ä¸ªä¼—ç­¹èµ„é‡‘çš„å”¯ä¸€ ID
*   `title`:æˆ‘ä»¬ä¼—ç­¹é¡¹ç›®çš„æ ‡é¢˜
*   `donation_target`:ä¼—ç­¹é¡¹ç›®çš„ç›®æ ‡é‡‘é¢ã€‚
*   `description`:ç¨å¾®æè¿°ä¸€ä¸‹æˆ‘ä»¬çš„ä¼—ç­¹é¡¹ç›®ã€‚

æˆ‘ä»¬åœ¨`model.rs`æ–‡ä»¶ä¸­çš„æ¨¡å‹å¦‚ä¸‹:

```
//model.rs
    #[derive(Clone, Serialize, Deserialize, BorshDeserialize, BorshSerialize)]
    #[serde(crate = "near_sdk::serde")]
    pub struct Donation {
        donor: AccountId,
    }
    impl Donation {
        pub fn new() -> Self {        
          Donation{
            donor: env::predecessor_account_id(),
            }
        }  
    }
```

å¯¹äºæˆ‘ä»¬çš„æèµ `struct`,æˆ‘ä»¬æœ‰ä¸€ä¸ª`donor`å­—æ®µï¼Œæˆ‘ä»¬å¸Œæœ›å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šã€‚ç„¶åæˆ‘ä»¬ç”¨`donor`åˆå§‹åŒ–ææ¬¾`struct`ï¼Œé»˜è®¤å€¼ä¸º`predecessor_account_id()`ï¼Œè¡¨ç¤ºå‘ä¼—ç­¹æ´»åŠ¨ææ¬¾çš„äººã€‚ç°åœ¨è®©æˆ‘ä»¬è½¬åˆ°æˆ‘ä»¬çš„`lib.rs`æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è°ƒç”¨ä¸åŒçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å°†ä½¿æˆ‘ä»¬çš„ä¼—ç­¹ dApp çš„æ‰€æœ‰åŠŸèƒ½æˆä¸ºå¯èƒ½ã€‚

# æ·»åŠ ä¼—ç­¹é¡¹ç›®

æˆ‘ä»¬å·²ç»åœ¨ model.rs æ–‡ä»¶ä¸­åˆ›å»ºäº†æˆ‘ä»¬çš„æ¨¡å‹ï¼Œç°åœ¨æˆ‘ä»¬å°†è½¬ç§»åˆ°æˆ‘ä»¬çš„`lib.rs`æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ç¼–å†™ä¸åŒçš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨è¿™äº›å‡½æ•°æ¥æ‰§è¡Œ dApp ä¸­çš„æŸäº›æ“ä½œã€‚åœ¨æˆ‘ä»¬è¿›å…¥äº‹æƒ…çš„æœ¬è´¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„`lib.rs`æ–‡ä»¶é¡¶éƒ¨å¯ç”¨çš„ä¸€äº›ä»£ç ã€‚

```
  mod models;
  mod utils;
  use crate::{
      utils::{
          AccountId,
          ONE_NEAR,
          assert_self,
          assert_single_promise_success,
      },
      models::{
          Crowdfund,
          Donation
      }
  };
  // To conserve gas, efficient serialization is achieved through Borsh (http://borsh.io/)
  use near_sdk::{borsh::{self, BorshDeserialize, BorshSerialize}, Promise};
  #[allow(unused_imports)]
  use near_sdk::{env, PromiseIndex, near_bindgen};
  near_sdk::setup_alloc!();   
```

æˆ‘ä»¬åœ¨`lib.rs`æ–‡ä»¶ä¸­åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¯¼å…¥`utils.rs`å’Œ`models.rs`æ¨¡å—ï¼Œå®ƒä»¬ä¹Ÿåœ¨åŒä¸€ä¸ª`src`æ–‡ä»¶å¤¹ä¸­ã€‚åœ¨é‚£ä¹‹åï¼Œæˆ‘ä»¬ç”¨`use`å…³é”®å­—è¡¨ç¤ºæˆ‘ä»¬å°†åœ¨é‚£äº›æ¨¡å—ä¸­ç‰¹åˆ«ä½¿ç”¨çš„ä¸œè¥¿ï¼Œç„¶åæœ€åå¼•å…¥ rust æ ‡å‡†ã€‚ç°åœ¨ç»§ç»­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¥‘çº¦ç»“æ„

```
 #[near_bindgen]
    #[derive(Clone, Default, BorshDeserialize, BorshSerialize)]
    pub struct Contract {
        owner: AccountId,
        crowdfunds: Vec<Crowdfund>,
        donations: Vec<Donation>,
    }
```

> åœ¨æˆ‘ä»¬çš„å¥‘çº¦`struct`ä¹‹å‰çš„`#[near_bindgen]`æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„å¥‘çº¦ä»£ç èƒ½å¤Ÿå®¹æ˜“åœ°ç¼–è¯‘åˆ° WebAssembly ä¸­ï¼Œæ‰€ä»¥å®ƒå¯¹äºé™„è¿‘çš„åŒºå—é“¾æ˜¯å…¼å®¹çš„å’Œå¯ä¼˜åŒ–çš„

åœ¨æˆ‘ä»¬çš„å¥‘çº¦`struct`ä¸­ï¼Œæˆ‘ä»¬æœ‰`owner`å­—æ®µï¼Œç„¶åæˆ‘ä»¬æœ‰`crowdfund`å’Œ`donation`å­—æ®µï¼Œå®ƒä»¬åªæ˜¯å®ƒä»¬çš„æ¨¡å‹`Crowdfund`å’Œ`Donation`çš„å‘é‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æœ‰`impl`

```
  #[near_bindgen]
    impl Contract{
        #[init]
        pub fn init(
            owner: AccountId,
        ) -> Self{
            let crowdfunds: Vec<Crowdfund> = Vec::new();
            let donations: Vec<Donation> = Vec::new();

            Contract{
                owner,
                crowdfunds,
                donations
            }
        }
    }
```

åœ¨æˆ‘ä»¬çš„å¥‘çº¦`impl`ä¸­ï¼Œ`#init`å…è®¸æˆ‘ä»¬ç”¨ä¸€ä¸ªæ¥å—å‚æ•°`owner`çš„å‡½æ•°æ¥åˆ›å»ºå¥‘çº¦çš„è‡ªå®šä¹‰åˆå§‹åŒ–ã€‚æˆ‘ä»¬ç”¨`Vec::new()`æ„é€ äº†ä¸€ä¸ªæ–°çš„ç©ºå‘é‡ï¼Œå¹¶å°†å…¶åˆ†åˆ«åˆ†é…ç»™`crowdfund`å’Œ`donations`ã€‚

> åœ¨å…ƒç´ è¢«æ¨é€åˆ°å‘é‡ä¸Šä¹‹å‰ï¼Œå‘é‡ä¸ä¼šè¢«åˆ†é…ã€‚

## add_crowdfund å‡½æ•°

åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹ç¼–å†™å‡½æ•°ã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯`add_crowdfund`å‡½æ•°ã€‚

```
       pub fn add_crowdfund(&mut self, title: String, donate:u128,description: String) {

            let id = self.crowdfunds.len() as i32;

            self.crowdfunds.push(Crowdfund::new(
                id,
                title,
                donate,
                description
            ));
            env::log("Added a new crowdfund".as_bytes());
        }
```

`add_crowdfund`å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œ`title`ã€`donate`å’Œ`description`ï¼Œæˆ‘ä»¬å°†åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ä¼ å…¥ã€‚æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªä¼—ç­¹é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„`id`ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºå‘é‡ä¸­çš„æ‰€æœ‰ä¼—ç­¹é¡¹ç›®çš„é•¿åº¦åˆ›å»ºäº†ä¸€ä¸ª`id`å˜é‡ã€‚æˆ‘ä»¬çš„ä¼—ç­¹é¡¹ç›®åˆ—è¡¨ä¸­å¢åŠ äº†ä¸€ä¸ªæ–°çš„ä¼—ç­¹é¡¹ç›®ã€‚å› æ­¤ï¼Œæ¯æ¬¡æˆ‘ä»¬è°ƒç”¨`add_crowdfund`å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ›´æ–°åŒºå—é“¾çŠ¶æ€ï¼Œä¸€ä¸ªæ–°çš„ä¼—ç­¹é¡¹ç›®ä¼šæ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬ä½œä¸ºå‚æ•°æä¾›çš„ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬ç»™åŒºå—é“¾æ—¥å¿—â€œå¢åŠ äº†ä¸€ä¸ªæ–°çš„ä¼—ç­¹â€ã€‚

> æ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨å‡½æ•°ä¸­ä¼ é€’`&mut self`çš„ï¼Ÿã€‚è¿™ä»…ä»…æ„å‘³ç€æˆ‘ä»¬æ­£åœ¨ä¼ é€’ä¸€ä¸ªæŒ‡å‘æˆ‘ä»¬çš„`Contract`çš„å¯å˜å¼•ç”¨`self`

# åˆ—å‡ºæ‰€æœ‰ä¼—ç­¹é¡¹ç›®

æˆ‘ä»¬éœ€è¦å½’è¿˜æ‰€æœ‰çš„ä¼—ç­¹é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°`list_crowdfunds`ã€‚

```
 pub fn list_crowdfunds(&self) -> Vec<Crowdfund> {
            assert_self();
           let crowdfunds = &self.crowdfunds;
           return crowdfunds.to_vec();
        }
```

å½“æˆ‘ä»¬è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åˆ©ç”¨æ¥è‡ªæˆ‘ä»¬çš„`utils.rs`æ–‡ä»¶çš„`assert_self`å‡½æ•°ï¼Œä»¥ç¡®ä¿åˆåŒè°ƒç”¨è‡ªèº«ï¼Œç„¶åæˆ‘ä»¬å°†ä¼—ç­¹èµ„é‡‘ä½œä¸ºä¸€ä¸ªå‘é‡è¿”å›ï¼Œè¯¥å‘é‡æ˜¾ç¤ºæˆ‘ä»¬æ‰€æœ‰ä¼—ç­¹é¡¹ç›®çš„æ•°ç»„ã€‚

# æŠ•ç¥¨è¡¨å†³ä¸€ä¸ªé¡¹ç›®

å‡è®¾æœ‰ä¸€ä¸ªé¡¹ç›®ç¡®å®éœ€è¦ä¸€äº›æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥å¯¹è¯¥é¡¹ç›®è¿›è¡ŒæŠ•ç¥¨ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„å¥‘çº¦ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ª`add_vote`å‡½æ•°ã€‚

```
        pub fn add_vote(&mut self, id:usize){
            let crowdfund: &mut Crowdfund = self.crowdfunds.get_mut(id).unwrap();
            let voter = env::predecessor_account_id();
            crowdfund.total_votes = crowdfund.total_votes + 1;
            env::log("vote submitted succesfully".as_bytes());
            crowdfund.votes.push(voter);

        }
```

æˆ‘ä»¬å°†ä¸€ä¸ª`id`å‚æ•°ä¼ é€’ç»™`add_vote`å‡½æ•°ï¼Œä»¥ç¡®å®šæˆ‘ä»¬æƒ³è¦æŠ•ç¥¨çš„ç‰¹å®šé¡¹ç›®ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨`.get_mut(id)`å¹¶ä¼ å…¥é¡¹ç›®çš„ id æ¥è®¿é—®é¡¹ç›®ã€‚æˆ‘ä»¬å°†æˆ‘ä»¬çš„æŠ•ç¥¨è€…è®¾ç½®ä¸º`predecessor_account_id()`ï¼Œç„¶åç”¨ä¸‹é¢è¿™æ¡çº¿æ”¹å˜æˆ‘ä»¬çš„çŠ¶æ€ã€‚

```
    crowdfund.total_votes = crowdfund.total_votes + 1;
```

æ¯å½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œè¿™ä¸ªå­—æ®µå°±å¢åŠ  1ï¼Œç„¶åæˆ‘ä»¬å°†æŠ•ç¥¨è€…æ·»åŠ åˆ°æŠ•ç¥¨å‘é‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è°åœ¨è¿™ä¸ªé¡¹ç›®ä¸ŠæŠ•äº†ç¥¨ã€‚

# å‘ä¸€ä¸ªé¡¹ç›®ææ¬¾

ä¸ºäº†æèµ ç»™ä¸€ä¸ªç‰¹å®šçš„é¡¹ç›®ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`add_donation`å‡½æ•°ï¼Œå¹¶ä¼ å…¥æˆ‘ä»¬æƒ³è¦æèµ çš„é¡¹ç›®çš„`id`ï¼Œä»¥åŠæˆ‘ä»¬æƒ³è¦æèµ çš„ NEAR token çš„æ•°é‡ã€‚

```
     pub fn add_donation(&mut self, id:usize, amount:u128) {
            let transfer_amount: u128 = ONE_NEAR * amount;
            let crowdfund: &mut Crowdfund = self.crowdfunds.get_mut(id).unwrap();
            crowdfund.total_donations = crowdfund.total_donations + transfer_amount;
            self.donations.push(Donation::new());

           Promise::new(env::predecessor_account_id()).transfer(transfer_amount);
          env::log("You have donated succesfully".as_bytes());
        }
```

è¿™é‡Œæˆ‘ä»¬ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä¼—ç­¹é¡¹ç›®çš„`id`å’Œæˆ‘ä»¬è¦æçš„`amount`ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æèµ çš„é‡‘é¢æ·»åŠ åˆ°å½“å‰çš„`total_donations`ä½™é¢ä¸­ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶æ¨é€ä¸€ç¬”æ–°çš„æèµ ï¼Œé‡‘é¢å°†è¢«è½¬ç§»åˆ°ä¼—ç­¹é¡¹ç›®æ‰€æœ‰è€…ã€‚

# è·å¾—æ€»ä¼—ç­¹èµ„é‡‘å’Œæèµ è®¡æ•°

è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„åˆåŒä¸­å†æ·»åŠ ä¸¤ä¸ªå‡½æ•°ï¼Œä»¥ç¡®å®šæˆ‘ä»¬æ‹¥æœ‰çš„ä¼—ç­¹é¡¹ç›®æ€»æ•°ä»¥åŠæŸä¸ªç‰¹å®šä¼—ç­¹é¡¹ç›®æ”¶åˆ°çš„ææ¬¾æ€»é¢ã€‚

```
    pub fn crowdfund_count(&mut self) -> usize {
            return self.crowdfunds.len();
        }

        pub fn get_total_donations(&mut self, id:usize) -> u128 {
            let crowdfund: &mut Crowdfund = self.crowdfunds.get_mut(id).unwrap();
            return crowdfund.total_donations;
        }
```

æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªå‡½æ•°`crowdfund_count`æ¥è¿”å›æˆ‘ä»¬çš„ä¼—ç­¹å‘é‡çš„é•¿åº¦ï¼Œä»¥åŠ`get_total_donations`æ¥è¿”å›ä¸€ä¸ªç‰¹å®šçš„ä¼—ç­¹é¡¹ç›®æ”¶åˆ°çš„ææ¬¾æ€»é¢ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†è¿™ä¸ªå¥‘çº¦çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ˜¯æ—¶å€™éƒ¨ç½²å’Œè°ƒç”¨æˆ‘ä»¬å¥‘çº¦ä¸­çš„åŠŸèƒ½äº†ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡éƒ½æ­£å¸¸å·¥ä½œï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è¦åšçš„äº‹æƒ…

# éƒ¨ç½²æ™ºèƒ½åˆåŒ<g-emoji class="g-emoji" alias="rocket" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f680.png">ğŸš€</g-emoji>

åœ¨æˆ‘ä»¬éƒ¨ç½²æ™ºèƒ½åˆçº¦ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆä½¿ç”¨`near-cli`ç™»å½•æˆ‘ä»¬åˆ›å»ºçš„ NEAR å¸æˆ·ã€‚

**ç”¨`near-cli`ç™»å½•**

ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†`near-cli`ï¼Œæ‚¨å¯ä»¥ä»å…ˆå†³æ¡ä»¶ä¸­çš„é“¾æ¥çœ‹åˆ°å®‰è£…æ­¥éª¤ã€‚ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
   near login
```

ç™»å½•åˆ°æˆ‘ä»¬åˆ›å»ºçš„å¸æˆ·åï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­çœ‹åˆ°ä¸€æ¡æˆåŠŸçš„æ¶ˆæ¯ã€‚

## éƒ¨ç½²åˆåŒ

ä¸ºäº†éƒ¨ç½²æˆ‘ä»¬çš„ä¼—ç­¹åˆåŒï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¸æˆ·ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ª testnet å¸æˆ·ï¼Œåœ¨æˆ‘çš„ä¾‹å­`umavictor.testnet`ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`umavictor.testnet`ä¸‹åˆ›å»ºä¸€ä¸ªå­å¸æˆ·æ¥éƒ¨ç½²å¥‘çº¦ã€‚

```
  near create-account crowdfunddapp.umavictor.testnet --masterAccount umavictor.testnet
```

[![sub account](../Images/0d2a1f6c007b75e4f7709d8dbe7cc210.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/createsubaccount.png?raw=true)

> åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼Œ`umavictor`å°†è¢«æ‚¨è‡ªå·±åˆ›å»ºçš„ NEAR testnet å¸æˆ·åæ›¿æ¢

åˆ›å»ºå­è´¦æˆ·åï¼Œå¯¼èˆªè‡³`src/config.js`å¹¶ä¿®æ”¹è®¾ç½®åˆåŒè´¦æˆ·åç§°çš„è¡Œã€‚å°†å…¶è®¾ç½®ä¸ºæ‚¨åœ¨ä¸Šé¢åˆ›å»ºçš„å­å¸æˆ·`id`ã€‚

```
  const CONTRACT_NAME = process.env.CONTRACT_NAME || 'crowdfunddapp.umavictor.testnet'
```

æˆ‘ä»¬ç»ˆäºå¯ä»¥éƒ¨ç½²æˆ‘ä»¬çš„åˆåŒäº†ã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† [create-near-app](https://github.com/near/create-near-app) ï¼Œæ‰€ä»¥éƒ¨ç½²æˆ‘ä»¬çš„å¥‘çº¦å¾ˆå®¹æ˜“ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å‘½ä»¤æ¥å®Œæˆ

```
near deploy 
```

[![deploy contract](../Images/d5f08776e61c7f7dfce48d5bf9b6180e.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/crowdfunddeploy.png?raw=true)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿è¡Œå‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬çš„å¥‘çº¦éƒ¨ç½²æˆåŠŸäº†ã€‚è€¶ï¼ã€‚

> å¦‚æœæ‚¨å¯¹åˆåŒè¿›è¡Œäº†æ›´æ”¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤`near delete crowdfunddapp.umavictor.testnet umavictor.testnet`åˆ é™¤å­è´¦æˆ·ï¼Œç„¶åé‡æ–°åˆ›å»ºã€‚

# é€šè¿‡è°ƒç”¨å¥‘çº¦æ–¹æ³•ä¸æˆ‘ä»¬çš„å¥‘çº¦è¿›è¡Œäº¤äº’

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æˆ‘ä»¬çš„åˆåŒè¿›è¡Œäº¤äº’ï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬çš„æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨åšå®ƒä»¬åº”è¯¥åšçš„äº‹æƒ…ã€‚è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹æ¯ä¸ªåŠŸèƒ½ï¼ã€‚

## æ·»åŠ ä¼—ç­¹é¡¹ç›®

ç”¨`near-cli`å‘¼å«`add_crowdfund`:

```
    near call crowdfunddapp.umavictor.testnet add_crowdfund '{"title": "Eliots eye sight", "donate": 30, "description":"Raise funds for little Eliot to see again. Loss of sight was caused by an accident to the head"}' --accountId umavictor.testnet
```

ä¸Šé¢çš„å‘½ä»¤æ‰€åšçš„æ˜¯è°ƒç”¨éƒ¨ç½²åœ¨`crowdfunddapp.umavictor.testnet`çš„å¥‘çº¦ã€‚å¥‘çº¦ä¸Šæœ‰ä¸€ä¸ªåä¸º`add_crowdfund`çš„æ–¹æ³•ï¼Œæä¾›äº†ä¸‰ä¸ªå‚æ•°ï¼Œå¹¶ç”±`umavictor.testnet`ç­¾åã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡º:

[![add crowdfund](../Images/becfcb664774b2008e402a034fc2f731.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/addcrowdfund.png?raw=true)

## ä¸ºä¸€ä¸ªä¼—ç­¹é¡¹ç›®æŠ•ç¥¨

ç”¨`near-cli`å‘¼å«`add_vote`:

```
   near call crowdfunddapp.umavictor.testnet add_vote '{"id":0}' --accountId umavictor.testnet
```

è¯¥å‘½ä»¤å°†ç¬¬ä¸€ä¸ªä¼—ç­¹é¡¹ç›®çš„æŠ•ç¥¨æ•°å¢åŠ  1ã€‚

[![addvote](../Images/da495cb08a2c280efff80c56187f9cae.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/addvote.png?raw=true)

# å‘ä¼—ç­¹é¡¹ç›®ææ¬¾

ç”¨`near-cli`è°ƒç”¨`add_donate`æ–¹æ³•

```
 near call crowdfunddapp.umavictor.testnet add_donation '{"id":0, "amount":1}' --accountId umavictor.testnet
```

è¿™ä¸ªå‘½ä»¤è°ƒç”¨`add_donation`æ–¹æ³•ï¼Œ1 NEAR è¢«å‘é€åˆ° crowdfund é¡¹ç›®ã€‚

# åˆ—å‡ºæ‰€æœ‰ä¼—ç­¹é¡¹ç›®

è°ƒç”¨`list_crowdfunds`æ–¹æ³•ã€‚

```
 near call crowdfunddapp.umavictor.testnet list_crowdfunds --accountId umavictor.testnet
```

è¿™ä¸ªå‘½ä»¤åˆ—å‡ºäº†æ‰€æœ‰åˆ°ç»ˆç«¯çš„ä¼—ç­¹é¡¹ç›®ã€‚

[![list crowdfunds](../Images/adfd7623e990c326516a46226ed61705.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/listcrowdfunds.png?raw=true)

ä½ å¯ä»¥ä»å›¾ç‰‡å’Œæˆ‘ä»¬è®¾ç½®çš„æ‰€æœ‰ä¿¡æ¯ä¸­çœ‹åˆ°è¿™ä¸¤ä¸ªä¼—ç­¹é¡¹ç›®ã€‚æˆ‘ä»¬å·²ç»è°ƒç”¨äº†è¿™äº›æ–¹æ³•æ¥æŸ¥çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œç°åœ¨è®©æˆ‘ä»¬æ„å»º react å‰ç«¯

# æ„å»ºæˆ‘ä»¬çš„å‰ç«¯

æˆ‘ä»¬ç»ˆäºå®Œæˆäº†æ™ºèƒ½åˆçº¦çš„æ„å»ºã€‚ä¸ºäº†è¿æ¥å’Œæ„å»ºæˆ‘ä»¬çš„ React å‰ç«¯ï¼Œæˆ‘ä»¬å°†åœ¨`src`æ–‡ä»¶å¤¹ä¸Šå·¥ä½œã€‚è¿™ä¸æ˜¯ä¸€ä¸ª React æ•™ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åªè§¦åŠé‡è¦çš„äº‹æƒ…ã€‚é¦–å…ˆï¼Œå¯¼èˆªåˆ°`utils.js`å¹¶æ›´æ–°æ‚¨çš„å˜æ›´å’ŒæŸ¥çœ‹æ–¹æ³•

```
//utils.js
  window.contract = await new Contract(window.walletConnection.account(), nearConfig.contractName, {
        // View methods are read only. They don't modify the state, but usually return some value.
        viewMethods: ['get_donation_count',"crowdfund_count"],
        // Change methods can modify the state. But you don't receive the returned value when called.
        changeMethods: ['add_crowdfund', 'add_vote','add_donation',"list_crowdfunds"],
      })
    }
```

çœ‹çœ‹æˆ‘ä»¬çš„`App.js`ä¸­çš„ä»£ç :

```
   // App.js
    import 'regenerator-runtime/runtime'
    import { useEffect, useState } from 'react'
    import ListCrowdfunds from './components/ListCrowdfunds'
    import CreateCrowdfund from './components/CreateCrowdfunds'
    import React from 'react'
    import { login, logout } from './utils'
    import './global.css'
    import getConfig from './config'
    const { networkId } = getConfig(process.env.NODE_ENV || 'development')

    export default function App() {
      const [crowdfunds, setCrowdfunds] = useState([])
      const [toggleModal, setToggleModal] = useState(false)
      function addProject() {
        setToggleModal(!toggleModal)
      }

      useEffect(
        () => {
          // in this case, we only care to query the contract when signed in
          if (window.walletConnection.isSignedIn()) {
            // window.contract is set by initContract in index.js
            window.contract.list_crowdfunds().then((crowdfundprojects) => {
              const crowdfundList = [...crowdfundprojects]
              setCrowdfunds(crowdfundList)
            })
          }
        },
        [],
      )

      // if not signed in, return early with sign-in prompt
      if (!window.walletConnection.isSignedIn()) {
        return (
          <main>
            <h1>Welcome to Paradis</h1>
            <p style={{ textAlign: 'center' }}>
              Click the button below to sign in:
            </p>
            <p style={{ textAlign: 'center', marginTop: '2.5em' }}>
              <button onClick={login}>Sign in</button>
            </p>
          </main>
        )
      }
      return (
        // use React Fragment, <>, to avoid wrapping elements in unnecessary divs
        <>
          <header>
            <div className="logo"></div>
            <button className="link" style={{ float: 'right' }} onClick={logout}>
              Sign out <span className="id">{window.accountId}</span>
            </button>
          </header>
          <button onClick={addProject}>Add a project</button>
          <main>
            <CreateCrowdfund toggleModal={toggleModal} />
            <section>
              {crowdfunds.map((project, id) => {
                return (
                  <div key={id}>
                    <ListCrowdfunds project={project} />
                  </div>
                )
              })}
            </section>
          </main>
        </>
      )
    }
```

åœ¨ä¸Šé¢çš„`App.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†å°†è¦ä½¿ç”¨çš„é…ç½®ã€å®ç”¨ç¨‹åºå’Œç»„ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºäº†æˆ‘ä»¬çš„`crowdfunds`çŠ¶æ€ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«æˆ‘ä»¬æ‰€æœ‰ä¼—ç­¹é¡¹ç›®çš„å¯¹è±¡æ•°ç»„ã€‚åœ¨`useEffect`é’©å­ä¸­ï¼Œæˆ‘ä»¬ä»å·²ç»ç”±`index.js`æ–‡ä»¶ä¸­çš„`initContract`è®¾ç½®çš„`window.contract`ä¸­è°ƒç”¨`list_crowdfund`æ–¹æ³•ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ React çš„`setState`è®¾ç½®ä¼—ç­¹çŠ¶æ€ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœæ²¡æœ‰ç”¨æˆ·ç™»å½•ï¼Œæˆ‘ä»¬ä¼šæç¤ºä»–ä»¬ç™»å½•ã€‚

[![Login](../Images/b968fbca80eb5237b04bc8fc2a84915b.png)T2ã€‘](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/assets/welcome.png?raw=true)

ç™»å½•åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¯ä¾›æèµ çš„é¡¹ç›®ã€‚

## ä¸Šå¸‚ä¼—ç­¹æˆåˆ†

å¯¹äºæˆ‘ä»¬çš„`App.js`ç»„ä»¶ï¼Œæˆ‘ä»¬éå†äº†æ‰€æœ‰çš„ä¼—ç­¹é¡¹ç›®ï¼Œå¹¶å°† object prop ä¼ é€’ç»™æˆ‘ä»¬çš„`ListCrowdfunds`ç»„ä»¶ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„`ListCrowdfunds`ç»„ä»¶çš„æ ·å­ã€‚

```
  // components/ListCrowdfunds.js
    import React, { useState } from 'react'
    const ONE_NEAR = 1_000_000_000_000_000_000_000_000
    function ListCrowdfunds({ project }) {
      const [donationAmount, setDonationAmount] = useState(0)
      const [showDonateNotification, setShowDonateNotification] = useState(false)
      function donate(e) {
        e.preventDefault()
        console.log(donationAmount)
        window.contract.add_donation({ id: project.id, amount: donationAmount * 1 })
        setShowDonateNotification(!showDonateNotification)
      }
      return (
        <div className="project">
          <h2>{project.title}</h2>{' '}
          <span className="creator">{project.creator}</span>
          <h3>description:</h3>
          <p>{project.description}</p>
          <h4>target: {project.donation_target} NEAR</h4>
          <h4>Votes: {project.total_votes}</h4>
          <button
            onClick={() => {
              window.contract.add_vote({ id: project.id })
            }}
          >
            Vote
          </button>
          <h4>total donations: {project.total_donations / ONE_NEAR} NEAR</h4>
          <form onSubmit={donate}>
            <input
              type="number"
              value={donationAmount}
              onChange={(e) => setDonationAmount(e.target.value)}
            ></input>
            <button onClick={donate}>Donate</button>
          </form>
          {showDonateNotification && <DonateNotification />}
        </div>
      )
    }
    function DonateNotification() {
      return (
        <aside>
          <footer>
            <div>âœ” Succeeded </div>
            <div>Donation was successful</div>
          </footer>
        </aside>
      )
    }
    export default ListCrowdfunds
```

åœ¨`ListCrowdfunds`ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®æèµ é‡‘é¢çŠ¶æ€ï¼Œå½“æˆ‘ä»¬æƒ³è¦æèµ æ—¶ï¼Œé€šè¿‡ç‚¹å‡»`Donate`æŒ‰é’®ï¼Œè°ƒç”¨`donate`å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨æˆ‘ä»¬ä»è¡¨å•ä¸­æä¾›çš„å‚æ•°è°ƒç”¨æˆ‘ä»¬çš„å¥‘çº¦ä¸­çš„`add_donation`æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé€šçŸ¥ç»„ä»¶ï¼Œå½“æˆ‘ä»¬çš„æèµ æˆåŠŸæ—¶ï¼Œå®ƒä¼šé€šçŸ¥ç”¨æˆ·ã€‚

## åˆ›å»ºä¼—ç­¹ç»„ä»¶

æˆ‘ä»¬çš„`CreateCrowdfund`ç»„ä»¶æ˜¯ä¸€ä¸ªåŒ…å«è¡¨å•çš„æ¨¡æ€ï¼Œç”¨äºæ·»åŠ ä¸€ä¸ªæ–°çš„ä¼—ç­¹é¡¹ç›®ã€‚

```
   import React, { useState } from 'react'
    function CreateCrowdfund({toggleModal}) {
      const [title, setTitle] = useState('')
      const [description, setDescription] = useState('')
      const [target, setTarget] = useState(0)
      const [showNotification, setShowNotification] = useState(false)
      const handleSubmit = (event) => {
        event.preventDefault()
        window.contract.add_crowdfund({title:title, donate:target * 1, description:description})
        setShowNotification(!showNotification)
        alert(`crowdfund info: ${title} ${target} ${description}`)
      }
    console.log(`its ${toggleModal}`);
      return (
        <div>
          {toggleModal == true && (
            <div className='addcrowdfund'>
              <form onSubmit={handleSubmit}>
                <label>
                  Enter project title:
                  <input
                    type="text"
                    value={title}
                    onChange={(e) => setTitle(e.target.value)}
                  />
                </label>
                <label>
                  Enter donation target:
                  <input
                    type="number"
                    value={target}
                    onChange={(e) => setTarget(e.target.value)}
                  />
                </label>
                <label>
                  Enter project description:
                  <input
                    type="text"
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                  />
                </label>
                <input type="submit" className='submit' />
              </form>
            </div>
          )}

          {showNotification && <Notification />}
        </div>

      )
    }
    function Notification() {
      return (
        <aside>
          <footer>
            <div>âœ” Succeeded </div> 
            <div>Added new project Just now</div>
          </footer>
        </aside>
      )
    }
    export default CreateCrowdfund
```

å½“`toggleModal`çŠ¶æ€ä¸º`true`æ—¶ï¼Œè¯¥ç»„ä»¶æœ‰æ¡ä»¶åœ°å‘ˆç°ã€‚æˆ‘ä»¬ä¸ºä¼—ç­¹`title`ã€`description`å’Œ`target donation amount`è®¾ç½®äº†ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯æ¬¡æˆ‘ä»¬çš„è¾“å…¥æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬å°†çŠ¶æ€è®¾ç½®ä¸ºè¾“å…¥å€¼ã€‚åœ¨æäº¤è¡¨å•æ—¶ï¼Œ`handleSubmit`å‡½æ•°è¿è¡Œï¼Œä»`window.contract`è°ƒç”¨æˆ‘ä»¬çš„`add_crowdfund`æ–¹æ³•ï¼Œå‚æ•°æ¥è‡ªè¾“å…¥å€¼ã€‚

æ‚¨å¯ä»¥æŸ¥çœ‹æœ€ç»ˆ dApp çš„è¿™ä¸ª[è§†é¢‘](https://www.loom.com/share/f65f0c04298e434f88e0696d9bf3ad6b)æ¼”ç¤ºã€‚

è€¶ï¼ã€‚æˆ‘ä»¬å·²ç»ç»“æŸäº†æ•™ç¨‹ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æºä»£ç ã€‚

# ç»“è®º

ç»ˆäºï¼ï¼Œæœ¬æ•™ç¨‹åˆ°æ­¤ç»“æŸã€‚æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åœ¨åŒºå—é“¾é™„è¿‘å»ºç«‹ä¸€ä¸ªä¼—ç­¹ dAppï¼Œåç«¯ä½¿ç”¨ Rustï¼Œå‰ç«¯ä½¿ç”¨ Reactï¼Œæµ‹è¯•æˆ‘ä»¬çš„æ–¹æ³•ï¼Œå¹¶åœ¨ç°åœºéƒ¨ç½²æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒã€‚

# æ¥ä¸‹æ¥å‘¢ï¼Ÿ

æ‚¨å¯ä»¥æ‘†å¼„ä»£ç ï¼Œå¹¶æ·»åŠ ä¸€äº›æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚æ·»åŠ åˆ†é¡µï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥åœ¨é¡µé¢ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚ä½ è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªæ’åºåŠŸèƒ½ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å¯¹æŠ•ç¥¨æœ€é«˜çš„ä¼—ç­¹é¡¹ç›®è¿›è¡Œæ’åºã€‚

# å…³äºä½œè€…

è¿™ä¸ªæ•™ç¨‹æ˜¯ç”±è½¯ä»¶å¼€å‘è€…å’Œ web3 çˆ±å¥½è€… Uma Victor åˆ›å»ºçš„ã€‚

# å‚è€ƒ

*   é è¿‘[æ–‡æ¡£](https://docs.near.org/docs/develop/basics/getting-started)ã€‚