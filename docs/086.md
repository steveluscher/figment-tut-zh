# ä»‹ç»

> åŸæ–‡:[https://github . com/fig ment-networks/learn-tutorials/blob/master/near/cross-contract-calls . MD](https://github.com/figment-networks/learn-tutorials/blob/master/near/cross-contract-calls.md)

[åŸæ•™ç¨‹å¯ä»¥åœ¨å®˜æ–¹ NEAR æ–‡æ¡£è¿™é‡Œæ‰¾åˆ°](https://docs.near.org/docs/tutorials/contracts/cross-contract-calls)ã€‚

åœ¨æŸäº›æ—¶å€™ï¼Œæ‚¨å¯èƒ½å¸Œæœ›è°ƒç”¨ç°æœ‰å¥‘çº¦ä¸Šçš„å‡½æ•°ã€‚è¿™è¢«ç§°ä¸º*äº¤å‰åˆçº¦è°ƒç”¨*ã€‚è¿™æ ·åšæœ‰å¾ˆå¤šåŸå› :

*   æ‚¨å¸Œæœ›åˆ©ç”¨ä»–äººç¼–å†™å¹¶å‘å¸ƒçš„ä»£ç åº“
*   æ‚¨å¸Œæœ›æ‚¨çš„åº”ç”¨ç¨‹åºä¸å…¶ä»–å…·æœ‰å¯è½¬ç§»çŠ¶æ€çš„åˆåŒé›†æˆåœ¨ä¸€èµ·(ä¾‹å¦‚ï¼Œå…·æœ‰å¯è½¬ç§»åº“å­˜çš„æ¸¸æˆ)
*   æ‚¨å¸Œæœ›æ„å»ºä¸€ä¸ªä»¥æŸç§æ–¹å¼ä¸ç°æœ‰å¥‘çº¦äº¤äº’çš„æœºå™¨äºº

è·¨å¥‘çº¦è°ƒç”¨å®é™…ä¸Šç±»ä¼¼äºåœ¨ web 2.0 ç¯å¢ƒä¸­è°ƒç”¨å¤–éƒ¨ APIã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªéå¸¸ç®€å•çš„ç¤ºä¾‹æ¥å¸®åŠ©æ‚¨å¯åŠ¨å’Œè¿è¡Œè·¨åˆåŒå‘¼å«ã€‚

# æè¿°

æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç®€å•çš„å¥‘çº¦:

*   è¿™ä¸ªåˆåŒå°†æœ‰æˆ‘ä»¬æƒ³è¦å†™ç»™ä»»ä½•äººè°ƒç”¨çš„è®¡ç®—
*   è¿™ä¸ªåˆåŒ(æ¯«æ— ç–‘é—®)å°†è°ƒç”¨å…¶ä»–åˆåŒä¸­å¯ç”¨çš„è®¡ç®—

å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†åªå®ç°`add`åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼è¶…çº§é‚ªæ¶è¶…çº§å…¬å¸çš„ä¼šè®¡éƒ¨é—¨æŠŠæ‰€æœ‰è¿™äº›æ•°å­—éƒ½ä½œä¸ºå­—ç¬¦ä¸²å‘é€ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¿™äº›å¼¦ä¼šæœ‰å¤šé•¿ã€‚ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸€ä¸ªé—®é¢˜:JavaScript èƒ½å¤„ç†çš„æœ€å¤§æ•´æ•°æ˜¯ [9007199254740991](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER) ã€‚ä¸ºäº†å¸®åŠ©æ¯ä¸ªæƒ³æŠŠé•¿æ•°å­—åŠ åœ¨ä¸€èµ·çš„äººï¼Œæˆ‘ä»¬å°†éƒ¨ç½²ä¸€ä¸ªå¥‘çº¦ï¼Œäººä»¬å¯ä»¥æŠŠå®ƒé›†æˆåˆ°è‡ªå·±çš„è®¡ç®—å™¨ä¸­ã€‚

# æ­¥éª¤ 1 -åœ¨ Gitpod ä¸­åˆ›å»ºæ–°çš„ä»¤ç‰ŒåˆåŒé¡¹ç›®

åœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾æˆ–çª—å£ä¸­:

*   åœ¨ [Gitpod](https://gitpod.io/#https://github.com/near-examples/token-contract-as) ä¸­æ‰“å¼€ä¸€ä¸ªæ–°çš„ä»¤ç‰ŒåˆåŒé¡¹ç›®

å½“å®ƒåœ¨ GitPod ä¸­æ‰“å¼€æ—¶ï¼Œä»£ç å°†ä¸ºè¿™ä¸ªé¡¹ç›®ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ NEAR å¸æˆ·ï¼Œç„¶åæ„å»ºå¹¶éƒ¨ç½²æ¨¡æ¿æ–‡ä»¶ã€‚æ‚¨å¯ä»¥é€šè¿‡å•å‡»â€œOpen Browserâ€æ¥æŸ¥çœ‹ä»¤ç‰Œç¤ºä¾‹çš„è¿è¡Œæƒ…å†µï¼Œä»è€Œäº†è§£æˆ‘ä»¬çš„å¼€å§‹ã€‚

è¿™ä¸ªç¤ºä¾‹é¡¹ç›®æœ‰ä¸€ä¸ªä»¤ç‰Œæ™ºèƒ½å¥‘çº¦ï¼Œè¿˜æœ‰ä¸€äº›è°ƒç”¨æ™ºèƒ½å¥‘çº¦å‡½æ•°çš„ JavaScript æµ‹è¯•ã€‚æ‚¨å¯ä»¥å°è¯•ç«‹å³è¿è¡Œè¿™äº›æµ‹è¯•æ¥æŸ¥çœ‹ä»£ç ä¸åŒºå—é“¾çš„äº¤äº’ã€‚

åœ¨ Gitpod ä¸­:

*   ç‚¹å‡»**ç»ˆç«¯** > > **æ–°å»ºç»ˆç«¯**

åœ¨ Gitpod åº•éƒ¨æ‰“å¼€çš„æ–°æ ‡ç­¾é¡µä¸­

*   åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹é”®å…¥`yarn jest`

ä¸€æ—¦å®Œæˆï¼Œç»ˆç«¯ä¸­è¿è¡Œçš„æµ‹è¯•å°†å¦‚ä¸‹æ‰€ç¤º:

[![Default Token Contract Test ](../Images/434a9469fb8934741a4014253a2b3868.png)T2ã€‘](https://camo.githubusercontent.com/7f0df064e6503573cf8b14e0f781e796a51fd247546abe4a5b75bd40eb4d3e10/68747470733a2f2f646f63732e6e6561722e6f72672f646f63732f6173736574732f64656661756c742d746f6b656e2d636f6e74726163742d746573742e706e67)

è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„`test-account-XXXXXXXXX_tTIMESTAMP-XXXXXXX`æ˜¯ä¸ºè¿™ä¸ªç‰¹å®šé¡¹ç›®è‡ªåŠ¨ç”Ÿæˆçš„ NEAR å¸æˆ·ã€‚ä¸è¦è¢«è¿™äº›ç»†èŠ‚åˆ†æ•£æ³¨æ„åŠ›ï¼Œåªéœ€å°†å¼€å‘äººå‘˜æ—¥å¿—è¾“å‡ºä¸æ–‡ä»¶`src/test.js`ä¸­çš„è¯­å¥è¿›è¡Œæ¯”è¾ƒã€‚

> æˆ‘ä»¬ä¸ä¼šä¿ç•™è¿™ä¸ªæ¨¡æ¿ä¸­çš„ä»»ä½•ä»£ç ã€‚å®ƒåªæ˜¯ä¸€ä¸ªèµ·ç‚¹ã€‚

# æ­¥éª¤ 2 -æ’°å†™è®¡ç®—å™¨åˆåŒ

å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åªå¯¹ç¼–å†™ä¸€ä¸ªå‡½æ•°æ„Ÿå…´è¶£ã€‚ä¸€ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå­—ç¬¦ä¸²`a`å’Œ`b`ï¼Œå¹¶å°†å®ƒä»¬ç›¸åŠ çš„ç»“æœä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚

åœ¨æ–‡ä»¶`assembly/main.ts`ä¸­:

*   å°†æ–‡ä»¶çš„**å…¨éƒ¨å†…å®¹æ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç *(æ³¨æ„:è¿™æ®µä»£ç å®ç°äº†ä¸¤ä¸ªå¤§æ•°çš„ç›¸åŠ ï¼Œå°±åƒæˆ‘ä»¬åœ¨çº¸ä¸Šåšçš„ä¸€æ ·)***

```
import { context, storage, logging } from "near-sdk-as";

export function addLongNumbers(a: string, b: string): string {
  // sends logs to the terminal of the contract placing call and the Near Explorer
  logging.log("-------------------------------------------------------")
  logging.log('Contract Called : ' + context.contractName)
  logging.log('Contract Signer : ' + context.predecessor)
  logging.log("- - - - - - - - - - - - - - - - - - - - - - - - - - - -")
  logging.log("Caculating : " + a + " + " + b)
  // Similar to long addition by hand, we start with the least significant digits first
  const aReversed = a.split("").reverse();
  const bReversed = b.split("").reverse();

  // We initialize our resultant variable to be one more than the largest number's length
  const maxLength = max(a.length, b.length);
  let resultArray = new Array<String | null>(maxLength + 1);
  let result = "";
  let carry = 0;

  // Loop through each digit adding the value to the other number, if it exists
  for (let i = 0; i < maxLength; ++i) {
    let aDigit = (i < a.length) ? U32.parseInt(aReversed[i]) : 0;
    let bDigit = (i < b.length) ? U32.parseInt(bReversed[i]) : 0;
    let digitSum = aDigit + bDigit + carry;

    // Keep track of the carry amount
    if (digitSum >= 10) {
      carry = 1;
      digitSum -= 10;
    } else {
      carry = 0;
    }

    resultArray[i] = digitSum.toString();
  }

  // If the final addition has a carry, add it to the extra slot we initialized for it
  if (carry > 0) {
    resultArray[maxLength] = carry.toString();
  }

  // Reverse again and combine the values for the final result
  let reversedResultArray = resultArray.reverse();

  // More terminal / Near Explorer logs
  logging.log(">>> RESULT : " + reversedResultArray.join(""))
  logging.log("-------------------------------------------------------")
  return reversedResultArray.join("");
}
```

æ—¢ç„¶æˆ‘ä»¬å·²ç»ä¿®æ”¹äº†ç¨‹åºé›†æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†éœ€è¦é‡æ–°éƒ¨ç½²è¯¥åå®šã€‚

åœ¨æ‚¨çš„ç»ˆç«¯çª—å£ä¸­:

*   é€‰æ‹©å·¦ä¾§è¿è¡Œæœ¬åœ°ä¸»æœºæœåŠ¡å™¨çš„ç¬¬ä¸€ä¸ªç»ˆç«¯é€‰é¡¹å¡
*   æŒ‰ä½`CTRL + C`åœæ­¢æœåŠ¡å™¨å¹¶æ˜¾ç¤ºå‘½ä»¤æç¤ºç¬¦
*   é”®å…¥`yarn dev`ä»¥é‡å»ºå’Œé‡æ–°éƒ¨ç½²æ‚¨ä¿®æ”¹çš„åˆåŒ

æˆ‘ä»¬çš„`Calculator`æš‚æ—¶å°±åˆ°è¿™é‡Œã€‚

# æ­¥éª¤ 3 -ä¸ºåˆåŒç¼–å†™ä¸€äº›æµ‹è¯•

ä¸€å†™å®Œä»£ç å°±æµ‹è¯•å®ƒæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œæ‰€ä»¥è¿™æ­£æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚

åœ¨æ–‡ä»¶`src/test.js`ä¸­:

*   ç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹

å®Œæˆå:

*   ç‚¹å‡»**æ–‡ä»¶** > > **å…¨éƒ¨ä¿å­˜**ä¿å­˜æ‚¨çš„ä¿®æ”¹

```
describe("Calculator", function() {
  let near;
  let contract;
  let alice;
  let bob = "bob.near";
  let eve = "eve.near";
  jasmine.DEFAULT_TIMEOUT_INTERVAL = 10000;

  // Common setup below
  beforeAll(async function () {
    near = await nearAPI.connect(nearConfig);
    accountId = nearConfig.contractName;
    contract = await near.loadContract(accountId, {
      // View methods are read only. They don't modify the state, but usually return some value.
      viewMethods: [],
      // Change methods can modify the state. But you don't receive the returned value when called.
      changeMethods: ["addLongNumbers"],
      sender: nearConfig.contractName
    });
    window.near = near;
  });

  // Multiple tests can be described below. Search Jasmine JS for documentation.
  describe("simple", function() {
    beforeAll(async function() {
    // There can be some common setup for each test.
    });

    it("adds one digit", async function() {
      const params = {
        a: "1",
        b: "3"
      };
      const result = await contract.addLongNumbers(params);
      expect(result).toBe("4");
    });

    it("should work with first string longer", async function() {
      const params = {
        a: "10",
        b: "3"
      };
      const result = await contract.addLongNumbers(params);
      expect(result).toBe("13");
    });

    it("should work with second string longer", async function() {
      const params = {
        a: "4",
        b: "15"
      };
      const result = await contract.addLongNumbers(params);
      expect(result).toBe("19");
    });

    it("should work with carry", async function() {
      const params = {
        a: "19",
        b: "22"
      };
      const result = await contract.addLongNumbers(params);
      expect(result).toBe("41");
    });

    it("should work when result is one digit longer than largest input", async function() {
      const params = {
        a: "91",
        b: "22"
      };
      const result = await contract.addLongNumbers(params);
      expect(result).toBe("113");
    });

    it("should work with really large input", async function() {
      const params = {
        a: "29348756231984613809465238956138947136497182364018246710289467102946710289467198046",
        b: "1"
      };
      const result = await contract.addLongNumbers(params);
      expect(result).toBe("29348756231984613809465238956138947136497182364018246710289467102946710289467198047");
    });
  });
});
```

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œæ‚¨çš„æ–°æµ‹è¯•ï¼

*   åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹é”®å…¥`yarn jest`

å®Œæˆåï¼Œç»ˆç«¯ä¸­å®Œæˆçš„æµ‹è¯•å°†å¦‚ä¸‹æ‰€ç¤º:

[![Jest tests running for Calculator Contract](../Images/ec8a19979486f9505c31a67b98f343f4.png)T2ã€‘](https://camo.githubusercontent.com/a8edbb036ae92de194f784e5f883ca8e4f4cc53402f047ac834c6cbe29a860ff/68747470733a2f2f646f63732e6e6561722e6f72672f646f63732f6173736574732f6a6573742d74657374732d666f722d63616c63756c61746f722d636f6e74726163742e706e67)

> è¯·è®°ä½ï¼Œæ—¥å¿—ä¸­çš„â€œåˆåŒç­¾è®¢äººâ€å’Œâ€œåˆåŒç­¾ç½²äººâ€æ˜¯ç›¸åŒçš„ã€‚è¿™ä¸€ç‚¹ä»¥åä¼šå¾ˆé‡è¦ã€‚

é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿™ä¸€ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ª UIï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯ä»åˆ«å¤„è°ƒç”¨çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­ç¬¬äºŒä¸ªå¥‘çº¦ã€‚

# æ­¥éª¤ 4 -ä¸ºè®¡ç®—å™¨å‘¼å«è€…åˆ›å»ºæ–°åˆåŒ

è®©æ‚¨æ­£åœ¨å¤„ç†çš„é€‰é¡¹å¡ä¿æŒæ‰“å¼€ï¼Œæ‚¨ç¨åå°†éœ€è¦åˆšåˆšåˆ›å»ºçš„åˆåŒçš„ IDã€‚

ID çš„å…¶ä½™éƒ¨åˆ†æ˜¯å‰ç¼€â€œdev-â€ï¼Œç±»ä¼¼äº`dev-159372XXXX-XXXXXXX`ã€‚äº‹å®ä¸Šï¼ŒåˆåŒçš„ ID åªæ˜¯ Gitpod è‡ªåŠ¨ä¸ºåˆåŒåˆ›å»ºçš„ NEAR å¸æˆ·ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºè¿‘å¹³å°[è´¦å·çš„å†…å®¹ã€‚](https://docs.near.org/docs/concepts/account)

æ‰€ä»¥è®©æˆ‘ä»¬å†åšä¸€ä¸ªèªæ˜çš„å¥‘çº¦ã€‚åœ¨*æ–°*æ ‡ç­¾æˆ–çª—å£ä¸­éµå¾ªä¸ä¹‹å‰ç›¸åŒçš„æ­¥éª¤...

*   åœ¨ [Gitpod](https://gitpod.io/#https://github.com/near-examples/token-contract-as) ä¸­æ‰“å¼€å¦ä¸€ä¸ªæ–°çš„ä»¤ç‰ŒåˆåŒé¡¹ç›®
*   æ‚¨åº”è¯¥ä¼šåœ¨çª—å£é¡¶éƒ¨çœ‹åˆ°ä¸€ä¸ª**åˆ›å»ºæ–°å·¥ä½œåŒº**æ¡†
*   ç‚¹å‡»å³ä¸Šè§’çš„**åˆ›å»º**

[![Create fresh workspace](../Images/cc45c0cf949305aa4fa7451603cc5bfe.png)T2ã€‘](https://camo.githubusercontent.com/9235c3916eacbc843b77d79698acb16b05c6ff10106bae15d68f758aada6d200/68747470733a2f2f646f63732e6e6561722e6f72672f646f63732f6173736574732f676974706f642d6372656174652d66726573682d776f726b73706163652e706e67)

æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªéƒ¨ç½²åœ¨ä¸åŒåœ°å€çš„å®Œå…¨ç‹¬ç«‹çš„å¥‘çº¦ï¼Œä»¥å±•ç¤ºè·¨å¥‘çº¦è°ƒç”¨çš„èƒ½åŠ›ã€‚

# æ­¥éª¤ 5 -ç¼–å†™è®¡ç®—å™¨è°ƒç”¨è€…ä»£ç 

æˆ‘ä»¬å¸Œæœ›å®ç°è¿™æ ·çš„ä»£ç ï¼Œå®ƒå®é™…ä¸Šå°†æ•°å­—ä¼ é€’ç»™æˆ‘ä»¬æ­£åœ¨è°ƒç”¨çš„å¥‘çº¦ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„`callAddNumbers`å‡½æ•°å¹¶æ·»åŠ ç®¡é“æ¥å®ç°è¿™ä¸ªå‡½æ•°ã€‚

è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å‡ æ ·ä¸œè¥¿:

*   ä¸ºäº†ä»ä¸€ä¸ªå¥‘çº¦å‘å¦ä¸€ä¸ªå¥‘çº¦å‘é€ä¸¤æ¡æ•°æ®(æˆ‘ä»¬æƒ³è¦æ·»åŠ çš„ä¸¤ä¸ªæ•°å­—)ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„*æ¨¡å‹*ä¾›æˆ‘ä»¬çš„å¥‘çº¦ä½¿ç”¨ã€‚å°†ä¼šæ˜¯ä¸€ä¸ªæˆ‘ä»¬ç”¨æ¥ç¼–ç æˆ‘ä»¬è¦å‘é€çš„å‚æ•°çš„ç±»ã€‚
*   è·¨å¥‘çº¦è°ƒç”¨æ€»æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤ï¼Œä¸ºäº†ä»å¦ä¸€ä¸ªå¥‘çº¦è·å–è¿”å›å€¼ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨æ¥è‡ª`near-sdk-as`çš„æœ¬æœº`ContractPromise`ç±»ã€‚
*   åˆ°`CalculatorAPI`ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ƒå°†é€šè¿‡ä¸€ä¸ª`add`æ–¹æ³•å‘é€æˆ‘ä»¬æƒ³è¦æ·»åŠ åˆ°å¦ä¸€ä¸ªå¥‘çº¦ä¸­çš„æ•°å­—
*   `callAddNumbers`ï¼Œè¿™ä¸ªå‡½æ•°å°†è°ƒç”¨æˆ‘ä»¬åˆ›å»ºçš„`CalculatorAPI`æ–¹æ³•æ¥æ·»åŠ æ•°å­—

è®©æˆ‘ä»¬é¦–å…ˆä»åˆ›å»ºæ¨¡å‹å¼€å§‹ã€‚

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`assembly/model.ts`:

*   ç‚¹å‡»æµè§ˆå™¨å·¦ä¾§çš„`assembly`æ–‡ä»¶å¤¹
*   ç„¶åç‚¹å‡»**æ–‡ä»¶**>T5**æ–°å»ºæ–‡ä»¶**
*   è¾“å…¥`model.ts`ç„¶åç‚¹å‡»**ç¡®å®š**
*   å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶/ç²˜è´´åˆ°è¿™ä¸ªæ–°æ–‡ä»¶ä¸­
*   ç‚¹å‡»**æ–‡ä»¶**>T5**ä¿å­˜**

```
@nearBindgen
export class AddArgs {
  a: string;
  b: string;
}
```

è¿™å°†å…è®¸æˆ‘ä»¬å°†å‚æ•°ç¼–ç ä¸ºå•ä¸ªå€¼åœ¨å¥‘çº¦ä¹‹é—´å‘é€ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»º APIï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è°ƒç”¨æˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„å¥‘çº¦ã€‚

åœ¨æ–‡ä»¶`assembly/main.ts`ä¸­ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹:

```
import { context, storage, logging, ContractPromise } from "near-sdk-as";
import { AddArgs } from "./model";
```

æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­æ³•`"./model"`ä»åˆšåˆšåˆ›å»ºçš„æ¨¡å‹ä¸­å¯¼å…¥`AddArgs`ï¼Œå¹¶ä¸”ä»`near-sdk-as`ä¸­å¯¼å…¥`ContractPromise`ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–¹æ³•`add`ï¼Œå®ƒæ¥å—æˆ‘ä»¬æƒ³è¦æ·»åŠ çš„å­—ç¬¦ä¸²å¹¶è¿”å›ä¸€ä¸ª`ContractPromise`ã€‚

æˆ‘ä»¬è¿˜ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„`AddArgs`æ¨¡å‹æ¥æ‰“åŒ…æˆ‘ä»¬æƒ³è¦å‘é€ç»™å¦ä¸€ä¸ªåˆåŒçš„å­—ç¬¦ä¸²ã€‚å½“æˆ‘ä»¬è°ƒç”¨`args.encode()`æ—¶ï¼Œå®ƒå¾ˆåƒç±»ä¼¼äº`JSON.stringify(args)`çš„ä¸œè¥¿ï¼Œå…è®¸æˆ‘ä»¬å‘é€è¿™äº›æ•°æ®ã€‚

*ä¸ºäº†åˆ›é€ è¿™ä¸ª`ContractPromise`ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“:*

*   æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„åˆåŒçš„ IDã€‚ä½ éœ€è¦æŠŠè¿™ä¸ªæ¢æˆä½ è‡ªå·±çš„ã€‚
*   æ— è®ºæˆ‘ä»¬è¯•å›¾åœ¨`Calculator`å¥‘çº¦ä¸Šè°ƒç”¨ä»€ä¹ˆå‡½æ•°ã€‚

> åœ¨æ–‡ä»¶`assembly/main.ts`ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ–‡ä»¶ä¸­:

```
const OTHER_CONTRACT = "dev-REPLACE_THIS_IDENTIFIER";

export class CalculatorApi {
  add(a: string, b: string): ContractPromise {
    let args: AddArgs = { a, b };
    let promise = ContractPromise.create(OTHER_CONTRACT, "addLongNumbers", args.encode(), 100000000000000);
    logging.log("OTHER_CONTRACT: " + "(" + OTHER_CONTRACT + ")")
    return promise;
  }
}
```

*(æœ‰å…³ä½¿ç”¨`ContractPromise`è¿›è¡Œè·¨åˆåŒè°ƒç”¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹*[*contract promise*](https://near.github.io/near-sdk-as/classes/_sdk_core_assembly_contract_.contractpromise.html)*å’Œ*[*contract promise result*](https://near.github.io/near-sdk-as/classes/_sdk_core_assembly_contract_.contractpromiseresult.html)

æé†’ä¸€ä¸‹ï¼Œä½¿ç”¨ä¹‹å‰çš„åˆåŒ(æ‚¨ä¹‹å‰æ‰“å¼€çš„é€‰é¡¹å¡)ï¼Œæ‰¾åˆ°åˆåŒçš„ IDã€‚ä½ å°†ç”¨è¿™ä¸ªæ¥ä»£æ›¿`dev-REPLACE_THIS_IDENTIFIER`ã€‚

æ‚¨å¯ä»¥åœ¨`neardev/dev-account.env`ä¸­æ‰¾åˆ°æ‚¨çš„åˆåŒ IDã€‚æ­¤å¤–ï¼Œæ‚¨å°†åœ¨è¿è¡ŒæœåŠ¡å™¨çš„ç¬¬ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­çœ‹åˆ°æ‚¨çš„åˆåŒ IDã€‚åœ¨åº•éƒ¨ä¼šæœ‰ä¸€è¡Œå†™ç€:â€œå®Œæˆéƒ¨ç½²åˆ° dev-1594333XXXXXX-XXXXXXXâ€ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„`CalculatorApi`ã€‚

åœ¨æ–‡ä»¶`assembly/main.ts`ä¸­ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ–‡ä»¶ä¸­:

```
export function calculate(a: string , b: string): void {
  let calculator = new CalculatorApi();
  let promise = calculator.add(a, b);
  promise.returnAsResult();
}
```

æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸ªå‡½æ•°è¿”å›`void`ï¼Œè¿™æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå¥‘çº¦è¿”å›çš„æ˜¯ä¸€ä¸ªæ‰¿è¯ºã€‚è¿™æ˜¯å› ä¸ºå®ƒåœ¨åˆ«å¤„è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°ï¼Œç¼–è¯‘å™¨è®¤ä¸ºå®ƒæ˜¯æ— æ•ˆçš„ã€‚

(åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§æƒ…å†µä¼šæœ‰æ‰€æ”¹å˜ã€‚)

ç°åœ¨ä¿å­˜æ‚¨çš„æ›´æ”¹å¹¶é‡æ–°éƒ¨ç½²åˆåŒ

*   ç‚¹å‡»**æ–‡ä»¶**>T5**ä¿å­˜**

ç„¶åå¯¼èˆªåˆ°æ‚¨çš„ç»ˆç«¯çª—å£

*   é€‰æ‹©å·¦ä¾§è¿è¡Œæœ¬åœ°ä¸»æœºæœåŠ¡å™¨çš„ç¬¬ä¸€ä¸ªç»ˆç«¯é€‰é¡¹å¡
*   æŒ‰ä½`CTRL + C`åœæ­¢æœåŠ¡å™¨å¹¶æ˜¾ç¤ºå‘½ä»¤æç¤ºç¬¦
*   é”®å…¥`yarn dev`ä»¥é‡å»ºå’Œé‡æ–°éƒ¨ç½²æ‚¨ä¿®æ”¹çš„åˆåŒ

# ç¬¬ 6 æ­¥-æ›´å¤šçš„æµ‹è¯•ï¼

è®©æˆ‘ä»¬ç¡®ä¿äº‹æƒ…æŒ‰é¢„æœŸè¿›è¡Œã€‚

åœ¨æ–‡ä»¶`src/test.js`ä¸­:

*   ç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹

```
const getConfig = require('./config');
let nearConfig = getConfig("development");
require('dotenv').config({ path: '/workspace/token-contract-as/neardev/dev-account.env' })

describe("CalculatorAPI", function() {
  let near;
  let contract;
  jasmine.DEFAULT_TIMEOUT_INTERVAL = 10000;

  // Common setup below
  beforeAll(async function () {
    near = await nearAPI.connect({
    deps: {
     keyStore: new nearAPI.keyStores.UnencryptedFileSystemKeyStore('../../../home/gitpod/.near-credentials')
    },
    ...nearConfig
  })
    accountId = process.env.CONTRACT_NAME;
    contract = await near.loadContract(accountId, {
    // NOTE: This configuration only needed while NEAR is still in development
    // View methods are read only. They don't modify the state, but usually return some value.
    viewMethods: [],
    // Change methods can modify the state. But you don't receive the returned value when called.
    changeMethods: ["calculate", "addLongNumbers"],
    sender: process.env.CONTRACT_NAME
    });
  });

  // Multiple tests can be described below. Search Jasmine JS for documentation.
  describe("simple", function() {
    beforeAll(async function() {
    // There can be some common setup for each test.
    });

    it("add one digit", async function() {
      const params = {
        a: "1",
        b: "99"
      };

      const result = await contract.calculate(params);
      expect(result).toBe("100");
    });
  });
});
```

å®Œæˆå:

*   ç‚¹å‡»**æ–‡ä»¶** > > **å…¨éƒ¨ä¿å­˜**ä¿å­˜æ‚¨çš„ä¿®æ”¹

ç°åœ¨è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼

åœ¨ Gitpod ä¸­:

*   ç‚¹å‡»**ç»ˆç«¯** > > **æ–°å»ºç»ˆç«¯**

åœ¨ Gitpod åº•éƒ¨æ‰“å¼€çš„æ–°é€‰é¡¹å¡ä¸­ï¼Œåœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹é”®å…¥`yarn jest`ã€‚

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„æˆåŠŸæµ‹è¯•:

[![Cross contract call Jest test](../Images/5ced035e43248e10106d402cf2172bc0.png)T2ã€‘](https://camo.githubusercontent.com/ebf9e9252c6ad178589dfaf64c51fbda3dfa4431202404a1d2577a984e720ee5/68747470733a2f2f646f63732e6e6561722e6f72672f646f63732f6173736574732f63726f73732d636f6e74726163742d63616c6c2d6a6573742d746573742e706e67)

è¿˜è®°å¾—æˆ‘ä»¬æ³¨æ„åˆ°åœ¨æµ‹è¯•ç¯å¢ƒä¸­â€œè¢«è°ƒç”¨çš„åˆåŒâ€å’Œâ€œåˆåŒç­¾ç½²è€…â€æ˜¯ç›¸åŒçš„å—ï¼Ÿè¯·æ³¨æ„ï¼Œå®ƒä»¬ç°åœ¨ä¸åŒäº†ï¼ä½ èƒ½ç†è§£è¿™æ„å‘³ç€ä»€ä¹ˆå—ï¼Ÿ

# ç»“è®º

æˆ‘ä»¬å®Œäº‹äº†ã€‚

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æµè§ˆå™¨é™„è¿‘çš„[æŸ¥çœ‹æ‚¨çš„è´¦æˆ·å’Œäº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯ã€‚](https://explorer.testnet.near.org/)

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¥‘çº¦è°ƒç”¨å¦ä¸€ä¸ªå¥‘çº¦çš„ä¾‹å­ï¼Œä½†æ˜¯è¿™å¸¦æ¥äº†å¾ˆå¤šæœºä¼šã€‚ç°åœ¨ï¼Œçœ‹çœ‹ä½ èƒ½å¦é€šè¿‡æŸ¥çœ‹æˆ‘ä»¬çš„[å…¶ä»–æ•™ç¨‹](https://docs.near.org/docs/roles/developer/tutorials/introduction)å’Œä¿®æ”¹`src/main.js`å’Œ`src/index.html`æ¥å¼„æ¸…æ¥šå¦‚ä½•æ„å»ºå‰ç«¯ã€‚

ä½ å·²ç»å‡†å¤‡å¥½è·¨è¶Šä½ æƒ³è¦çš„é‚£ä¹ˆå¤šåˆåŒäº†ï¼ç¼–ç å¿«ä¹ï¼<g-emoji class="g-emoji" alias="rocket" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f680.png">ğŸš€</g-emoji>

å¦‚æœæ‚¨åœ¨å­¦ä¹ æœ¬æ•™ç¨‹æ—¶æœ‰ä»»ä½•å›°éš¾ï¼Œæˆ–è€…åªæ˜¯æƒ³ä¸æˆ‘ä»¬è®¨è®º NEAR techï¼Œæ‚¨å¯ä»¥ä»Šå¤©å°± [**åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒº**](https://figment.io/devchat) ï¼