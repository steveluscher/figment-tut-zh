# ä»‹ç»

> åŸæ–‡:[https://github . com/fig ment-networks/learn-tutorials/blob/master/cosmos/build-a-polling-app . MD](https://github.com/figment-networks/learn-tutorials/blob/master/cosmos/build-a-polling-app.md)

[**åŸæ–‡æ•™ç¨‹å¯ä»¥åœ¨ Cosmos SDK æ–‡æ¡£è¿™é‡Œæ‰¾åˆ°**](https://tutorials.cosmos.network/starport-polling-app/) ã€‚

[![Application screenshot](../Images/86bb7e8a73868729dde3fec77ba6df8c.png)T2ã€‘](https://camo.githubusercontent.com/0e6ffef1157cf4ecfd8aa497b19cca105772ebc198dfeb9f16a093d96c41038a/68747470733a2f2f7475746f7269616c732e636f736d6f732e6e6574776f726b2f6173736574732f696d672f312e38633836646630362e706e67)

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æŠ•ç¥¨åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­ç™»å½•ï¼Œåˆ›å»ºæŠ•ç¥¨ï¼ŒæŠ•ç¥¨å’ŒæŸ¥çœ‹æŠ•ç¥¨ç»“æœã€‚åˆ›å»ºä¸€ä¸ªæŠ•ç¥¨å°†èŠ±è´¹ 200 ä¸ªä»£å¸ï¼ŒæŠ•ç¥¨æ˜¯å…è´¹çš„ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªæ“ä½œåªå¯¹å·²ç™»å½•çš„ç”¨æˆ·å¯ç”¨ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Starport](https://github.com/tendermint/starport) ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ„å»ºåŒºå—é“¾çš„å·¥å…·ã€‚[å®‰è£… Starport](https://github.com/tendermint/starport#installation) å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæŠ•ç¥¨é¡¹ç›®:

```
starport app github.com/alice/voter 
```

Starport `app`å‘½ä»¤å°†åœ¨`voter`ç›®å½•ä¸­ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ­å»ºä¸€ä¸ªé¡¹ç›®ç»“æ„ã€‚ç¡®ä¿ç”¨ä½ çš„ GitHub ç”¨æˆ·åæ›¿æ¢`alice`ã€‚

åœ¨`voter`ç›®å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ ä¸ªæ–‡ä»¶å’Œç›®å½•:

*   åŒ…å«è¿æ¥åº”ç”¨ç¨‹åºæ‰€æœ‰æ´»åŠ¨éƒ¨åˆ†çš„æ–‡ä»¶ã€‚
*   `cmd`è´Ÿè´£`voterd`å’Œ`votercli`ç¨‹åºï¼Œå®ƒä»¬åˆ†åˆ«å…è®¸ä½ å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶ä¸ä¹‹äº¤äº’ã€‚
*   `frontend`åŒ…å«ä½ çš„åº”ç”¨ç¨‹åºçš„ç½‘ç»œç”¨æˆ·ç•Œé¢ï¼Œå¯¹ä½ åœ¨ä¸Šé¢æˆªå›¾ä¸­çœ‹åˆ°çš„ä¸€åˆ‡è´Ÿè´£ã€‚
*   åŒ…å«äº†ä½ çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç»„æˆéƒ¨åˆ†:æ¨¡å—ã€‚ç°åœ¨æˆ‘ä»¬åªæœ‰ä¸€ä¸ª:`voter`ã€‚

æˆ‘ä»¬é¡¹ç›®çš„ç›®å½•åŒ…å«æ„å»ºå’Œå¯åŠ¨åŸºäºåŒºå—é“¾çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä»£ç ã€‚è®©æˆ‘ä»¬è¯•ç€åœ¨é¡¹ç›®ä¸­è¿è¡Œ starport serve æ¥å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº:

```
starport serve 
```

```
ğŸ“¦ Installing dependencies...
ğŸš§ Building the application... 
ğŸ’« Initializing the chain...
ğŸ™‚ Created an account. Password (mnemonic): truth tooth front fabric sing divert zone milk fatigue urban hundred certain sorry merge milk treat foam coral absent run stand invest monkey aspect
ğŸ™‚ Created an account. Password (mnemonic): famous faculty genre finger build fantasy squirrel icon carbon absent sleep weather fold piece thank earth pioneer excite trim cupboard grow pumpkin bundle auction
ğŸŒ Running a Cosmos 'voter' app with Tendermint.

ğŸš€ Get started: http://localhost:12345/ 
```

æ­å–œä½ ï¼ç°åœ¨ï¼Œåªéœ€ä¸¤ä¸ªå‘½ä»¤ï¼Œæ‚¨çš„è®¡ç®—æœºä¸Šå°±è¿è¡Œäº†ä¸€ä¸ªåŒºå—é“¾åº”ç”¨ç¨‹åºã€‚å®ƒè¿˜æ²¡æœ‰åšä»»ä½•äº‹æƒ…ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­åŠªåŠ›ã€‚

æˆ‘ä»¬çš„æŠ•ç¥¨åº”ç”¨ç¨‹åºæœ‰ä¸¤ç§ç±»å‹çš„å®ä½“:æŠ•ç¥¨å’ŒæŠ•ç¥¨ã€‚è½®è¯¢æ˜¯ä¸€ç§å…·æœ‰ä¸€ä¸ª`title`å’Œä¸€ä¸ª`options`åˆ—è¡¨çš„ç±»å‹ã€‚

# æ·»åŠ æŠ•ç¥¨

```
starport type poll title options 
```

è¯¥å‘½ä»¤ç”Ÿæˆäº†å¤„ç†`poll`é¡¹åˆ›å»ºçš„ä»£ç ã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œ`starport serve`å¹¶è®¿é—® [http://localhost:8080](http://localhost:8080/) ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€ä¸ªç”¨äºåˆ›å»ºæŠ•ç¥¨çš„è¡¨å•ã€‚é‡å»ºåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥è¯·ç¨ç­‰å‡ ç§’é’Ÿã€‚

[![Application screenshot](../Images/145815d662bf55a529d03225a39921e1.png)T2ã€‘](https://camo.githubusercontent.com/21387659d5e367f387c046e63fa677d5b75bcfbdc151284194e69191408943da/68747470733a2f2f7475746f7269616c732e636f736d6f732e6e6574776f726b2f6173736574732f696d672f322e37663839396130332e706e67)

ä½¿ç”¨æ§åˆ¶å°ä¸Šæ‰“å°çš„å¯†ç ä¹‹ä¸€ç™»å½•ï¼Œå¹¶å°è¯•åˆ›å»ºä¸€ä¸ªæŠ•ç¥¨ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°å¯¹è±¡è¢«åˆ›å»ºå¹¶æ˜¾ç¤ºåœ¨è¡¨å•ä¸Šæ–¹ã€‚æ‚¨å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šï¼

ç„¶è€Œï¼Œè¿™å¹¶ä¸å®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„éœ€è¦ã€‚æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿæ·»åŠ é€‰é¡¹å­—æ®µ(å¹¶å°†å®ƒä»¬å­˜å‚¨ä¸ºæ•°ç»„)ï¼Œå¹¶ä¸”å®ƒä»¬åº”è¯¥æ˜¾ç¤ºä¸ºäº¤äº’å¼æŒ‰é’®ã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç”±`starport type`å‘½ä»¤ä¿®æ”¹çš„ä¸€äº›æ–‡ä»¶ã€‚

**T2`x/voter/types/TypePoll.go`**

è¯¥æ–‡ä»¶åŒ…å«`Poll`ç±»å‹çš„å®šä¹‰ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªæŠ•ç¥¨æœ‰ä¸¤ä¸ªå­—æ®µ(åˆ›å»ºè€…å’Œ ID)ï¼Œè¿™æ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼Œè¿˜æœ‰ä¸¤ä¸ªå­—æ®µ(æ ‡é¢˜å’Œé€‰é¡¹)æ˜¯æˆ‘ä»¬å®šä¹‰çš„ã€‚æ—¢ç„¶æˆ‘ä»¬æƒ³è®©`Options`æˆä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œ**ç”¨`[]string`** æ›¿æ¢`string`

**T2`x/voter/types/MsgCreatePoll.go`**

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºè½®è¯¢çš„æ¶ˆæ¯ã€‚

ä¸ºäº†å‘åŒºå—é“¾å†™å…¥ä»»ä½•å†…å®¹æˆ–æ‰§è¡Œä»»ä½•å…¶ä»–çŠ¶æ€è½¬æ¢ï¼Œå®¢æˆ·ç«¯(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ web app)å‘[HTTP://localhost:1317/voter/poll](http://localhost:1317/voter/poll)ç«¯ç‚¹å¤„ç†ç¨‹åºå‘å‡ºä¸€ä¸ªå¸¦æœ‰æ ‡é¢˜å’Œé€‰é¡¹çš„ HTTP POST è¯·æ±‚ï¼Œç«¯ç‚¹å¤„ç†ç¨‹åºåœ¨`x/voter/client/rest/txPoll.go`ä¸­å®šä¹‰ã€‚è¯¥å¤„ç†ç¨‹åºåˆ›å»ºä¸€ä¸ªåŒ…å«æ¶ˆæ¯æ•°ç»„çš„æœªç­¾åäº‹åŠ¡ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œå¹¶å°†å…¶å‘é€åˆ°[http://localhost:1317/txs](http://localhost:1317/txs)ã€‚ç„¶åï¼Œåº”ç”¨ç¨‹åºé€šè¿‡å°†æ¯æ¡æ¶ˆæ¯å‘é€åˆ°ç›¸åº”çš„å¤„ç†ç¨‹åºæ¥å¤„ç†äº‹åŠ¡ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`x/voter/handlerMessageCreatePoll.go`ã€‚ç„¶åï¼Œä¸€ä¸ªå¤„ç†ç¨‹åºè°ƒç”¨`x/voter/keeper/poll.go`ä¸­å®šä¹‰çš„`CreatePoll`å‡½æ•°ï¼Œå°†è½®è¯¢æ•°æ®å†™å…¥å­˜å‚¨ã€‚

å›åˆ°`MsgCreatePoll.go`ï¼Œæˆ‘ä»¬éœ€è¦å°†é€‰é¡¹å­˜å‚¨ä¸ºåˆ—è¡¨è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚åœ¨`MsgCreatePoll`ç»“æ„ä¸­å°†`Options string`æ›¿æ¢ä¸º`Options []string`ï¼Œåœ¨`NewMsgCreatePoll`å‡½æ•°çš„å‚æ•°ä¸­å°†`options string`æ›¿æ¢ä¸º`options []string`ã€‚

**T2`x/voter/client/rest/txPoll.go`**

åœ¨`createPollRequest`ç»“æ„ä¸­å°†`Options string`æ›¿æ¢ä¸º`Options []string`ã€‚

**T2`x/voter/client/cli/txPoll.go`**

ç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚

```
votercli tx voter create-poll "Text editors" "Emacs" "Vim" --from user1 
```

è¯¥å‘½ä»¤å°†ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰â€œåˆ›å»ºè½®è¯¢â€æ¶ˆæ¯çš„äº‹åŠ¡ï¼Œä½¿ç”¨ç§é’¥`user1`(é»˜è®¤åˆ›å»ºçš„ä¸¤ä¸ªç”¨æˆ·ä¹‹ä¸€)å¯¹å…¶è¿›è¡Œç­¾åï¼Œå¹¶å°†å…¶å¹¿æ’­åˆ°åŒºå—é“¾ã€‚

æˆ‘ä»¬éœ€è¦åšçš„å”¯ä¸€ä¿®æ”¹æ˜¯æ›´æ”¹ä»æ§åˆ¶å°è¯»å–å‚æ•°çš„ä¸€è¡Œä»£ç :`argsOptions := args[1:len(args)]`ã€‚è¿™å°†å‡è®¾ç¬¬ä¸€ä¸ªå‚æ•°ä¹‹åçš„æ‰€æœ‰å‚æ•°éƒ½ä»£è¡¨ä¸€ä¸ªé€‰é¡¹åˆ—è¡¨ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåšäº†æ‰€æœ‰å¿…è¦çš„æ›´æ”¹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚

```
starport serve 
```

# å‰ç«¯åº”ç”¨ç¨‹åº

Starport ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç”Ÿæˆäº†ä¸€ä¸ªåŸºæœ¬çš„å‰ç«¯ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ [Vue.js](https://vuejs.org/) framework ä¸ [Vuex](https://vuex.vuejs.org/) ä¸€èµ·ç”¨äºçŠ¶æ€ç®¡ç†ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ç‰¹æ€§éƒ½æ˜¯é€šè¿‡ HTTP API å…¬å¼€çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä»»ä½•è¯­è¨€æˆ–æ¡†æ¶æ¥æ„å»ºå®¢æˆ·ç«¯ã€‚

æˆ‘ä»¬æœ€æ„Ÿå…´è¶£çš„æ˜¯`frontend/src/views`ç›®å½•ï¼Œå®ƒåŒ…å«æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„é¡µé¢æ¨¡æ¿ï¼Œ`frontend/src/store/index.js`å¤„ç†å‘é€äº‹åŠ¡å’Œä»æˆ‘ä»¬çš„åŒºå—é“¾å’Œ`frontend/src/components`ç›®å½•æ¥æ”¶æ•°æ®ï¼Œåè€…åŒ…å«æŒ‰é’®å’Œè¡¨å•ç­‰ç»„ä»¶ã€‚

åœ¨`frontend/src/store/index.js`å†…éƒ¨ï¼Œæˆ‘ä»¬å¯¼å…¥äº† [CosmJS](https://github.com/cosmwasm/cosmjs) ï¼Œä¸€ä¸ªç”¨äºå¤„ç†é’±åŒ…ã€åˆ›å»ºã€ç­¾ç½²å’Œå¹¿æ’­äº¤æ˜“çš„åº“ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ª Vuex å•†åº—ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`entitySubmit`å‡½æ•°å‘æˆ‘ä»¬çš„åŒºå—é“¾å‘é€æ•°æ®(å°±åƒä¸€ä¸ª JSON è¡¨ç¤ºä¸€ä¸ªæ–°åˆ›å»ºçš„æŠ•ç¥¨)ï¼Œä½¿ç”¨`entityFetch`è¯·æ±‚ä¸€ä¸ªæŠ•ç¥¨åˆ—è¡¨ï¼Œä½¿ç”¨`accountUpdate`è·å–å…³äºä»¤ç‰Œä½™é¢çš„ä¿¡æ¯ã€‚

**T2`frontend/src/view/Index.vue`**

å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦é»˜è®¤çš„è¡¨å•ç»„ä»¶ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªæ–°ç»„ä»¶`<poll-form />`æ›¿æ¢`frontend/src/views/Index.vue`ä¸­çš„`<type-list />`ï¼Œè¿™ä¸ªæ–°ç»„ä»¶å°†åœ¨`frontend/src/components/PollForm.vue`çš„ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­åˆ›å»ºã€‚

**T2`frontend/src/components/PollForm.vue`**

```
<template>
    <div>
      <app-input placeholder="Title" v-model="title" />
      <div v-for="option in options">
         <app-input placeholder="Option" v-model="option.title" />
      </div>
      <app-button @click.native="add">Add option</app-button>
      <app-button @click.native="submit">Create poll</app-button>
    </div>
</template>

<script>
export default {
  data() {
    return {
      title: "",
      options: []
     };
  },
  methods: {
    add() {
      this.options = [...this.options, { title: "" }];
    },
    async submit() {
      const payload = {
        type: "poll",
        body: {
          title: this.title,
          options: this.options.map(o => o.title)
        }
      };
      await this.$store.dispatch("entitySubmit", payload);
			  await this.$store.dispatch("entityFetch", payload);
			  await this.$store.dispatch("accountUpdate");
    }
  }
};
</script>      
```

`add()`åŠŸèƒ½:

```
<script>
  add() { 
    this.options = [...this.options, { title: "" }]; 
  }, 
  async submit() { const payload = { type: "poll", body: { title: this.title, options: this.options.map(o => o.title) } }; 
await this.$store.dispatch\("entitySubmit", payload\); 
await this.$store.dispatch\("entityFetch", payload\); 
await this.$store.dispatch\("accountUpdate"\); } } };
</script>
```

æŠ•ç¥¨è¡¨å•ç»„ä»¶æœ‰ä¸€ä¸ªæ ‡é¢˜è¾“å…¥å’Œä¸€ä¸ªé€‰é¡¹è¾“å…¥åˆ—è¡¨ã€‚ç‚¹å‡»â€œæ·»åŠ é€‰é¡¹â€æŒ‰é’®æ·»åŠ ä¸€ä¸ªç©ºè¾“å…¥ï¼Œç‚¹å‡»â€œåˆ›å»ºæŠ•ç¥¨â€å‘é€ã€åˆ›å»ºå’Œå¹¿æ’­ä¸€ä¸ªå¸¦æœ‰â€œåˆ›å»ºæŠ•ç¥¨â€æ¶ˆæ¯çš„äº¤æ˜“ã€‚

åˆ·æ–°é¡µé¢ï¼Œä½¿ç”¨å¯†ç ç™»å½•å¹¶åˆ›å»ºæ–°çš„æŠ•ç¥¨ã€‚å¤„ç†ä¸€ç¬”äº¤æ˜“éœ€è¦å‡ ç§’é’Ÿã€‚ç°åœ¨ï¼Œå¦‚æœæ‚¨è®¿é—®[http://localhost:1317/voter/poll](http://localhost:1317/voter/poll)ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæŠ•ç¥¨åˆ—è¡¨(è¿™ä¸ªç«¯ç‚¹åœ¨`x/voter/rest/queryPoll.go`ä¸­å®šä¹‰):

```
{
  "height": "0",
  "result": [
    {
      "creator": "cosmos19qqa7j73735w4pcx9mkkaxr00af7p432n62tv6",
      "id": "826477ab-0005-4e68-8031-19758d331681",
      "title": "A poll title",
      "options": ["First option", "The second option"]
    }
  ]
},
{ 
  "height": "0", 
  "result": [ 
    { 
      "creator": "cosmos19qqa7j73735w4pcx9mkkaxr00af7p432n62tv6", 
      "id": "826477ab-0005-4e68-8031-19758d331681", 
      "title": "A poll title", 
      "options": ["First option", "The second option"]
    } 
  ] 
}
```

# æ·»åŠ æŠ•ç¥¨

æŠ•ç¥¨ç±»å‹åŒ…å«æŠ•ç¥¨ ID å’Œå€¼(æ‰€é€‰é€‰é¡¹çš„å­—ç¬¦ä¸²è¡¨ç¤º)ã€‚

```
starport type vote pollID value 
```

**T2`frontend/src/views/Index.vue`**

å°†`<poll-list />`æ·»åŠ åˆ°æŠ•ç¥¨è¡¨å•ç»„ä»¶åçš„`frontend/src/view/Index.vue`æ–‡ä»¶ä¸­ã€‚ç„¶ååœ¨`frontend/src/components/PollList.vue`åˆ¶ä½œä¸€ä¸ªæ–°ç»„ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

**T2`frontend/src/components/PollList.vue`**

```
<template>
  <div>
    <div v-for="poll in polls">
      <app-text type="h2">Poll {{ poll.title }}</app-text>
      <app-radio-item
        @click.native="submit(poll.id, option)"
        v-for="option in poll.options"
        :value="option"
      />
      <app-text type="subtitle">Results: {{ results(poll.id) }}</app-text>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      selected: ""
    };
  },
  computed: {
    polls() {
      return this.$store.state.data.poll || [];
    },
    votes() {
      return this.$store.state.data.vote || [];
    }
  },
  methods: {
    results(id) {
      const results = this.votes.filter(v => v.pollID === id);
      return this.$lodash.countBy(results, "value");
    },
    async submit(pollID, value) {
      const type = { type: "vote" };
      const body = { pollID, value };
      await this.$store.dispatch("entitySubmit", { ...type, body });
      await this.$store.dispatch("entityFetch", type);
    }
  }
};
</script>
```

`PollList`ç»„ä»¶ä»¥æŒ‰é’®çš„å½¢å¼åˆ—å‡ºäº†æ¯ä¸ªæŠ•ç¥¨çš„æ‰€æœ‰é€‰é¡¹ã€‚é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ä¼šè§¦å‘ä¸€ä¸ª`submit`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¹¿æ’­ä¸€ä¸ªå¸¦æœ‰â€œcreate voteâ€æ¶ˆæ¯çš„äº‹åŠ¡ï¼Œå¹¶ä»æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå–å›æ•°æ®ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°ä¸ç¬¬ä¸€ä¸ªæˆªå›¾ç›¸åŒçš„ç”¨æˆ·ç•Œé¢ã€‚å°è¯•åˆ›å»ºæ°‘æ„æµ‹éªŒå’ŒæŠ•ç¥¨ã€‚æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œä¸€æ¬¡æŠ•ç¥¨å¯ä»¥æŠ•å¤šå¼ ç¥¨ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çº æ­£è¿™ç§è¡Œä¸ºã€‚

# åªæŠ•ä¸€æ¬¡ç¥¨

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»äº†è§£æ•°æ®æ˜¯å¦‚ä½•å­˜å‚¨åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­çš„ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®å­˜å‚¨æƒ³è±¡æˆä¸€ä¸ªæŒ‰å­—å…¸é¡ºåºæ’åˆ—çš„é”®å€¼å­˜å‚¨ã€‚æ‚¨å¯ä»¥å¾ªç¯æ¡ç›®ï¼ŒæŒ‰å…³é”®å­—å‰ç¼€è¿‡æ»¤ï¼Œæ·»åŠ ã€æ›´æ–°å’Œåˆ é™¤æ¡ç›®ã€‚å°†å•†åº—å½¢è±¡åŒ–ä¸º JSON æ›´å®¹æ˜“:

```
{
  "poll-1a266241-c58d-4cbc-bacf-aaf939c95de1": {
    "creator": "cosmos15c6g4v5yvq0hy3kjllyr9ytlx45r936y0m6dm6",
    "id": "1a266241-c58d-4cbc-bacf-aaf939c95de1",
    "title": "Soft drinks",
    "options": ["Coca-Cola", "Pepsi"]
  },
  "vote-cd63b110-2959-45b0-8ce3-afa2fb7a5652": {
    "creator": "cosmos15c6g4v5yvq0hy3kjllyr9ytlx45r936y0m6dm6",
    "id": "cd63b110-2959-45b0-8ce3-afa2fb7a5652",
    "pollID": "1a266241-c58d-4cbc-bacf-aaf939c95de1",
    "value": "Pepsi"
  }
}
```

`poll-`å’Œ`vote-`éƒ½æ˜¯å‰ç¼€ã€‚å®ƒä»¬è¢«æ·»åŠ åˆ°é”®ä¸­ä»¥ä¾¿äºè¿‡æ»¤ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå‰ç¼€åœ¨`x/voter/key.go`ä¸­å®šä¹‰ã€‚

æ¯å½“ç”¨æˆ·æŠ•ç¥¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„â€œcreate voteâ€æ¶ˆæ¯ç”±ä¸€ä¸ªå¤„ç†ç¨‹åºå¤„ç†ï¼Œå¹¶è¢«ä¼ é€’ç»™ç®¡ç†å‘˜ã€‚Keeper é‡‡ç”¨ä¸€ä¸ª`vote-`å‰ç¼€ï¼Œæ·»åŠ ä¸€ä¸ª UUID(å¯¹æ¯æ¡æ¶ˆæ¯éƒ½æ˜¯å”¯ä¸€çš„),å¹¶ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå¯†é’¥ã€‚

**T2`x/voter/keeper/vote.go`**

```
key := []byte(types.VotePrefix + vote.ID)
```

è¿™äº›å­—ç¬¦ä¸²æ˜¯å”¯ä¸€çš„ï¼Œæˆ‘ä»¬å¾—åˆ°é‡å¤çš„æŠ•ç¥¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ç®¡ç†å‘˜é€šè¿‡é€‰æ‹©æ­£ç¡®çš„å¯†é’¥æ¥è®°å½•æ¯ä¸€æ¬¡æŠ•ç¥¨ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ•ç¥¨ ID å’Œåˆ›å»ºè€…åœ°å€æ¥ç¡®ä¿ä¸€ä¸ªç”¨æˆ·æ¯æ¬¡æŠ•ç¥¨åªèƒ½æŠ•ä¸€ç¥¨ã€‚

```
key := []byte(types.VotePrefix + vote.PollID + "-" + string(vote.Creator))
```

é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œå¹¶å°è¯•åœ¨ä¸€æ¬¡æŠ•ç¥¨ä¸­å¤šæ¬¡æŠ•ç¥¨ï¼Œä½ ä¼šå‘ç°ä½ å¯ä»¥æƒ³æŠ•å¤šå°‘æ¬¡å°±æŠ•å¤šå°‘æ¬¡ï¼Œä½†åªè®¡ç®—ä½ æœ€è¿‘çš„æŠ•ç¥¨ã€‚

# å¼•å…¥åˆ›å»ºæŠ•ç¥¨çš„è´¹ç”¨

è®©æˆ‘ä»¬è¿™æ ·åšï¼Œåˆ›å»ºä¸€ä¸ªæŠ•ç¥¨èŠ±è´¹ 200 ä»£å¸ã€‚

è¿™ä¸ªç‰¹æ€§å¾ˆå®¹æ˜“æ·»åŠ ã€‚æˆ‘ä»¬å·²ç»è¦æ±‚ç”¨æˆ·æ³¨å†Œå¸æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä»¤ç‰Œã€‚æˆ‘ä»¬å”¯ä¸€éœ€è¦åšçš„æ˜¯åœ¨æˆ‘ä»¬åˆ›å»ºæŠ•ç¥¨ä¹‹å‰ï¼Œä»ç”¨æˆ·çš„å¸æˆ·å‘é€ç¡¬å¸åˆ°ä¸€ä¸ªæ¨¡å—å¸æˆ·ã€‚

**T2`x/voter/handlerMsgCreatePoll.go`**

```
moduleAcct := sdk.AccAddress(crypto.AddressHash([]byte(types.ModuleName)))
payment, _ := sdk.ParseCoins("200token")
if err := k.CoinKeeper.SendCoins(ctx, poll.Creator, moduleAcct, payment); err != nil {
	return nil, err
}
```

åœ¨`k.CreatePoll(ctx, poll)`å‰åŠ ä¸Šä¸Šé¢çš„ä»£ç ã€‚è¿™æ ·ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œåº”ç”¨ç¨‹åºå°†å¼•å‘é”™è¯¯ï¼Œå¹¶ä¸”ä¸ä¼šç»§ç»­åˆ›å»ºè½®è¯¢ã€‚ç¡®ä¿å°†`"github.com/tendermint/tendermint/crypto"`æ·»åŠ åˆ°å¯¼å…¥è¯­å¥ä¸­(å¦‚æœæ‚¨çš„æ–‡æœ¬ç¼–è¾‘å™¨æ²¡æœ‰ä¸ºæ‚¨æ·»åŠ çš„è¯)ã€‚

ç°åœ¨ï¼Œé‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œå°è¯•åˆ›å»ºå‡ ä¸ªæŠ•ç¥¨ï¼Œçœ‹çœ‹è¿™å¦‚ä½•å½±å“æ‚¨çš„ä»¤ç‰Œä½™é¢ã€‚

# ç»“è®º

æ­å–œä½ ï¼Œä½ ç°åœ¨æœ‰ä¸€ä¸ªåœ¨ Cosmos ä¸Šè¿è¡Œçš„å·¥ä½œæŠ•ç¥¨åº”ç”¨ç¨‹åºäº†ï¼