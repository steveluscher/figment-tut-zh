# mirror/03-create-entry

> åŸæ–‡ï¼š<https://github.com/figment-networks/learn-tutorials/blob/master/mirror/03-create-entry.md>

ä¼ ç»Ÿåšå®¢ä½¿ç”¨æ•°æ®åº“æ¥ä¿å­˜æ¡ç›®ã€‚ä½œè€…å¯èƒ½ä¼šç¼–å†™ä¸€äº›å†…å®¹å¹¶å‘å¸ƒå®ƒï¼Œè¿™å°†åœ¨æœåŠ¡å™¨ä¸Šè§¦å‘ä¸€ä¸ªå°†æ•°æ®å†™å…¥æ•°æ®åº“çš„åˆ›å»ºæ“ä½œã€‚æ•°æ®åº“ä¼šæœ‰å®šä¹‰æ•°æ®ç»“æ„çš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ªåŒ…å«æ¡ç›® idã€å†…å®¹å’Œä½œè€… id çš„**æ¡ç›®**è¡¨ã€‚

ç„¶è€Œï¼ŒåŒºå—é“¾æœ‰ç‚¹ä¸åŒï¼Œå› ä¸ºå®ƒæ˜¯åˆ†æ•£çš„ã€‚æˆ‘ä»¬å°†åˆ©ç”¨ä¸€ä¸ªä¸å—ä¸­å¤®æœºæ„æ§åˆ¶çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè€Œä¸æ˜¯å†™å…¥ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“ã€‚

Arweave æ˜¯ä¸€ç§åˆ†æ•£å¼ç½‘ç»œï¼Œå…è®¸æ‹¥æœ‰é¢å¤–å­˜å‚¨ç©ºé—´çš„ç”¨æˆ·å‘ç½‘ç»œæä¾›å­˜å‚¨ç©ºé—´ï¼Œä»¥æ¢å–ç»æµå¥–åŠ±ã€‚å¸Œæœ›ä»¥åˆ†æ•£ã€å®‰å…¨ã€æŠ—å®¡æŸ¥çš„æ–¹å¼å­˜å‚¨æ•°æ®çš„ç”¨æˆ·å¯ä»¥åˆ©ç”¨ç½‘ç»œæ¥å®ç°è¿™ä¸€ç›®çš„ã€‚å®é™…ä¸Šï¼ŒArweave æ˜¯ dApps å †æ ˆçš„å­˜å‚¨éƒ¨åˆ†ã€‚

Arweave ä½¿ç”¨ä¸€ç§å«åšâ€œblockweavesâ€çš„æŠ€æœ¯æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¸è·¨å—è¿æ¥ä¸»é“¾ä¸­çš„äº‹åŠ¡çš„åŒºå—é“¾ç±»ä¼¼ï¼Œå—ç¼–ç»‡æ˜¯åŒ…å«æ•°æ®çš„è¿æ¥å—ã€‚ä¸€ä¸ªä¸»è¦çš„åŒºåˆ«æ˜¯ï¼Œå—ç¼–ç»‡æ›´åƒå›¾ï¼Œè€Œä¸æ˜¯å°†å—è¿æ¥æˆä¸€ä¸ªå•é“¾è¡¨ã€‚

è¯¥ç³»ç»Ÿéœ€è¦ä¸€ä¸ªå¼ºå¥ä¸”å¯æŒç»­çš„ç»æµç»“æ„ï¼Œä»¥ç¡®ä¿å­˜å‚¨æä¾›å•†æœ‰åŠ¨åŠ›ä»¥åˆç†çš„æˆæœ¬ä¸ºç”¨æˆ·æ°¸ä¹…å¤åˆ¶ä¿¡æ¯ã€‚åŸºæœ¬ä¸Šï¼Œç”¨æˆ·é¢„å…ˆæ”¯ä»˜å°‘é‡è´¹ç”¨æ¥æ°¸ä¹…å­˜å‚¨æ•°æ®ã€‚è¿™ç¬”è´¹ç”¨è¢«è§†ä¸ºæœ¬é‡‘ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¼šç»™å­˜å‚¨æä¾›å•†å¸¦æ¥åˆ©æ¯ã€‚

å®ç°è¿™ä¸€åˆ‡çš„æ¶æ„è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œä½†æ˜¯å¦‚æœæ‚¨æœ‰å…´è¶£æ·±å…¥äº†è§£ï¼Œæˆ‘ä»¬å»ºè®®æŸ¥çœ‹ä¸€ä¸‹ [Arweave é»„çš®ä¹¦](https://www.arweave.org/yellow-paper.pdf)ã€‚

[![Like this but decentralized...](img/8cf1e7b2bb4d085a6478eec13c57dd7a.png)](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/mirror/assets/storage.jpeg)

{% label %}åƒè¿™æ ·ä½†åˆ†æ•£...

# å®æ–½ <g-emoji class="g-emoji" alias="jigsaw" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f9e9.png">ğŸ§©</g-emoji>

æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¸ Arweave äº¤äº’ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Arweave çš„æ°´é¾™å¤´ç¨‹åºï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Arweave é’±åŒ…ï¼Œå¹¶ç”¨è¶³å¤Ÿçš„ä»£å¸ä¸ºå®ƒæä¾›èµ„é‡‘ï¼Œè®©æˆ‘ä»¬ç»§ç»­å‰è¿›ã€‚

{% sidenote title="Box 3.1:ä»€ä¹ˆæ˜¯æ°´é¾™å¤´ï¼Ÿ"%}æ°´é¾™å¤´æ˜¯ä¸€ç§æ™ºèƒ½åˆçº¦ï¼Œå®ƒå°†æœ‰é™æ•°é‡çš„ä»¤ç‰Œè½¬ç§»ç»™ç”¨æˆ·ç”¨äºæµ‹è¯•ç›®çš„ã€‚å¤§å¤šæ•°åè®®éƒ½å®ç°äº†æ°´é¾™å¤´ï¼Œä»¥æ–¹ä¾¿å¼€å‘äººå‘˜çš„æµ‹è¯•å’Œæ„å»ºå·¥ä½œã€‚

# Arweave é’±åŒ…<g-emoji class="g-emoji" alias="handbag" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f45c.png">ğŸ‘œ</g-emoji>

è¿›å…¥ [Arweave mainnet æ°´é¾™å¤´](https://faucet.arweave.net/)ï¼ŒæŒ‰ç…§æŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªé’±åŒ…ã€‚ç¡®ä¿åœ¨è¿‡ç¨‹ç»“æŸæ—¶ä¸‹è½½ JSON æ–‡ä»¶ã€‚å°†è¯¥æ–‡ä»¶é‡æ–°å‘½åä¸º`arweave-wallet.json`ï¼Œå¹¶ä¿å­˜åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ã€‚ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨`.gitignore`ä¸­åŒ…å«äº†è¿™ä¸€ç‚¹ï¼Œä»¥é˜²æ­¢æš´éœ²ä»»ä½•ç§äººä¿¡æ¯ã€‚

å°† JSON æ–‡ä»¶ä¿å­˜åˆ°æ ¹ç›®å½•åï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ç»ˆç«¯ä¸­åœæ­¢æœ¬åœ°æœåŠ¡å™¨(åœ¨è¿è¡ŒæœåŠ¡å™¨çš„ç»ˆç«¯çª—å£ä¸­æŒ‰ CTRL+C)ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­åˆå§‹åŒ–`ARWEAVE_WALLET`ç¯å¢ƒå˜é‡ï¼Œå¹¶å†æ¬¡è¿è¡Œæœ¬åœ°æœåŠ¡å™¨:

```js
$ ARWEAVE_WALLET=$(cat arweave-wallet.json) yarn dev 
```

# å‘å¸ƒåˆ° Arweave <g-emoji class="g-emoji" alias="incoming_envelope" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f4e8.png">ğŸ“¨</g-emoji>

æœ‰äº† Arweave é’±åŒ…ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å‘ä¸€ä¸ªç«¯ç‚¹æ¥åˆ›å»ºæ¡ç›®ã€‚åœ¨`pages/api/arweave/entry.ts`ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¡†æ¶ç«¯ç‚¹æ¥æ·»åŠ  Arweave å†™é€»è¾‘ã€‚æ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬ä¼ å…¥äº†åŒ…å«æ•°æ®å’Œåœ°å€å­—æ®µçš„`req.body`ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®å°†æ˜¯æ¡ç›®çš„æ–‡æœ¬ï¼Œåœ°å€å°†æ˜¯ä½œè€…çš„å…¬å…±åœ°å€ã€‚åœ¨`routes.ts`æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°è·¯çº¿æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`JSON.parse`åˆå§‹åŒ–é’±åŒ…:

```js
const wallet = JSON.parse(process.env.ARWEAVE_WALLET as string);
```

æˆ‘ä»¬è¿˜åº”è¯¥é€šè¿‡åˆ©ç”¨ Arweave çš„ JavaScript åº“å¹¶ä¼ å…¥æ•°æ®å’Œé’±åŒ…æ¥å®ä¾‹åŒ–ä¸€ä¸ªäº‹åŠ¡ã€‚

```js
const transaction = await arweave.createTransaction({data: data}, wallet);
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·»åŠ æ ‡ç­¾ä½œä¸ºå…ƒæ•°æ®ï¼Œå°†æ•°æ®ä¸æˆ‘ä»¬çš„ dApp å’Œä½œè€…ç›¸å…³è”ã€‚æˆ‘ä»¬è¿˜åº”è¯¥åŒ…å«ä¸€ä¸ªæ ‡è®°ï¼Œå°†æ•°æ®è¡¨ç¤ºä¸ºâ€œapplication/jsonâ€ã€‚

```js
transaction.addTag('App-Name', process.env.APP_NAME as string);
transaction.addTag('Content-Type', 'application/json');
transaction.addTag('Address', address);
```

ç„¶åï¼Œæˆ‘ä»¬è¦ç­¾ç½²äº¤æ˜“å¹¶å°†å…¶å‘é€åˆ° Arweave:

```js
await arweave.transactions.sign(transaction, wallet);
await arweave.transactions.post(transaction);
```

ä½ ä¼šæ³¨æ„åˆ° Arweave çš„è¯­æ³•éå¸¸ç®€å•ã€‚è¿™ä¸ªå·¥ä½œæµå”¯ä¸€çš„æ–°æ–¹é¢æ˜¯ç­¾åéƒ¨åˆ†ï¼Œè¿™æ˜¯éªŒè¯äº¤æ˜“æ˜¯å¦æœ‰æ•ˆæ‰€å¿…éœ€çš„ã€‚

ä¸ºäº†ç»“æŸç«¯ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†äº‹åŠ¡ id ä½œä¸ºå“åº”çš„ä¸€éƒ¨åˆ†è¿”å›:

```js
res.status(200).json(transaction.id);
```

# å®Œæˆè¡¨æ ¼<g-emoji class="g-emoji" alias="memo" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f4dd.png">ğŸ“</g-emoji>

ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ©ç”¨æˆ‘ä»¬çš„å…¥å£ç«¯ç‚¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è½¬åˆ°`components/CreateEntryForm/CreateEntryForm.tsx`å¹¶å®Œæˆ`handleSubmit`å‡½æ•°ã€‚

ä¸ºäº†æäº¤åˆ›å»ºæ¡ç›®çš„ Arweave äº‹åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [axios](https://axios-http.com/docs/intro) æ¥è°ƒç”¨æˆ‘ä»¬ä¸Šé¢å†™çš„`entry`ç«¯ç‚¹ã€‚æˆ‘ä»¬åº”è¯¥å°†æ•°æ®å’Œåœ°å€ä½œä¸ºè¯·æ±‚ä½“çš„ä¸€éƒ¨åˆ†ä¼ å…¥ï¼Œè¿˜åº”è¯¥å°†è¿”å›å€¼â€”â€”äº‹åŠ¡ idâ€”â€”å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­ã€‚å½“æˆ‘ä»¬å°† NFT åŠŸèƒ½åˆå¹¶åˆ°æˆ‘ä»¬çš„ dApp ä¸­æ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦äº‹åŠ¡ idã€‚

```js
const response = await axios.post(routes.api.arweave.post, {
  data,
  address,
});
const transactionId = response.data;
console.log('transactionId: ', transactionId);
```

å®Œæˆåï¼Œæˆ‘ä»¬çš„ç”¨æˆ·å°±å¯ä»¥åˆ›å»ºæ°¸ä¹…ä¿å­˜åœ¨ Arweave åŒºå—é“¾ä¸Šçš„ä½œå“äº†ï¼æ‚¨å¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œå¹¶ç¡®è®¤`transactionId`æ˜¯å¦æ‰“å°åœ¨æ§åˆ¶å°ä¸­ã€‚

ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å³ä½¿æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•åœ¨ dApp ä¸­çœ‹åˆ°å®ƒã€‚æˆ‘ä»¬å°†å¾ˆå¿«è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç«¯ç‚¹æ¥è·å–æ¡ç›®ã€‚æˆ‘ä»¬å°†åœ¨æ­¥éª¤ 4 ä¸­å¤„ç†ä¸‹ä¸€ä¸ªé—®é¢˜ã€‚

##### *æ¸…å• 3.1:åˆ›å»ºå…¥å£ç«¯ç‚¹çš„ä»£ç *

```js
export default async function (
  req: NextApiRequest,
  res: NextApiResponse<string>,
): Promise<any> {
  try {
    const {data, address} = req.body;

    const wallet = JSON.parse(process.env.ARWEAVE_WALLET as string);
    const transaction = await arweave.createTransaction({data: data}, wallet);

    transaction.addTag('App-Name', process.env.APP_NAME as string);
    transaction.addTag('Content-Type', 'application/json');
    transaction.addTag('Address', address);

    await arweave.transactions.sign(transaction, wallet);
    await arweave.transactions.post(transaction);
    res.status(200).json(transaction.id);
  }
  ...
}
```

##### *æ¸…å• 3.2:å¤„ç†æ¡ç›®æäº¤çš„ä»£ç *

```js
if (provider && contract) {
  const data = createJsonMetaData(values);

  const response = await axios.post(routes.api.arweave.post, {
    data,
    address,
  });
  const transactionId = response.data;
  console.log('transactionId: ', transactionId);
}
```

# æŒ‘æˆ˜<g-emoji class="g-emoji" alias="weight_lifting" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f3cb.png">ğŸ‹ï¸</g-emoji>

åœ¨æ‚¨çš„ä»£ç ç¼–è¾‘å™¨ä¸­å¯¼èˆªåˆ°`pages/api/arweave/entry.ts`å’Œ`components/CreateEntryForm/CreateEntryForm.tsx`ï¼Œå¹¶æŒ‰ç…§æ³¨é‡Šä¸­åŒ…å«çš„æ­¥éª¤å®Œæˆåˆ›å»ºæ¡ç›®åŠŸèƒ½çš„ç¼–å†™ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæè¿°ï¼Œä»¥åŠä¸€ä¸ªé“¾æ¥ï¼Œé“¾æ¥åˆ°æ‚¨ä¸ºäº†å®ç°æ¯ä¸€è¡Œè€Œéœ€è¦æŸ¥çœ‹çš„æ–‡æ¡£ã€‚ç›¸å…³ä»£ç å—ä¹ŸåŒ…å«åœ¨ä¸‹é¢çš„**æ¸…å• 3.3** å’Œ**æ¸…å• 3.4** ä¸­ã€‚

##### *æ¸…å• 3.3:åˆ›å»ºå…¥å£ç«¯ç‚¹çš„æŒ‡ä»¤*

```js
export default async function (
  req: NextApiRequest,
  res: NextApiResponse<string>,
): Promise<any> {
  try {
    const {data, address} = req.body;

    // Initialize wallet using ARWEAVE_WALLET environmental variable (Tip: Use JSON.parse)

    // Create Arweave transaction passing in data. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

    // Add tags:
    // - App-Name - APP_NAME environmental variable
    // - Content-Type - Should be application/json
    // - Address - Address of a user
    // Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

    // Sign Arweave transaction with your wallet. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

    // Post Arweave transaction. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

    // Return transaction id
  }
  ...
}
```

##### *æ¸…å• 3.4:å¤„ç†å‚èµ›ä½œå“æäº¤çš„è¯´æ˜*

```js
if (provider && contract) {
  const data = createJsonMetaData(values);
  // Submit Arweave transaction
  // Use axios to post data and address to api/arweave/entry endpoint.
  // This request should return transactionId

  // Stop here when you complete Step 3 ^^^^
  ...
}
```

ä¸€æ—¦æ‚¨å®Œæˆäº†ä»£ç ï¼Œæ‚¨å°†æƒ³è¦å°è¯•é€šè¿‡ç‚¹å‡»ä»ªè¡¨æ¿ä¸Šçš„**åˆ›å»ºæ¡ç›®**æŒ‰é’®æ¥åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œç„¶åè¾“å…¥ä¸€ä¸ªæ ‡é¢˜å’Œä¸€äº›æ–‡æœ¬ã€‚

[![Screenshot displaying a list of entries](img/d57e0e460d52fd4809fa393fb9acd206.png)](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/mirror/assets/entries.jpg)