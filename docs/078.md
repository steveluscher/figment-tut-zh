# å®æ–½ğŸ§©

> åŸæ–‡:[https://github . com/fig ment-networks/learn-tutorials/blob/master/mirror/04-show-entry . MD](https://github.com/figment-networks/learn-tutorials/blob/master/mirror/04-show-entry.md)

ä¸Šä¸€æ­¥è®©æˆ‘ä»¬åœæ»ä¸å‰ï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶æ²¡æœ‰çœ‹åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ¡ç›®ã€‚è®©æˆ‘ä»¬ç»§ç»­æ„å»ºä¸€ä¸ª API ç«¯ç‚¹æ¥æ£€ç´¢æ¡ç›®ã€‚

æˆ‘ä»¬é¦–å…ˆéœ€è¦ç¼–å†™å¦ä¸€ä¸ªç«¯ç‚¹ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·å–ä¸€ä¸ªæŒ‡å®šçš„æ¡ç›®ã€‚æˆ‘ä»¬å·²ç»åœ¨`pages/api/arweave/[transactionHash].ts`æ„å»ºäº†ç«¯ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦ç¼–å†™æ ¸å¿ƒåŠŸèƒ½ã€‚

è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªç«¯ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä¼ å…¥äº‹åŠ¡çš„æ ‡è¯†ç¬¦ï¼Œå¹¶è·å¾—äº‹åŠ¡æ•°æ®ä½œä¸ºå“åº”ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨ Arweave äº‹åŠ¡çš„`getData`æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è§£æå®ƒè¿”å›çš„ JSON:

```
const txDataResp = (await arweave.transactions.getData(
  transactionHash as string,
  {
    decode: true,
    string: true,
  },
)) as string;
const txData = JSON.parse(txDataResp);
```

ç„¶åï¼Œåœ¨å‘å®¢æˆ·ç«¯å‘é€å“åº”ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥æ£€æŸ¥äº¤æ˜“æ˜¯å¦å·²è¢«ç¡®è®¤ã€‚

{ % side note title = " Box 4.1:ar weave äº¤æ˜“ç¡®è®¤æ„å‘³ç€ä»€ä¹ˆï¼Ÿ"%}ä¸ä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿä¸€æ ·ï¼Œåœ¨é€Ÿåº¦å’Œå»ä¸­å¿ƒåŒ–ä¹‹é—´æœ‰ä¸€ä¸ªæƒè¡¡ã€‚ä¸ºäº†å­˜å‚¨æ•°æ®ï¼ŒArweave åè®®å¿…é¡»è¾¾æˆå…±è¯†ã€‚ä½ å¯ä»¥é˜…è¯»æ›´å¤šå…³äº Arweave çš„å…±è¯†æœºåˆ¶çš„å†…å®¹ï¼Œä½†å¯ä»¥è¯´å¤§å¤šæ•°æ•°æ®åº“åœ¨å†™å…¥æ•°æ®æ—¶çš„å»¶è¿Ÿåœ¨åˆ†å¸ƒå¼å­˜å‚¨ä¸­åŠ å‰§äº†ã€‚æ•°æ®ä¸ä»…é€šè¿‡ç½‘ç»œå†™å…¥ï¼Œè€Œä¸”é€šè¿‡åè®®è¾¾æˆä¸€è‡´ï¼Œè¿™ä¸€äº‹å®æ”¾å¤§äº†è¿™ç§æ»åã€‚è¿™é€šå¸¸éœ€è¦ 5-10 åˆ†é’Ÿã€‚

åœ¨ç¬¬ 6 æ­¥ä¸­ï¼Œå½“æˆ‘ä»¬å°† NFTs ä¸æ¯ä¸ªæ¡ç›®ç›¸å…³è”æ—¶ï¼ŒåŸå› å°†å˜å¾—å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯ä½œä¸ºé¢„è§ˆï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·åœ¨ Arweave ä¸Šå®é™…åˆ›å»ºä¸€ä¸ªæ¡ç›®ä¹‹å‰å£°æ˜ NFTsã€‚

å¦è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ¡ç›®åœ¨è¢«è§†ä¸ºå·²ç¡®è®¤ä¹‹å‰åº”è¯¥æ”¶åˆ°å¤šå°‘æ¬¡ç¡®è®¤ã€‚å¯¹äºè¿™ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡`MIN_NUMBER_OF_CONFIRMATIONS`ç¯å¢ƒå˜é‡åœ¨`constants.ts`ä¸­è®¾ç½®äº†æ‰€éœ€çš„ç¡®è®¤æ•°é‡ã€‚

```
const txStatusResp = await arweave.transactions.getStatus(
  transactionHash as string,
);

const txStatus =
  txStatusResp.status === 200 &&
  txStatusResp.confirmed &&
  txStatusResp.confirmed.number_of_confirmations >=
    MIN_NUMBER_OF_CONFIRMATIONS
    ? TransactionStatusE.CONFIRMED
    : TransactionStatusE.NOT_CONFIRMED;
```

ä¸€æ—¦æˆ‘ä»¬ç¡®è®¤æˆ‘ä»¬çš„æ•°æ®å·²ç»è¢«å†™å…¥ Arweaveï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä½¿ç”¨æŸ¥è¯¢å‚æ•°`transactionHash`ä¸­çš„æ ‡è¯†ç¬¦æ¥è·å–äº‹åŠ¡ã€‚

```
const tx = await arweave.transactions.get(transactionHash as string);
```

æˆ‘ä»¬è¿˜åº”è¯¥å¾—åˆ°æ ‡ç­¾ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®ç”¨æˆ·çš„åœ°å€:

```
const tags = {} as PostTagsT;
(tx.get('tags') as any).forEach((tag) => {
  const key = tag.get('name', {decode: true, string: true});
  tags[key] = tag.get('value', {decode: true, string: true});
});
```

æˆ‘ä»¬åº”è¯¥è·å¾—å—ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¿é—®æ¡ç›®çš„æ—¶é—´æˆ³:

```
const block = txStatusResp.confirmed
  ? await arweave.blocks.get(txStatusResp.confirmed.block_indep_hash)
  : null;
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†å®¢æˆ·æœºæ˜¾ç¤ºæ¡ç›®æ‰€éœ€çš„æ‰€æœ‰æ„ä»¶â€”â€”æ¡ç›®æ•°æ®ã€ä½œè€…å’Œæ—¶é—´æˆ³ã€‚æˆ‘ä»¬å¯ä»¥æ„å»ºå“åº”å¹¶è¿”å›å®ƒ:

```
res.status(200).json({
  id: transactionHash as string,
  data: txData,
  status: txStatus,
  timestamp: block?.timestamp,
  tags,
});
```

â€œä½†æˆ‘ä»¬ä»ç„¶æ²¡æœ‰æ˜¾ç¤ºä¸€ä¸ªæ¡ç›®ï¼â€ï¼Œä½ å¤§å–Šã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬ç»å¯¹åº”è¯¥è¿™æ ·åšã€‚æˆ‘ä»¬å°†åœ¨æ­¥éª¤ 5 ä¸­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚

[![We're getting very close to some magic.](img/d28c5345065b95726859525ede4595e5.png)](https://raw.githubusercontent.com/figment-networks/learn-tutorials/master/mirror/assets/map.jpeg)

{% label %}æˆ‘ä»¬å·²ç»éå¸¸æ¥è¿‘æŸç§é­”æ³•äº†ã€‚

##### *æ¸…å• 4.1:è·å–æ–‡ç« çš„ä»£ç *

```
const {transactionHash} = req.query;
const txDataResp = (await arweave.transactions.getData(
  transactionHash as string,
  {
    decode: true,
    string: true,
  },
)) as string;
const txData = JSON.parse(txDataResp);

const txStatusResp = await arweave.transactions.getStatus(
  transactionHash as string,
);
const txStatus =
  txStatusResp.status === 200 &&
  txStatusResp.confirmed &&
  txStatusResp.confirmed.number_of_confirmations >=
    MIN_NUMBER_OF_CONFIRMATIONS
    ? TransactionStatusE.CONFIRMED
    : TransactionStatusE.NOT_CONFIRMED;

if (txStatus === TransactionStatusE.CONFIRMED) {
  const tx = await arweave.transactions.get(transactionHash as string);

  const tags = {} as PostTagsT;
  (tx.get('tags') as any).forEach((tag) => {
    const key = tag.get('name', {decode: true, string: true});
    tags[key] = tag.get('value', {decode: true, string: true});
  });

  const block = txStatusResp.confirmed
    ? await arweave.blocks.get(txStatusResp.confirmed.block_indep_hash)
    : null;

  res.status(200).json({
    id: transactionHash as string,
    data: txData,
    status: txStatus,
    timestamp: block?.timestamp,
    tags,
  });
} else {
  throw new Error('Transaction not confirmed');
}
```

# æŒ‘æˆ˜<g-emoji class="g-emoji" alias="weight_lifting" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f3cb.png">ğŸ‹ï¸</g-emoji>

åœ¨æ‚¨çš„ç¼–è¾‘å™¨ä¸­å¯¼èˆªåˆ°`pages/api/arweave/[transactionHash].ts`,æŒ‰ç…§æ³¨é‡Šä¸­åŒ…å«çš„æ­¥éª¤å®Œæˆç¼–å†™ç«¯ç‚¹ä»¥æ£€ç´¢æ¡ç›®ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæè¿°ï¼Œä»¥åŠä¸€ä¸ªé“¾æ¥ï¼Œé“¾æ¥åˆ°æ‚¨ä¸ºäº†å®ç°æ¯ä¸€è¡Œè€Œéœ€è¦æŸ¥çœ‹çš„æ–‡æ¡£ã€‚ç›¸å…³çš„ä»£ç å—ä¹ŸåŒ…å«åœ¨ä¸‹é¢çš„æ¸…å• 4.2 ä¸­ã€‚

##### *æ¸…å• 4.2:è·å–å¸–å­çš„æŒ‡ä»¤*

```
const {transactionHash} = req.query;
  // Get Arweave transaction data. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

  // Get Arweave transaction status. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js
  const txStatus = undefined;
if (txStatus === TransactionStatusE.CONFIRMED) {
  // Get Arweave transaction. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

  // Get Arweave transaction tags. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

  // Get Arweave transaction block in order to retrieve timestamp. Documentation can be found here: https://github.com/ArweaveTeam/arweave-js

  // Return JSON response in form:
  // res.status(200).json({
  //   id: transactionHash as string,
  //   data: txData,
  //   status: txStatus,
  //   timestamp: block?.timestamp,
  //   tags,
  // });
} else {
  throw new Error('Transaction not confirmed');
}
```