# ä»‹ç»

> åŸæ–‡ï¼š<https://github.com/figment-networks/learn-tutorials/blob/master/polygon/petgram.md>

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªç±»ä¼¼äº Instagram çš„ç¤¾äº¤åª’ä½“ dApp(å»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åº),ä»¥åŠå¦‚ä½•å°†å…¶éƒ¨ç½²åœ¨ Polygon (Matic)å­Ÿä¹°æµ‹è¯•ç½‘ç»œä¸Šã€‚æ‰€ä»¥æ‹¿èµ·ä½ æœ€å–œæ¬¢çš„é¥®æ–™ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ <g-emoji class="g-emoji" alias="coffee" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/2615.png">â˜•ï¸</g-emoji> ï¼

PetGram æ˜¯ Instagram å¹³å°çš„ä¸€ä¸ªåˆ†æ•£ç‰ˆæœ¬ï¼Œç”¨æˆ·å¯ä»¥æµè§ˆè‡ªå·±å–œæ¬¢çš„å® ç‰©çš„å¯çˆ±ç…§ç‰‡ï¼ŒæŸ¥çœ‹ç‰¹å®šå® ç‰©çš„è¯¦ç»†ä¿¡æ¯ï¼Œåˆ›å»ºå¸–å­å¹¶èµšå– NFTã€‚

# å…ˆå†³æ¡ä»¶

å¯¹äºæœ¬æ•™ç¨‹ï¼Œå»ºè®®å®Œæˆ[å¤šè¾¹å½¢è·¯å¾„](https://learn.figment.io/protocols/polygon)ã€‚ä»¥åŠå¯¹ Solidity çš„åŸºæœ¬ç†è§£ã€React å’Œ JavaScript çš„å·¥ä½œçŸ¥è¯†ã€‚

# è¦æ±‚

æ‚¨éœ€è¦åœ¨è®¡ç®—æœºä¸Šå®‰è£…ä»¥ä¸‹è½¯ä»¶æ¥æ„å»ºæ­¤ dApp:

*   [Node.js](https://nodejs.org/en/download/) v14.17.6 LTS æˆ–æ›´é«˜ç‰ˆæœ¬å·²å®‰è£…
*   [æ¾éœ²](https://www.trufflesuite.com/truffle)æœ€æ–°ç‰ˆæœ¬å®‰è£…å®Œæ¯•
*   [Ganache](https://www.trufflesuite.com/ganache) å®‰è£…æœ€æ–°ç‰ˆæœ¬
*   å®‰è£…åœ¨æµè§ˆå™¨ä¸­çš„[å…ƒæ©ç ](https://metamask.io/)
*   ä½ è¿˜éœ€è¦ä¸€ä¸ª GitHub è´¦æˆ·

å¼ºçƒˆå»ºè®®åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒæ©ç å¸æˆ·è¿›è¡Œæµ‹è¯•ã€‚æ‚¨ä¼šå¸Œæœ›å°†è¿™ä¸ªæ–°å¸æˆ·çš„ç§˜å¯†æ¢å¤çŸ­è¯­æ”¾åœ¨æ‰‹è¾¹ï¼Œå› ä¸ºéƒ¨ç½²æ™ºèƒ½åˆçº¦éœ€è¦å®ƒã€‚

è¦é€šè¿‡å…ƒæ©ç ä¸å¤šè¾¹å½¢äº¤äº’ï¼Œé¦–å…ˆå¿…é¡»æ·»åŠ ä¸€ä¸ªæ–°çš„ RPC ç«¯ç‚¹ã€‚é€šè¿‡ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„ Fox å›¾æ ‡æ‰“å¼€ Metamask æ‰©å±•ï¼Œç„¶åé€‰æ‹©è®¾ç½®->ç½‘ç»œ->æ·»åŠ ç½‘ç»œ->ä¿å­˜ã€‚å¡«å†™ä¸‹å›¾ä¸­ç»™å‡ºçš„ä¿¡æ¯:

![](img/2cc97254baf13a8a47cfccd294cb7035.png)

ç°åœ¨ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ‚¨çš„é’±åŒ…ä¸­ä½™é¢ä¸ºé›¶(0 MATIC)ï¼Œè¦è·å¾—ç”¨äºéƒ¨ç½²å’Œæµ‹è¯•çš„ test Maticï¼Œè¯·è½¬åˆ° MATIC æ°´é¾™å¤´[é“¾æ¥](https://faucet.matic.network) - >é€‰æ‹©å­Ÿä¹°- >ç²˜è´´æ‚¨çš„é’±åŒ…åœ°å€- >å•å‡»â€œæäº¤â€ã€‚

å½“è¿™ä¸ªå®Œæˆæ—¶ï¼Œæ£€æŸ¥ä½ çš„å…ƒæ©ç &ä½ ä¼šåœ¨é‚£é‡Œçœ‹åˆ°ä¸€äº› MATIC æ ‡è®°ã€‚æˆ‘ä»¬åªéœ€è¦å°‘é‡çš„ MATIC(å¤§çº¦ 5-10 ä¸ª)æ¥éƒ¨ç½²å’Œæµ‹è¯•æˆ‘ä»¬çš„ dAppã€‚

![](img/06cac7e75a23db7c96943beaaa42cbc6.png)

# é¡¹ç›®è®¾ç½®

ä¸ºäº†é¿å…æ½œåœ¨çš„ç‰ˆæœ¬ç›¸å…³é”™è¯¯&æˆ‘ä»¬ä¸æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å®‰è£…æ”¯æŒä»£ç åº“(ä¾èµ–é¡¹)ï¼Œè€Œæ˜¯é€šè¿‡å…‹éš†åŒ…å«é¡¹ç›®æ–‡ä»¶çš„ GitHub å­˜å‚¨åº“å¹¶å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–é¡¹æ¥å¼€å§‹æ„å»º Petgram dAppã€‚

*   åˆ†å‰ä½äº[https://github.com/electrone901/tutorial-petgram](https://github.com/electrone901/tutorial-petgram)çš„åº“ï¼Œè¿™å°†åœ¨ä½ è‡ªå·±çš„ GitHub è´¦æˆ·ä¸­å¤åˆ¶è¿™ä¸ªé¡¹ç›®ã€‚

*   ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…‹éš† GitHub å­˜å‚¨åº“(è¿™å°†æŠŠé¡¹ç›®æ–‡ä»¶ä» GitHub å¤åˆ¶åˆ°æ‚¨çš„è®¡ç®—æœºä¸Š):

```
git clone https://github.com/<YourGitHubUsername>/tutorial-petgram.git 
```

ç°åœ¨å¯ä»¥ç”¨è‡ªå·±å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨æˆ–è€… IDE æ‰“å¼€é¡¹ç›®äº†ï¼Œæ¯”å¦‚ [Visual Studio ä»£ç ](https://code.visualstudio.com)ã€‚å¦‚æœä½ æµè§ˆé¡¹ç›®ç›®å½•ï¼Œä½ ä¼šæ³¨æ„åˆ°ä¸€ä¸ªæ¥è‡ª [Create React app](https://github.com/facebook/create-react-app) çš„åŸºæœ¬ React App é¡¹ç›®ç»“æ„ã€‚è¿™åŒ…å«æˆ‘ä»¬çš„å‰ç«¯ React ä»£ç ï¼Œä¸€æ—¦æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦éƒ¨ç½²å®Œæ¯•ï¼Œæˆ‘ä»¬å°†éœ€è¦å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚

åœ¨è¿è¡Œ React å‰ç«¯ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç”¨å‘½ä»¤`npm install`å®‰è£…ä¾èµ–é¡¹ã€‚

ç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®å·²ç»æ‹¥æœ‰äº†æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤`npm start`æ¥è¿è¡Œå®ƒã€‚æ‚¨çš„æµè§ˆå™¨åº”è¯¥ä¼šè‡ªåŠ¨æ‰“å¼€å¹¶æ˜¾ç¤ºä¸»é¡µ(è§ä¸‹å›¾)ã€‚å¦‚æœæ‚¨çš„æµè§ˆå™¨æ²¡æœ‰æ‰“å¼€ï¼Œè¯·ç¡®ä¿æ‚¨çš„é¡¹ç›®æ­£åœ¨è¿è¡Œï¼Œè½¬åˆ°æ‚¨çš„æµè§ˆå™¨ï¼Œå¹¶é”®å…¥`http://localhost:3000/`ã€‚

![](img/7d9eb2ac39acb0e75320de957082d016.png)

> æ³¨æ„:éšç€æœ¬æ•™ç¨‹çš„è¿›è¡Œï¼Œç¡®ä¿ä½ çš„é¡¹ç›®åœ¨ç»™å®šçš„ç‚¹ä¸Šåæ˜ äº†ç›¸ä¼¼çš„ç»“æœã€‚å‡ ä¹æ¯ä¸€æ­¥éƒ½æœ‰æˆªå›¾ä½œä¸ºæ£€æŸ¥ç‚¹ã€‚

# å¯é çš„æ™ºèƒ½åˆåŒ

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹è®¾ç½®ç¼–ç æ™ºèƒ½å¥‘çº¦çš„ç¯å¢ƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Truffleï¼Œå®ƒæ˜¯ä»¥å¤ªåŠå’Œå…¶ä»– EVM å…¼å®¹åŒºå—é“¾å¦‚ Polygon çš„å¼€å‘ç¯å¢ƒã€æµ‹è¯•æ¡†æ¶å’Œèµ„äº§ç®¡é“ã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…å®ƒï¼Œç”¨å‘½ä»¤`npm install -g truffle`å®‰è£… truffleã€‚

å¯¹äºä¸€ç»„é»˜è®¤çš„å¥‘çº¦å’Œæµ‹è¯•ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­è¿è¡Œ`truffle init`ã€‚

æ¾éœ²åˆå§‹åŒ–è¿‡ç¨‹åˆ›å»ºäº†ä¸‰ä¸ªç›®å½•:`contracts`ã€`migrations`å’Œ`test`ï¼Œä»¥åŠä¸‰ä¸ªæ–‡ä»¶`Migrations.sol`ã€`1_initial_migrations.js`å’Œ`truffle-config.js`ã€‚

*   å­˜å‚¨æˆ‘ä»¬çš„ Solidity æ™ºèƒ½åˆåŒä»£ç çš„åœ°æ–¹ã€‚æ‚¨ä¼šæ³¨æ„åˆ°è¿™é‡Œå·²ç»æœ‰ä¸€ä¸ªåä¸º`Migrations.sol`çš„æ™ºèƒ½å¥‘çº¦ï¼Œå®ƒåœ¨è¿ç§»è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚

*   `migrations/`å°†å­˜å‚¨ Truffle çš„â€œéƒ¨ç½²è€…â€Javascript æ–‡ä»¶ã€‚æ¯æ¬¡ä½ æƒ³éƒ¨ç½²ä¸€ä¸ªå¥‘çº¦ï¼Œä½ éƒ½éœ€è¦å‘Šè¯‰ Truffle æ˜¯å“ªä¸€ä¸ªï¼Œä»¥åŠä½ å¯èƒ½éœ€è¦ä»€ä¹ˆæ„é€ å‡½æ•°å‚æ•°ã€‚`1_initial_migration.js`æ˜¯éƒ¨ç½²æˆ‘ä»¬çš„è¿ç§»åˆåŒçš„è„šæœ¬ã€‚è¿™æ˜¯æœ€åŸºæœ¬çš„éƒ¨ç½²ç±»å‹ï¼Œå› ä¸ºå®ƒä¸éœ€è¦åº“é“¾æ¥æˆ–æ„é€ å‡½æ•°å‚æ•°ã€‚

*   æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œä¸ºæˆ‘ä»¬çš„ dApp ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚å®ƒå¯ä»¥åŒ…å«ã€‚`js`æˆ–`.sol`æ–‡ä»¶ï¼Œè¿™å–å†³äºä½ é€‰æ‹©çš„æµ‹è¯•è¯­è¨€ã€‚

*   `truffle-config.js`æ˜¯ Truffle é¡¹ç›®çš„ä¸»è¦é…ç½®æ–‡ä»¶ã€‚è¿™æ˜¯æˆ‘ä»¬å®šä¹‰ä½¿ç”¨å“ªäº›ç½‘ç»œï¼Œä½¿ç”¨å¤šå°‘å¤©ç„¶æ°”ï¼Œéƒ¨ç½²åœ°å€å’Œå…¶ä»–ä¸€äº›å˜é‡çš„åœ°æ–¹ã€‚

**truffle-config.js**

åœ¨æˆ‘ä»¬å¯ä»¥åœ¨`truffle-config.js`ä¸­è®¾ç½®ä¸€äº›é…ç½®ç»†èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»åˆ é™¤æ–‡ä»¶çš„ç°æœ‰å†…å®¹å¼€å§‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªç©ºç™½çš„çŸ³æ¿ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®‰è£… npm åŒ… dotenv å’Œ hdwallet-providerã€‚ä½¿ç”¨å‘½ä»¤`npm install dotenv @truffle/hdwallet-provider`ã€‚

dotenv æ˜¯ä¸€ä¸ªå°†ç¯å¢ƒå˜é‡ä»ä¸€ä¸ª`.env`æ–‡ä»¶åŠ è½½åˆ° JavaScript çš„ process.env ä¸­çš„æ¨¡å—ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ dotenv æ¥å­˜å‚¨æ¥è‡ª Metamask çš„ç§˜å¯†æ¢å¤çŸ­è¯­(åŠ©è®°ç¬¦)ã€‚è¿™ç”¨äºç”Ÿæˆåœ¨ Ganache ä¸Šå¼€å‘æœŸé—´å¯ç”¨çš„åœ°å€ï¼Œä»¥åŠä»è¿™äº›åœ°å€å‘é€çš„ç­¾åäº‹åŠ¡ã€‚

Truffle çš„ HDWalletProvider ç±»æ”¯æŒ Web3 providerï¼Œç”¨äºä¸ºä» 12 æˆ– 24 ä¸ªå­—çš„ç§˜å¯†æ¢å¤çŸ­è¯­(åŠ©è®°ç¬¦)æ´¾ç”Ÿçš„åœ°å€ç­¾ç½²äº¤æ˜“ã€‚

è®©æˆ‘ä»¬å°†å®ƒä»¬å¯¼å…¥åˆ°æˆ‘ä»¬çš„`truffle-config.js`:

```
require('dotenv').config()
const HDWalletProvider = require('@truffle/hdwallet-provider')
```

æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª`.env`æ–‡ä»¶æ¥å­˜å‚¨åŠ©è®°ç¬¦â€”â€”åäºŒä¸ªå•è¯çš„çŸ­è¯­ã€‚è¦åˆ›å»ºå®ƒï¼Œè¯·éµå¾ªæœ¬æŒ‡å—ã€‚

ä½ çš„æ–‡ä»¶åº”è¯¥ç±»ä¼¼äºè¿™ä¸ª: ![](img/4c88a77ba54126d298a0e9e8d9e5e579.png)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`dotenv`å°†åŠ©è®°ç¬¦åˆå§‹åŒ–ä¸ºä¸€ä¸ªå˜é‡ï¼Œè¿™å…è®¸æˆ‘ä»¬é€šè¿‡`process.env`ä»`.env`æ–‡ä»¶ä¸­è®¿é—®ç¯å¢ƒå˜é‡:

```
const mnemonic = process.env.MNEMONIC.toString().trim()
```

ç°åœ¨æˆ‘ä»¬éœ€è¦å®šä¹‰æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ç½‘ç»œã€‚ç½‘ç»œæŒ‡å®šäº†æˆ‘ä»¬å¦‚ä½•å°† Truffle è¿æ¥åˆ°æˆ‘ä»¬çš„ä»¥å¤ªåŠå®¢æˆ·ç«¯ï¼Œå¹¶è®©æˆ‘ä»¬ä¸ºç”¨äºå‘é€äº¤æ˜“çš„ web3 è®¾ç½®é»˜è®¤å€¼ã€‚å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¼€å‘å’Œ matic ç½‘ç»œã€‚

å¼€å‘ç½‘ç»œæ˜¯ Truffle é»˜è®¤ä½¿ç”¨çš„ç‰¹æ®Šç½‘ç»œï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•ã€‚åŸºæœ¬è®¾ç½®éœ€è¦ä¸»æœºã€ç«¯å£å·å’Œç½‘ç»œ idã€‚å…³äºé…ç½®çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ [Truffle æ–‡æ¡£](https://www.trufflesuite.com/docs/truffle/reference/configuration)ä¸­æ‰¾åˆ°ã€‚

å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ‚¨çš„`truffle-config.js`ä¸­:

```
require('dotenv').config()
const HDWalletProvider = require('@truffle/hdwallet-provider')
const mnemonic = process.env.MNEMONIC.toString().trim()

module.exports = {
  networks: {
    development: {
      host: '127.0.0.1',
      port: 7545,
      network_id: '*', // Match any network id
    },
    matic: {
      provider: () =>
        new HDWalletProvider(
          mnemonic,
          `https://matic-mumbai.chainstacklabs.com`,
        ),
      network_id: 80001,
      confirmations: 2,
      timeoutBlocks: 200,
      skipDryRun: true,
    },
  },
}
```

æˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šåˆåŒæ„å»ºç›®å½•ã€Solidity ç‰ˆæœ¬å’Œ Solidity ç¼–è¯‘å™¨(solc)ç¼ºçœå€¼ã€‚

åˆåŒç”Ÿæˆç›®å½•æ˜¯å·²ç¼–è¯‘åˆåŒçš„é»˜è®¤è¾“å‡ºç›®å½•è·¯å¾„ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›è¾“å‡ºåœ¨é¡¹ç›®çš„å‰ç«¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Solidity ç¼–è¯‘å™¨ç‰ˆæœ¬ 0.6.0 å’Œé»˜è®¤è®¾ç½®ã€‚è¿è¡Œæ¬¡æ•°å°†å½±å“å¥‘çº¦åˆ›å»º gas æˆæœ¬å’Œåç»­å‡½æ•°è°ƒç”¨ gas æˆæœ¬ä¹‹é—´çš„æƒè¡¡ã€‚å¦‚æœä½ ä¸ä»‹æ„å¤§é‡çš„å‰æœŸæˆæœ¬ï¼Œä½ åº”è¯¥å¤šè¿è¡Œå‡ æ¬¡ç¼–è¯‘å™¨ã€‚æŸ¥çœ‹ Solidity æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯[https://docs . soliditylang . org/en/develop/using-the-compiler . html # using-the-compiler](https://docs.soliditylang.org/en/develop/using-the-compiler.html#using-the-compiler)ã€‚

å°†è¿™äº› solc é»˜è®¤å€¼æ·»åŠ åˆ°æ‚¨çš„`truffle-config.js`æ–‡ä»¶ä¸­ï¼Œåœ¨ç½‘ç»œä¸‹é¢:

```
module.exports = {
  networks: {
    development: {
      host: '127.0.0.1',
      port: 7545,
      network_id: '*', // Match any network id
    },
    matic: {
      provider: () =>
        new HDWalletProvider(
          mnemonic,
          `https://matic-mumbai.chainstacklabs.com`,
        ),
      network_id: 80001,
      confirmations: 2,
      timeoutBlocks: 200,
      skipDryRun: true,
    },
  },
 contracts_build_directory: './src/abis/',
 compilers: {
   solc: {
     version: '^0.6.0',
     optimizer: {
       enabled: true,
       runs: 200,
     },
   },
 },
}
```

# å½¼å¾—Â·ç´¢å°”

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹ç¼–å†™æ™ºèƒ½åˆçº¦ã€‚åœ¨ contracts æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨æ–°çš„ç»ˆç«¯ä¸­æ‰“å¼€æ‚¨çš„é¡¹ç›®ï¼Œå¹¶åœ¨ Linux/macOS ä¸Šä½¿ç”¨å‘½ä»¤`touch ./contracts/Pet.sol`æˆ–åœ¨ Windows ä¸Šä½¿ç”¨å‘½ä»¤`type nul > contracts\Pet.sol`ã€‚

![](img/390d58ebc56c97f3124ddee24bb70284.png)

è¿™æ˜¯æˆ‘ä»¬ç”¨ Solidity ç¼–ç¨‹è¯­è¨€ç¼–å†™æ‰€æœ‰å® ç‰©ä»¤ç‰Œæºä»£ç çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å°†è®¾è®¡æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒï¼Œä½¿ç”¨ IPFS å­˜å‚¨æ•°æ®æ¥å­˜å‚¨ç¦»çº¿ç…§ç‰‡ã€‚NFT å…ƒæ•°æ®é€šå¸¸ä½¿ç”¨åˆ†æ•£å­˜å‚¨ï¼Œå¦‚ IPFS æˆ– Filecoinã€‚ä½¿ç”¨ NFT å…ƒæ•°æ®å…è®¸æˆ‘ä»¬ä¸Šä¼ æ•°æ®å¹¶æ¥æ”¶å†…å®¹çš„ IPFS æ•£åˆ—(CID æˆ–å†…å®¹æ ‡è¯†ç¬¦),è¯¥æ•£åˆ—å¯ä»¥ä½œä¸ºæŒ‡å‘å†…å®¹çš„æŒ‡é’ˆåœ¨é“¾ä¸Šè¢«å¼•ç”¨ã€‚

è®©æˆ‘ä»¬åƒè¿™æ ·åˆ›å»ºæ™ºèƒ½åˆçº¦çš„åŸºæœ¬ç»“æ„:

```
pragma solidity ^0.6.0;
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";

contract Pet is ERC721 {
   constructor() ERC721("Pet", "PET") public  {}
}
```

é¦–å…ˆï¼Œæˆ‘ä»¬ä»å£°æ˜ Solidity ç¼–ç¨‹è¯­è¨€çš„ç‰ˆæœ¬å¼€å§‹ï¼Œæˆ‘ä»¬å°†ç”¨å®ƒæ¥ç¼–ç æ™ºèƒ½å¥‘çº¦ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œç‰ˆæœ¬æ˜¯ 0.6.0ã€‚

ç„¶åï¼Œæˆ‘ä»¬å¯¼å…¥ OpenZeppelin Solidity åº“ã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå®‰è£…åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚ä½¿ç”¨ç»ˆç«¯å‘½ä»¤:

*   `npm i @openzeppelin/contracts@3.4.1`

æˆ‘ä»¬åˆ›å»ºäº†åä¸º Pet çš„æ™ºèƒ½åˆçº¦ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬çš„å¥‘çº¦ç»§æ‰¿äº† OpenZeppelin ERC721 åº“ä¸­çš„å‡½æ•°å’Œè¡Œä¸º:

```
contract Pet is ERC721 {}
```

æˆ‘ä»¬å¥‘çº¦çš„å‰©ä½™ä»£ç å°†æ”¾åœ¨èŠ±æ‹¬å·å†…ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬çš„ä»¤ç‰Œï¼Œç»™å®ƒä¸€ä¸ªåç§°å’Œä¸€ä¸ªç¬¦å·ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
contract Pet is ERC721 {
  constructor() ERC721("Pet", "PET") public  {}
}
```

åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ„é€ å‡½æ•°æ¥å®šåˆ¶ä»¤ç‰Œã€‚æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—åƒåå­—â€œå® ç‰©â€å’Œç¬¦å·â€œå® ç‰©â€è¿™æ ·çš„å‚æ•°ã€‚å½“éƒ¨ç½²åå®šæ—¶ï¼Œæ„é€ å‡½æ•°åªè¿è¡Œä¸€æ¬¡ã€‚æ¯å½“åˆ›å»ºæ™ºèƒ½å¥‘çº¦æ—¶ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨ ABI ( [åº”ç”¨äºŒè¿›åˆ¶æ¥å£](https://docs.soliditylang.org/en/latest/abi-spec.html))çš„å¸®åŠ©ä¸‹é€šè¿‡åç§°â€œPetâ€æ¥å¼•ç”¨è¯¥å¥‘çº¦ã€‚

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ OpenZeppelin ERC-721 æ ‡å‡†æ¥åˆ›å»ºä»¤ç‰Œã€‚ERC-721 æ ‡å‡†æ˜¯ä¸€å¥—è§„åˆ™ï¼Œè§„å®šäº†æ™ºèƒ½åˆçº¦åº”è¯¥å…·æœ‰çš„åŠŸèƒ½å’Œè¡Œä¸ºã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯» [OpenZeppelin æ–‡æ¡£](https://docs.openzeppelin.com/contracts/4.x/erc721)ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ·»åŠ  mintPetNFT å‡½æ•°ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬åˆ›å»ºæ–°çš„å® ç‰©ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
pragma solidity ^0.6.0;
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";

contract Pet is ERC721 {
  constructor() ERC721("Pet", "PET") public  {}

   function mintPetNFT(string memory _tokenURI) external {
       uint _tokenId = totalSupply().add(1);
       _safeMint(msg.sender, _tokenId);
       _setTokenURI(_tokenId, _tokenURI);
       emit PetNFTCreated(_tokenId, _tokenURI, now, msg.sender);
    }

 }
```

è¿™æ˜¯å‡½æ•°çš„åŸºæœ¬ç»“æ„ã€‚å®ƒå°†æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ•°æ®ç±»å‹çš„å‚æ•°ï¼Œè¿™å°†æ˜¯ IPFS å›¾åƒçš„è·¯å¾„(å›¾åƒæ‰€åœ¨çš„ä½ç½®)ã€‚tokenId å˜é‡è¢«å£°æ˜ä¸º uint æ•°æ®ç±»å‹ï¼Œè¿™æ„å‘³ç€æ— ç¬¦å·æ•´æ•°(åªèƒ½æ˜¯ 0 æˆ–ä»¥ä¸Šçš„æ•°å­—ï¼Œä¸èƒ½æ˜¯è´Ÿæ•°)ã€‚è¿™ä¸ªå˜é‡ä¸ºæ¯ä¸ªå® ç‰©ä»¤ç‰Œä¿å­˜ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦å·ç ã€‚

`_safeMint`å‡½æ•°è·å–ç”¨æˆ·çš„é’±åŒ…åœ°å€å’Œä»¤ç‰Œ Id æ¥åˆ›å»ºå’Œè®¾ç½® NFT çš„æ‰€æœ‰æƒã€‚`_setTokenURI`å‡½æ•°è·å– tokenId å’Œ tokenURI(å›¾åƒçš„ä½ç½®)å¹¶å°†å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†è®©æ¯ä¸ªä»¤ç‰Œéƒ½æœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ã€ä¸€ä¸ªæ‰€æœ‰è€…å’Œä¸€ä¸ªå›¾åƒè·¯å¾„ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨`emit`å‡½æ•°å¹¶å°†å…¶å‘½åä¸ºâ€œPetNFTCreatedâ€ï¼Œå‘å‡ºä¸€ä¸ªå¸¦æœ‰ tokenIdã€tokenURIã€æ—¶é—´æˆ³å’Œç”¨æˆ·é’±åŒ…åœ°å€çš„äº‹ä»¶ã€‚

æœ€åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ PetNFTCreated äº‹ä»¶ã€‚è¯¥äº‹ä»¶å¯¹äºäº¤æ˜“ç¡®è®¤éå¸¸æœ‰ç”¨ï¼Œæ¯æ¬¡æˆ‘ä»¬åˆ›å»º NFT æ—¶ï¼Œå®ƒéƒ½ä¼šè¿”å› NFT ä»¤ç‰Œ Idã€å›¾åƒè·¯å¾„ã€æ—¶é—´å’Œç”¨æˆ·é’±åŒ…åœ°å€ã€‚

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";

contract Pet is ERC721 {

  constructor() ERC721("Pet", "PET") public  {}
  event PetNFTCreated (

    uint tokenId,
    string imageURL,
    uint date,
    address payable from
  );

  function mintPetNFT(string memory _tokenURI) external {
    uint _tokenId = totalSupply().add(1);
    _safeMint(msg.sender, _tokenId);
    _setTokenURI(_tokenId, _tokenURI);
    emit PetNFTCreated(_tokenId, _tokenURI, now, msg.sender);
  }
}
```

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç¡®ä¿ä¸€åˆ‡å·¥ä½œæ­£å¸¸ã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œç¡®ä¿æ‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­å¹¶è¿è¡Œå‘½ä»¤`truffle compile`ã€‚

![](img/a93819440859fa01c177df4395a8c0fa.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒéƒ¨ç½²åˆ°å¼€å‘æœ¬åœ°åŒºå—é“¾ã€‚é¦–å…ˆï¼Œç¡®ä¿ Ganache æ­£åœ¨è¿è¡Œ(åœ¨å®ƒè‡ªå·±çš„ç»ˆç«¯çª—å£/æ ‡ç­¾ä¸­)ã€‚ç„¶åï¼Œåœ¨`migrations`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`2_deploy_contracts.js`çš„æ–°è¿ç§»æ–‡ä»¶ã€‚

å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°è¿™ä¸ªæ–°æ–‡ä»¶ä¸­:

```
const MyPet = artifacts.require('Pet')
module.exports = function (deployer) {
  deployer.deploy(MyPet)
}
```

è¿™ä¸ªç®€å•çš„ JavaScript æ–‡ä»¶è´Ÿè´£å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œå¹¶é€šè¿‡è¿è¡Œ Truffle è¿ç§»å°†æ™ºèƒ½åˆçº¦æ”¾åœ¨æœ¬åœ°åŒºå—é“¾ä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
truffle migrate 
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼çš„ç»“æœã€‚

![](img/67ca2b6351b73d2c5f77cef8c2bbc25c.png)

# å°†æ™ºèƒ½åˆåŒéƒ¨ç½²åˆ° Polygon Mumbai Testnet

è¦åœ¨ Polygon Mumbai testnet ä¸Šéƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼Œæ‚¨éœ€è¦ä¸ºæ‚¨çš„å¸æˆ·æä¾›èµ„é‡‘ã€‚å¦‚æœä½ éœ€è¦è¿™æ–¹é¢çš„å¸®åŠ©ï¼Œè¯·æŸ¥çœ‹æœ¬[æŒ‡å—](https://learn.figment.io/tutorials/fund-a-polygon-account)ã€‚

è®©æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éƒ¨ç½²æ™ºèƒ½åˆçº¦:

```
truffle migrate --network matic
```

å¦‚æœæ‚¨æ˜¯ç¬¬äºŒæ¬¡æˆ–è€…æ›´å¤šæ¬¡éƒ¨ç½²å®ƒï¼Œä½¿ç”¨`--reset`æ ‡å¿—æ¥é¿å… JSON é”™è¯¯:`truffle migrate --network matic --reset`ã€‚

åªè¦éƒ¨ç½²æˆåŠŸï¼Œè¾“å‡ºåº”è¯¥å·®ä¸å¤š: ![](img/67ca2b6351b73d2c5f77cef8c2bbc25c.png)

# æ„å»º React å‰ç«¯

è·¯å¾„:`/src/components/`

React åº”ç”¨ç¨‹åºç”±å„ç§ç»„ä»¶ç»„æˆï¼Œä¾‹å¦‚ï¼Œå¯¼èˆªæ ã€ä¸»é¡µã€é¡µè„šç­‰ã€‚

React åŠ è½½ä¸€ä¸ªå•ç‹¬çš„ HTML é¡µé¢(`/public/index.html`)ï¼Œç„¶åç”¨é¡¹ç›®ä¸­å®šä¹‰çš„æ‰€æœ‰ç»„ä»¶å¡«å……è¿™ä¸ªé¡µé¢ã€‚å¦‚æœæ‰“å¼€ components æ–‡ä»¶å¤¹ï¼Œæ‚¨å°†çœ‹åˆ°æˆ‘ä»¬é¡¹ç›®çš„ä¸€èˆ¬ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹æ–‡ä»¶å¤¹:

*   `commons/`:åŒ…å«æ¯å½“é¡µé¢åŠ è½½æ—¶éƒ½ä¼šå‘ˆç°çš„ CircularProgress ç»„ä»¶ã€‚
*   è¿™ä¸ªç›®å½•æ˜¯æˆ‘ä»¬æ·»åŠ åˆ›å»ºæ–°å¸–å­çš„åŠŸèƒ½çš„åœ°æ–¹
*   `home-container/`:æœ‰ä¸‰ä¸ªå­æ–‡ä»¶å¤¹
    *   è¿™ä¸ªç›®å½•æ˜¯å›¾åº“(PetGallery)çš„å®¹å™¨ï¼Œå®ƒåŒ…å«äº†æ ‡ç­¾å’ŒæŒ‰é’®çš„ HTMLã€‚
    *   è¿™ä¸ªç›®å½•æ˜¯æˆ‘ä»¬ä¿å­˜ä»£ç çš„åœ°æ–¹ï¼Œè¿™äº›ä»£ç ä¸ä» nft.storage ä¸­è·å–æ‰€æœ‰å® ç‰©å¹¶æ˜¾ç¤ºå®ƒä»¬çš„åŸºæœ¬ä¿¡æ¯æœ‰å…³ã€‚
    *   è¿™ä¸ªç›®å½•åŒ…å«äº†æˆ‘ä»¬å°†ç”¨æ¥æ˜¾ç¤ºå® ç‰©æ‰€æœ‰ä¿¡æ¯çš„ç»„ä»¶ï¼Œä»¥åŠ mint NFTsã€‚

# App.js

è®©æˆ‘ä»¬å¤„ç† React UI çš„ä¸»æ–‡ä»¶:`App.js`å°†åŒ…å«ç»„æˆ React åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ç»„ä»¶(navbarã€mainã€footerã€home ç­‰)ã€‚

å½“æ‚¨æ‰“å¼€`App.js`æ–‡ä»¶æ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ React Router DOM æ¨¡å—åœ¨ web åº”ç”¨ç¨‹åºä¸­å®ç°åŠ¨æ€è·¯ç”±ã€‚ä¸ä¼ ç»Ÿçš„è·¯ç”±æ¶æ„ä¸åŒï¼Œåœ¨ä¼ ç»Ÿçš„è·¯ç”±æ¶æ„ä¸­ï¼Œè·¯ç”±æ˜¯åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¹‹å¤–çš„é…ç½®ä¸­å¤„ç†çš„ï¼ŒReact Router DOM æ ¹æ®åº”ç”¨ç¨‹åºå’Œå¹³å°çš„éœ€æ±‚ä¿ƒè¿›äº†åŸºäºç»„ä»¶çš„è·¯ç”±ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»åˆå§‹åŒ–äº†ä¸€äº›å‡½æ•°ï¼Œç¨åæˆ‘ä»¬å°†å®ç°è¿™äº›å‡½æ•°ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†æˆ‘ä»¬çš„è·¯ç”±ï¼Œæˆ‘ä»¬ç”¨åŒ…å«ç»„ä»¶(ç§°ä¸ºå­ç»„ä»¶)çš„è·¯ç”±å™¨å…ƒç´ åŒ…è£…äº†å®ƒä»¬ã€‚å­ç»„ä»¶å¯ä»¥æ¥å—ä»»ä½•å±æ€§(ç¨åå°†è¯¦ç»†ä»‹ç»)ã€‚

è¯·æ³¨æ„ï¼Œswitch è¯­å¥ä¹‹å¤–çš„ä»»ä½•å†…å®¹éƒ½å°†æ˜¾ç¤ºåœ¨ä¸»é¡µä¸Šï¼ŒReact router çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ¯æ¡è·¯å¾„æä¾›ä¸åŒçš„ç»„ä»¶ã€‚

```
import React from 'react'
import { BrowserRouter as Router, Switch, Route } from 'react-router-dom'
import './App.css'
import { Navbar } from './components/layout/navbar/Navbar'
import Footer from './components/layout/footer/Footer'
import Home from './components/home-container/home/Home'
import PetDetails from './components/home-container/pet-details/PetDetails'
import CreatePet from './components/create-post/CreatePet'

function App() {
  // Add variables

  const loadWeb3 = async () => {}

  const getContract = async () => {}

  const connectWallet = async () => {}

  return (
    <Router>
      <div className="cl">
        <Navbar />
        <Route exact path="/" component={Home} />
        <Switch>
          <Route exact path="/create-pet" component={CreatePet} />
          <Route path="/pet-details/:petId">
            <PetDetails />
          </Route>
        </Switch>
        <Footer />
      </div>
    </Router>
  )
}

export default App
```

æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„ React å‰ç«¯è¿æ¥åˆ°åŒºå—é“¾ç½‘ç»œï¼Œä»¥ä¾¿å®ƒå¯ä»¥ä¸æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚è®©æˆ‘ä»¬ä»ä½¿ç”¨å‘½ä»¤`npm install web3`å®‰è£… web3 å¼€å§‹ã€‚ç„¶åå¯¼å…¥ web3ã€useState å’Œæ™ºèƒ½åˆçº¦çš„ ABI(åœ¨ã€‚json æ ¼å¼):

```
import Web3 from 'web3'
import MyPet from './abis/Pet.json'
import { useState } from 'react'
```

Web3 æ˜¯ä¸€ä¸ªåº“é›†åˆï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨ HTTPã€IPC æˆ– WebSockets ä¸æœ¬åœ°æˆ–è¿œç¨‹ä»¥å¤ªåŠèŠ‚ç‚¹è¿›è¡Œäº¤äº’ã€‚

æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›å˜é‡æ¥è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚åœ¨å‡½æ•°åº”ç”¨ç¨‹åºä¸­ï¼Œåœ¨æ³¨é‡Šâ€œæ·»åŠ å˜é‡â€ä¸‹æ·»åŠ è¿™äº›å˜é‡:

```
const [account, setAccount] = useState('')
const [contractData, setContractData] = useState('')
```

æˆ‘ä»¬ä½¿ç”¨ React useState é’©å­æ¥è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚åœ¨åŠŸèƒ½ç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸ªé’©å­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªçŠ¶æ€ï¼Œè€Œä¸ç”¨åˆ‡æ¢åˆ°å…·æœ‰å†…ç½®çŠ¶æ€å¯¹è±¡çš„ç±»ç»„ä»¶ã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå˜é‡å£°æ˜:

```
const [account, setAccount] = useState('')
```

è¯¥è¯­å¥çš„ç¬¬ä¸€éƒ¨åˆ†(account)æ˜¯ä¸€ä¸ªåˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²çš„å˜é‡ã€‚setAccount æ˜¯ä¸€ä¸ªä¸º Account å˜é‡è®¾ç½®æ–°å€¼çš„å‡½æ•°ã€‚

ç°åœ¨æˆ‘ä»¬éœ€è¦å®ç°`loadWeb3`å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†æŠŠ web3 åŠ è½½åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚ç¼–è¾‘`loadWeb3`å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
const loadWeb3 = async () => {
  if (window.ethereum) {
    window.web3 = new Web3(window.ethereum)
    await window.ethereum.request({ method: 'eth_requestAccounts' })
  } else if (window.web3) {
    window.web3 = new Web3(window.web3.currentProvider)
  } else {
    window.alert(
      'Non-Ethereum browser detected. You should consider trying Metamask!',
    )
  }
}
```

è¿™æ®µä»£ç æ˜¯å¦‚ä½•ä½¿ç”¨`request`å¹¶æŒ‡å®š`eth_requestAccounts`æ–¹æ³•æ­£ç¡®åŠ è½½ web3 çš„ä¾‹å­ã€‚å®ƒä» Metamask è·å–ä»¥å¤ªåŠæä¾›ç¨‹åºå¹¶å°†å…¶æ³¨å…¥åˆ°æ‚¨çš„ dApp ä¸­ï¼Œå¦‚æœæ‚¨çš„æµè§ˆå™¨æ²¡æœ‰å®‰è£… Metamaskï¼Œå®ƒå°†æ˜¾ç¤ºä¸€æ¡å¼¹å‡ºæ¶ˆæ¯:â€œæ£€æµ‹åˆ°éä»¥å¤ªåŠæµè§ˆå™¨ã€‚ä½ åº”è¯¥è€ƒè™‘è¯•è¯• Metamaskï¼â€

è®©æˆ‘ä»¬ç»§ç»­è®¨è®º`getContract`å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æŠŠæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°æ™ºèƒ½åˆçº¦ã€‚ç¼–è¾‘`getContract`å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
const getContract = async () => {
  const web3 = window.web3
  const accounts = await web3.eth.getAccounts()
  setAccount(accounts[0])
  const networkId = await web3.eth.net.getId()
  const networkData = MyPet.networks[networkId]

  if (networkData) {
    const abi = MyPet.abi
    const address = MyPet.networks[networkId].address
    const myContract = new web3.eth.Contract(abi, address)
    setContractData(myContract)
  } else {
    window.alert(
      'Contract is not deployed to the detected network. Connect to the correct network!',
    )
  }
}
```

åœ¨`getContract`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†åŠ è½½è¿æ¥çš„å¸æˆ·&å¹¶å°†å…¶ä¸ç½‘ç»œ ID è¿æ¥ã€‚å¦‚æœæ™ºèƒ½åˆçº¦æœªéƒ¨ç½²åˆ°ç›¸åº”çš„ç½‘ç»œï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼¹å‡ºçª—å£â€œåˆçº¦æœªéƒ¨ç½²åˆ°æ£€æµ‹åˆ°çš„ç½‘ç»œã€‚è¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œï¼â€

æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†è¿æ¥åˆ° web3 å’Œæˆ‘ä»¬çš„å¥‘çº¦çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™äº›å‡½æ•°äº†ã€‚è®©æˆ‘ä»¬åœ¨`connectWallet`å‡½æ•°å†…éƒ¨è°ƒç”¨è¿™äº›å‡½æ•°ã€‚ç¼–è¾‘`connectWallet`å‡½æ•°ï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„:

```
const connectWallet = async () => {
  await loadWeb3()
  await getContract()
}
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†`account`å˜é‡å’Œ`connectWallet`å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ä¼ é€’ç»™æˆ‘ä»¬çš„`Navbar`ç»„ä»¶ã€‚è¯¥ç»„ä»¶å°†ä½¿ç”¨å®ƒä»¬æ¥è¿æ¥åˆ°æˆ‘ä»¬çš„é’±åŒ…ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦åœ¨ Navbar.js æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªâ€œè¿æ¥é’±åŒ…â€æŒ‰é’®ã€‚æˆ‘ä»¬å°†åœ¨ç§»åŠ¨åˆ°å¯¼èˆªæ¡æ—¶å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å°†`account`å˜é‡å’Œ`connectWallet`å‡½æ•°ä½œä¸ºå±æ€§ä¼ é€’ç»™å¯¼èˆªæ¡ã€‚ç¼–è¾‘`Navbar`è·¯çº¿ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
<Navbar account={account} connectWallet={connectWallet} />
```

ç±»ä¼¼åœ°ï¼Œ`PetDetails`ç»„ä»¶éœ€è¦`account`å’Œ`contractData`å˜é‡æ¥ç”Ÿæˆ NFTï¼Œå› æ­¤ç¼–è¾‘`PetDetails`è·¯ç”±ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
<PetDetails account={account} contractData={contractData} />
```

è€¶ï¼ï¼æˆ‘ä»¬å®Œæˆäº† App.js æ–‡ä»¶ï¼Œç°åœ¨æˆ‘ä»¬çš„å‰ç«¯è¿æ¥åˆ°åŒºå—é“¾ã€‚

ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å¼‚æ­¥/ç­‰å¾…ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªå…³äºå¼‚æ­¥/ç­‰å¾…æ¦‚å¿µçš„ç®€çŸ­è§£é‡Šã€‚

*   å¼‚æ­¥:å®ƒåªæ˜¯å…è®¸æˆ‘ä»¬ç¼–å†™åŸºäºæ‰¿è¯ºçš„ä»£ç ï¼Œå°±åƒå®ƒæ˜¯åŒæ­¥çš„ä¸€æ ·ï¼Œå¹¶ä¸”å®ƒæ£€æŸ¥æˆ‘ä»¬æ²¡æœ‰ç ´åæ‰§è¡Œçº¿ç¨‹ã€‚å®ƒé€šè¿‡äº‹ä»¶å¾ªç¯å¼‚æ­¥è¿è¡Œã€‚â€‹â€‹
*   **Await** :å¯ä»¥æ”¾åœ¨ä»»ä½•åŸºäºå¼‚æ­¥æ‰¿è¯ºçš„å‡½æ•°å‰é¢ï¼Œæš‚åœä»£ç ç›´åˆ°æ‰¿è¯ºå®ç°ï¼Œç„¶åè¿”å›ç»“æœå€¼ã€‚æ‚¨å¯ä»¥åœ¨è°ƒç”¨ä»»ä½•è¿”å›æ‰¿è¯ºçš„å‡½æ•°æ—¶ä½¿ç”¨ awaitï¼ŒåŒ…æ‹¬ web API å‡½æ•°ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° Async/Await å‡½æ•°[çš„ç®€å•è§£é‡Šã€‚](https://www.geeksforgeeks.org/async-await-function-in-javascript/)

# navbar.js

*   è·¯å¾„:`src/components/layout/navbar/navbar.js`

åœ¨ Navbar ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æ˜¾ç¤ºå“ç‰Œæ ‡å¿—ã€å“ç‰Œåç§°å’Œåˆ›å»ºæ–°å¸–å­çš„é“¾æ¥ã€‚æˆ‘ä»¬ä½¿ç”¨[æè´¨ UI](https://material-ui.com/) æ¥åˆ›å»ºå¯¼èˆªæ å’Œé¡µè„šç»„ä»¶çš„åŸºæœ¬ç»“æ„ã€‚

è®©æˆ‘ä»¬è½¬ç§»åˆ°é‡è¦çš„ä¸œè¥¿ï¼Œè®°å¾—æˆ‘ä»¬æ­£åœ¨ä¼ é€’ä¸€äº›å±æ€§(å¸æˆ·ï¼Œè¿æ¥é’±åŒ…)åˆ°æˆ‘ä»¬çš„ navbar ç»„ä»¶ï¼Ÿ

è®©æˆ‘ä»¬ç”¨ withRouter åŒ…è£…æ•´ä¸ª Navbar ç»„ä»¶ï¼Œè¿™åº”è¯¥åŒ…æ‹¬æ‰€æœ‰çš„å‡½æ•°ã€å˜é‡å’Œ HTMLã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„ç»„ä»¶ï¼Œä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘åªæ˜¾ç¤ºäº†æˆ‘ä»¬çš„ Navbar ç»„ä»¶çš„å¼€å§‹å’Œç»“æŸã€‚ä½ å¯ä»¥åšçš„æ˜¯ç¼–è¾‘ç¬¬ 22 è¡Œçš„å¼€å§‹éƒ¨åˆ†ï¼Œå¹¶é€šè¿‡æ·»åŠ å³èŠ±æ‹¬å·å’Œåœ†æ‹¬å·æ¥ç¼–è¾‘ç»“å°¾éƒ¨åˆ†ã€‚

è®©æˆ‘ä»¬ç¼–è¾‘æˆ‘ä»¬çš„ Navbar ç»„ä»¶ï¼Œä½¿å®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

```
export const Navbar = withRouter(({ account, connectWallet }) => {
  const [anchorEl, setAnchorEl] = useState(null)
  const [mobileMoreAnchorEl, setMobileMoreAnchorEl] = useState(null)
  // Remember to include all the existing code inside the withRouter
})
```

æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å·²ç»ä»æ–‡ä»¶é¡¶éƒ¨çš„`react-router-dom`å¯¼å…¥çš„ withRouterã€‚withRouter æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒæ¥å—`account`å’Œ`connectWallet`å±æ€§ã€‚æ¯å½“åŒ…è£…çš„ç»„ä»¶å‘ˆç°æ—¶ï¼ŒwithRouter è´Ÿè´£å°†æœ€è¿‘è·¯çº¿çš„åŒ¹é…ã€å½“å‰ä½ç½®å’Œå†å²å±æ€§ä¼ é€’ç»™åŒ…è£…çš„ç»„ä»¶ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå°†æˆ‘ä»¬çš„ç»„ä»¶è¿æ¥åˆ°è·¯ç”±å™¨ï¼Œå¹¶å°†å±æ€§ä¼ é€’ç»™è¿™ä¸ªæ–‡ä»¶ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†é’±åŒ…å¸æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ³¨é‡Šâ€œæ·»åŠ å¸æˆ·â€ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç :

```
{
  account ? (
    <>
      <Button className="whiteLink">
        {account.substring(0, 8)}...{account.substring(32, 24)}
      </Button>
      <Button
        variant="contained"
        className="connected-btn"
        endIcon={<VerifiedUserSharpIcon />}
      >
        Connected
      </Button>
    </>
  ) : (
    <Button
      variant="contained"
      className="connect-wallet-btn"
      onClick={() => {
        connectWallet()
      }}
    >
      Connect Wallet
    </Button>
  )
}
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥å¸æˆ·æ˜¯å¦å­˜åœ¨ï¼Œç„¶åæ˜¾ç¤ºé’±åŒ…åœ°å€ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬æ˜¾ç¤ºæ ‡ç­¾ä¸º`Connect Wallet`çš„æŒ‰é’®ã€‚æ­¤æ—¶ï¼Œæ¯å½“æ‚¨å•å‡»`Connect Wallet`æŒ‰é’®æ—¶ï¼Œå®ƒéƒ½ä¼šæç¤ºæ‚¨è¿æ¥å…ƒæ©ç ï¼Œå¹¶ä¸” UI ä¼šå‘ç”Ÿå˜åŒ–ä»¥åæ˜ è¿æ¥çš„é’±åŒ…ã€‚

![](img/381255410991a787a49a39bac15b1c61.png)

# CreatePet.js æ–‡ä»¶

*   è·¯å¾„:`src/components/create-post/CreatePet.js`

ä¸ºäº†è®©è¿™ä¸ªæ–‡ä»¶å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… nft.storageã€‚

ç„¶åå¯¼å…¥ä»¥ä¸‹ä»£ç :

```
import { NFTStorage, File } from 'nft.storage'
import { createRef } from 'react'
import { apiKey } from '../../APIKEYS'
```

å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¯¼å…¥äº†ä¸€äº›ä¸œè¥¿:

*   `NFTStorage`:æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ¥å£ï¼Œç”¨äºä» web æµè§ˆå™¨æˆ– Node.js ä½¿ç”¨åŸå§‹ HTTP APIã€‚

*   `File`:å…è®¸æˆ‘ä»¬ç”¨å›¾åƒåç§°å’Œç±»å‹åˆ›å»ºæ–°çš„æ–‡ä»¶å¯¹è±¡ã€‚

*   `createRef`:æ¥æ”¶åº•å±‚ DOM å…ƒç´ ä½œä¸ºå…¶å½“å‰å±æ€§ã€‚æ¢å¥è¯è¯´ï¼Œé€šè¿‡ ref å±æ€§ä» React å…ƒç´ åˆ›å»ºå¼•ç”¨ã€‚

*   è¿™æ˜¯æˆ‘ä»¬çš„ apiKey å‡­è¯ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„ dApp å¯ä»¥ä¸ nft.storage API å¯¹è¯ã€‚

è¦è·å– API å¯†é’¥ï¼Œè¯·è®¿é—® [nft.storage](https://nft.storage) ï¼Œæ³¨å†Œä¸€ä¸ªå¸æˆ·ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ API å¯†é’¥ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ° APIKEYS.js æ–‡ä»¶ä¸­ã€‚

![](img/4c015ab0a90392ab61c35e1015a707b2.png)

ä¸è¦å¿˜è®°åœ¨ src ä¸­åˆ›å»º APIKEYS.jsï¼Œå®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/1187aac5ca96bfe0660daa976fdcf3bc.png)

ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„å® ç‰©ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å˜é‡å’Œå‡½æ•°ã€‚è®©æˆ‘ä»¬æ·»åŠ æ‰€æœ‰æ”¶é›†ç”¨æˆ·è¾“å…¥çš„å‡½æ•°ï¼Œå¦‚å® ç‰©åç§°ã€ä¸»äººå§“åã€å›¾åƒç±»å‹ç­‰ã€‚

åœ¨æ³¨é‡Šâ€œæ·»åŠ å˜é‡â€ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚å®ƒåº”è¯¥æ˜¯è¿™æ ·çš„:

```
function CreatePet() {
  // Add variables
  const history = useHistory()
  const [image, setImage] = useState('')
  const petTypeRef = createRef()
  const [petName, setPetName] = useState('')
  const [loading, setLoading] = useState(false)
  const [ownerName, setOwnerName] = useState('')
  const [imageName, setImageName] = useState('')
  const [imageType, setImageType] = useState('')
  const [petType, setPetType] = useState('')
  ...
}
```

æ³¨æ„ï¼Œå‡ ä¹æ¯ä¸ªå˜é‡éƒ½æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²å¼€å§‹çš„ã€‚å½“ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä¿å­˜åˆ°ç»„ä»¶çŠ¶æ€ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬ä¼ é€’ç»™æˆ‘ä»¬çš„ API è°ƒç”¨ï¼Œä»¥å°†å®ƒä»¬å­˜å‚¨åœ¨ IPFSã€‚è®°ä½ï¼Œä¸ºäº†è·Ÿè¸ªçŠ¶æ€ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† useState React é’©å­ã€‚

æˆ‘ä»¬è¿˜éœ€è¦ä¸¤ä¸ªå‡½æ•°:

*   `handleImage`å‡½æ•°å°†è´Ÿè´£ç”¨ç”¨æˆ·è¾“å…¥æ›´æ–°å˜é‡ã€‚æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œä½¿`handleImage`çœ‹èµ·æ¥åƒè¿™æ ·:

```
const handleImage = (event) => {
  setImage(event.target.files[0])
  setImageName(event.target.files[0].name)
  setImageType(event.target.files[0].type)
}
```

å¦‚æ‚¨æ‰€è§ï¼Œ`handleImage`å‡½æ•°æ¥æ”¶ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶å°†ä¿¡æ¯ä¿å­˜åˆ°çŠ¶æ€ä¸­ã€‚

*   è´Ÿè´£é€šè¿‡ nft.storage å°†æ•°æ®ä¸Šä¼ åˆ° IPFS çš„`handleSubmit`å‡½æ•°ã€‚ç¼–è¾‘`handleSubmit`å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
const handleSubmit = async (event) => {
  event.preventDefault()
  try {
    setLoading(true)
    const client = new NFTStorage({ token: apiKey })
    const metadata = await client.store({
      name: petName,
      description: `${ownerName}, ${petType}`,
      image: new File([image], imageName, { type: imageType }),
    })
    if (metadata) {
      history.push('/')
    }
  } catch (error) {
    console.log(error)
    setLoading(false)
  }
}
```

åœ¨`handleSubmit`å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ NFTStorage å®¢æˆ·ç«¯åº“ä¸Šä¼ æˆ‘ä»¬çš„æ•°æ®ã€‚è¿™ä¸ªå®¢æˆ·ç«¯åº“æ¥å—æˆ‘ä»¬çš„ API é”®ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬å°†æ•°æ®æ ¼å¼åŒ–æˆä¸€ä¸ªå¸¦æœ‰åç§°ã€æè¿°å’Œå›¾åƒçš„å¯¹è±¡ã€‚ç„¶åæˆ‘ä»¬æ£€æŸ¥æˆ‘ä»¬çš„æ•°æ®æ˜¯å¦è¢«æˆåŠŸä¿å­˜ï¼Œå®ƒå°†ç”¨æˆ·é‡å®šå‘åˆ°ä¸»é¡µé¢ã€‚å¦åˆ™ï¼Œä¼šå¼•å‘é”™è¯¯æ¶ˆæ¯ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¡¨å•æ¥åˆ›å»ºæ–°å¸–å­ï¼Œè®©æˆ‘ä»¬å°†æ­¤è¡¨å•æ·»åŠ åˆ°è¯„è®ºâ€œæ·»åŠ è¡¨å•â€ä¸‹:

```
{
  image ? (
    <img src={URL.createObjectURL(image)} alt="pet" className="img-preview" />
  ) : (
    ''
  )
}
<div className="form-container">
  <form className="form" noValidate autoComplete="off">
    <input
      accept="image/*"
      className="input"
      id="icon-button-photo"
      defaultValue={image}
      onChange={handleImage}
      type="file"
    />
    <label htmlFor="icon-button-photo">
      <IconButton color="primary" component="span">
        <PhotoCamera />
      </IconButton>
    </label>
    <TextField
      fullWidth
      id="outlined-basic"
      label="Pet's name"
      variant="outlined"
      className="text-field"
      defaultValue={petName}
      onChange={(e) => setPetName(e.target.value)}
    />
    <TextField
      fullWidth
      id="outlined-basic"
      label="Owner's name"
      variant="outlined"
      className="text-field"
      defaultValue={ownerName}
      onChange={(e) => setOwnerName(e.target.value)}
    />
    <TextField
      fullWidth
      name="petType"
      select
      label="Choose one option"
      variant="outlined"
      className="text-field"
      onChange={(e) => setPetType(e.target.value)}
      defaultValue=""
      ref={petTypeRef}
    >
      <MenuItem value="Cat">Cat</MenuItem>
      <MenuItem value="Dog">Dog</MenuItem>
      <MenuItem value="Bird">Bird</MenuItem>
      <MenuItem value="Fish">Fish</MenuItem>
      <MenuItem value="Other">Other</MenuItem>
    </TextField>
    <Button
      size="large"
      variant="contained"
      color="primary"
      onClick={handleSubmit}
    >
      Submit
    </Button>
  </form>
</div>
```

ä¸ºäº†è·å¾—è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬æ­£åœ¨æ·»åŠ ä¸Šä¼ å›¾åƒçš„é¢„è§ˆã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¯´å¦‚æœå›¾åƒå­˜åœ¨ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªå›¾åƒå¹¶æ¸²æŸ“å®ƒï¼Œå¦åˆ™æ˜¾ç¤ºä¸€ä¸ªç©ºç™½ã€‚

ç„¶åï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªç®€å•çš„è¡¨å•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå›¾åƒå­—æ®µã€ä¸¤ä¸ªæ–‡æœ¬å­—æ®µï¼Œåˆ†åˆ«è¡¨ç¤ºä¸»äººå§“åå’Œå® ç‰©åç§°ã€‚ä»¥åŠå® ç‰©ç±»å‹çš„ä¸‹æ‹‰èœå•ã€‚å®ƒä»¬éƒ½ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡å’Œ onChange å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬å°†æäº¤æŒ‰é’®ç»‘å®šåˆ° handleSubmit å‡½æ•°ï¼Œå°†æ•°æ®å‘é€åˆ° nft.storage APIã€‚

ç°åœ¨ï¼Œè¿›å…¥[http://localhost:3000/create-pet](http://localhost:3000/create-pet)å¹¶å°è¯•åˆ›å»ºä¸€ä¸ªæ–°å¸–å­ã€‚åº”è¯¥æ˜¯è¿™æ ·çš„: ![](img/57f4dc19ee545a26d33de4e48164793a.png)

æ­¤å¤–ï¼Œå®ƒåº”è¯¥å‘é€ä¿¡æ¯åˆ° nft.storageã€‚è¦æ£€æŸ¥ï¼Œå»[https://nft.storage/files/](https://nft.storage/files/)å®ƒåº”è¯¥æœ‰ä¸€ä¸ªæ–‡ä»¶: ![](img/8ab81268a795fb5ff898098ca2633aa0.png)

è€¶ï¼ï¼æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºæ–°å¸–å­ï¼Œè®©æˆ‘ä»¬ç§»åŠ¨åˆ°å® ç‰©ç”»å»Šã€‚æ­¤æ—¶ï¼Œå¯ä»¥éšæ„æ·»åŠ ä¸€äº›å¸–å­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨`PetGallery.js`ç»„ä»¶ä¸­æ˜¾ç¤ºå®ƒä»¬ã€‚

# å® ç‰©ç”»å»Š. js

*   è·¯å¾„:`src/components/home-container/gallery/PetGallery.js`

åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†æ¸²æŸ“ä¸€ä¸ªåŒ…å«æ‰€æœ‰ NFT çš„å›¾åº“ã€‚è®©æˆ‘ä»¬ä»å¯¼å…¥æˆ‘ä»¬çš„`apiKey`æ–‡ä»¶å’Œæ¥è‡ª`react-router-dom`çš„`Link`å¼€å§‹ã€‚

```
import { apiKey } from '../../../APIKEYS'
import { Link } from 'react-router-dom'
```

React Router æä¾›äº†ä¸€ä¸ª`Link`ç»„ä»¶ï¼Œç”¨äºåœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­åˆ›å»ºé“¾æ¥ã€‚

ç›®å‰ï¼Œæˆ‘ä»¬çš„å¯¼å…¥åº”è¯¥æ˜¯è¿™æ ·çš„:

```
import React, { useEffect, useState } from 'react'
import CircularStatic from '../../commons/CircularProgressWithLabel'
import ImageListItem from '@material-ui/core/ImageListItem'
import IconButton from '@material-ui/core/IconButton'
import Button from '@material-ui/core/Button'
import ImageListItemBar from '@material-ui/core/ImageListItemBar'
import { Grid } from '@material-ui/core'
import './PetGallery.css'
import { apiKey } from '../../../APIKEYS'
import { Link } from 'react-router-dom'
```

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç»„ä»¶å’Œä¸€äº›æ¥è‡ª material-ui çš„å…ƒç´ ï¼Œä½†æœ€é‡è¦çš„æ˜¯`CircularStatic`ç»„ä»¶ã€‚è¿™ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªå¾ªç¯çš„è¿›åº¦æ¡ï¼Œæ¯å½“æˆ‘ä»¬çš„é¡µé¢åŠ è½½æ—¶éƒ½ä¼šå‘ˆç°ã€‚å…¶ä½™çš„å…ƒç´ åªæ˜¯ HTML æ ‡ç­¾ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºå›¾åº“ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä» IPFS è·å–å® ç‰©çš„æ•°æ®ï¼Œå¹¶å°†å®ƒä»¬æ˜¾ç¤ºåˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚ç¼–è¾‘`useEffect` React é’©å­å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
useEffect(() => {
  const loadPets = async () => {
    try {
      setLoading(true)
      let cids = await fetch('https://api.nft.storage', {
        headers: {
          Authorization: `Bearer ${apiKey}`,
          'Content-Type': 'application/json',
        },
      })
      cids = await cids.json()
      const temp = []
      for (let cid of cids.value) {
        if (cid?.cid) {
          let data = await fetch(
            `https://ipfs.io/ipfs/${cid.cid}/metadata.json`,
          )
          data = await data.json()

          const getImage = (ipfsURL) => {
            if (!ipfsURL) return
            ipfsURL = ipfsURL.split('://')
            return 'https://ipfs.io/ipfs/' + ipfsURL[1]
          }

          data.image = await getImage(data.image)
          data.cid = cid.cid
          data.created = cid.created
          temp.push(data)
        }
      }
      setPetsData(temp)
      setLoading(false)
    } catch (error) {
      console.log(error)
      setLoading(false)
    }
  }
  loadPets()
}, [])
```

æˆ‘ä»¬å£°æ˜ petsData å˜é‡ï¼Œå®ƒè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºæ•°ç»„ï¼Œä»¥åŠ`setPetsData`å‡½æ•°ã€‚æˆ‘ä»¬ç”¨ useEffect React é’©å­æ¥åšè¿™ä»¶äº‹ï¼Œå®ƒå‘Šè¯‰ React æˆ‘ä»¬çš„ç»„ä»¶åœ¨æ¸²æŸ“åéœ€è¦åšä¸€äº›äº‹æƒ…ã€‚

æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ useEffect çš„æœ«å°¾è°ƒç”¨äº†`loadPets`å‡½æ•°ã€‚`loadPets`å‡½æ•°è·å– API å¯†é’¥ï¼Œä» IPFS å­˜å‚¨å™¨ä¸­è·å–å® ç‰©çš„ä¿¡æ¯ï¼Œç„¶åè¿”å›åŒ…å« NFT ä¿¡æ¯çš„å†…å®¹æ ‡è¯†ç¬¦ã€‚æˆ‘ä»¬éå† cids æ•°ç»„ï¼Œæ‰¾åˆ°å®ƒçš„ id å¹¶åˆ›å»ºä¿å­˜ NFT å…ƒæ•°æ®çš„æ•°æ®å˜é‡ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨`getImage`å‡½æ•°ã€‚

æœ€åï¼Œæˆ‘ä»¬éœ€è¦å°†å›¾åƒã€å†…å®¹æ ‡è¯†ç¬¦(CID)å’Œæ—¶é—´æˆ³é™„åŠ åˆ°æ•°æ®å˜é‡ä¸Šã€‚ç„¶åï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾å…¥ä¸€ä¸ªä¸´æ—¶æ•°ç»„ï¼Œæœ€åæˆ‘ä»¬æŠŠå®ƒè®¾ç½®ä¸ºçŠ¶æ€å˜é‡ petsDataã€‚

å‡½æ•°`getImage`è·å– URL è·¯å¾„ï¼Œå¹¶ç”¨å­—ç¬¦â€œ://â€å°†å…¶æ‹†åˆ†ã€‚Split æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªå…ƒç´ æ•°ç»„ã€‚ç„¶åï¼Œ`getImage`é€šè¿‡æ·»åŠ æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ è¿”å›æ­£ç¡®çš„è·¯å¾„ã€‚æˆ‘ä»¬éœ€è¦è¿™æ ·åšï¼Œå› ä¸º IPFS URL ä¸ä¿ç•™åŸå§‹è·¯å¾„ï¼Œè€Œæ˜¯éœ€è¦ä¸€ä¸ªåˆ°/ä» URI è¡¨ç¤ºçš„è½¬æ¢æ­¥éª¤ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ [IPFS æ–‡æ¡£](https://docs.ipfs.io/how-to/address-ipfs-on-web/#native-urls)ã€‚

æ³¨æ„:CIDs å¼•ç”¨ä¸å¯å˜çš„å†…å®¹ï¼Œå› æ­¤æ‚¨å¯ä»¥ç¡®ä¿æ‚¨è®¿é—®çš„å†…å®¹æ˜¯ NFT ä¸­å¼•ç”¨çš„å†…å®¹ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¸²æŸ“è¿™äº›æ•°æ®ã€‚åœ¨æ³¨é‡Šâ€œæ·»åŠ å® ç‰©çš„æ•°æ®â€ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç :

```
{
  loading ? (
    <CircularStatic />
  ) : (
    <div style={{ flexGrow: 1 }}>
      <Grid container spacing={1}>
        {petsData.length ? (
          petsData.map((pet, index) => (
            <Grid item xs={6} sm={3} key={index}>
              <ImageListItem style={{ height: '450px', listStyle: 'none' }}>
                <img src={pet.image} alt={pet.name} />
                <ImageListItemBar
                  title={pet.name}
                  subtitle={<span>by: {pet.description}</span>}
                  actionIcon={
                    <IconButton
                      aria-label={`info about ${pet.name}`}
                      className="icon"
                    >
                      <Button
                        variant="contained"
                        size="small"
                        component={Link}
                        to={`/pet-details/${pet.cid}`}
                        className="view-btn"
                      >
                        View
                      </Button>
                    </IconButton>
                  }
                />
              </ImageListItem>
            </Grid>
          ))
        ) : (
          <h2>No Pets Yet...</h2>
        )}
      </Grid>
    </div>
  )
}
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ loading æ˜¯å¦ä¸ºçœŸï¼Œç„¶åæˆ‘ä»¬å°†æ˜¾ç¤º loading ç»„ä»¶ã€‚å¦‚æœ loading ä¸º falseï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ‹¥æœ‰ petsData æ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾ªç¯éå† petsData å¹¶è¿”å›ä¸€ä¸ªåŒ…å«å® ç‰©å›¾åƒã€åç§°å’ŒæŒ‰é’®çš„é¡¹ç›®åˆ—è¡¨ï¼Œä»¥æŸ¥çœ‹æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

å¦‚æœ`petsData`æ•°ç»„ä¸ºç©ºï¼Œå®ƒå°†æ˜¾ç¤ºâ€œè¿˜æ²¡æœ‰å® ç‰©â€¦â€¦â€ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ petsData æ•°ç»„ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå® ç‰©ã€‚éšæ„æ·»åŠ æ›´å¤šï¼Œè¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„ç”»å»Šã€‚

![](img/bcd57ff4def3b07e497046d433b14146.png)

# PetDetails.js

*   è·¯å¾„:`src/components/home-container/pet-details/PetDetails.js`

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ å® ç‰©è¯¦ç»†ä¿¡æ¯ã€åˆ›å»º NFT çš„åŠŸèƒ½ã€åˆ›å»ºä»¤ç‰Œçš„äº¤æ˜“ç¡®è®¤ï¼Œä»¥åŠæ·»åŠ è¯„è®ºçš„ç®€å• React è¡¨å•ã€‚å°±æœ¬æ•™ç¨‹çš„èŒƒå›´è€Œè¨€ï¼Œæˆ‘ä»¬ä¸æ‰“ç®—ä¿å­˜è¯„è®ºæˆ–å®ç° likes åŠŸèƒ½ï¼Œä½†å¯ä»¥éšæ„æ‰©å±•ã€‚

è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ä¸œè¥¿ã€‚è®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸‹é¢ä¸€è¡Œæ¥å¯¼å…¥æˆ‘ä»¬çš„`apiKey`:

```
import { apiKey } from '../../../APIKEYS'
```

ç›®å‰ï¼Œæˆ‘ä»¬çš„å¯¼å…¥åº”è¯¥æ˜¯è¿™æ ·çš„:

```
import React, { useState, useEffect } from 'react'
import { useParams } from 'react-router'
import FavoriteIcon from '@material-ui/icons/Favorite'
import ShareIcon from '@material-ui/icons/Share'
import {
  TextField,
  List,
  ListItem,
  ListItemAvatar,
  ListItemText,
  Avatar,
  IconButton,
  Grid,
  Container,
  Typography,
  Button,
  Card,
  StylesProvider,
} from '@material-ui/core'
import './PetDetails.css'
import { apiKey } from '../../../APIKEYS'
...
```

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨ useState å’Œ useEffect - React é’©å­æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚

useState å…è®¸æˆ‘ä»¬çš„åŠŸèƒ½ç»„ä»¶å˜å¾—æœ‰çŠ¶æ€ï¼ŒuseEffect å…è®¸æˆ‘ä»¬çš„åŠŸèƒ½ç»„ä»¶åˆ©ç”¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼Œè¿™åœ¨è¿‡å»åªæ”¯æŒç±»ç»„ä»¶ã€‚ç®€å•æ¥è¯´ï¼ŒuseEffect å°±åƒ componentDidMountã€componentDidUpdate å’Œ componentWillUnmount çš„ç»„åˆã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å…³äº [React é’©å­](https://reactjs.org/docs/hooks-effect.html)çš„æ–‡æ¡£ã€‚

æˆ‘ä»¬ä½¿ç”¨`useParams`æ¥è®¿é—®å½“å‰è·¯çº¿çš„å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å® ç‰© id æ¥ä» IPFS è·å–å® ç‰©çš„æ•°æ®ã€‚

`StylesProvider`æ˜¯ä¸€ä¸ª Material-UI ç»„ä»¶ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬æ”¹å˜æ ·å¼åº”ç”¨äºç»„ä»¶çš„æ–¹å¼ã€‚å…¶ä½™çš„å¯¼å…¥åªæ˜¯ Material-UI ä¸­çš„å¸¸è§„å…ƒç´ 

æˆ‘ä»¬éœ€è¦ä¸€äº›å˜é‡æ¥ä¿å­˜å® ç‰©çš„ä¿¡æ¯ã€‚åœ¨æ³¨é‡Šâ€œæ·»åŠ çŠ¶æ€å˜é‡â€ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç :

```
const [image, setPetImage] = useState('')
const [petName, setPetName] = useState('')
const [petOwner, setOwnerName] = useState('')
const [petCategory, setPetCategory] = useState('')
const [input, setInput] = useState('')
const [comment, setComment] = useState('')
const [codeHash, setCodeHash] = useState('')
```

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„çŠ¶æ€å˜é‡åº”è¯¥æ˜¯è¿™æ ·çš„:

```
const { petId } = useParams()
// Add state variables
const [image, setPetImage] = useState('')
const [petName, setPetName] = useState('')
const [petOwner, setOwnerName] = useState('')
const [petCategory, setPetCategory] = useState('')
const [input, setInput] = useState('')
const [comment, setComment] = useState('')
const [codeHash, setCodeHash] = useState('')
```

`{ petId }`æ­£åœ¨ä» useParams å¯¹è±¡ä¸­æå– petId å€¼ã€‚è‡³äºå…¶ä½™çš„å˜é‡ï¼Œå®ƒä»¬éƒ½è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚ç¨åï¼Œæˆ‘ä»¬å°†æ›´æ–°å®ƒä»¬ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è®¨è®º useEffect å‡½æ•°ã€‚ç›®å‰æˆ‘ä»¬çš„æƒ…å†µæ˜¯è¿™æ ·çš„:

```
useEffect(() => {
  if (petId) {
    getMetadata()
    getImage()
  }
}, [petId, contractData])
```

å¦‚ä½ æ‰€è§ï¼Œ`useEffect`å‡½æ•°æ­£åœ¨è°ƒç”¨`getImage`å’Œ`getMetadata`å‡½æ•°ã€‚è®©æˆ‘ä»¬é¦–å…ˆå®ç°`getImage`å‡½æ•°ï¼Œç¼–è¾‘è¿™ä¸ªå‡½æ•°ï¼Œä½¿å®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

```
const getImage = (ipfsURL) => {
  if (!ipfsURL) return
  ipfsURL = ipfsURL.split('://')
  return 'https://ipfs.io/ipfs/' + ipfsURL[1]
}
```

å¦‚æœæ‚¨è®°å¾—æˆ‘ä»¬åœ¨`PetGallery`ç»„ä»¶ä¸­ä½¿ç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€æ®µä»£ç å¹¶å¯¼å…¥å®ƒï¼Œä½†æ˜¯ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œè®©æˆ‘ä»¬ä¿æŒç®€å•ã€‚

è®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨`getMetadata`å‡½æ•°ã€‚ç¼–è¾‘è¯¥å‡½æ•°ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒè¿™æ ·:

```
const getMetadata = async () => {
  let data = await fetch(`https://ipfs.io/ipfs/${petId}/metadata.json`)
  data = await data.json()
  const [petOwner, petCategory] = data.description.split(',')
  const imageFormated = getImage(data.image)
  setPetImage(imageFormated)
  setPetName(data.name)
  setOwnerName(petOwner)
  setPetCategory(petCategory)
}
```

`getMetadata`å‡½æ•°è´Ÿè´£ä» IPFS è·å–ç‰¹å®šå® ç‰©çš„å…ƒæ•°æ®ã€‚å®ƒé€šè¿‡æä¾› petId æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œç„¶åè¿›è¡Œ API è°ƒç”¨ï¼Œå¹¶è¿”å›å® ç‰©çš„æ•°æ®ã€‚åœ¨ä¿å­˜`petOwner`å’Œ`petCategory`å˜é‡ä¹‹å‰ï¼Œå®ƒé€šè¿‡ç”¨é€—å·åˆ†å‰²æ•°æ®ä»`data.description`ä¸­æå–å®ƒä»¬ã€‚ç„¶åè°ƒç”¨`getImage`å‡½æ•°æ¥æ­£ç¡®æ ¼å¼åŒ–å›¾åƒè·¯å¾„ï¼Œæœ€åå°†å®ƒä»¬ä¿å­˜åˆ°ç›¸åº”çš„å˜é‡ä¸­ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºå® ç‰©çš„ç»†èŠ‚ï¼Œä½†æˆ‘ä»¬å°†éœ€è¦`mintNFT`åŠŸèƒ½ã€‚è®©æˆ‘ä»¬ç°åœ¨æ·»åŠ å®ƒï¼Œç¼–è¾‘è¿™ä¸ªå‡½æ•°ï¼Œä½¿å®ƒçœ‹èµ·æ¥åƒè¿™æ ·:

```
const mintNFT = async (petId) => {
  try {
    const data = await contractData.methods
      .mintPetNFT(`https://${petId}`)
      .send({ from: account })

    setCodeHash(data)
  } catch (err) {
    console.error(err)
  }
}
```

å¦‚æ‚¨æ‰€è§ï¼ŒPetDetails ç»„ä»¶æ­£åœ¨ä¸º account å’Œ contractData è·å–ä¸€äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬ä¸æ™ºèƒ½åˆåŒè¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è°ƒç”¨`mintPetNFT`å¥‘çº¦æ–¹æ³•ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ petIdï¼Œç”¨ pet id å’Œç”¨æˆ·å¸æˆ·è°ƒç”¨å¥‘çº¦çš„`mintPetNFT`æ–¹æ³•ï¼Œç„¶åä½¿ç”¨ setCodeHash å‡½æ•°å°†è¿”å›çš„æ•°æ®ä¿å­˜åˆ°ç»„ä»¶çŠ¶æ€ã€‚

å‰å®³ï¼ç°åœ¨æˆ‘ä»¬åªéœ€è¦æ˜¾ç¤ºè¿™äº›ä¿¡æ¯ã€‚è®©æˆ‘ä»¬å°†æ­¤ä»£ç æ·»åŠ åˆ°â€œæ·»åŠ å® ç‰©è¯¦ç»†ä¿¡æ¯â€éƒ¨åˆ†:

```
<div className="flex-container">
  <h2>{`${petName} the ${petCategory}`}</h2>
  <Button
    variant="contained"
    className="wallet-btn"
    color="primary"
    onClick={mintNFT}
  >
    Mint NFT
  </Button>
</div>

<img className="img" src={image} alt="pet" />
<div className="flex-container">
  <div>
    <IconButton aria-label="add to favorites">
      <FavoriteIcon />
    </IconButton>

    <IconButton aria-label="share">
      <ShareIcon />
    </IconButton>
  </div>

  <Typography variant="body1" color="primary">
    0 Likes
  </Typography>
</div>

<Typography gutterBottom variant="subtitle1" className="details-text">
  Pet's Details
</Typography>

<Typography variant="body2" gutterBottom className="details-text">
  Full rights and credits to the owner @{petOwner}...
</Typography>
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°æ’å…¥äº†ä» IPFS é‚£é‡Œå¾—åˆ°çš„å® ç‰©ç»†èŠ‚ã€‚æ³¨æ„â€œè–„è· NFTâ€æŒ‰é’®è¿æ¥åˆ°`mintNFT`åŠŸèƒ½ã€‚è¿™ä¸ªå‡½æ•°å°†ä¸ºæˆ‘ä»¬åˆ›å»º NFTã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„ç»„ä»¶åº”è¯¥æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹:

![](img/f152497ffe825d69ff5d39055b513586.png)

æˆ‘ä»¬ä»ç„¶ç¼ºå°‘é“¸é€ ä»¤ç‰Œçš„äº‹åŠ¡ç¡®è®¤ï¼Œå³æ·»åŠ æ³¨é‡Šçš„ React è¡¨å•ã€‚è®©æˆ‘ä»¬ä»æ·»åŠ äº¤æ˜“ç¡®è®¤å¼€å§‹ã€‚æ¯å½“æˆ‘ä»¬é“¸é€  NFTSï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¡®è®¤ï¼Œé€šçŸ¥æˆ‘ä»¬ï¼Œå¦‚æœæˆ‘ä»¬çš„äº¤æ˜“æˆåŠŸä¸å¦ã€‚è®©æˆ‘ä»¬åœ¨â€œæ·»åŠ äº¤æ˜“ç¡®è®¤â€éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹ä»£ç :

```
{
  codeHash ? (
    <Card className="code-hash">
      <Typography gutterBottom variant="subtitle1">
        Confirmation Transaction:
      </Typography>
      <p>
        TransactionHash: <span>{codeHash.transactionHash}</span>{' '}
      </p>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href={'https://mumbai.polygonscan.com/tx/' + codeHash.transactionHash}
      >
        <Button variant="contained" color="primary" className="wallet-btn">
          See transaction
        </Button>
      </a>
    </Card>
  ) : (
    ''
  )
}
```

è¿˜è®°å¾—æˆ‘ä»¬çš„`mintPetNFT`å‡½æ•°å—ï¼Ÿè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡æ•°æ®ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æ˜¯äº‹åŠ¡å“ˆå¸Œã€‚äº‹åŠ¡å“ˆå¸Œæ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œå®ƒè¢«èµ‹äºˆæ¯ä¸ªç»è¿‡éªŒè¯å¹¶æ·»åŠ åˆ°åŒºå—é“¾çš„äº‹åŠ¡ã€‚è¦æŸ¥çœ‹è¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ·»åŠ  Polygonscan é“¾æ¥å’Œ`transactionHash`ã€‚

ç°åœ¨ï¼Œç‚¹å‡»â€œé“¸é€  NFTâ€æŒ‰é’®ï¼Œå°è¯•é“¸é€  NFTã€‚ç‚¹å‡»ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„é’±åŒ…å·²è¿æ¥ã€‚ä¸€æ—¦ä½ ç‚¹å‡»â€œè–„è· NFTâ€æŒ‰é’® metamask åº”è¯¥æç¤ºï¼Œç»§ç»­å¹¶ç¡®è®¤äº¤æ˜“ã€‚

æ­¤äº¤æ˜“å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼Œè¿‡ç¨‹å¦‚ä¸‹:

1.  ç¡®è®¤äº¤æ˜“
2.  äº‹åŠ¡è¿›å…¥é˜Ÿåˆ—
3.  äº¤æ˜“å¾…å®š
4.  äº¤æ˜“å®Œæˆäº†

![](img/2afaa44ed2905b441bb86086e7bfd385.png)

![](img/c0389a86ad4f433024e2002511636e84.png)

ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬é“¸é€ ä¸€æš NFT å¸æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°è¿™ä¸€ç¡®è®¤ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨ Polygonscan ä¸ŠæŸ¥çœ‹äº¤æ˜“ç»†èŠ‚ã€‚

å¤ªæ£’äº†ï¼Œæˆ‘ä»¬åˆ°æœ€åä¸€éƒ¨åˆ†äº†ï¼è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ•™ç¨‹ï¼Œä½†æˆ‘ä»¬å­¦åˆ°äº†å¾ˆå¤šã€‚è®©æˆ‘ä»¬æ·»åŠ æœ€åä¸€éƒ¨åˆ†ï¼Œå³ååº”å½¢å¼ã€‚åœ¨æ³¨é‡Šâ€œæ·»åŠ è¡¨å•â€ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç :

```
<form noValidate autoComplete="off">
  <TextField
    id="outlined-basic"
    label="Comment"
    variant="outlined"
    value={input}
    onChange={handleChange}
    className="text-field"
  />
</form>
<Button type="submit" variant="contained" onClick={handleSubmit}>
  Add comment
</Button>
```

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ·»åŠ è¯„è®ºçš„è¡¨å•ã€‚æ³¨æ„ï¼Œæ–‡æœ¬å­—æ®µéœ€è¦`handleChange`å‡½æ•°ï¼Œæäº¤æŒ‰é’®éœ€è¦`handleSubmit`å‡½æ•°ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¹Ÿæ·»åŠ å®ƒä»¬ã€‚ç¼–è¾‘è¿™äº›å‡½æ•°ï¼Œä½¿å…¶å¦‚ä¸‹æ‰€ç¤º:

```
const handleChange = (event) => {
  setInput(event.target.value)
}

const handleSubmit = (event) => {
  event.preventDefault()
  setComment(input)
  setInput('')
}
```

`handleChange`åŠŸèƒ½å°†ç”¨æˆ·è¾“å…¥è®¾ç½®åˆ°`input variable`ã€‚ç„¶å`handleSubmit`å‡½æ•°å°†`comment variable`è®¾ç½®ä¸ºç­‰äº`input variable`ï¼Œç„¶åå°†è¾“å…¥å˜é‡é‡ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ä½¿ç”¨`input variable`ä½œä¸ºä¸´æ—¶å˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é‡ç½®è¡¨å•æ–‡æœ¬å­—æ®µã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè¯„è®ºã€‚ä¸ºæ­¤ï¼Œåœ¨â€œæ˜¾ç¤ºæ³¨é‡Šâ€éƒ¨åˆ†ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç :

```
{
  comment ? (
    <ListItem style={{ paddingLeft: '0px' }}>
      <ListItemAvatar>
        <Avatar alt="Remy Sharp" />
      </ListItemAvatar>
      <ListItemText
        secondary={
          <React.Fragment>
            <Typography
              component="span"
              variant="body2"
              className="inline"
              color="textPrimary"
            >
              {account}:
            </Typography>
            {` ${comment}`}
          </React.Fragment>
        }
      />
    </ListItem>
  ) : (
    <h2>No comments</h2>
  )
}
```

æˆ‘ä»¬å°†ç”¨æˆ·çš„å¸æˆ·å’Œè¯„è®ºæ·»åŠ åˆ° UI ä¸­ã€‚å°è¯•å‘å¸ƒä¸€æ¡è¯„è®ºï¼Œç»“æœåº”è¯¥ç±»ä¼¼äºä»¥ä¸‹å†…å®¹:

![](img/47bb20375835b8fae534dee0c7ee4104.png)

è¯·è®°ä½ï¼Œæˆ‘ä»¬ä¸ä¼šä¿å­˜è¯„è®ºï¼Œæ‰€ä»¥åªè¦æ‚¨åˆ·æ–°é¡µé¢ï¼Œè¯„è®ºå°±ä¼šæ¶ˆå¤±ã€‚

# ç»“è®º

æ­å–œä½ ï¼æ‚¨å·²ç»åˆ›å»ºäº†è‡ªå·±çš„ fullstack dApp <g-emoji class="g-emoji" alias="sunglasses" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f60e.png">ğŸ˜</g-emoji> <g-emoji class="g-emoji" alias="unicorn" fallback-src="https://github.githubassets.cimg/icons/emoji/unicode/1f984.png">ğŸ¦„</g-emoji>ï¼ï¼å®Œæˆæœ¬æ•™ç¨‹åï¼Œæ‚¨åº”è¯¥å¯¹å¦‚ä½•åˆ›å»ºç”¨äºåˆ›å»ºå’Œç®¡ç† NFT çš„ dApp æœ‰äº†å¾ˆå¥½çš„ç†è§£ã€‚

# å…³äºä½œè€…

è‰¾ä¼¯ç‰¹Â·å¡å·´è´¾å°”æ˜¯ä¸€å web å¼€å‘äººå‘˜ï¼ŒåŒºå—é“¾çš„ç‹‚çƒ­çˆ±å¥½è€…ï¼Œå¯¹è½¯ä»¶å¼€å‘å’Œå»ä¸­å¿ƒåŒ–å……æ»¡çƒ­æƒ…ã€‚è¯·éšæ—¶åœ¨ [GitHub](https://github.com/electrone901) ä¸Šä¸æˆ‘è”ç³»ã€‚

# å‚è€ƒ

*   å—èŒæ–‡ä»¶:[https://www.trufflesuite.com/docs/truffle/overview](https://www.trufflesuite.com/docs/truffle/overview)
*   å¤šè¾¹å½¢(Matic)æ–‡æ¡£:[https://docs . Matic . network/docs/develop/getting-started](https://docs.matic.network/docs/develop/getting-started)
*   å…ƒæ©æ¨¡æ–‡ä»¶:[https://docs.metamask.io/guide/#why-metamask](https://docs.metamask.io/guide/#why-metamask)
*   Web3 docs: [https://web3js.readthedocs.io/en/v1.4.0/](https://web3js.readthedocs.io/en/v1.4.0/)
*   ååº”æ–‡ä»¶:[https://reactjs.org/docs/getting-started.html](https://reactjs.org/docs/getting-started.html)
*   IPFS æ–‡æ¡£:[https://docs . ipfs . io/concepts/what-is-ipfs/#å»ä¸­å¿ƒåŒ–](https://docs.ipfs.io/concepts/what-is-ipfs/#decentralization)
*   async/Await:[https://www . geeks forgeeks . org/async-Await-function-in-JavaScript](https://www.geeksforgeeks.org/async-await-function-in-javascript)
*   æè´¨-ui ç»„ä»¶:[https://material-ui.com](https://material-ui.com)
*   ååº”é’©å­:[https://reactjs.org/docs/hooks-effect.html](https://reactjs.org/docs/hooks-effect.html)